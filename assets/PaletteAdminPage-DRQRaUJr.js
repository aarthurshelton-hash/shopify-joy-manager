const e='import React, { useState, useEffect } from \'react\';\nimport { useNavigate } from \'react-router-dom\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { colorPalettes, PaletteId, PieceType } from \'@/lib/chess/pieceColors\';\nimport { \n  isUserAdmin, \n  getPaletteOverrides, \n  savePaletteOverride, \n  deletePaletteOverride,\n  countLinkedVisualizations,\n  PaletteOverride \n} from \'@/lib/admin/paletteAdmin\';\nimport { Button } from \'@/components/ui/button\';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Input } from \'@/components/ui/input\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { \n  Dialog, \n  DialogContent, \n  DialogDescription, \n  DialogHeader, \n  DialogTitle \n} from \'@/components/ui/dialog\';\nimport { toast } from \'sonner\';\nimport { \n  Shield, \n  Palette, \n  Save, \n  RotateCcw, \n  Loader2, \n  Check, \n  AlertTriangle,\n  Eye,\n  Users\n} from \'lucide-react\';\n\nconst PIECE_TYPES: PieceType[] = [\'k\', \'q\', \'r\', \'b\', \'n\', \'p\'];\nconst PIECE_NAMES: Record<PieceType, string> = {\n  k: \'King\', q: \'Queen\', r: \'Rook\', b: \'Bishop\', n: \'Knight\', p: \'Pawn\'\n};\n\nconst PaletteAdminPage: React.FC = () => {\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  \n  const [isAdmin, setIsAdmin] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [overrides, setOverrides] = useState<PaletteOverride[]>([]);\n  const [selectedPalette, setSelectedPalette] = useState<PaletteId | null>(null);\n  const [editColors, setEditColors] = useState<{\n    white: Record<PieceType, string>;\n    black: Record<PieceType, string>;\n  } | null>(null);\n  const [linkedCounts, setLinkedCounts] = useState<Record<string, number>>({});\n  const [isSaving, setIsSaving] = useState(false);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  \n  // Check admin status\n  useEffect(() => {\n    const checkAdmin = async () => {\n      if (!user) {\n        navigate(\'/\');\n        return;\n      }\n      \n      const adminStatus = await isUserAdmin(user.id);\n      if (!adminStatus) {\n        toast.error(\'Access denied\', { description: \'Admin privileges required\' });\n        navigate(\'/\');\n        return;\n      }\n      \n      setIsAdmin(true);\n      await loadData();\n      setIsLoading(false);\n    };\n    \n    checkAdmin();\n  }, [user, navigate]);\n  \n  const loadData = async () => {\n    const { data } = await getPaletteOverrides();\n    setOverrides(data);\n    \n    // Load linked visualization counts\n    const counts: Record<string, number> = {};\n    for (const palette of colorPalettes.filter(p => p.id !== \'custom\')) {\n      counts[palette.id] = await countLinkedVisualizations(palette.id);\n    }\n    setLinkedCounts(counts);\n  };\n  \n  const handleSelectPalette = (paletteId: PaletteId) => {\n    const palette = colorPalettes.find(p => p.id === paletteId);\n    if (!palette) return;\n    \n    // Check if there\'s an override\n    const override = overrides.find(o => o.palette_id === paletteId);\n    \n    setSelectedPalette(paletteId);\n    setEditColors({\n      white: override?.white_colors || { ...palette.white },\n      black: override?.black_colors || { ...palette.black },\n    });\n  };\n  \n  const handleColorChange = (side: \'white\' | \'black\', piece: PieceType, color: string) => {\n    if (!editColors) return;\n    \n    setEditColors({\n      ...editColors,\n      [side]: {\n        ...editColors[side],\n        [piece]: color,\n      },\n    });\n  };\n  \n  const handleSave = async () => {\n    if (!selectedPalette || !editColors || !user) return;\n    \n    const linkedCount = linkedCounts[selectedPalette] || 0;\n    if (linkedCount > 0) {\n      setShowConfirmDialog(true);\n      return;\n    }\n    \n    await performSave();\n  };\n  \n  const performSave = async () => {\n    if (!selectedPalette || !editColors || !user) return;\n    \n    setIsSaving(true);\n    setShowConfirmDialog(false);\n    \n    const { error, version } = await savePaletteOverride(\n      selectedPalette,\n      editColors.white,\n      editColors.black,\n      user.id\n    );\n    \n    if (error) {\n      toast.error(\'Failed to save\', { description: error.message });\n    } else {\n      toast.success(\'Palette updated!\', { \n        description: `Version ${version} saved. ${linkedCounts[selectedPalette] || 0} visualizations will use the new colors.` \n      });\n      await loadData();\n    }\n    \n    setIsSaving(false);\n  };\n  \n  const handleRevert = async () => {\n    if (!selectedPalette) return;\n    \n    setIsSaving(true);\n    const { error } = await deletePaletteOverride(selectedPalette);\n    \n    if (error) {\n      toast.error(\'Failed to revert\', { description: error.message });\n    } else {\n      toast.success(\'Reverted to defaults\');\n      handleSelectPalette(selectedPalette);\n      await loadData();\n    }\n    \n    setIsSaving(false);\n  };\n  \n  const getOriginalPalette = (paletteId: PaletteId) => {\n    return colorPalettes.find(p => p.id === paletteId);\n  };\n  \n  const hasOverride = (paletteId: string) => {\n    return overrides.some(o => o.palette_id === paletteId);\n  };\n  \n  if (isLoading) {\n    return (\n      <div className="min-h-screen bg-background flex items-center justify-center">\n        <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />\n      </div>\n    );\n  }\n  \n  if (!isAdmin) return null;\n  \n  return (\n    <div className="min-h-screen bg-background">\n      <div className="container max-w-6xl py-8">\n        {/* Header */}\n        <div className="flex items-center gap-3 mb-8">\n          <div className="p-2 rounded-lg bg-primary/10">\n            <Shield className="h-6 w-6 text-primary" />\n          </div>\n          <div>\n            <h1 className="text-2xl font-bold">Palette Administration</h1>\n            <p className="text-muted-foreground text-sm">\n              Modify featured palette colors. Changes propagate to all linked visualizations.\n            </p>\n          </div>\n        </div>\n        \n        <div className="grid md:grid-cols-3 gap-6">\n          {/* Palette List */}\n          <div className="space-y-3">\n            <h2 className="font-semibold text-sm text-muted-foreground uppercase tracking-wide">\n              Featured Palettes\n            </h2>\n            {colorPalettes.filter(p => p.id !== \'custom\').map(palette => (\n              <Card \n                key={palette.id}\n                className={`cursor-pointer transition-all hover:border-primary/50 ${\n                  selectedPalette === palette.id ? \'border-primary ring-1 ring-primary/20\' : \'\'\n                }`}\n                onClick={() => handleSelectPalette(palette.id)}\n              >\n                <CardContent className="p-3">\n                  <div className="flex items-center justify-between mb-2">\n                    <span className="font-medium text-sm">{palette.name}</span>\n                    <div className="flex items-center gap-1.5">\n                      {hasOverride(palette.id) && (\n                        <Badge variant="secondary" className="text-[10px] px-1.5 py-0">\n                          Modified\n                        </Badge>\n                      )}\n                      {linkedCounts[palette.id] > 0 && (\n                        <Badge variant="outline" className="text-[10px] px-1.5 py-0 gap-1">\n                          <Users className="h-2.5 w-2.5" />\n                          {linkedCounts[palette.id]}\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  <div className="flex gap-0.5">\n                    {PIECE_TYPES.map(pt => (\n                      <div \n                        key={`w-${pt}`}\n                        className="w-4 h-4 rounded-sm"\n                        style={{ backgroundColor: palette.white[pt] }}\n                      />\n                    ))}\n                    {PIECE_TYPES.map(pt => (\n                      <div \n                        key={`b-${pt}`}\n                        className="w-4 h-4 rounded-sm"\n                        style={{ backgroundColor: palette.black[pt] }}\n                      />\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n          \n          {/* Editor */}\n          <div className="md:col-span-2">\n            {selectedPalette && editColors ? (\n              <Card>\n                <CardHeader>\n                  <div className="flex items-center justify-between">\n                    <div>\n                      <CardTitle className="flex items-center gap-2">\n                        <Palette className="h-5 w-5" />\n                        {getOriginalPalette(selectedPalette)?.name}\n                      </CardTitle>\n                      <CardDescription>\n                        {getOriginalPalette(selectedPalette)?.description}\n                      </CardDescription>\n                    </div>\n                    <div className="flex gap-2">\n                      {hasOverride(selectedPalette) && (\n                        <Button \n                          variant="outline" \n                          size="sm" \n                          onClick={handleRevert}\n                          disabled={isSaving}\n                        >\n                          <RotateCcw className="h-4 w-4 mr-1" />\n                          Revert\n                        </Button>\n                      )}\n                      <Button \n                        size="sm" \n                        onClick={handleSave}\n                        disabled={isSaving}\n                      >\n                        {isSaving ? (\n                          <Loader2 className="h-4 w-4 mr-1 animate-spin" />\n                        ) : (\n                          <Save className="h-4 w-4 mr-1" />\n                        )}\n                        Save Changes\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className="space-y-6">\n                  {/* White Pieces */}\n                  <div>\n                    <h3 className="font-medium mb-3 text-sm">\n                      {getOriginalPalette(selectedPalette)?.legendTheme.whiteEmoji} White Pieces\n                    </h3>\n                    <div className="grid grid-cols-3 gap-3">\n                      {PIECE_TYPES.map(pt => (\n                        <div key={`w-${pt}`} className="space-y-1.5">\n                          <label className="text-xs text-muted-foreground">\n                            {PIECE_NAMES[pt]}\n                          </label>\n                          <div className="flex items-center gap-2">\n                            <Input\n                              type="color"\n                              value={editColors.white[pt]}\n                              onChange={(e) => handleColorChange(\'white\', pt, e.target.value)}\n                              className="w-10 h-8 p-0.5 cursor-pointer"\n                            />\n                            <Input\n                              type="text"\n                              value={editColors.white[pt]}\n                              onChange={(e) => handleColorChange(\'white\', pt, e.target.value)}\n                              className="h-8 text-xs font-mono"\n                            />\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  \n                  {/* Black Pieces */}\n                  <div>\n                    <h3 className="font-medium mb-3 text-sm">\n                      {getOriginalPalette(selectedPalette)?.legendTheme.blackEmoji} Black Pieces\n                    </h3>\n                    <div className="grid grid-cols-3 gap-3">\n                      {PIECE_TYPES.map(pt => (\n                        <div key={`b-${pt}`} className="space-y-1.5">\n                          <label className="text-xs text-muted-foreground">\n                            {PIECE_NAMES[pt]}\n                          </label>\n                          <div className="flex items-center gap-2">\n                            <Input\n                              type="color"\n                              value={editColors.black[pt]}\n                              onChange={(e) => handleColorChange(\'black\', pt, e.target.value)}\n                              className="w-10 h-8 p-0.5 cursor-pointer"\n                            />\n                            <Input\n                              type="text"\n                              value={editColors.black[pt]}\n                              onChange={(e) => handleColorChange(\'black\', pt, e.target.value)}\n                              className="h-8 text-xs font-mono"\n                            />\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  \n                  {/* Preview */}\n                  <div className="border-t pt-4">\n                    <h3 className="font-medium mb-3 text-sm flex items-center gap-2">\n                      <Eye className="h-4 w-4" />\n                      Color Preview\n                    </h3>\n                    <div className="flex gap-4">\n                      <div className="space-y-1">\n                        <span className="text-xs text-muted-foreground">White</span>\n                        <div className="flex gap-1">\n                          {PIECE_TYPES.map(pt => (\n                            <div \n                              key={`preview-w-${pt}`}\n                              className="w-8 h-8 rounded-md shadow-sm"\n                              style={{ backgroundColor: editColors.white[pt] }}\n                              title={PIECE_NAMES[pt]}\n                            />\n                          ))}\n                        </div>\n                      </div>\n                      <div className="space-y-1">\n                        <span className="text-xs text-muted-foreground">Black</span>\n                        <div className="flex gap-1">\n                          {PIECE_TYPES.map(pt => (\n                            <div \n                              key={`preview-b-${pt}`}\n                              className="w-8 h-8 rounded-md shadow-sm"\n                              style={{ backgroundColor: editColors.black[pt] }}\n                              title={PIECE_NAMES[pt]}\n                            />\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              <Card className="h-full flex items-center justify-center">\n                <CardContent className="text-center py-12">\n                  <Palette className="h-12 w-12 text-muted-foreground/30 mx-auto mb-4" />\n                  <p className="text-muted-foreground">\n                    Select a palette to edit its colors\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n      \n      {/* Confirmation Dialog */}\n      <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className="flex items-center gap-2">\n              <AlertTriangle className="h-5 w-5 text-amber-500" />\n              Confirm Palette Update\n            </DialogTitle>\n            <DialogDescription>\n              This palette is linked to <strong>{linkedCounts[selectedPalette || \'\'] || 0}</strong> visualizations.\n              Saving these changes will affect how all linked visualizations render.\n            </DialogDescription>\n          </DialogHeader>\n          <div className="flex justify-end gap-2 mt-4">\n            <Button variant="outline" onClick={() => setShowConfirmDialog(false)}>\n              Cancel\n            </Button>\n            <Button onClick={performSave} disabled={isSaving}>\n              {isSaving ? (\n                <Loader2 className="h-4 w-4 mr-1 animate-spin" />\n              ) : (\n                <Check className="h-4 w-4 mr-1" />\n              )}\n              Confirm Update\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default PaletteAdminPage;\n';export{e as default};
