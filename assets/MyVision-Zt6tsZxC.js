import{u as e,r as s,j as a,C as t,p as r,q as n,t as i,B as l,v as o,w as c,x as d,y as m,z as u,D as x,E as h,F as p,L as f,I as g,b as j,s as v,J as b,K as N,M as y,N as w,O as C,Q as _,U as z,V as D,W as k,X as S,Y as M,Z as q,_ as A,$ as P,a0 as L,a1 as B,a2 as H,a3 as I,a4 as G,a5 as V,a6 as R,a7 as K,a8 as U,a9 as E,aa as F,ab as Y,ac as W,ad as O,ae as T,af as Z,ag as X,ah as $,ai as J,aj as Q,ak as ee,al as se,am as ae,an as te,ao as re,ap as ne,aq as ie,a as le,ar as oe,as as ce,at as de,H as me,au as ue,av as xe,aw as he,ax as pe,ay as fe,az as ge,aA as je,aB as ve,aC as be,aD as Ne,G as ye,d as we,aE as Ce,e as _e,f as ze,g as De,h as ke,i as Se,k as Me,l as qe,m as Ae,T as Pe,aF as Le,aG as Be,aH as He,aI as Ie}from"./index-Dq7M-Dd_.js";import{getUserVisualizations as Ge,deleteVisualization as Ve}from"./visualizationStorage-Bot8K2mP.js";import{u as Re}from"./useMarketplaceRealtime-CeSs2bJ0.js";import{C as Ke}from"./circle-alert-DLuTTT-3.js";import{G as Ue}from"./GracePeriodBanner-txeUdw74.js";import{C as Ee}from"./calendar-CcmZmUfC.js";import{T as Fe}from"./tag-CVqoVg00.js";import"./visualizationSchemas-fU8xXOfv.js";import"./flagContent-CI7aBguZ.js";import"./alert-CW40bkVz.js";const Ye=()=>{const{user:v,isPremium:b,subscriptionStatus:N,isCheckingSubscription:y,checkSubscription:w,openCheckout:C,openCustomerPortal:_}=e(),[z,D]=s.useState(!1),[k,S]=s.useState(!1);if(!v)return null;const M=(null==N?void 0:N.subscriptionEnd)?new Date(N.subscriptionEnd):null,q=M&&M.getTime()-Date.now()<6048e5;return a.jsxs(t,{className:"border-border/50",children:[a.jsxs(r,{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(n,{className:"h-5 w-5 text-primary"}),a.jsx(i,{className:"text-lg",children:"Subscription"})]}),a.jsx(l,{variant:"ghost",size:"sm",onClick:async()=>{S(!0);try{await w(),j.success("Subscription status updated")}catch(e){j.error("Failed to refresh status")}finally{S(!1)}},disabled:k||y,children:a.jsx(o,{className:"h-4 w-4 "+(k||y?"animate-spin":"")})})]}),a.jsx(c,{children:"Manage your Visionary premium subscription"})]}),a.jsxs(d,{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"})}),b?a.jsxs(m,{className:"bg-green-500/10 text-green-500 border-green-500/20",children:[a.jsx(u,{className:"h-3 w-3 mr-1"}),"Active"]}):a.jsxs(m,{variant:"secondary",className:"bg-muted",children:[a.jsx(x,{className:"h-3 w-3 mr-1"}),"Inactive"]})]}),a.jsx(h,{}),b?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(Ee,{className:"h-4 w-4"}),a.jsx("span",{children:"Renewal Date"})]}),a.jsx("div",{className:"text-sm font-medium",children:M?p(M,"MMMM d, yyyy"):"N/A"})]}),q&&a.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[a.jsx(Ke,{className:"h-4 w-4 text-amber-500"}),a.jsx("span",{className:"text-sm text-amber-500",children:"Your subscription renews in less than 7 days"})]}),a.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[a.jsx("h4",{className:"text-sm font-medium mb-2",children:"Your Benefits"}),a.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[a.jsx("li",{children:"• Unlimited HD downloads"}),a.jsx("li",{children:"• No watermarks on exports"}),a.jsx("li",{children:"• Personal vision gallery"}),a.jsx("li",{children:"• Early access to new features"})]})]})]}),a.jsx(h,{}),a.jsxs(l,{variant:"outline",className:"w-full",onClick:async()=>{D(!0);try{await _()}catch(e){j.error("Failed to open subscription management",{description:e instanceof Error?e.message:"Please try again"})}finally{D(!1)}},disabled:z,children:[z?a.jsx(f,{className:"h-4 w-4 animate-spin mr-2"}):a.jsx(g,{className:"h-4 w-4 mr-2"}),"Manage Subscription"]}),a.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Update payment method, cancel, or view invoices"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[a.jsx("h4",{className:"text-sm font-medium mb-2",children:"Premium Benefits"}),a.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[a.jsx("li",{children:"• Unlimited HD downloads"}),a.jsx("li",{children:"• No watermarks on exports"}),a.jsx("li",{children:"• Personal vision gallery"}),a.jsx("li",{children:"• Early access to new features"})]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("span",{className:"text-2xl font-bold",children:"$7"}),a.jsx("span",{className:"text-muted-foreground",children:"/month"})]})]}),a.jsxs(l,{className:"w-full btn-luxury",onClick:async()=>{D(!0);try{await C()}catch(e){j.error("Failed to open checkout",{description:e instanceof Error?e.message:"Please try again"})}finally{D(!1)}},disabled:z,children:[z?a.jsx(f,{className:"h-4 w-4 animate-spin mr-2"}):a.jsx(n,{className:"h-4 w-4 mr-2"}),"Upgrade to Premium"]}),a.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Cancel anytime. Secure payment via Stripe."})]})]})]})};!function(){const e=Ze,s=Te();for(;;)try{if(567907===-parseInt(e(137))/1*(parseInt(e(145))/2)+parseInt(e(150))/3+parseInt(e(202))/4*(parseInt(e(156))/5)+parseInt(e(205))/6+parseInt(e(194))/7*(-parseInt(e(206))/8)+-parseInt(e(211))/9+parseInt(e(198))/10)break;s.push(s.shift())}catch(a){s.push(s.shift())}}();const We=function(){const e=Ze,s={};s[e(164)]=e(212);const a=s;let t=!0;return function(s,r){const n=e,i={};i.jwLpc=a[n(164)];const l=i,o=t?function(){const e=n;if(l[e(166)]===e(212)){if(r){const e=r.apply(s,arguments);return r=null,e}}else{const s=_0x1bbeb2[e(222)+"r"][e(224)][e(148)](_0x41312b),a=_0x1fa34f[_0x1eb05f],t=_0x15a7ef[a]||s;s[e(218)]=_0x28a0aa[e(148)](_0x29d450),s[e(227)]=t[e(227)].bind(t),_0x4e9d5b[a]=s}}:function(){};return t=!1,o}}()(void 0,function(){const e=Ze,s={};s[e(175)]="(((.+)+)+)+$";const a=s;return We[e(227)]().search(e(165)+"+$").toString().constructor(We)[e(209)](a.TZGaM)});We();const Oe=function(){const e=Ze,s={LKIMJ:function(e,s){return e===s}};s[e(195)]=e(154);const a=s;let t=!0;return function(s,r){const n=e;if(a[n(186)](a[n(195)],a[n(195)])){const e=t?function(){if(r){const e=r[n(196)](s,arguments);return r=null,e}}:function(){};return t=!1,e}return _0x49fcc2[n(227)]()[n(209)](n(165)+"+$")[n(227)]()[n(222)+"r"](_0x4e23dd)[n(209)]("(((.+)+)+)+$")}}();function Te(){const e=["mti0wgHvBvbw","Dg90ywXnB3zLCW","CgDU","mZK2ndC0Exj6A3fj","ofLdEezswG","swDwB20","qLv2z0G","C2vHCMnO","A1vbqwO","nZyYnJG1mK5jwhDzCG","qKX2t1u","zxzLBNq","tLzJr2u","D2fYBG","zMv0y2GGDMLZDq","E30Uy29UC3rYDq","x19WCM90B19F","zNjVBq","vg5WuNe","veHlA1m","y29UC3rYDwn0BW","D29NExC","ChjVDg90ExbL","BMn0Aw9UkcKG","ywXPEMf0Aw9UCW","Dg9tDhjPBMC","DM9tweq","ENnPBuS","Bg9N","uKnMB0O","ndaXndbTCvjJrLm","rKL0vgu","y29UC29Szq","rMfPBgvKihrVia","BgvUz3rO","CNnYrgq","zxjYB3jZ","vgrsuMG","oezVyxrdqq","uxrJsfm","CeP0BwC","yMLUza","BwLNCMf0zwq","mtK1ndyYnMP2qvrqua","z2fTzv9KyxrH","yM9HCMq","ysbHDMfPBgfIBa","EujPufu","DxbKyxrL","mtm1mJKWtwHrtu5N","CM4GDgHPCYiPka","D2HPDgu","r1jHCei","DxnLCL9Pza","CMvZDwX0","DgfIBgu","zgf0zq","uKjjrhC","kcGOlISPkYKRkq","ANDmCgm","CMv0DxjUicHMDq","C3HNvfy","B0DHwMS","ChvZAa","zxHJzxb0Aw9U","Dg90ywW","ChjVy2vZCYbqrW","DLPrsKq","vfPhyu0","zMfPBgvK","thvUrNK","BMvYyxrPB24","DhjHy2u","C2f2zwrFDMLZDq","C3vJy2vZCW","z2fTzurHDge","Bw92zxm","zxjYB3i","wKvLtvO","teTjtuO","z2TqD0W","BwvZC2fNzq","AxnbCNjHEq","y3rVCIGICMv0Dq","Aw5MBW","zsbMB3iGCMvNzq","yMXHy2S","nZu4mdK1mxvqrwj1BW","BfnczLi","yxbWBhK","q1LWDg4","mteWmJq2otbOsMLwwNi","tK1bA3G","zhztyK0","Du5ezMi"];return(Te=function(){return e})()}function Ze(e,s){e-=135;const a=Te();let t=a[e];if(void 0===Ze.zHhKCX){var r=function(e){let s="",a="",t=s+r;for(let r,n,i=0,l=0;n=e.charAt(l++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=t.charCodeAt(l+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let r=0,n=s.length;r<n;r++)a+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(a)};Ze.mASDbL=r,Ze.CqnusV={},Ze.zHhKCX=!0}const n=e+a[0],i=Ze.CqnusV[n];if(i)t=i;else{const e=function(e){this.OjcdAi=e,this.bplWAL=[1,0,0],this.lhHppK=function(){return"newState"},this.GXdnjX="\\w+ *\\(\\) *{\\w+ *",this.ivOBof="['|\"].+['|\"];? *}"};e.prototype.UNVDdK=function(){const e=new RegExp(this.GXdnjX+this.ivOBof).test(this.lhHppK.toString())?--this.bplWAL[1]:--this.bplWAL[0];return this.jicCCX(e)},e.prototype.jicCCX=function(e){return Boolean(~e)?this.nxqfzc(this.OjcdAi):e},e.prototype.nxqfzc=function(e){for(let s=0,a=this.bplWAL.length;s<a;s++)this.bplWAL.push(Math.round(Math.random())),a=this.bplWAL.length;return e(this.bplWAL[0])},new e(Ze).UNVDdK(),t=Ze.mASDbL(t),Ze.CqnusV[n]=t}return t}async function Xe(e){const s=Ze,a={};a[s(199)]=s(135),a[s(168)]=s(215),a.QtcHS=s(191),a.pJtmg=s(184),a[s(210)]=s(171),a.NVcGe=s(179),a[s(221)]=function(e,s){return e<s},a.zeciS=function(e,s){return e===s},a[s(142)]="VCJFm",a[s(228)]="wWoUN";const t=a;if(e[s(151)].board&&Array.isArray(e.game_data.board)){const e={};return e[s(181)]=!0,e}const r=e[s(204)]||e.game_data[s(204)];if(!r){const e={};return e[s(181)]=!1,e[s(184)]="No PGN data availabl"+s(192)+s(178),e}try{if(t.zeciS(t[s(142)],"VCJFm")){const a=b(r),t={};t[s(158)]=e.game_data.white||a[s(182)][s(158)],t[s(193)]=e.game_data.black||a[s(182)][s(193)],t.event=e[s(151)].event||a[s(182)][s(213)],t[s(163)]=e[s(151)][s(163)]||a.gameData.date,t[s(161)]=e[s(151)][s(161)]||a[s(182)].result,t[s(204)]=r,t.moves=a.gameData[s(183)],t[s(152)]=a[s(152)],t.totalMoves=a[s(203)];const n=t,i={};i[s(151)]=n;const{error:l}=await v[s(219)](s(180)+s(226))[s(155)](i).eq("id",e.id);if(l){if("trKqV"===s(177)){const e={};return e[s(181)]=!0,e}{const e={success:!1};return e.error=l[s(188)],e}}const o={};return o[s(181)]=!0,o}{let e;try{e=_0x31b13f(s(167)+s(225)+(s(217)+s(190)+'rn this")( ));'))()}catch(n){e=_0x6a7a5a}const a=e[s(139)]=e[s(139)]||{},t=[gxSmrM[s(199)],gxSmrM[s(168)],gxSmrM[s(146)],gxSmrM[s(147)],gxSmrM[s(210)],s(162),gxSmrM[s(214)]];for(let r=0;gxSmrM[s(221)](r,t[s(141)]);r++){const e=_0x271566[s(222)+"r"][s(224)][s(148)](_0x154af3),n=t[r],i=a[n]||e;e[s(218)]=_0x5a914f[s(148)](_0x4a946c),e[s(227)]=i[s(227)].bind(i),a[n]=e}}}catch(i){if(s(174)!==t.voSXD){const e={};return e[s(181)]=!1,e.error=i instanceof Error?i[s(188)]:"Failed to "+s(173)+"N",e}{const e={};return e[s(181)]=!1,e.error=_0x54ef18.message,e}}}Oe(void 0,function(){const e=Ze,s={LQGAa:e(136),uNDfb:function(e,s){return e(s)},wogyw:function(e,s){return e+s},DQIAa:"return (fu"+e(225),iUfkA:function(e){return e()},zsimK:"dzacS",oGaZk:e(135),ZEeMZ:e(191),IgVom:e(184),FItTe:e(162),SRwSA:function(e,s){return e<s},CYptn:e(200)};let a;try{if(e(136)!==s.LQGAa)return _0x479003[e(143)][e(170)]((null==_0x6b2ffd?void 0:_0x6b2ffd[e(188)])||e(140)+e(216)+e(226)),_0x30e6ff;{const t=s[e(201)](Function,s[e(223)](s.DQIAa,e(217)+e(190)+e(157)+" )")+");");a=s.iUfkA(t)}}catch(n){if(s[e(229)]!=s[e(229)]){if(_0x3d1d60){const s=_0x68ec84[e(196)](_0x4086dd,arguments);return _0xb0c29a=null,s}}else a=window}const t=a[e(139)]=a[e(139)]||{},r=[s[e(169)],e(215),s[e(185)],s[e(207)],e(171),s[e(138)],"trace"];for(let i=0;s.SRwSA(i,r.length);i++)if(s[e(197)]===e(200)){const s=Oe[e(222)+"r"][e(224)][e(148)](Oe),a=r[i],n=t[a]||s;s[e(218)]=Oe[e(148)](Oe),s[e(227)]=n.toString[e(148)](n),t[a]=s}else if(_0xe4b4ce){const s=_0x329278[e(196)](_0x497f6d,arguments);return _0x2236de=null,s}})(),function(){const e=Je,s=es();for(;;)try{if(779699===parseInt(e(389))/1*(parseInt(e(353))/2)+parseInt(e(338))/3*(-parseInt(e(404))/4)+parseInt(e(382))/5*(-parseInt(e(336))/6)+-parseInt(e(415))/7+parseInt(e(369))/8*(-parseInt(e(348))/9)+-parseInt(e(397))/10+parseInt(e(406))/11)break;s.push(s.shift())}catch(a){s.push(s.shift())}}();const $e=function(){const e=Je,s={LCUHm:function(e,s){return e!==s}};s.tQiAq=e(352);const a=s;let t=!0;return function(e,s){const r=t?function(){const t=Je;if(s){if(a.LCUHm(a.tQiAq,a.tQiAq)){_0x53f1b9[t(379)](t(388)+t(327)+t(374),_0x1aaa31);const e={};return e[t(386)]=!1,e[t(337)]=t(379),e[t(401)]=t(375)+"validate premium sta"+t(396)+"e try again.",e}{const a=s[t(373)](e,arguments);return s=null,a}}}:function(){};return t=!1,r}}()(void 0,function(){const e=Je,s={};s.UojpH=e(332)+"+$";const a=s;return $e[e(359)]()[e(346)](a.UojpH)[e(359)]()[e(392)+"r"]($e)[e(346)](e(332)+"+$")});function Je(e,s){e-=327;const a=es();let t=a[e];if(void 0===Je.sXinSX){var r=function(e){let s="",a="",t=s+r;for(let r,n,i=0,l=0;n=e.charAt(l++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=t.charCodeAt(l+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let r=0,n=s.length;r<n;r++)a+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(a)};Je.GpHPLA=r,Je.sfwZmk={},Je.sXinSX=!0}const n=e+a[0],i=Je.sfwZmk[n];if(i)t=i;else{const e=function(e){this.ejjrqM=e,this.rtKyrI=[1,0,0],this.nFgDfz=function(){return"newState"},this.cFxyuX="\\w+ *\\(\\) *{\\w+ *",this.PSzsrm="['|\"].+['|\"];? *}"};e.prototype.fAiHEx=function(){const e=new RegExp(this.cFxyuX+this.PSzsrm).test(this.nFgDfz.toString())?--this.rtKyrI[1]:--this.rtKyrI[0];return this.FeEhQH(e)},e.prototype.FeEhQH=function(e){return Boolean(~e)?this.MHjuRs(this.ejjrqM):e},e.prototype.MHjuRs=function(e){for(let s=0,a=this.rtKyrI.length;s<a;s++)this.rtKyrI.push(Math.round(Math.random())),a=this.rtKyrI.length;return e(this.rtKyrI[0])},new e(Je).fAiHEx(),t=Je.GpHPLA(t),Je.sfwZmk[n]=t}return t}$e();const Qe=function(){let e=!0;return function(s,a){const t=e?function(){const e=Je;if(e(366)===e(383)){const s=_0x53bc57?function(){if(_0x178a2d){const s=_0x300fba[e(373)](_0x2c961d,arguments);return _0x201938=null,s}}:function(){};return _0x2e084b=!1,s}if(a){const t=a[e(373)](s,arguments);return a=null,t}}:function(){};return e=!1,t}}();function es(){const e=["mJi2nerRzxDdsa","ifbYzw1PDw0GzG","qxv0Ag9YAxPHDa","ChjVDg90ExbL","yxbWBhK","CNjVCJO","rMfPBgvKihrVia","DMfSAwrHDguTCa","CM4GDgHPCYiPka","CMvTAxvTihn0yq","zxjYB3i","BwL1BsbZDgf0Dq","Aw1Hz2vZ","mtq1q3f4BgfT","re5buxe","yMzhrgi","u3rLwgW","ywXSB3DLza","AgvHzgvYCW","uhjLBwL1Bsb2yq","mwHyA2jWAW","yNnJCMLWDgLVBG","BMn0Aw9UkcKG","y29UC3rYDwn0BW","v2DsrMq","zej2weS","EvrfAeC","DhvZlIbqBgvHCW","mti3nty4mg9PA1PNsa","CMv0DxjUicHMDq","E30Uy29UC3rYDq","uhjLBwL1BsbZDq","BwvZC2fNzq","C3vIC2nYAxb0Aq","ugXLyxnLihrYEq","nZjhzfzethq","DhjHy2u","mZq2nda3otnVtvjhAKO","Bg9Hzhm","ihjLCxvPCMvKia","rNfcDLq","yMLUza","BMXVywrZ","Aw52B2TL","zNvUy3rPB25Z","s3HMz3a","mta2ntG4otn0EfLmzMC","B3iGDw5SAw1PDa","BgLKyxrPB24Gzq","vw5HyMXLihrVia","vLHfCw4","CMvTAxvTlwrVDW","z2v0u2vZC2LVBG","kcGOlISPkYKRkq","vxbNCMfKzsb0BW","zwqGseqGzg93BG","zsb0CNKGywDHAq","odC5nZHOyMnREvG","CMvHC29U","odq2otn5CwjAsKG","veDTsKe","DMvYAwz5ihbYzq","CLPPDxa","zxHJzxb0Aw9U","DMfSAwrHDguGCa","thHzz3C","AgfZuhjLBwL1Bq","C2vHCMnO","Bg9N","mJi3ndn0D2rbvui","x19WCM90B19F","qMvHCMvYia","zM9YieHeigrVDW","r0zPEgG","mtG1ody1ohvOwe5ZDq","BM9FC3vIC2nYAq","DgvKigvYCM9Yia","B25fBMq","ywnJzxnZx3rVAW","qvvSvNG","Dg9tDhjPBMC","igfNywLUlG","y3rVCIGICMv0Dq","B25Fzw5K","ChrPB24","yxv0Aa","s3L5EKW","rK11ve8","Au1Ru2S","y29UC29Szq"];return(es=function(){return e})()}Qe(void 0,function(){const e=Je,s={};s.lYXqz=e(358),s.VXEqn=e(347),s.wTPaK="info",s[e(394)]=e(342),s[e(414)]=function(e,s){return e<s};const a=s,t=function(){const s=e,t={};t.yTEhG="Upgrade to"+s(370)+s(416)+"ed HD downloads";const r=t;let n;try{n=Function(s(398)+s(391)+(s(399)+s(361)+s(377)+" ));"))()}catch(i){"mfuoP"!==a.lYXqz?n=window:_0x5c049c=_0x20ed65[s(401)]||r[s(395)]}return n}(),r=t[e(368)]=t[e(368)]||{},n=[a[e(329)],"warn",a.wTPaK,e(379),a.dBvXK,"table",e(405)];for(let i=0;a[e(414)](i,n.length);i++){const s=Qe[e(392)+"r"][e(372)][e(410)](Qe),a=n[i],t=r[a]||s;s[e(349)]=Qe.bind(Qe),s[e(359)]=t[e(359)][e(410)](t),r[a]=s}})();var ss="Radio",[as,ts]=M(ss),[rs,ns]=as(ss),is=s.forwardRef((e,t)=>{const{__scopeRadio:r,name:n,checked:i=!1,required:l,disabled:o,value:c="on",onCheck:d,form:m,...u}=e,[x,h]=s.useState(null),p=_(t,e=>h(e)),f=s.useRef(!1),g=!x||(m||!!x.closest("form"));return a.jsxs(rs,{scope:r,checked:i,disabled:o,children:[a.jsx(C.button,{type:"button",role:"radio","aria-checked":i,"data-state":ds(i),"data-disabled":o?"":void 0,disabled:o,value:c,...u,ref:p,onClick:D(e.onClick,e=>{i||null==d||d(),g&&(f.current=e.isPropagationStopped(),f.current||e.stopPropagation())})}),g&&a.jsx(cs,{control:x,bubbles:!f.current,name:n,value:c,checked:i,required:l,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});is.displayName=ss;var ls="RadioIndicator",os=s.forwardRef((e,s)=>{const{__scopeRadio:t,forceMount:r,...n}=e,i=ns(ls,t);return a.jsx(S,{present:r||i.checked,children:a.jsx(C.span,{"data-state":ds(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s})})});os.displayName=ls;var cs=s.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:n=!0,...i},l)=>{const o=s.useRef(null),c=_(o,l),d=q(r),m=A(t);return s.useEffect(()=>{const e=o.current;if(!e)return;const s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set;if(d!==r&&a){const s=new Event("click",{bubbles:n});a.call(e,r),e.dispatchEvent(s)}},[d,r,n]),a.jsx(C.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:c,style:{...i.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function ds(e){return e?"checked":"unchecked"}cs.displayName="RadioBubbleInput";var ms=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],us="RadioGroup",[xs]=M(us,[k,ts]),hs=k(),ps=ts(),[fs,gs]=xs(us),js=s.forwardRef((e,s)=>{const{__scopeRadioGroup:t,name:r,defaultValue:n,value:i,required:l=!1,disabled:o=!1,orientation:c,dir:d,loop:m=!0,onValueChange:u,...x}=e,h=hs(t),p=N(d),[f,g]=y({prop:i,defaultProp:n??null,onChange:u,caller:us});return a.jsx(fs,{scope:t,name:r,required:l,disabled:o,value:f,onValueChange:g,children:a.jsx(w,{asChild:!0,...h,orientation:c,dir:p,loop:m,children:a.jsx(C.div,{role:"radiogroup","aria-required":l,"aria-orientation":c,"data-disabled":o?"":void 0,dir:p,...x,ref:s})})})});js.displayName=us;var vs="RadioGroupItem",bs=s.forwardRef((e,t)=>{const{__scopeRadioGroup:r,disabled:n,...i}=e,l=gs(vs,r),o=l.disabled||n,c=hs(r),d=ps(r),m=s.useRef(null),u=_(t,m),x=l.value===i.value,h=s.useRef(!1);return s.useEffect(()=>{const e=e=>{ms.includes(e.key)&&(h.current=!0)},s=()=>h.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}},[]),a.jsx(z,{asChild:!0,...c,focusable:!o,active:x,children:a.jsx(is,{disabled:o,required:l.required,checked:x,...d,...i,name:l.name,ref:u,onCheck:()=>l.onValueChange(i.value),onKeyDown:D(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:D(i.onFocus,()=>{var e;h.current&&(null==(e=m.current)||e.click())})})})});bs.displayName=vs;var Ns=s.forwardRef((e,s)=>{const{__scopeRadioGroup:t,...r}=e,n=ps(t);return a.jsx(os,{...n,...r,ref:s})});Ns.displayName="RadioGroupIndicator";var ys=js,ws=bs,Cs=Ns;const _s=s.forwardRef(({className:e,...s},t)=>a.jsx(ys,{className:P("grid gap-2",e),...s,ref:t}));_s.displayName=ys.displayName;const zs=s.forwardRef(({className:e,...s},t)=>a.jsx(ws,{ref:t,className:P("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:a.jsx(Cs,{className:"flex items-center justify-center",children:a.jsx(L,{className:"h-2.5 w-2.5 fill-current text-current"})})}));zs.displayName=ws.displayName;const Ds=Y({priceCents:W().int("Price must be a whole number of cents").min(0,"Price cannot be negative").max(1e6,"Maximum price is $10,000")}),ks=({isOpen:e,onClose:t,visualizationId:r,visualizationTitle:n,onSuccess:i})=>{const[o,c]=s.useState("free"),[d,m]=s.useState("5.00"),[u,x]=s.useState(!1),[h,p]=s.useState(null);return a.jsx(B,{open:e,onOpenChange:t,children:a.jsxs(H,{className:"sm:max-w-md",children:[a.jsxs(I,{children:[a.jsx(G,{children:"List for Sale or Gift"}),a.jsxs(V,{children:['Transfer "',n,'" to another collector']})]}),a.jsxs("div",{className:"space-y-6 py-4",children:[a.jsxs(_s,{value:o,onValueChange:e=>c(e),className:"grid grid-cols-2 gap-4",children:[a.jsxs(R,{htmlFor:"free",className:"flex flex-col items-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all "+("free"===o?"border-green-500 bg-green-500/10":"border-border hover:border-muted-foreground/50"),children:[a.jsx(zs,{value:"free",id:"free",className:"sr-only"}),a.jsx(K,{className:"h-8 w-8 "+("free"===o?"text-green-500":"text-muted-foreground")}),a.jsx("span",{className:"font-medium",children:"Gift (Free)"}),a.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"No fees — first to claim gets full value"})]}),a.jsxs(R,{htmlFor:"paid",className:"flex flex-col items-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all "+("paid"===o?"border-primary bg-primary/10":"border-border hover:border-muted-foreground/50"),children:[a.jsx(zs,{value:"paid",id:"paid",className:"sr-only"}),a.jsx(U,{className:"h-8 w-8 "+("paid"===o?"text-primary":"text-muted-foreground")}),a.jsx("span",{className:"font-medium",children:"Sell"}),a.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"5% fee — you receive 95%"})]})]}),a.jsx("div",{className:"text-xs p-3 rounded-lg "+("free"===o?"bg-green-500/10 border border-green-500/30":"bg-muted/50"),children:"free"===o?a.jsxs("p",{className:"text-green-600",children:[a.jsx("strong",{children:"Gift:"})," The recipient receives full ownership and all accrued value. No platform fees are charged."]}):a.jsxs("p",{className:"text-muted-foreground",children:[a.jsx("strong",{children:"Sale:"})," 5% platform fee supports the Education Fund. Buyer pays with Platform Credits; you receive 95% instantly."]})}),"paid"===o&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(R,{htmlFor:"price",children:"Price (Platform Credits)"}),a.jsxs("div",{className:"relative",children:[a.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(E,{id:"price",type:"number",min:"1",step:"0.01",value:d,onChange:e=>{m(e.target.value),p(null)},className:"pl-9 "+(h?"border-destructive":""),placeholder:"5.00",max:"10000"})]}),h?a.jsxs("p",{className:"text-xs text-destructive flex items-center gap-1",children:[a.jsx(Ke,{className:"h-3 w-3"}),h]}):a.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[a.jsx("p",{children:"Minimum $1.00, maximum $10,000."}),a.jsxs("p",{className:"text-primary/80",children:["You receive: $",(.95*parseFloat(d||"0")).toFixed(2)," (95%)"]})]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(l,{variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),a.jsx(l,{onClick:async()=>{var e;x(!0),p(null);const s="free"===o?0:Math.round(100*parseFloat(d)),a=Ds.safeParse({priceCents:s});if(!a.success){const s=(null==(e=a.error.errors[0])?void 0:e.message)||"Invalid price";return p(s),j.error(s),void x(!1)}if("paid"===o&&(isNaN(s)||s<100))return p("Minimum price is $1.00"),j.error("Minimum price is $1.00"),void x(!1);const{error:n}=await F(r,s);x(!1),n?j.error("Failed to create listing",{description:n.message}):(j.success("free"===o?"Listed as gift!":`Listed for $${(s/100).toFixed(2)}!`,{description:"Your visualization is now on the marketplace"}),null==i||i(),t())},disabled:u,className:"flex-1",children:u?a.jsx(f,{className:"h-4 w-4 animate-spin"}):"free"===o?"List as Gift":`List for $${parseFloat(d||"0").toFixed(2)}`})]})]})})},Ss=()=>{const{user:n}=e(),[l,o]=s.useState([]),[c,u]=s.useState(!0),[x,h]=s.useState(0),[p,g]=s.useState(0);s.useEffect(()=>{n&&j()},[n]);const j=async()=>{if(n){u(!0);try{const{data:e,error:s}=await v.from("saved_visualizations").select("id, title, image_path, created_at").eq("user_id",n.id).order("created_at",{ascending:!1});if(s)throw s;const a=(null==e?void 0:e.map(e=>e.id))||[];let t={};if(a.length>0){const{data:e}=await v.from("vision_scores").select("visualization_id, total_score, view_count, print_order_count, trade_count, royalty_cents_earned, print_revenue_cents").in("visualization_id",a);t=(e||[]).reduce((e,s)=>(e[s.visualization_id]={total_score:Number(s.total_score)||0,view_count:s.view_count||0,print_order_count:s.print_order_count||0,trade_count:s.trade_count||0,royalty_cents_earned:s.royalty_cents_earned||0,print_revenue_cents:s.print_revenue_cents||0},e),{})}const r=(e||[]).map(e=>({...e,score:t[e.id]}));o(r);const{data:i}=await v.rpc("calculate_portfolio_value",{p_user_id:n.id});h(i||0);const{data:l}=await v.rpc("get_or_create_wallet",{p_user_id:n.id});l&&g(l.balance_cents||0)}catch(e){}u(!1)}},b=e=>`$${(e/100).toFixed(2)}`;l.reduce((e,s)=>{var a;return e+((null==(a=s.score)?void 0:a.total_score)||0)},0);const N=l.reduce((e,s)=>{var a;return e+((null==(a=s.score)?void 0:a.view_count)||0)},0),y=l.reduce((e,s)=>{var a;return e+((null==(a=s.score)?void 0:a.print_order_count)||0)},0),w=l.reduce((e,s)=>{var a;return e+((null==(a=s.score)?void 0:a.trade_count)||0)},0),C=l.reduce((e,s)=>{var a;return e+((null==(a=s.score)?void 0:a.royalty_cents_earned)||0)},0);return c?a.jsx(t,{children:a.jsx(d,{className:"flex items-center justify-center py-12",children:a.jsx(f,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs(t,{className:"bg-gradient-to-br from-primary/10 via-background to-amber-500/5 border-primary/20",children:[a.jsx(r,{className:"pb-3",children:a.jsxs(i,{className:"flex items-center gap-2",children:[a.jsx(O,{className:"h-5 w-5 text-primary"}),"Holdings Value Dashboard",a.jsx(T,{children:a.jsxs(Z,{children:[a.jsx(X,{children:a.jsx($,{className:"h-4 w-4 text-muted-foreground"})}),a.jsx(J,{className:"max-w-xs",children:a.jsx("p",{children:"Your holdings value is calculated from vision scores + value appreciation from print orders. This represents your portfolio's market value when selling."})})]})})]})}),a.jsxs(d,{children:[a.jsxs("div",{className:"grid sm:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"p-4 rounded-xl bg-background/50 border border-border/50",children:[a.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[a.jsx(Q,{className:"h-4 w-4 text-primary"}),a.jsx("span",{className:"text-sm",children:"Portfolio Value"})]}),a.jsx("p",{className:"text-3xl font-bold text-primary",children:b(x)}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Based on vision scores + value appreciation"})]}),a.jsxs("div",{className:"p-4 rounded-xl bg-background/50 border border-border/50",children:[a.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[a.jsx(ee,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm",children:"Available Balance"})]}),a.jsx("p",{className:"text-3xl font-bold text-green-500",children:b(p)}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ready for marketplace purchases"})]})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-6",children:[a.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[a.jsx(se,{className:"h-4 w-4 mx-auto text-blue-500 mb-1"}),a.jsx("p",{className:"text-xl font-bold",children:l.length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Visions"})]}),a.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[a.jsx(ae,{className:"h-4 w-4 mx-auto text-purple-500 mb-1"}),a.jsx("p",{className:"text-xl font-bold",children:N}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Views"})]}),a.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[a.jsx(te,{className:"h-4 w-4 mx-auto text-amber-500 mb-1"}),a.jsx("p",{className:"text-xl font-bold",children:y}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Prints"})]}),a.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[a.jsx(re,{className:"h-4 w-4 mx-auto text-cyan-500 mb-1"}),a.jsx("p",{className:"text-xl font-bold",children:w}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Trades"})]})]}),C>0&&a.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-amber-600",children:"Value Appreciation from Print Orders"}),a.jsx("span",{className:"font-bold text-amber-600",children:b(C)})]}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(100*ne.valueAppreciationRate),"% of print revenue adds to your holdings value"]})]})]})]}),l.length>0&&a.jsxs(t,{children:[a.jsx(r,{className:"pb-3",children:a.jsxs(i,{className:"text-lg flex items-center gap-2",children:[a.jsx(U,{className:"h-5 w-5"}),"Top Holdings by Value"]})}),a.jsxs(d,{children:[a.jsx("div",{className:"space-y-3",children:l.sort((e,s)=>{var a,t;return((null==(a=s.score)?void 0:a.total_score)||0)-((null==(t=e.score)?void 0:t.total_score)||0)}).slice(0,5).map((e,s)=>{var t,r,n;const i=10*((null==(t=e.score)?void 0:t.total_score)||0)+((null==(r=e.score)?void 0:r.royalty_cents_earned)||0),o=l.length>0?Math.max(...l.map(e=>{var s,a;return 10*((null==(s=e.score)?void 0:s.total_score)||0)+((null==(a=e.score)?void 0:a.royalty_cents_earned)||0)})):1;return a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-lg font-bold text-muted-foreground w-6",children:["#",s+1]}),a.jsx("div",{className:"h-10 w-10 rounded overflow-hidden bg-muted flex-shrink-0",children:a.jsx("img",{src:e.image_path,alt:e.title,className:"h-full w-full object-cover"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium truncate",children:e.title}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx(ie,{value:i/o*100,className:"h-1.5 flex-1"}),a.jsx("span",{className:"text-xs text-muted-foreground w-12 text-right",children:((null==(n=e.score)?void 0:n.total_score)||0).toFixed(1)})]})]}),a.jsx(m,{variant:"outline",className:"flex-shrink-0",children:b(i)})]},e.id)})}),0===l.length&&a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(se,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),a.jsx("p",{children:"No visions in your collection yet"}),a.jsx("p",{className:"text-sm",children:"Create or claim visions to build your portfolio"})]})]})]}),a.jsx(t,{className:"bg-muted/30",children:a.jsxs(d,{className:"p-4",children:[a.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center gap-2",children:[a.jsx($,{className:"h-4 w-4"}),"How Value Works"]}),a.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 text-xs text-muted-foreground",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(m,{variant:"outline",className:"mt-0.5",children:"1"}),a.jsx("p",{children:"Vision score accumulates from views, downloads, prints, and trades"})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(m,{variant:"outline",className:"mt-0.5",children:"2"}),a.jsxs("p",{children:[Math.round(100*ne.valueAppreciationRate),"% of print order revenue adds to your holdings value"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(m,{variant:"outline",className:"mt-0.5",children:"3"}),a.jsx("p",{children:"List visions for sale on the marketplace at your chosen price"})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(m,{variant:"outline",className:"mt-0.5",children:"4"}),a.jsxs("p",{children:[Math.round(100*ne.sellerRetentionRate),"% of sales go to you (",Math.round(100*ne.marketplaceTransactionFee),"% platform fee)"]})]})]})]})})]})},Ms=({viz:e,listedIds:r,isDownloading:n,onNavigate:i,onDownload:o,onPrint:c,onSell:u,onDelete:x,onCopyLink:h,onViewPublic:p,isPrivate:g})=>{const[j,v]=s.useState(!1);return a.jsxs(t,{className:"overflow-hidden group cursor-pointer transition-all hover:ring-2 hover:ring-primary/50 active:scale-[0.98]",onClick:i,children:[a.jsxs("div",{className:"relative aspect-square",children:[a.jsx("img",{src:e.image_path,alt:e.title,className:"w-full h-full object-cover",loading:"lazy"}),a.jsxs("div",{className:`absolute inset-0 bg-black/60 transition-opacity flex flex-col items-center justify-center gap-2 p-3\n            ${j?"opacity-100":"opacity-0"}\n            sm:group-hover:opacity-100 sm:opacity-0`,onClick:e=>{e.stopPropagation(),window.innerWidth<640&&v(!j)},children:[a.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full max-w-[200px]",children:[a.jsxs(l,{size:"sm",variant:"secondary",onClick:e=>{e.stopPropagation(),i()},className:"gap-1 text-xs sm:text-sm",children:[a.jsx(Le,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Open"}),a.jsx("span",{className:"sm:hidden",children:"View"})]}),a.jsxs(l,{size:"sm",variant:"secondary",onClick:e=>{e.stopPropagation(),o()},className:"gap-1 text-xs sm:text-sm",disabled:n===e.id,children:[n===e.id?a.jsx(f,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}):a.jsx(pe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"DL"})]}),a.jsxs(l,{size:"sm",onClick:e=>{e.stopPropagation(),c()},className:"gap-1 bg-gradient-to-r from-amber-500/80 to-amber-600/80 hover:from-amber-500 hover:to-amber-600 text-stone-900 text-xs sm:text-sm",children:[a.jsx(te,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"Print"})]}),!r.has(e.id)&&!g&&a.jsxs(l,{size:"sm",variant:"secondary",onClick:e=>{e.stopPropagation(),u()},className:"gap-1 text-xs sm:text-sm",children:[a.jsx(Fe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),a.jsx("span",{children:"Sell"})]})]}),a.jsxs(l,{size:"sm",variant:"destructive",onClick:e=>{e.stopPropagation(),x()},className:"gap-1 w-full max-w-[200px] text-xs sm:text-sm mt-2",children:[a.jsx(Pe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Delete"]}),a.jsx("span",{className:"text-white/60 text-[10px] sm:hidden mt-1",children:"Tap image to close"})]}),a.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-black/60 text-white/80 text-[10px] px-2 py-1 rounded-full backdrop-blur-sm transition-opacity sm:hidden\n            "+(j?"opacity-0":"opacity-100"),children:"Tap for actions"}),r.has(e.id)&&a.jsxs(m,{className:"absolute top-2 left-2 bg-green-500/90 text-[10px] sm:text-xs",children:[a.jsx(Be,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 mr-1"}),"Listed"]}),g&&a.jsxs(m,{variant:"secondary",className:"absolute top-2 right-2 text-[10px] sm:text-xs",children:[a.jsx(we,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 mr-1"}),"Private"]})]}),a.jsxs(d,{className:"p-3 sm:p-4 space-y-2",children:[a.jsx("h3",{className:"font-medium truncate text-sm sm:text-base",children:e.title}),a.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",children:[e.game_data.white," vs ",e.game_data.black]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),e.public_share_id&&a.jsxs("div",{className:"flex gap-1",children:[a.jsx(l,{size:"icon",variant:"ghost",className:"h-7 w-7 sm:h-6 sm:w-6",onClick:e=>{e.stopPropagation(),h()},title:"Copy share link",children:a.jsx(fe,{className:"h-3.5 w-3.5 sm:h-3 sm:w-3"})}),a.jsx(l,{size:"icon",variant:"ghost",className:"h-7 w-7 sm:h-6 sm:w-6",onClick:e=>{e.stopPropagation(),p()},title:"View public page",children:a.jsx(Le,{className:"h-3.5 w-3.5 sm:h-3 sm:w-3"})})]})]})]})]})},qs=()=>{const r=le(),{user:i,isPremium:c,isLoading:m}=e(),{setOrderData:u}=oe(),{setCurrentSimulation:x,setSavedShareId:h,setReturningFromOrder:p,returningFromOrder:g,capturedTimelineState:b,setCapturedTimelineState:N}=ce(),[y,w]=s.useState([]),[C,_]=s.useState(!0),[z,D]=s.useState(!1),[k,S]=s.useState(null),[M,q]=s.useState(!1),[A,P]=s.useState(!1),[L,B]=s.useState(null),[H,I]=s.useState(new Set),[G,V]=s.useState(!1),[R,K]=s.useState(!1),[U,E]=s.useState(null),[F,Y]=s.useState("public");s.useEffect(()=>{if(g&&b){const{currentMove:e,totalMoves:s,title:t}=b,r=t||"Visualization",n=void 0!==e&&void 0!==s?`Move ${e} of ${s}`:void 0!==e?`Move ${e}`:"Your gallery is ready";j.success(`${r} restored!`,{description:n,icon:a.jsx(Q,{className:"w-4 h-4"})}),p(!1),N(null)}},[g,b,p,N]);const W=s.useCallback(async()=>{if(!i)return;_(!0);const{data:e,error:s}=await Ge(i.id);if(s)j.error("Failed to load visualizations",{description:s.message});else{if(w(e),e.length>0){const s=e.map(e=>e.id),a=await de(s);I(new Set(Object.entries(a).filter(([e,s])=>s).map(([e])=>e)))}else I(new Set);e.some(e=>!e.game_data.board||!Array.isArray(e.game_data.board))&&e.length>0&&O()}_(!1)},[i]);Re({userId:null==i?void 0:i.id,onVisualizationChange:W,onScoreChange:()=>{},enabled:!!i&&c}),s.useEffect(()=>{i&&c?W():_(!1)},[i,c,W]);const O=async()=>{if(i&&!z){D(!0);try{const e=await async function(e){const s=Ze,a={};a[s(144)]=function(e,s){return e||s},a[s(220)]=function(e,s){return e===s},a[s(208)]="dwaad",a[s(159)]=s(187);const t=a,r={};r[s(172)]=0,r[s(149)]=0,r[s(176)]=0,r[s(143)]=[];const n=r,{data:i,error:l}=await v.from(s(180)+"alizations").select("*").eq(s(160),e);if(t[s(144)](l,!i))return n[s(143)][s(170)]((null==l?void 0:l.message)||"Failed to "+s(216)+s(226)),n;n[s(172)]=i[s(141)];for(const o of i){const e=o;if(!e.game_data[s(152)]||!Array[s(189)](e[s(151)][s(152)])){if(t[s(220)](t[s(208)],"ajASr")){const e={};return e[s(181)]=!1,e.error="No PGN dat"+s(153)+"e for rege"+s(178),e}{const a=await Xe(e);a[s(181)]?t[s(220)](s(187),t[s(159)])?n[s(149)]++:(_0x250592.failed++,_0x1de94b[s(184)]&&_0x461380.errors[s(170)](_0x392691.title+": "+_0x548d73[s(184)])):(n[s(176)]++,a[s(184)]&&n[s(143)].push(e.title+": "+a[s(184)]))}}}return n}(i.id);if(e.migrated>0){j.success(`Updated ${e.migrated} visualization(s)`,{description:"Your saved games now support full interactivity"});const{data:s}=await Ge(i.id);s&&w(s)}e.failed}catch(e){}finally{D(!1)}}},T=async e=>{E(e.id);try{const s=await async function(){const e=Je,s={};s.SteXl=e(367),s[e(341)]=e(388)+e(327)+e(374),s[e(393)]=e(379);const a=s;try{if(a.SteXl!==a[e(385)]){const s=_0x5de23e[e(373)](_0x39d513,arguments);return _0x1b0b93=null,s}{const{data:{session:s}}=await v[e(364)][e(331)]();if(!(null==s?void 0:s[e(357)+"en"])){const s={allowed:!1};return s[e(337)]=e(354)+e(363),s[e(401)]="Please sign in to download HD "+e(381),s}const t={};t[e(371)+"ion"]=e(350)+s[e(357)+"en"];const r={};r[e(387)]=t;const{data:n,error:i}=await v[e(413)][e(412)](e(376)+e(330)+"nload",r);if(i){const s={};return s[e(386)]=!1,s[e(337)]=a[e(393)],s[e(401)]=e(375)+e(343)+e(378)+"tus. Pleas"+e(335)+"n.",s}const l={};return l[e(386)]=n[e(386)],l.reason=n[e(337)],l[e(401)]=n[e(401)],l["subscripti"+e(356)]=n[e(402)+e(362)],l}}catch(t){const s={};return s[e(386)]=!1,s[e(337)]=e(379),s[e(401)]="An unexpec"+e(355)+"occurred. "+e(403)+e(360),s}}();if(!s.allowed)return j.error("Premium Required",{description:s.message||"Upgrade to Premium for HD downloads"}),void V(!0);const a=await fetch(e.image_path),t=await a.blob(),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`${e.title.replace(/[^a-z0-9]/gi,"-")}.png`,n.click(),URL.revokeObjectURL(r),j.success("Image downloaded!")}catch(s){j.error("Failed to download image")}finally{E(null)}},Z=async e=>{var s;const a=e.pgn||e.game_data.pgn,t=null==(s=e.game_data.visualizationState)?void 0:s.paletteId;if(!a)return void j.error("Share link not available");const r=Ie(a,t);try{await navigator.clipboard.writeText(r),j.success("Share link copied!",{description:"Universal game link!"})}catch{j.error("Failed to copy link")}},X=e=>{var s;const a=e.pgn||e.game_data.pgn,t=null==(s=e.game_data.visualizationState)?void 0:s.paletteId;if(!a)return;const r=He(a),n=new URLSearchParams;t&&n.set("p",t);const i=n.toString();window.open(`/g/${r}${i?`?${i}`:""}`,"_blank")},$=e=>{var s;const a=e.game_data,t={board:a.board||Array(8).fill(null).map((e,s)=>Array(8).fill(null).map((e,a)=>({file:a,rank:s,visits:[],isLight:(a+s)%2==1}))),gameData:{white:a.white||"White",black:a.black||"Black",event:a.event||"",date:a.date||"",result:a.result||"",pgn:a.pgn||e.pgn||"",moves:a.moves||[]},totalMoves:a.totalMoves||(null==(s=a.moves)?void 0:s.length)||0};x(t,e.pgn||"",e.title),h(e.public_share_id||null),p(!0),u({visualizationId:e.id,imagePath:e.image_path,title:e.title,pgn:e.pgn||void 0,gameData:{white:e.game_data.white,black:e.game_data.black,event:e.game_data.event,date:e.game_data.date,result:e.game_data.result},simulation:t,shareId:e.public_share_id,returnPath:"/my-vision"}),r("/order-print")};return m?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(me,{}),a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})})}),a.jsx(ue,{})]}):i?c?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(me,{}),a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[a.jsx(Ue,{className:"mb-6"}),a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(n,{className:"h-6 w-6 text-primary"}),a.jsx("h1",{className:"text-3xl font-display font-bold",children:"My Vision Gallery"})]}),a.jsx("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide shrink-0",children:z?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground shrink-0",children:[a.jsx(o,{className:"h-4 w-4 animate-spin"}),a.jsx("span",{children:"Updating..."})]}):a.jsxs(a.Fragment,{children:[a.jsxs(l,{variant:"outline",size:"sm",onClick:O,disabled:z||0===y.length,className:"gap-2 shrink-0",title:"Refresh and re-process any failed visualizations",children:[a.jsx(o,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),a.jsxs(l,{variant:"outline",size:"sm",onClick:()=>K(!R),className:"gap-2 shrink-0",children:[a.jsx(ge,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Subscription"})]})]})})]}),a.jsx("p",{className:"text-muted-foreground",children:"Your saved chess visualizations, ready to download anytime."})]}),R&&a.jsx("div",{className:"mb-8 max-w-md",children:a.jsx(Ye,{})}),a.jsx("div",{className:"mb-6 sm:mb-8",children:a.jsx(Ss,{})}),C?a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6",children:[...Array(4)].map((e,s)=>a.jsxs(t,{className:"overflow-hidden",children:[a.jsx(je,{className:"aspect-square w-full"}),a.jsxs(d,{className:"p-3 sm:p-4 space-y-2",children:[a.jsx(je,{className:"h-4 sm:h-5 w-3/4"}),a.jsx(je,{className:"h-3 sm:h-4 w-1/2"})]})]},s))}):0===y.length?a.jsxs("div",{className:"text-center py-16 space-y-4",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center",children:a.jsx(se,{className:"h-10 w-10 text-muted-foreground"})})}),a.jsx("h2",{className:"text-xl font-medium",children:"No visualizations yet"}),a.jsx("p",{className:"text-muted-foreground max-w-sm mx-auto",children:"Create a chess visualization and save it to your gallery to see it here."}),a.jsx(l,{onClick:()=>r("/"),className:"btn-luxury mt-4",children:"Create Your First Visualization"})]}):a.jsxs(ve,{value:F,onValueChange:e=>Y(e),children:[a.jsxs(be,{className:"mb-6",children:[a.jsxs(Ne,{value:"public",className:"gap-2",children:[a.jsx(ye,{className:"h-4 w-4"}),"Public (",y.filter(e=>!e.game_data.is_private).length,")"]}),a.jsxs(Ne,{value:"private",className:"gap-2",children:[a.jsx(we,{className:"h-4 w-4"}),"Private (",y.filter(e=>e.game_data.is_private).length,")"]})]}),a.jsxs(Ce,{value:"public",children:[a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6",children:y.filter(e=>!e.game_data.is_private).map(e=>a.jsx(Ms,{viz:e,listedIds:H,isDownloading:U,onNavigate:()=>r(`/my-vision/${e.id}`),onDownload:()=>T(e),onPrint:()=>$(e),onSell:()=>B(e),onDelete:()=>S(e),onCopyLink:()=>Z(e),onViewPublic:()=>X(e)},e.id))}),0===y.filter(e=>!e.game_data.is_private).length&&a.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No public visions yet. Your visions will be visible to other collectors here."})]}),a.jsxs(Ce,{value:"private",children:[a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6",children:y.filter(e=>e.game_data.is_private).map(e=>a.jsx(Ms,{viz:e,listedIds:H,isDownloading:U,onNavigate:()=>r(`/my-vision/${e.id}`),onDownload:()=>T(e),onPrint:()=>$(e),onSell:()=>B(e),onDelete:()=>S(e),onCopyLink:()=>Z(e),onViewPublic:()=>X(e),isPrivate:!0},e.id))}),0===y.filter(e=>e.game_data.is_private).length&&a.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No private visions. Toggle any vision to private to hide it from other collectors."})]})]})]}),a.jsx(_e,{open:!!k,onOpenChange:()=>S(null),children:a.jsxs(ze,{children:[a.jsxs(De,{children:[a.jsx(ke,{children:"Delete Visualization?"}),a.jsxs(Se,{children:['This will permanently delete "',null==k?void 0:k.title,'" from your gallery. This action cannot be undone.']})]}),a.jsxs(Me,{children:[a.jsx(qe,{disabled:M,children:"Cancel"}),a.jsxs(Ae,{onClick:async()=>{if(!k)return;q(!0);const{error:e}=await Ve(k.id,k.image_path);e?j.error("Failed to delete visualization",{description:e.message}):(w(e=>e.filter(e=>e.id!==k.id)),j.success("Visualization deleted")),q(!1),S(null)},disabled:M,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[M?a.jsx(f,{className:"h-4 w-4 animate-spin mr-2"}):a.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),L&&a.jsx(ks,{isOpen:!!L,onClose:()=>B(null),visualizationId:L.id,visualizationTitle:L.title,onSuccess:()=>{W()}}),a.jsx(xe,{isOpen:G,onClose:()=>V(!1),onAuthRequired:()=>{V(!1),P(!0)},trigger:"save"}),a.jsx(ue,{})]}):a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(me,{}),a.jsx("div",{className:"container mx-auto px-4 py-16",children:a.jsxs("div",{className:"max-w-2xl mx-auto text-center space-y-8",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center",children:a.jsx(Q,{className:"h-10 w-10 text-primary"})})}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h1",{className:"text-3xl font-display font-bold",children:"Unlock My Vision Gallery"}),a.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed",children:"Save your chess visualizations to a personal gallery. Download them anytime, share with unique QR codes, and build your collection of chess art."})]}),a.jsxs("div",{className:"grid sm:grid-cols-3 gap-4 text-left",children:[a.jsxs("div",{className:"p-4 rounded-lg bg-card border border-border/50",children:[a.jsx(pe,{className:"h-6 w-6 text-primary mb-2"}),a.jsx("h3",{className:"font-medium text-sm",children:"Unlimited Downloads"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"HD images, no watermarks"})]}),a.jsxs("div",{className:"p-4 rounded-lg bg-card border border-border/50",children:[a.jsx(fe,{className:"h-6 w-6 text-primary mb-2"}),a.jsx("h3",{className:"font-medium text-sm",children:"Shareable Links"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Unique QR codes for prints"})]}),a.jsxs("div",{className:"p-4 rounded-lg bg-card border border-border/50",children:[a.jsx(se,{className:"h-6 w-6 text-primary mb-2"}),a.jsx("h3",{className:"font-medium text-sm",children:"Personal Gallery"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"All your art in one place"})]})]}),a.jsxs(l,{onClick:()=>V(!0),className:"btn-luxury gap-2",size:"lg",children:[a.jsx(n,{className:"h-5 w-5"}),"Become a Visionary"]})]})}),a.jsx(ue,{})]}):a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(me,{}),a.jsxs("div",{className:"container mx-auto px-4 py-16",children:[a.jsxs("div",{className:"max-w-md mx-auto text-center space-y-6",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:a.jsx(n,{className:"h-8 w-8 text-primary"})})}),a.jsx("h1",{className:"text-2xl font-display font-bold",children:"My Vision Gallery"}),a.jsx("p",{className:"text-muted-foreground",children:"Sign in to access your personal gallery of saved chess visualizations."}),a.jsx(l,{onClick:()=>V(!0),className:"btn-luxury",children:"Sign In to Continue"})]}),a.jsx(xe,{isOpen:G,onClose:()=>V(!1),onAuthRequired:()=>{V(!1),P(!0)},trigger:"save"}),a.jsx(he,{isOpen:A,onClose:()=>P(!1)})]}),a.jsx(ue,{})]})};export{qs as default};
