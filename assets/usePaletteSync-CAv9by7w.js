const e="/**\n * Palette Synchronization Hook\n * \n * Ensures palette state is synchronized between:\n * - URL parameters (?p=)\n * - Global pieceColors module state\n * - React component state\n * - Session/localStorage persistence\n * \n * This is the SINGLE SOURCE OF TRUTH for palette state.\n */\n\nimport { useEffect, useCallback, useRef, useMemo } from 'react';\nimport { useSearchParams, useLocation } from 'react-router-dom';\nimport { \n  setActivePalette, \n  getActivePalette, \n  PaletteId, \n  colorPalettes,\n  ColorPalette,\n} from '@/lib/chess/pieceColors';\n\ninterface PaletteSyncState {\n  paletteId: PaletteId;\n  palette: ColorPalette;\n  whitePalette: Record<string, string>;\n  blackPalette: Record<string, string>;\n  setPalette: (id: PaletteId) => void;\n  updateUrlPalette: (id: PaletteId) => void;\n}\n\nconst DEFAULT_PALETTE: PaletteId = 'modern';\n\n/**\n * Master hook for palette synchronization across the entire application\n */\nexport function usePaletteSync(initialPaletteId?: string): PaletteSyncState {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const location = useLocation();\n  const lastSyncedRef = useRef<PaletteId | null>(null);\n  \n  // Get palette from URL first (highest priority for shared links)\n  const urlPaletteId = searchParams.get('p') as PaletteId | null;\n  \n  // Determine the effective palette ID with priority:\n  // 1. URL parameter (for shared links)\n  // 2. Initial prop (from component/route)\n  // 3. Currently active global palette\n  // 4. Default\n  const effectivePaletteId = useMemo((): PaletteId => {\n    // URL takes precedence for shared links\n    if (urlPaletteId && colorPalettes.some(p => p.id === urlPaletteId)) {\n      return urlPaletteId;\n    }\n    \n    // Then initial prop\n    if (initialPaletteId && colorPalettes.some(p => p.id === initialPaletteId)) {\n      return initialPaletteId as PaletteId;\n    }\n    \n    // Then current global state\n    const current = getActivePalette();\n    if (current && current.id !== 'hotCold') {\n      return current.id;\n    }\n    \n    return DEFAULT_PALETTE;\n  }, [urlPaletteId, initialPaletteId]);\n  \n  // Get the full palette object\n  const palette = useMemo(() => {\n    return colorPalettes.find(p => p.id === effectivePaletteId) || \n           colorPalettes.find(p => p.id === DEFAULT_PALETTE)!;\n  }, [effectivePaletteId]);\n  \n  // Sync global state when effective palette changes\n  useEffect(() => {\n    if (effectivePaletteId !== lastSyncedRef.current) {\n      setActivePalette(effectivePaletteId);\n      lastSyncedRef.current = effectivePaletteId;\n    }\n  }, [effectivePaletteId]);\n  \n  // Set palette and update all sources\n  const setPalette = useCallback((id: PaletteId) => {\n    // Validate palette exists\n    if (!colorPalettes.some(p => p.id === id)) {\n      console.warn(`[PaletteSync] Invalid palette ID: ${id}`);\n      return;\n    }\n    \n    // Update global state\n    setActivePalette(id);\n    lastSyncedRef.current = id;\n    \n    // Update URL if on a game view route\n    if (location.pathname.startsWith('/g/')) {\n      const newParams = new URLSearchParams(searchParams);\n      if (id !== DEFAULT_PALETTE) {\n        newParams.set('p', id);\n      } else {\n        newParams.delete('p');\n      }\n      setSearchParams(newParams, { replace: true });\n    }\n  }, [location.pathname, searchParams, setSearchParams]);\n  \n  // Update only the URL palette without triggering full sync\n  const updateUrlPalette = useCallback((id: PaletteId) => {\n    const newParams = new URLSearchParams(searchParams);\n    if (id !== DEFAULT_PALETTE) {\n      newParams.set('p', id);\n    } else {\n      newParams.delete('p');\n    }\n    setSearchParams(newParams, { replace: true });\n  }, [searchParams, setSearchParams]);\n  \n  return {\n    paletteId: effectivePaletteId,\n    palette,\n    whitePalette: palette.white,\n    blackPalette: palette.black,\n    setPalette,\n    updateUrlPalette,\n  };\n}\n\n/**\n * Read-only hook for components that just need current palette\n */\nexport function useCurrentPalette(): ColorPalette {\n  const current = getActivePalette();\n  return current;\n}\n\n/**\n * Palette validation utility\n */\nexport function isValidPalette(id: string | null | undefined): id is PaletteId {\n  if (!id) return false;\n  return colorPalettes.some(p => p.id === id);\n}\n";export{e as default};
