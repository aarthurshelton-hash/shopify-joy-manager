const e='import React, { useEffect, useMemo, useState } from \'react\';\nimport { useNavigate, useLocation } from \'react-router-dom\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { \n  ArrowLeft, \n  Sparkles, \n  Sun, \n  Moon, \n  Package,\n  Crown,\n  Image as ImageIcon,\n  ShoppingCart,\n  Check,\n  Palette,\n  Swords,\n  BookOpen,\n} from \'lucide-react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Card, CardContent } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Header } from \'@/components/shop/Header\';\nimport { Footer } from \'@/components/shop/Footer\';\nimport { ProductSelector } from \'@/components/shop/ProductSelector\';\nimport LifestyleMockupGallery from \'@/components/shop/LifestyleMockupGallery\';\nimport { usePrintOrderStore, PrintOrderData } from \'@/stores/printOrderStore\';\nimport { useCartStore } from \'@/stores/cartStore\';\nimport PrintReadyVisualization from \'@/components/chess/PrintReadyVisualization\';\nimport GameInfoDisplay from \'@/components/chess/GameInfoDisplay\';\nimport { SquareData } from \'@/lib/chess/gameSimulator\';\nimport { getPaletteArt, getPaletteDisplayName, isPremiumPalette } from \'@/lib/marketplace/paletteArtMap\';\nimport { getGameImage } from \'@/lib/chess/gameImages\';\nimport { detectGameCard, GameCardMatch } from \'@/lib/chess/gameCardDetection\';\nimport { detectOpeningFromPgn } from \'@/lib/chess/openingDetector\';\nimport { OpeningBadge, OpeningMarketingCard } from \'@/components/chess/OpeningBadge\';\nimport enPensentLogo from \'@/assets/en-pensent-logo-new.png\';\n\n/**\n * Filter board data to match a specific move in the timeline\n */\nfunction filterBoardToMove(board: SquareData[][], currentMove: number): SquareData[][] {\n  if (currentMove === Infinity || currentMove <= 0) return board;\n  \n  return board.map(row => \n    row.map(square => ({\n      ...square,\n      visits: square.visits.filter(visit => visit.moveNumber <= currentMove)\n    }))\n  );\n}\n\n// Location state from marketplace navigation\ninterface MarketplaceNavState {\n  fromMarketplace?: boolean;\n  visualizationId?: string;\n  title?: string;\n  imageUrl?: string;\n}\n\nconst OrderPrint: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { orderData: storeOrderData, setOrderData, clearOrderData } = usePrintOrderStore();\n  const [darkMode, setDarkMode] = useState(false);\n\n  // Check for marketplace navigation state\n  const navState = location.state as MarketplaceNavState | null;\n  \n  // Build order data from either store or navigation state\n  const orderData = useMemo(() => {\n    // If we have store data, use that\n    if (storeOrderData) return storeOrderData;\n    \n    // If we came from marketplace with state, construct order data\n    if (navState?.fromMarketplace && navState.title) {\n      const marketplaceOrder: PrintOrderData = {\n        visualizationId: navState.visualizationId,\n        imagePath: navState.imageUrl,\n        title: navState.title || \'Chess Visualization\',\n        gameData: {\n          white: \'White\',\n          black: \'Black\',\n        },\n        returnPath: `/marketplace/${navState.visualizationId}`,\n      };\n      return marketplaceOrder;\n    }\n    \n    return null;\n  }, [storeOrderData, navState]);\n\n  // Redirect if no order data\n  useEffect(() => {\n    if (!orderData) {\n      navigate(\'/\', { replace: true });\n    }\n  }, [orderData, navigate]);\n\n  if (!orderData) {\n    return null;\n  }\n\n  const hasEnPensentData = orderData.moveHistory && orderData.whitePalette && orderData.blackPalette;\n  const hasSimulation = !!orderData.simulation;\n  const hasImagePath = !!orderData.imagePath;\n\n  // Prepare simulation for ProductSelector - apply captured state filtering\n  const simulationForCart = orderData.simulation;\n  \n  // Apply captured state filtering to the display board\n  const displayBoard = useMemo(() => {\n    if (!orderData.simulation) return null;\n    \n    const capturedState = orderData.capturedState;\n    if (capturedState && capturedState.currentMove !== Infinity && capturedState.currentMove > 0) {\n      return filterBoardToMove(orderData.simulation.board, capturedState.currentMove);\n    }\n    return orderData.simulation.board;\n  }, [orderData.simulation, orderData.capturedState]);\n\n  // Get palette and game card artwork for banners\n  const paletteArt = useMemo(() => getPaletteArt(orderData.paletteId), [orderData.paletteId]);\n  const paletteName = useMemo(() => getPaletteDisplayName(orderData.paletteId), [orderData.paletteId]);\n  const isPremiumPaletteFlag = useMemo(() => isPremiumPalette(orderData.paletteId), [orderData.paletteId]);\n  \n  // Get game card artwork - either from stored gameId or by detecting from PGN\n  const gameCardArt = useMemo(() => {\n    // First try direct lookup by gameId\n    if (orderData.gameId) {\n      const art = getGameImage(orderData.gameId);\n      if (art) return art;\n    }\n    // Otherwise detect from PGN\n    if (orderData.pgn) {\n      const match = detectGameCard(orderData.pgn);\n      if (match.isMatch && match.matchedGame) {\n        return getGameImage(match.matchedGame.id);\n      }\n    }\n    return null;\n  }, [orderData.gameId, orderData.pgn]);\n  \n  // Get game card match info for display\n  const gameCardMatch = useMemo(() => {\n    if (orderData.pgn) {\n      return detectGameCard(orderData.pgn);\n    }\n    return null;\n  }, [orderData.pgn]);\n  \n  // Detect opening from PGN\n  const detectedOpening = useMemo(() => {\n    if (orderData.pgn) {\n      return detectOpeningFromPgn(orderData.pgn);\n    }\n    return null;\n  }, [orderData.pgn]);\n  \n  // Check if this item is already in cart\n  const cartItems = useCartStore(state => state.items);\n  const isInCart = useMemo(() => {\n    return cartItems.some(item => \n      item.customPrintData?.gameHash === orderData.gameHash &&\n      item.customPrintData?.paletteId === orderData.paletteId\n    );\n  }, [cartItems, orderData.gameHash, orderData.paletteId]);\n  \n  // Count similar items in cart (same game, different sizes/frames)\n  const cartItemCount = useMemo(() => {\n    return cartItems.filter(item => \n      item.customPrintData?.gameHash === orderData.gameHash\n    ).reduce((sum, item) => sum + item.quantity, 0);\n  }, [cartItems, orderData.gameHash]);\n\n  return (\n    <div className="min-h-screen bg-background">\n      <Header />\n      \n      <main className="container mx-auto px-4 py-8 max-w-6xl">\n        {/* Game Card / Palette Hero Banner */}\n        <AnimatePresence>\n          {(gameCardArt || paletteArt) && (\n            <motion.div \n              className="relative h-32 md:h-40 -mx-4 mb-6 overflow-hidden rounded-xl mx-0"\n              initial={{ opacity: 0, y: -20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n            >\n              <img \n                src={gameCardArt || paletteArt!} \n                alt="Vision Banner"\n                className="w-full h-full object-cover"\n              />\n              <div className="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-transparent" />\n              <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />\n              \n              {/* Banner Content */}\n              <div className="absolute bottom-4 left-4 right-4 flex items-end justify-between">\n                <div className="space-y-1">\n                  {gameCardMatch?.isMatch && gameCardMatch.matchedGame && (\n                    <div className="flex items-center gap-2">\n                      <Swords className="h-4 w-4 text-white/90" />\n                      <span className="text-sm font-medium text-white/90">\n                        Famous Game Card\n                      </span>\n                      <Badge className="bg-amber-500/90 text-stone-900 text-[10px] px-1.5">\n                        {gameCardMatch.matchType === \'exact\' ? \'Exact Match\' : \'Partial Match\'}\n                      </Badge>\n                    </div>\n                  )}\n                  {paletteArt && paletteName && (\n                    <div className="flex items-center gap-2">\n                      <Palette className="h-4 w-4 text-white/90" />\n                      <span className="text-sm font-medium text-white/90">\n                        {paletteName} Palette\n                      </span>\n                      {isPremiumPaletteFlag && (\n                        <Badge className="bg-gradient-to-r from-amber-500 to-amber-600 text-stone-900 text-[10px] px-1.5 border-0">\n                          Premium\n                        </Badge>\n                      )}\n                    </div>\n                  )}\n                  {detectedOpening && (\n                    <div className="flex items-center gap-2">\n                      <BookOpen className="h-4 w-4 text-white/90" />\n                      <span className="text-sm font-medium text-white/90">\n                        {detectedOpening.fullName}\n                      </span>\n                      <Badge className="bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-[10px] px-1.5 border-0">\n                        Book Opening\n                      </Badge>\n                    </div>\n                  )}\n                </div>\n                \n                {/* Cart indicator on banner */}\n                {cartItemCount > 0 && (\n                  <motion.div\n                    initial={{ scale: 0 }}\n                    animate={{ scale: 1 }}\n                    className="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary text-primary-foreground text-xs font-medium shadow-lg"\n                  >\n                    <ShoppingCart className="h-3.5 w-3.5" />\n                    <span>{cartItemCount} in cart</span>\n                    <Check className="h-3 w-3" />\n                  </motion.div>\n                )}\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Back Button & Header */}\n        <motion.div \n          className="mb-8"\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <Button \n            variant="ghost" \n            onClick={() => {\n              if (orderData.returnPath) {\n                navigate(orderData.returnPath);\n              } else {\n                navigate(-1);\n              }\n            }}\n            className="mb-4 -ml-2"\n          >\n            <ArrowLeft className="h-4 w-4 mr-2" />\n            Return\n          </Button>\n          \n          <div className="flex items-center justify-between gap-3">\n            <div className="flex items-center gap-3">\n              <div className="h-12 w-12 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-lg shadow-amber-500/20">\n                <Package className="h-6 w-6 text-stone-900" />\n              </div>\n              <div>\n                <h1 className="text-2xl md:text-3xl font-display font-bold">Order Premium Print</h1>\n                <p className="text-muted-foreground text-sm">Turn your chess art into museum-quality wall art</p>\n              </div>\n            </div>\n            \n            {/* Mobile cart indicator */}\n            {cartItemCount > 0 && !(gameCardArt || paletteArt) && (\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                className="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-primary/10 border border-primary/30 text-primary text-xs font-medium"\n              >\n                <ShoppingCart className="h-3.5 w-3.5" />\n                <span>{cartItemCount}</span>\n              </motion.div>\n            )}\n          </div>\n        </motion.div>\n\n        <div className="grid lg:grid-cols-2 gap-8">\n          {/* Preview Column */}\n          <motion.div \n            className="space-y-4"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.1 }}\n          >\n            <Card className="overflow-hidden">\n              <CardContent className="p-4 sm:p-6">\n                {/* Mode Toggle for En Pensent visualization */}\n                {hasEnPensentData && (\n                  <div className="flex justify-center gap-2 mb-4">\n                    <Button\n                      variant={darkMode ? "outline" : "default"}\n                      size="sm"\n                      onClick={() => setDarkMode(false)}\n                      className="gap-2 text-xs"\n                    >\n                      <Sun className="h-3 w-3" />\n                      Light\n                    </Button>\n                    <Button\n                      variant={darkMode ? "default" : "outline"}\n                      size="sm"\n                      onClick={() => setDarkMode(true)}\n                      className="gap-2 text-xs"\n                    >\n                      <Moon className="h-3 w-3" />\n                      Dark\n                    </Button>\n                  </div>\n                )}\n\n                {/* Visualization Preview - using unified PrintReadyVisualization */}\n                <div className="flex justify-center">\n                  {hasSimulation && displayBoard ? (\n                    // Full simulation visualization - includes highlight state for exact match\n                    <PrintReadyVisualization \n                      board={displayBoard}\n                      gameData={{\n                        ...orderData.simulation!.gameData,\n                        moves: orderData.simulation!.gameData.moves,\n                      }}\n                      size={400}\n                      darkMode={orderData.capturedState?.darkMode ?? darkMode}\n                      title={orderData.title}\n                      compact={false}\n                      pgn={orderData.pgn}\n                      highlightState={orderData.capturedState?.lockedPieces && orderData.capturedState.lockedPieces.length > 0 ? {\n                        lockedPieces: orderData.capturedState.lockedPieces.map(p => ({\n                          pieceType: p.pieceType as \'k\' | \'q\' | \'r\' | \'b\' | \'n\' | \'p\',\n                          pieceColor: (p.pieceColor === \'white\' ? \'w\' : p.pieceColor === \'black\' ? \'b\' : p.pieceColor) as \'w\' | \'b\',\n                        })),\n                        compareMode: orderData.capturedState.compareMode || false,\n                      } : undefined}\n                      piecesState={orderData.capturedState?.showPieces ? {\n                        showPieces: true,\n                        pieceOpacity: orderData.capturedState.pieceOpacity ?? 0.7,\n                        currentMoveNumber: orderData.capturedState.currentMove,\n                      } : undefined}\n                    />\n                  ) : hasEnPensentData ? (\n                    // En Pensent live game visualization - unified component\n                    <PrintReadyVisualization \n                      enPensentData={{\n                        moveHistory: orderData.moveHistory!,\n                        whitePalette: orderData.whitePalette!,\n                        blackPalette: orderData.blackPalette!,\n                      }}\n                      gameData={{\n                        white: orderData.gameData.white,\n                        black: orderData.gameData.black,\n                        event: orderData.gameData.event || \'Chess Game\',\n                        date: orderData.gameData.date || \'\',\n                        result: orderData.gameData.result || \'\',\n                      }}\n                      size={400}\n                      darkMode={darkMode}\n                      title={orderData.title}\n                      compact={false}\n                    />\n                  ) : hasImagePath ? (\n                    // Saved visualization from gallery\n                    <div \n                      className={`p-6 rounded-lg border shadow-xl ${\n                        darkMode \n                          ? \'bg-[#0A0A0A] border-stone-800\' \n                          : \'bg-[#FDFCFB] border-stone-200\'\n                      }`}\n                    >\n                      <img \n                        src={orderData.imagePath} \n                        alt={orderData.title}\n                        className="w-72 h-72 sm:w-80 sm:h-80 object-contain"\n                      />\n                      <GameInfoDisplay \n                        gameData={{\n                          white: orderData.gameData.white,\n                          black: orderData.gameData.black,\n                          event: orderData.gameData.event || \'Chess Game\',\n                          date: orderData.gameData.date || \'\',\n                          result: orderData.gameData.result || \'\',\n                          moves: [],\n                          pgn: \'\',\n                        }}\n                        darkMode={darkMode}\n                      />\n                      <p \n                        className={`text-center text-[10px] tracking-[0.3em] uppercase mt-4 ${\n                          darkMode ? \'text-stone-600\' : \'text-stone-400\'\n                        }`}\n                      >\n                        ♔ En Pensent ♚\n                      </p>\n                    </div>\n                  ) : (\n                    // Fallback placeholder\n                    <div className="w-64 h-64 sm:w-80 sm:h-80 flex items-center justify-center bg-muted/20 rounded">\n                      <ImageIcon className="h-12 w-12 text-muted-foreground" />\n                    </div>\n                  )}\n                </div>\n\n                {/* Game Title */}\n                <div className="mt-6 text-center space-y-2">\n                  <h2 className="text-lg font-display font-semibold">{orderData.title}</h2>\n                  <div className="flex items-center justify-center gap-2 text-xs text-muted-foreground">\n                    <Sparkles className="h-3 w-3" />\n                    <span>Unique chess art visualization</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Premium Print Benefits */}\n            <Card className="border-primary/20 bg-primary/5">\n              <CardContent className="p-4">\n                <div className="flex items-center gap-2 mb-3">\n                  <Crown className="h-4 w-4 text-primary" />\n                  <span className="text-sm font-medium">Premium Print Features</span>\n                </div>\n                <ul className="space-y-2 text-xs text-muted-foreground">\n                  <li className="flex items-center gap-2">\n                    <div className="h-1 w-1 rounded-full bg-primary" />\n                    Museum-quality archival paper (100+ year color guarantee)\n                  </li>\n                  <li className="flex items-center gap-2">\n                    <div className="h-1 w-1 rounded-full bg-primary" />\n                    Vibrant, fade-resistant giclée inks\n                  </li>\n                  <li className="flex items-center gap-2">\n                    <div className="h-1 w-1 rounded-full bg-primary" />\n                    Worldwide shipping with tracking\n                  </li>\n                  <li className="flex items-center gap-2">\n                    <div className="h-1 w-1 rounded-full bg-primary" />\n                    Optional artistic QR code linking to game replay\n                  </li>\n                </ul>\n              </CardContent>\n            </Card>\n            \n            {/* Opening Marketing Card - if detected */}\n            {detectedOpening && (\n              <OpeningMarketingCard opening={detectedOpening} showValue={true} />\n            )}\n          </motion.div>\n\n          {/* Product Selector Column */}\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.2 }}\n          >\n            <ProductSelector\n              customPrintData={{\n                pgn: orderData.pgn || \'\',\n                gameTitle: orderData.title,\n                previewImageBase64: orderData.imagePath,\n                gameHash: orderData.gameHash,\n                gameId: orderData.gameId,\n                paletteId: orderData.paletteId,\n                gameData: orderData.gameData,\n              }}\n              simulation={simulationForCart}\n              shareId={orderData.shareId}\n              capturedState={orderData.capturedState ? {\n                ...orderData.capturedState,\n                darkMode, // Use current page dark mode setting\n              } : {\n                currentMove: Infinity,\n                selectedPhase: \'all\',\n                lockedPieces: [],\n                compareMode: false,\n                displayMode: \'standard\',\n                darkMode,\n                showTerritory: false,\n                showHeatmaps: false,\n                showPieces: false,\n                pieceOpacity: 0.7,\n                capturedAt: new Date(),\n              }}\n              enPensentData={hasEnPensentData ? {\n                moveHistory: orderData.moveHistory!,\n                whitePalette: orderData.whitePalette!,\n                blackPalette: orderData.blackPalette!,\n                gameInfo: orderData.gameData,\n              } : undefined}\n              onAddedToCart={() => {\n                // Optional: could navigate to cart or show success\n              }}\n            />\n          </motion.div>\n        </div>\n\n        {/* Lifestyle Mockup Gallery Section */}\n        <motion.section\n          className="mt-16 pt-12 border-t border-border/50"\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.4 }}\n        >\n          <LifestyleMockupGallery showTitle={true} />\n        </motion.section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default OrderPrint;\n';export{e as default};
