const n='import React, { useState, useEffect } from \'react\';\nimport { useNavigate } from \'react-router-dom\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { Button } from \'@/components/ui/button\';\nimport { Avatar, AvatarFallback, AvatarImage } from \'@/components/ui/avatar\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n  DropdownMenuLabel,\n} from \'@/components/ui/dropdown-menu\';\nimport { User, LogOut, Palette, Settings, Crown, CreditCard, Image, Gamepad2, BarChart3, History, Paintbrush, Shield, ShieldCheck, Wrench, Database, Wallet, Banknote, Scale, Gift, LayoutDashboard, BookOpen, ImageIcon, IdCard, LineChart, Zap, FileText, Code, Presentation, Sparkles } from \'lucide-react\';\nimport AuthModal from \'./AuthModal\';\nimport MFASetup from \'./MFASetup\';\nimport PremiumBadge from \'@/components/premium/PremiumBadge\';\nimport { VisionaryMembershipCard } from \'@/components/premium\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport CEOBusinessCard from \'@/components/admin/CEOBusinessCard\';\n\nconst UserMenu: React.FC = () => {\n  const { user, profile, isLoading, isPremium, isFreeAccount, mfaStatus, signOut, openCheckout, openCustomerPortal } = useAuth();\n  const navigate = useNavigate();\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const [showVisionaryModal, setShowVisionaryModal] = useState(false);\n  const [showMFASetup, setShowMFASetup] = useState(false);\n  const [showCEOCard, setShowCEOCard] = useState(false);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [pendingWithdrawals, setPendingWithdrawals] = useState(0);\n  const [pendingDMCA, setPendingDMCA] = useState(0);\n\n  // Check if user is admin and fetch pending withdrawals\n  useEffect(() => {\n    const checkAdminStatus = async () => {\n      if (!user) {\n        setIsAdmin(false);\n        setPendingWithdrawals(0);\n        setPendingDMCA(0);\n        return;\n      }\n      \n      try {\n        const { data, error } = await supabase\n          .from(\'user_roles\')\n          .select(\'role\')\n          .eq(\'user_id\', user.id)\n          .eq(\'role\', \'admin\')\n          .maybeSingle();\n        \n        if (error) throw error;\n        const adminStatus = !!data;\n        setIsAdmin(adminStatus);\n        \n        // Fetch pending counts if admin\n        if (adminStatus) {\n          const [withdrawalsResult, dmcaResult] = await Promise.all([\n            supabase\n              .from(\'withdrawal_requests\')\n              .select(\'*\', { count: \'exact\', head: true })\n              .eq(\'status\', \'pending\'),\n            supabase\n              .from(\'dmca_reports\')\n              .select(\'*\', { count: \'exact\', head: true })\n              .eq(\'status\', \'pending\'),\n          ]);\n          \n          if (!withdrawalsResult.error) {\n            setPendingWithdrawals(withdrawalsResult.count || 0);\n          }\n          if (!dmcaResult.error) {\n            setPendingDMCA(dmcaResult.count || 0);\n          }\n        }\n      } catch (error) {\n        console.error(\'Error checking admin status:\', error);\n        setIsAdmin(false);\n      }\n    };\n    \n    checkAdminStatus();\n  }, [user]);\n\n  if (isLoading) {\n    return (\n      <div className="w-8 h-8 rounded-full bg-muted animate-pulse" />\n    );\n  }\n\n  if (!user) {\n    return (\n      <>\n        <Button\n          variant="outline"\n          size="sm"\n          onClick={() => setShowAuthModal(true)}\n          className="gap-2"\n        >\n          <User className="h-4 w-4" />\n          <span className="hidden sm:inline">Sign In</span>\n        </Button>\n        <Button\n          variant="default"\n          size="sm"\n          onClick={() => {\n            setShowAuthModal(true);\n          }}\n          className="gap-1.5 btn-luxury hidden sm:flex"\n        >\n          <Gift className="h-4 w-4" />\n          Free Sign Up\n        </Button>\n        <VisionaryMembershipCard\n          isOpen={showVisionaryModal}\n          onClose={() => setShowVisionaryModal(false)}\n          onAuthRequired={() => {\n            setShowVisionaryModal(false);\n            setShowAuthModal(true);\n          }}\n          trigger="general"\n        />\n        <AuthModal isOpen={showAuthModal} onClose={() => setShowAuthModal(false)} defaultMode="signup" />\n      </>\n    );\n  }\n\n  const displayName = profile?.display_name || user.email?.split(\'@\')[0] || \'User\';\n  const initials = displayName.slice(0, 2).toUpperCase();\n\n  const handleSubscriptionAction = async () => {\n    try {\n      if (isPremium) {\n        await openCustomerPortal();\n      } else {\n        await openCheckout();\n      }\n    } catch (error) {\n      console.error(\'Subscription action error:\', error);\n    }\n  };\n\n  return (\n    <>\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant="ghost"\n            size="sm"\n            className="gap-2 hover:bg-primary/10"\n          >\n            <Avatar className="h-7 w-7 border border-border">\n              <AvatarImage src={profile?.avatar_url || undefined} alt={displayName} />\n              <AvatarFallback className="text-xs bg-primary/20 text-primary">\n                {initials}\n              </AvatarFallback>\n            </Avatar>\n            <span className="hidden sm:inline text-sm font-medium">{displayName}</span>\n            <PremiumBadge showText={false} />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align="end" className="w-56 bg-card border-border z-50 p-0 overflow-hidden">\n          <ScrollArea className="h-auto max-h-[70vh] overflow-y-auto">\n            <div className="p-1">\n          <div className="px-3 py-2">\n            <div className="flex items-center gap-2">\n              <Avatar className="h-8 w-8 border border-border">\n                <AvatarImage src={profile?.avatar_url || undefined} alt={displayName} />\n                <AvatarFallback className="text-xs bg-primary/20 text-primary">\n                  {initials}\n                </AvatarFallback>\n              </Avatar>\n              <div className="flex-1 min-w-0">\n                <div className="flex items-center gap-1">\n                  <p className="text-sm font-medium truncate">{displayName}</p>\n                  {isPremium ? (\n                    <PremiumBadge />\n                  ) : isFreeAccount ? (\n                    <Badge variant="outline" className="text-[9px] px-1 py-0 h-4 bg-muted">FREE</Badge>\n                  ) : null}\n                </div>\n                <p className="text-xs text-muted-foreground truncate">{user.email}</p>\n              </div>\n            </div>\n          </div>\n          <DropdownMenuSeparator />\n          \n          {!isPremium && (\n            <>\n              <DropdownMenuItem \n                onClick={() => setShowVisionaryModal(true)}\n                className="gap-2 cursor-pointer bg-primary/5 text-primary focus:bg-primary/10 focus:text-primary"\n              >\n                <Crown className="h-4 w-4" />\n                {isFreeAccount ? \'Upgrade to Premium\' : \'Get Premium\'}\n                {isFreeAccount && (\n                  <Badge variant="secondary" className="ml-auto text-[9px] px-1.5 bg-green-500/10 text-green-600">\n                    Unlock All\n                  </Badge>\n                )}\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n            </>\n          )}\n          \n          <DropdownMenuLabel className="text-xs text-muted-foreground uppercase tracking-wider">\n            Play\n          </DropdownMenuLabel>\n          <DropdownMenuItem \n            onClick={() => navigate(\'/play\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Gamepad2 className="h-4 w-4" />\n            Play En Pensent\n          </DropdownMenuItem>\n          <DropdownMenuItem \n            onClick={() => navigate(\'/game-history\')}\n            className="gap-2 cursor-pointer"\n          >\n            <History className="h-4 w-4" />\n            Game History\n          </DropdownMenuItem>\n          <DropdownMenuItem \n            onClick={() => navigate(\'/creative-mode\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Paintbrush className="h-4 w-4" />\n            Creative Mode\n            {!isPremium && <Crown className="h-3 w-3 text-primary ml-auto" />}\n          </DropdownMenuItem>\n          <DropdownMenuSeparator />\n          \n          <DropdownMenuLabel className="text-xs text-muted-foreground uppercase tracking-wider">\n            Studio\n          </DropdownMenuLabel>\n          <DropdownMenuItem \n            onClick={() => navigate(\'/my-palettes\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Palette className="h-4 w-4" />\n            My Palettes\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => navigate(\'/my-vision\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Image className="h-4 w-4" />\n            My Vision Gallery\n            {!isPremium && <Crown className="h-3 w-3 text-primary ml-auto" />}\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => navigate(\'/creator-dashboard\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Wallet className="h-4 w-4" />\n            Creator Dashboard\n            {!isPremium && <Crown className="h-3 w-3 text-primary ml-auto" />}\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => navigate(\'/analytics\')}\n            className="gap-2 cursor-pointer"\n          >\n            <BarChart3 className="h-4 w-4" />\n            Analytics\n          </DropdownMenuItem>\n          \n          \n          {isAdmin && (\n            <>\n              <DropdownMenuSeparator />\n              <DropdownMenuLabel className="text-xs text-primary uppercase tracking-wider flex items-center gap-1">\n                <Crown className="h-3 w-3" />\n                Admin\n              </DropdownMenuLabel>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/moderation\')}\n                className="gap-2 cursor-pointer text-primary"\n              >\n                <Shield className="h-4 w-4" />\n                Content Moderation\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/seed-marketplace\')}\n                className="gap-2 cursor-pointer text-primary"\n              >\n                <Database className="h-4 w-4" />\n                Seed Marketplace\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/palettes\')}\n                className="gap-2 cursor-pointer text-primary"\n              >\n                <Wrench className="h-4 w-4" />\n                Palette Admin\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/withdrawals\')}\n                className="gap-2 cursor-pointer text-primary"\n              >\n                <Banknote className="h-4 w-4" />\n                Withdrawals\n                {pendingWithdrawals > 0 && (\n                  <span className="ml-auto bg-destructive text-destructive-foreground text-xs font-medium px-1.5 py-0.5 rounded-full">\n                    {pendingWithdrawals}\n                  </span>\n                )}\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/dmca\')}\n                className="gap-2 cursor-pointer text-primary"\n              >\n                <Scale className="h-4 w-4" />\n                DMCA Reports\n                {pendingDMCA > 0 && (\n                  <span className="ml-auto bg-destructive text-destructive-foreground text-xs font-medium px-1.5 py-0.5 rounded-full">\n                    {pendingDMCA}\n                  </span>\n                )}\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/economics\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <BarChart3 className="h-4 w-4" />\n                CEO Economics\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/ceo-dashboard\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <LayoutDashboard className="h-4 w-4" />\n                CEO Dashboard\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/book\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <BookOpen className="h-4 w-4" />\n                Book Generator\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/ai-art-bank\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <ImageIcon className="h-4 w-4" />\n                AI Art Bank\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => setShowCEOCard(true)}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <IdCard className="h-4 w-4" />\n                CEO Business Card\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/premium-analytics\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <BarChart3 className="h-4 w-4" />\n                Premium Analytics\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuLabel className="text-xs text-amber-500 uppercase tracking-wider flex items-center gap-1">\n                <Zap className="h-3 w-3" />\n                En Pensent Engine\n              </DropdownMenuLabel>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/admin/system-vitals\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold bg-amber-500/10"\n              >\n                <Zap className="h-4 w-4 animate-pulse" />\n                System Vitals (LIVE)\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/benchmark\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <BarChart3 className="h-4 w-4" />\n                Benchmark Engine\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/stock-predictions\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <LineChart className="h-4 w-4" />\n                Stock Predictions\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/trading\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <Zap className="h-4 w-4" />\n                Trading Terminal\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/strategic-plan\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <FileText className="h-4 w-4" />\n                Strategic Plan\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/code-analysis\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <Code className="h-4 w-4" />\n                Code Analyzer\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/showcase\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <Presentation className="h-4 w-4" />\n                Showcase Tour\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n              <DropdownMenuItem \n                onClick={() => navigate(\'/investor-portal\')}\n                className="gap-2 cursor-pointer text-amber-500 font-semibold"\n              >\n                <Sparkles className="h-4 w-4" />\n                Investor Portal\n                <Crown className="h-3 w-3 ml-auto" />\n              </DropdownMenuItem>\n            </>\n          )}\n          <DropdownMenuSeparator />\n          \n          <DropdownMenuLabel className="text-xs text-muted-foreground uppercase tracking-wider">\n            Account\n          </DropdownMenuLabel>\n          \n          {isPremium && (\n            <DropdownMenuItem \n              onClick={handleSubscriptionAction}\n              className="gap-2 cursor-pointer"\n            >\n              <CreditCard className="h-4 w-4" />\n              Manage Subscription\n            </DropdownMenuItem>\n          )}\n          \n          <DropdownMenuItem \n            onClick={() => setShowMFASetup(true)}\n            className="gap-2 cursor-pointer"\n          >\n            {mfaStatus.enabled ? (\n              <ShieldCheck className="h-4 w-4 text-green-500" />\n            ) : (\n              <Shield className="h-4 w-4" />\n            )}\n            Security Settings\n            {!isPremium && <Crown className="h-3 w-3 text-primary ml-auto" />}\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => navigate(\'/account\')}\n            className="gap-2 cursor-pointer"\n          >\n            <Settings className="h-4 w-4" />\n            Account Settings\n          </DropdownMenuItem>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem \n            onClick={() => signOut()}\n            className="gap-2 cursor-pointer text-destructive focus:text-destructive"\n          >\n            <LogOut className="h-4 w-4" />\n            Sign Out\n          </DropdownMenuItem>\n            </div>\n          </ScrollArea>\n        </DropdownMenuContent>\n      </DropdownMenu>\n\n      <MFASetup isOpen={showMFASetup} onClose={() => setShowMFASetup(false)} />\n      \n      <CEOBusinessCard isOpen={showCEOCard} onClose={() => setShowCEOCard(false)} />\n      \n      <VisionaryMembershipCard\n        isOpen={showVisionaryModal}\n        onClose={() => setShowVisionaryModal(false)}\n        onAuthRequired={() => {\n          setShowVisionaryModal(false);\n          setShowAuthModal(true);\n        }}\n        trigger="general"\n      />\n      <AuthModal isOpen={showAuthModal} onClose={() => setShowAuthModal(false)} />\n    </>\n  );\n};\n\nexport default UserMenu;\n';export{n as default};
