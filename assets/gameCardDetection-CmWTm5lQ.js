const e="// Game Card Detection - Auto-detect when uploaded PGN matches our famous game cards\n// Also integrates with emerging game detection for new high-value games\nimport { famousGames, FamousGame } from './famousGames';\nimport { Chess } from 'chess.js';\n\nexport interface GameCardMatch {\n  isMatch: boolean;\n  matchedGame: FamousGame | null;\n  similarity: number; // 0-1 representing how closely the moves match\n  matchType: 'exact' | 'partial' | 'none';\n}\n\n// Re-export emerging game detection for unified access\nexport { detectEmergingGame, formatSignificanceDisplay, getSignificanceLabel } from './emergingGameDetection';\nexport type { EmergingGameSignificance } from './emergingGameDetection';\n\n/**\n * Normalize PGN moves by removing annotations, comments, and extra whitespace\n */\nfunction normalizeMoves(pgn: string): string[] {\n  try {\n    const chess = new Chess();\n    chess.loadPgn(pgn);\n    return chess.history();\n  } catch {\n    // If PGN fails to load, try extracting moves manually\n    const moveSection = pgn.replace(/\\[.*?\\]/g, '').trim();\n    const moves = moveSection\n      .replace(/\\{[^}]*\\}/g, '') // Remove comments\n      .replace(/\\([^)]*\\)/g, '') // Remove variations\n      .replace(/\\d+\\.\\s*/g, ' ') // Remove move numbers\n      .replace(/1-0|0-1|1\\/2-1\\/2|\\*/g, '') // Remove results\n      .split(/\\s+/)\n      .filter(m => m.length > 0 && /^[KQRBNP]?[a-h]?[1-8]?x?[a-h][1-8](?:=[QRBN])?[+#]?$/i.test(m) || m === 'O-O' || m === 'O-O-O');\n    return moves;\n  }\n}\n\n/**\n * Calculate similarity between two move arrays\n */\nfunction calculateMoveSimilarity(moves1: string[], moves2: string[]): number {\n  if (moves1.length === 0 || moves2.length === 0) return 0;\n  \n  const minLength = Math.min(moves1.length, moves2.length);\n  const maxLength = Math.max(moves1.length, moves2.length);\n  \n  let matchingMoves = 0;\n  for (let i = 0; i < minLength; i++) {\n    if (moves1[i] === moves2[i]) {\n      matchingMoves++;\n    } else {\n      // Once moves diverge, stop counting\n      break;\n    }\n  }\n  \n  // Similarity is based on matching moves vs the longer game\n  // We want to catch both exact matches and games that are subsets\n  return matchingMoves / maxLength;\n}\n\n/**\n * Detect if an uploaded PGN matches one of our famous game cards\n * @param uploadedPgn The PGN string uploaded by the user\n * @returns GameCardMatch object with match details\n */\nexport function detectGameCard(uploadedPgn: string): GameCardMatch {\n  if (!uploadedPgn || uploadedPgn.trim().length === 0) {\n    return { isMatch: false, matchedGame: null, similarity: 0, matchType: 'none' };\n  }\n\n  const uploadedMoves = normalizeMoves(uploadedPgn);\n  \n  if (uploadedMoves.length < 5) {\n    // Too few moves to make a meaningful match\n    return { isMatch: false, matchedGame: null, similarity: 0, matchType: 'none' };\n  }\n\n  let bestMatch: FamousGame | null = null;\n  let bestSimilarity = 0;\n  \n  for (const game of famousGames) {\n    const gameMoves = normalizeMoves(game.pgn);\n    const similarity = calculateMoveSimilarity(uploadedMoves, gameMoves);\n    \n    if (similarity > bestSimilarity) {\n      bestSimilarity = similarity;\n      bestMatch = game;\n    }\n  }\n\n  // Thresholds for matching:\n  // - Exact: 95%+ similarity (allows for minor annotation differences)\n  // - Partial: 70%+ similarity (covers games that are subsets or have minor variations)\n  // - None: below 70%\n  \n  if (bestSimilarity >= 0.95) {\n    return {\n      isMatch: true,\n      matchedGame: bestMatch,\n      similarity: bestSimilarity,\n      matchType: 'exact'\n    };\n  } else if (bestSimilarity >= 0.70) {\n    return {\n      isMatch: true,\n      matchedGame: bestMatch,\n      similarity: bestSimilarity,\n      matchType: 'partial'\n    };\n  }\n  \n  return { isMatch: false, matchedGame: null, similarity: bestSimilarity, matchType: 'none' };\n}\n\n/**\n * Check if a PGN exactly matches any of our famous game cards\n * Used for ownership/save restrictions\n */\nexport function isExactGameCardMatch(pgn: string): boolean {\n  const match = detectGameCard(pgn);\n  return match.matchType === 'exact';\n}\n\n/**\n * Get the matched game card for analytics and data collection\n */\nexport function getMatchedGameCard(pgn: string): FamousGame | null {\n  const match = detectGameCard(pgn);\n  return match.isMatch ? match.matchedGame : null;\n}\n";export{e as default};
