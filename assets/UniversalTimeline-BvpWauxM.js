const n='import React, { useEffect, useMemo, useState, useCallback } from \'react\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { \n  Play, Pause, SkipBack, SkipForward, RotateCcw, Gauge, \n  Flag, Sword, Crown, Zap, Target, Castle, Info, ChevronUp, ChevronDown, Keyboard,\n  Navigation, ChevronRight, BookOpen, Layers\n} from \'lucide-react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Slider } from \'@/components/ui/slider\';\nimport { Badge } from \'@/components/ui/badge\';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n  DropdownMenuSeparator,\n  DropdownMenuLabel,\n} from \'@/components/ui/dropdown-menu\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport { MoveHistoryEntry } from \'./EnPensentOverlay\';\nimport { KeyMomentMarker, KeyMoment as EnhancedKeyMoment, KeyMomentType } from \'./KeyMomentMarker\';\nimport { analyzeTimeline, TimelineAnalysisResult } from \'@/lib/chess/timelineAnalysis\';\n\n// Local KeyMoment type for basic parsing (converted to EnhancedKeyMoment for display)\ninterface LocalKeyMoment {\n  moveNumber: number;\n  type: \'capture\' | \'check\' | \'checkmate\' | \'castling\' | \'promotion\';\n  move: string;\n  player: \'white\' | \'black\';\n}\n\ninterface GamePhase {\n  name: \'opening\' | \'middlegame\' | \'endgame\';\n  startMove: number;\n  endMove: number;\n  color: string;\n  bgColor: string;\n  icon: typeof Flag;\n  description: string;\n}\n\ninterface UniversalTimelineProps {\n  totalMoves: number;\n  moves?: string[];\n  moveHistory?: MoveHistoryEntry[];\n  currentMove: number;\n  onMoveChange: (move: number) => void;\n  compact?: boolean;\n  vertical?: boolean;\n  pgn?: string; // Added for deep analysis\n}\n\n// Icon descriptions for tooltips with richer content\nconst ICON_DESCRIPTIONS = {\n  capture: {\n    icon: Target,\n    color: \'bg-orange-500 text-orange-400\',\n    label: \'Capture\',\n    description: \'A piece was captured, shifting material balance.\',\n    tactical: \'Captures often open new tactical opportunities and change the positional landscape of the game.\',\n    emoji: \'‚öîÔ∏è\',\n  },\n  check: {\n    icon: Zap,\n    color: \'bg-yellow-500 text-yellow-400\',\n    label: \'Check\',\n    description: \'The king is under direct attack!\',\n    tactical: \'The opponent must immediately respond to escape the threat. Checks can disrupt plans and force defensive moves.\',\n    emoji: \'‚ö°\',\n  },\n  checkmate: {\n    icon: Crown,\n    color: \'bg-red-500 text-red-400\',\n    label: \'Checkmate\',\n    description: \'Game over! The king cannot escape.\',\n    tactical: \'The ultimate goal of chess. The king is in check with no legal moves to escape.\',\n    emoji: \'üëë\',\n  },\n  castling: {\n    icon: Castle,\n    color: \'bg-blue-500 text-blue-400\',\n    label: \'Castle\',\n    description: \'King moves to safety, rook activates.\',\n    tactical: \'A crucial defensive and developmental move. Protects the king while connecting the rooks.\',\n    emoji: \'üè∞\',\n  },\n  promotion: {\n    icon: Crown,\n    color: \'bg-purple-500 text-purple-400\',\n    label: \'Promotion\',\n    description: \'Pawn promoted to a powerful piece!\',\n    tactical: \'A pawn reaching the 8th rank transforms into a queen, rook, bishop, or knight. Usually decisive.\',\n    emoji: \'‚ú®\',\n  },\n};\n\n// Phase descriptions for the timeline\nconst PHASE_CONFIG = {\n  opening: {\n    name: \'Opening\',\n    description: \'The first 10-15 moves where players develop pieces and fight for center control.\',\n    tips: \'Control the center, develop pieces, castle early, connect rooks.\',\n    icon: Flag,\n    color: \'text-emerald-400\',\n    bgColor: \'bg-emerald-500/20\',\n    borderColor: \'border-emerald-500/30\',\n  },\n  middlegame: {\n    name: \'Middlegame\',\n    description: \'The strategic battle where tactics, attacks, and positional play dominate.\',\n    tips: \'Create threats, improve piece activity, target weaknesses.\',\n    icon: Sword,\n    color: \'text-amber-400\',\n    bgColor: \'bg-amber-500/20\',\n    borderColor: \'border-amber-500/30\',\n  },\n  endgame: {\n    name: \'Endgame\',\n    description: \'Few pieces remain. King becomes active, passed pawns are crucial.\',\n    tips: \'Activate the king, create passed pawns, simplify if ahead.\',\n    icon: Crown,\n    color: \'text-purple-400\',\n    bgColor: \'bg-purple-500/20\',\n    borderColor: \'border-purple-500/30\',\n  },\n};\n\n// Analyze moves to find key moments\nfunction findKeyMoments(moves: string[], moveHistory?: MoveHistoryEntry[]): LocalKeyMoment[] {\n  const moments: LocalKeyMoment[] = [];\n  const movesToAnalyze = moves.length > 0 ? moves : (moveHistory?.map(() => \'\') || []);\n  \n  movesToAnalyze.forEach((move, index) => {\n    const moveNumber = index + 1;\n    const player: \'white\' | \'black\' = index % 2 === 0 ? \'white\' : \'black\';\n    \n    if (move.includes(\'#\')) {\n      moments.push({ moveNumber, type: \'checkmate\', move, player });\n    } else if (move.includes(\'+\')) {\n      moments.push({ moveNumber, type: \'check\', move, player });\n    }\n    \n    if (move.includes(\'x\')) {\n      moments.push({ moveNumber, type: \'capture\', move, player });\n    }\n    \n    if (move.includes(\'O-O\') || move.includes(\'0-0\')) {\n      moments.push({ moveNumber, type: \'castling\', move, player });\n    }\n    \n    if (move.includes(\'=\')) {\n      moments.push({ moveNumber, type: \'promotion\', move, player });\n    }\n  });\n  \n  return moments;\n}\n\n// Calculate game phases based on total moves\nfunction calculateGamePhases(totalMoves: number): GamePhase[] {\n  if (totalMoves === 0) return [];\n  \n  const phases: GamePhase[] = [];\n  \n  // Opening: first ~20% of moves, max 30 half-moves\n  const openingEnd = Math.min(Math.floor(totalMoves * 0.25), 30);\n  \n  // Endgame: last ~30% of moves, starts after move 60 minimum\n  const endgameStart = Math.max(Math.floor(totalMoves * 0.7), Math.min(60, totalMoves));\n  \n  phases.push({\n    name: \'opening\',\n    startMove: 1,\n    endMove: openingEnd,\n    color: \'text-emerald-400\',\n    bgColor: \'bg-emerald-500/20\',\n    icon: Flag,\n    description: \'Development & center control\',\n  });\n  \n  if (openingEnd < endgameStart - 1) {\n    phases.push({\n      name: \'middlegame\',\n      startMove: openingEnd + 1,\n      endMove: endgameStart - 1,\n      color: \'text-amber-400\',\n      bgColor: \'bg-amber-500/20\',\n      icon: Sword,\n      description: \'Tactics & attacks\',\n    });\n  }\n  \n  if (endgameStart <= totalMoves) {\n    phases.push({\n      name: \'endgame\',\n      startMove: endgameStart,\n      endMove: totalMoves,\n      color: \'text-purple-400\',\n      bgColor: \'bg-purple-500/20\',\n      icon: Crown,\n      description: \'King activation & pawns\',\n    });\n  }\n  \n  return phases;\n}\n\nexport const UniversalTimeline: React.FC<UniversalTimelineProps> = ({\n  totalMoves,\n  moves = [],\n  moveHistory = [],\n  currentMove,\n  onMoveChange,\n  compact = false,\n  vertical = false,\n}) => {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(500);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n  const [showShortcutHint, setShowShortcutHint] = useState(true);\n\n  // Find key moments and game phases\n  const keyMoments = useMemo(() => findKeyMoments(moves, moveHistory), [moves, moveHistory]);\n  const gamePhases = useMemo(() => calculateGamePhases(totalMoves), [totalMoves]);\n  \n  // Get current phase\n  const currentPhase = useMemo(() => {\n    return gamePhases.find(p => currentMove >= p.startMove && currentMove <= p.endMove);\n  }, [gamePhases, currentMove]);\n\n  // Keyboard shortcuts for timeline control\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    // Don\'t trigger shortcuts when typing in inputs\n    if (\n      e.target instanceof HTMLInputElement ||\n      e.target instanceof HTMLTextAreaElement ||\n      (e.target as HTMLElement).isContentEditable\n    ) {\n      return;\n    }\n\n    switch (e.key) {\n      case \' \': // Space - play/pause\n        e.preventDefault();\n        if (currentMove >= totalMoves) {\n          onMoveChange(0);\n        }\n        setIsPlaying(prev => !prev);\n        setShowShortcutHint(false);\n        break;\n      case \'ArrowRight\': // Step forward\n        e.preventDefault();\n        if (currentMove < totalMoves) {\n          onMoveChange(currentMove + 1);\n        }\n        setShowShortcutHint(false);\n        break;\n      case \'ArrowLeft\': // Step backward\n        e.preventDefault();\n        if (currentMove > 0) {\n          onMoveChange(currentMove - 1);\n        }\n        setShowShortcutHint(false);\n        break;\n      case \'Home\': // Go to start\n        e.preventDefault();\n        setIsPlaying(false);\n        onMoveChange(0);\n        break;\n      case \'End\': // Go to end (show all)\n        e.preventDefault();\n        setIsPlaying(false);\n        onMoveChange(totalMoves);\n        break;\n    }\n  }, [currentMove, totalMoves, onMoveChange]);\n\n  useEffect(() => {\n    window.addEventListener(\'keydown\', handleKeyDown);\n    return () => window.removeEventListener(\'keydown\', handleKeyDown);\n  }, [handleKeyDown]);\n  \n  // Playback animation\n  useEffect(() => {\n    if (!isPlaying) return;\n    \n    const interval = setInterval(() => {\n      onMoveChange(currentMove >= totalMoves ? totalMoves : currentMove + 1);\n      if (currentMove >= totalMoves) {\n        setIsPlaying(false);\n      }\n    }, playbackSpeed);\n    \n    return () => clearInterval(interval);\n  }, [isPlaying, currentMove, totalMoves, playbackSpeed, onMoveChange]);\n\n  const handleSliderChange = (value: number[]) => {\n    onMoveChange(value[0]);\n  };\n\n  const togglePlayback = () => {\n    if (currentMove >= totalMoves) {\n      onMoveChange(0);\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const stepForward = () => {\n    if (currentMove < totalMoves) {\n      onMoveChange(currentMove + 1);\n    }\n  };\n\n  const stepBackward = () => {\n    if (currentMove > 0) {\n      onMoveChange(currentMove - 1);\n    }\n  };\n\n  const reset = () => {\n    setIsPlaying(false);\n    onMoveChange(totalMoves);\n  };\n\n  const speedOptions = [\n    { label: \'0.25x\', value: 2000 },\n    { label: \'0.5x\', value: 1000 },\n    { label: \'1x\', value: 500 },\n    { label: \'2x\', value: 250 },\n    { label: \'4x\', value: 125 },\n  ];\n\n  const currentSpeedLabel = speedOptions.find(s => s.value === playbackSpeed)?.label || \'1x\';\n  \n  const getMoveLabel = () => {\n    if (currentMove >= totalMoves || currentMove === Infinity) return `All ${totalMoves} moves`;\n    if (currentMove === 0) return \'Start\';\n    const moveIndex = currentMove - 1;\n    if (moves[moveIndex]) {\n      const moveNum = Math.floor(moveIndex / 2) + 1;\n      const isWhite = moveIndex % 2 === 0;\n      return `${moveNum}.${isWhite ? \'\' : \'..\'} ${moves[moveIndex]}`;\n    }\n    return `Move ${currentMove}`;\n  };\n\n  const getCurrentPlayer = () => {\n    if (currentMove === 0 || currentMove >= totalMoves) return null;\n    return (currentMove % 2 === 1) ? \'white\' : \'black\';\n  };\n\n  const player = getCurrentPlayer();\n\n  // Count moments by type\n  const momentCounts = useMemo(() => {\n    const counts = { capture: 0, check: 0, checkmate: 0, castling: 0, promotion: 0 };\n    keyMoments.forEach(m => counts[m.type]++);\n    return counts;\n  }, [keyMoments]);\n\n  // Group moments by type for jump menu\n  const momentsByType = useMemo(() => {\n    const grouped: Record<string, LocalKeyMoment[]> = {\n      capture: [],\n      check: [],\n      checkmate: [],\n      castling: [],\n      promotion: [],\n    };\n    keyMoments.forEach(m => grouped[m.type].push(m));\n    return grouped;\n  }, [keyMoments]);\n\n  // Format move for display\n  const formatMoveDisplay = (moment: LocalKeyMoment) => {\n    const moveIndex = moment.moveNumber - 1;\n    const moveNum = Math.floor(moveIndex / 2) + 1;\n    const isWhite = moveIndex % 2 === 0;\n    return `${moveNum}.${isWhite ? \'\' : \'..\'} ${moment.move}`;\n  };\n\n  if (totalMoves === 0) return null;\n\n  if (isCollapsed) {\n    return (\n      <button\n        onClick={() => setIsCollapsed(false)}\n        className="flex items-center gap-2 p-2 rounded-lg bg-card/80 backdrop-blur-sm border border-border/50 hover:bg-accent/30 transition-colors"\n      >\n        <Play className="w-3 h-3 text-primary" />\n        <span className="text-xs font-display uppercase tracking-wider">Timeline</span>\n        <ChevronDown className="w-3 h-3" />\n      </button>\n    );\n  }\n\n  return (\n    <TooltipProvider>\n      <motion.div \n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        className={`bg-card/80 backdrop-blur-sm rounded-lg border border-border/50 p-3 space-y-3 ${\n          compact ? \'max-w-xs\' : \'\'\n        }`}\n      >\n        {/* Header */}\n        <div className="flex items-center justify-between">\n          <div className="flex items-center gap-2">\n            <span className="text-[10px] font-display font-semibold uppercase tracking-widest text-muted-foreground">\n              Timeline\n            </span>\n            {player && (\n              <div className={`w-2 h-2 rounded-full ${player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n            )}\n          </div>\n          <button\n            onClick={() => setIsCollapsed(true)}\n            className="p-1 rounded hover:bg-accent/50 transition-colors"\n          >\n            <ChevronUp className="w-3 h-3 text-muted-foreground" />\n          </button>\n        </div>\n\n        {/* Key moments summary with tooltips */}\n        {keyMoments.length > 0 && (\n          <div className="flex items-center gap-3 text-[10px] flex-wrap">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className="text-muted-foreground flex items-center gap-1 cursor-help">\n                  <Info className="w-3 h-3" />\n                  Key moments:\n                </span>\n              </TooltipTrigger>\n              <TooltipContent className="max-w-[220px] p-3">\n                <div className="space-y-2">\n                  <div className="font-semibold">Key Moments</div>\n                  <p className="text-xs text-muted-foreground leading-relaxed">\n                    Critical events that shaped the game. Click any marker on the timeline to jump directly to that moment.\n                  </p>\n                  <p className="text-[10px] text-primary italic">\n                    üí° Hover over icons for details\n                  </p>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n            <div className="flex items-center gap-2 flex-wrap">\n              {Object.entries(momentCounts).map(([type, count]) => {\n                if (count === 0) return null;\n                const config = ICON_DESCRIPTIONS[type as keyof typeof ICON_DESCRIPTIONS];\n                const Icon = config.icon;\n                \n                return (\n                  <Tooltip key={type}>\n                    <TooltipTrigger asChild>\n                      <button className={`flex items-center gap-1 ${config.color.split(\' \')[1]} hover:scale-110 transition-transform cursor-help`}>\n                        <Icon className="w-3 h-3" />\n                        <span>{count}</span>\n                      </button>\n                    </TooltipTrigger>\n                    <TooltipContent side="bottom" className="max-w-[240px] p-3">\n                      <div className="space-y-2">\n                        <div className="font-semibold flex items-center gap-2">\n                          <span className="text-lg">{config.emoji}</span>\n                          <Icon className={`w-4 h-4 ${config.color.split(\' \')[1]}`} />\n                          {config.label}\n                        </div>\n                        <p className="text-xs text-muted-foreground leading-relaxed">\n                          {config.description}\n                        </p>\n                        <p className="text-xs leading-relaxed border-t border-border/50 pt-2">\n                          {config.tactical}\n                        </p>\n                        <p className="text-[10px] text-primary mt-1 font-medium">\n                          {count} occurrence{count !== 1 ? \'s\' : \'\'} in this game\n                        </p>\n                      </div>\n                    </TooltipContent>\n                  </Tooltip>\n                );\n            })}\n          </div>\n        </div>\n        )}\n\n        {/* Game Phase Navigation */}\n        {gamePhases.length > 0 && (\n          <div className="flex items-center gap-2">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className="text-muted-foreground flex items-center gap-1 cursor-help">\n                  <Layers className="w-3 h-3" />\n                </span>\n              </TooltipTrigger>\n              <TooltipContent className="max-w-[220px] p-3">\n                <div className="space-y-2">\n                  <div className="font-semibold">Game Phases</div>\n                  <p className="text-xs text-muted-foreground leading-relaxed">\n                    Click any phase to jump to its starting position. View how the game evolved through each stage.\n                  </p>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n            \n            {/* All Moves Button */}\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant={currentMove >= totalMoves ? "secondary" : "ghost"}\n                  size="sm"\n                  className="h-6 px-2 text-[10px] font-medium"\n                  onClick={() => onMoveChange(totalMoves)}\n                >\n                  All Moves\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent className="max-w-[200px] p-3">\n                <div className="space-y-1">\n                  <div className="font-semibold">All Moves</div>\n                  <p className="text-xs text-muted-foreground">Show the complete visualization with all {totalMoves} moves.</p>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n\n            {/* Phase Buttons */}\n            {gamePhases.map((phase) => {\n              const phaseConfig = PHASE_CONFIG[phase.name];\n              const PhaseIcon = phaseConfig.icon;\n              const isActive = currentMove >= phase.startMove && currentMove <= phase.endMove && currentMove < totalMoves;\n              \n              return (\n                <Tooltip key={phase.name}>\n                  <TooltipTrigger asChild>\n                    <Button\n                      variant={isActive ? "secondary" : "ghost"}\n                      size="sm"\n                      className={`h-6 px-2 text-[10px] font-medium gap-1 ${isActive ? phaseConfig.bgColor : \'\'}`}\n                      onClick={() => onMoveChange(phase.startMove)}\n                    >\n                      <PhaseIcon className={`w-3 h-3 ${phaseConfig.color}`} />\n                      <span className="hidden sm:inline capitalize">{phase.name}</span>\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent className="max-w-[240px] p-3">\n                    <div className="space-y-2">\n                      <div className="font-semibold flex items-center gap-2">\n                        <PhaseIcon className={`w-4 h-4 ${phaseConfig.color}`} />\n                        {phaseConfig.name}\n                      </div>\n                      <p className="text-xs text-muted-foreground leading-relaxed">\n                        {phaseConfig.description}\n                      </p>\n                      <p className="text-xs leading-relaxed border-t border-border/50 pt-2">\n                        {phaseConfig.tips}\n                      </p>\n                      <p className="text-[10px] text-primary mt-1 font-medium">\n                        Moves {phase.startMove} - {phase.endMove}\n                      </p>\n                      <p className="text-[10px] text-primary italic">\n                        Click to jump to start of {phase.name}\n                      </p>\n                    </div>\n                  </TooltipContent>\n                </Tooltip>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Current move label */}\n        <div className="flex items-center justify-between">\n          <div className="text-sm font-medium">{getMoveLabel()}</div>\n          <div className="text-xs text-muted-foreground">\n            {currentMove >= totalMoves ? totalMoves : currentMove} / {totalMoves}\n          </div>\n        </div>\n\n        {/* Slider with moment markers */}\n        <div className="relative">\n          {/* Key moment markers - now using enhanced KeyMomentMarker with hover highlighting */}\n          <div className="absolute inset-x-0 top-0 h-5 pointer-events-none z-10">\n            {keyMoments.slice(0, 20).map((moment, idx) => {\n              const position = (moment.moveNumber / totalMoves) * 100;\n              \n              // Convert LocalKeyMoment to EnhancedKeyMoment for the marker\n              const enhancedMoment: EnhancedKeyMoment = {\n                moveNumber: moment.moveNumber,\n                type: moment.type as KeyMomentType,\n                move: moment.move,\n                player: moment.player,\n              };\n              \n              return (\n                <div key={`${moment.moveNumber}-${moment.type}-${idx}`} className="pointer-events-auto">\n                  <KeyMomentMarker\n                    moment={enhancedMoment}\n                    position={position}\n                    totalMoves={totalMoves}\n                    onClick={onMoveChange}\n                    size="md"\n                  />\n                </div>\n              );\n            })}\n          </div>\n\n          <Slider\n            value={[Math.min(currentMove, totalMoves)]}\n            min={0}\n            max={totalMoves}\n            step={1}\n            onValueChange={handleSliderChange}\n            className="w-full mt-2"\n          />\n        </div>\n\n        {/* Controls */}\n        <div className="flex items-center justify-center gap-2">\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button variant="ghost" size="sm" onClick={reset} className="h-8 w-8 p-0">\n                <RotateCcw className="h-4 w-4" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent className="max-w-[200px] p-3">\n              <div className="space-y-1">\n                <div className="font-semibold">Show Complete Vision</div>\n                <p className="text-xs text-muted-foreground">Reset to display all moves, revealing the full artistic pattern. Press End.</p>\n                <p className="text-[10px] text-primary italic">üí° Complete visions have higher collector value</p>\n              </div>\n            </TooltipContent>\n          </Tooltip>\n\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant="ghost"\n                size="sm"\n                onClick={stepBackward}\n                disabled={currentMove <= 0}\n                className="h-8 w-8 p-0"\n              >\n                <SkipBack className="h-4 w-4" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent className="max-w-[200px] p-3">\n              <div className="space-y-1">\n                <div className="font-semibold">Previous Move</div>\n                <p className="text-xs text-muted-foreground">Step back through the game\'s evolution. Use ‚Üê arrow key.</p>\n                <p className="text-[10px] text-primary italic">üí° Watch patterns emerge in reverse</p>\n              </div>\n            </TooltipContent>\n          </Tooltip>\n\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant={isPlaying ? "secondary" : "default"}\n                size="sm"\n                onClick={() => {\n                  togglePlayback();\n                  setShowShortcutHint(false);\n                }}\n                className="h-10 w-10 p-0 rounded-full"\n              >\n                {isPlaying ? <Pause className="h-5 w-5" /> : <Play className="h-5 w-5 ml-0.5" />}\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent className="max-w-[220px] p-3">\n              <div className="space-y-1">\n                <div className="font-semibold">{isPlaying ? \'Pause Animation\' : \'Animate Vision\'}</div>\n                <p className="text-xs text-muted-foreground">\n                  {isPlaying \n                    ? \'Freeze the current state for analysis or capture.\' \n                    : \'Watch the visualization build move-by-move, revealing the game\\\'s story.\'}\n                </p>\n                <p className="text-[10px] text-primary italic">‚å®Ô∏è Press Space to toggle</p>\n              </div>\n            </TooltipContent>\n          </Tooltip>\n\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant="ghost"\n                size="sm"\n                onClick={stepForward}\n                disabled={currentMove >= totalMoves}\n                className="h-8 w-8 p-0"\n              >\n                <SkipForward className="h-4 w-4" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent className="max-w-[200px] p-3">\n              <div className="space-y-1">\n                <div className="font-semibold">Next Move</div>\n                <p className="text-xs text-muted-foreground">Advance through the game. Use ‚Üí arrow key.</p>\n                <p className="text-[10px] text-primary italic">üí° Each move adds new layers to the art</p>\n              </div>\n            </TooltipContent>\n          </Tooltip>\n\n          {/* Speed selector */}\n          <DropdownMenu>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <DropdownMenuTrigger asChild>\n                  <Button variant="ghost" size="sm" className="h-8 px-2 gap-1 text-xs">\n                    <Gauge className="h-3 w-3" />\n                    {currentSpeedLabel}\n                  </Button>\n                </DropdownMenuTrigger>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className="text-xs">Playback speed</p>\n              </TooltipContent>\n            </Tooltip>\n            <DropdownMenuContent align="end" className="bg-popover">\n              {speedOptions.map((option) => (\n                <DropdownMenuItem\n                  key={option.value}\n                  onClick={() => setPlaybackSpeed(option.value)}\n                  className={playbackSpeed === option.value ? \'bg-accent\' : \'\'}\n                >\n                  {option.label}\n                </DropdownMenuItem>\n              ))}\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          {/* Jump to Key Moment */}\n          {keyMoments.length > 0 && (\n            <DropdownMenu>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant="ghost" size="sm" className="h-8 px-2 gap-1 text-xs">\n                      <Navigation className="h-3 w-3" />\n                      <span className="hidden sm:inline">Jump</span>\n                    </Button>\n                  </DropdownMenuTrigger>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p className="text-xs">Jump to key moment</p>\n                </TooltipContent>\n              </Tooltip>\n              <DropdownMenuContent align="end" className="w-56 bg-popover max-h-80 overflow-y-auto">\n                <DropdownMenuLabel className="text-xs text-muted-foreground">\n                  Jump to Key Moment\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                \n                {/* Captures */}\n                {momentsByType.capture.length > 0 && (\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger className="flex items-center gap-2">\n                      <Target className="h-3.5 w-3.5 text-orange-400" />\n                      <span>Captures</span>\n                      <span className="ml-auto text-xs text-muted-foreground">\n                        {momentsByType.capture.length}\n                      </span>\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent className="bg-popover max-h-60 overflow-y-auto">\n                      {momentsByType.capture.map((moment, idx) => (\n                        <DropdownMenuItem\n                          key={`capture-${idx}`}\n                          onClick={() => onMoveChange(moment.moveNumber)}\n                          className="flex items-center gap-2"\n                        >\n                          <div className={`w-2 h-2 rounded-full ${moment.player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n                          <span className="font-mono text-xs">{formatMoveDisplay(moment)}</span>\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                )}\n\n                {/* Checks */}\n                {momentsByType.check.length > 0 && (\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger className="flex items-center gap-2">\n                      <Zap className="h-3.5 w-3.5 text-yellow-400" />\n                      <span>Checks</span>\n                      <span className="ml-auto text-xs text-muted-foreground">\n                        {momentsByType.check.length}\n                      </span>\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent className="bg-popover max-h-60 overflow-y-auto">\n                      {momentsByType.check.map((moment, idx) => (\n                        <DropdownMenuItem\n                          key={`check-${idx}`}\n                          onClick={() => onMoveChange(moment.moveNumber)}\n                          className="flex items-center gap-2"\n                        >\n                          <div className={`w-2 h-2 rounded-full ${moment.player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n                          <span className="font-mono text-xs">{formatMoveDisplay(moment)}</span>\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                )}\n\n                {/* Castling */}\n                {momentsByType.castling.length > 0 && (\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger className="flex items-center gap-2">\n                      <Castle className="h-3.5 w-3.5 text-blue-400" />\n                      <span>Castling</span>\n                      <span className="ml-auto text-xs text-muted-foreground">\n                        {momentsByType.castling.length}\n                      </span>\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent className="bg-popover max-h-60 overflow-y-auto">\n                      {momentsByType.castling.map((moment, idx) => (\n                        <DropdownMenuItem\n                          key={`castling-${idx}`}\n                          onClick={() => onMoveChange(moment.moveNumber)}\n                          className="flex items-center gap-2"\n                        >\n                          <div className={`w-2 h-2 rounded-full ${moment.player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n                          <span className="font-mono text-xs">{formatMoveDisplay(moment)}</span>\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                )}\n\n                {/* Promotions */}\n                {momentsByType.promotion.length > 0 && (\n                  <DropdownMenuSub>\n                    <DropdownMenuSubTrigger className="flex items-center gap-2">\n                      <Crown className="h-3.5 w-3.5 text-purple-400" />\n                      <span>Promotions</span>\n                      <span className="ml-auto text-xs text-muted-foreground">\n                        {momentsByType.promotion.length}\n                      </span>\n                    </DropdownMenuSubTrigger>\n                    <DropdownMenuSubContent className="bg-popover max-h-60 overflow-y-auto">\n                      {momentsByType.promotion.map((moment, idx) => (\n                        <DropdownMenuItem\n                          key={`promotion-${idx}`}\n                          onClick={() => onMoveChange(moment.moveNumber)}\n                          className="flex items-center gap-2"\n                        >\n                          <div className={`w-2 h-2 rounded-full ${moment.player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n                          <span className="font-mono text-xs">{formatMoveDisplay(moment)}</span>\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuSubContent>\n                  </DropdownMenuSub>\n                )}\n\n                {/* Checkmates */}\n                {momentsByType.checkmate.length > 0 && (\n                  <>\n                    <DropdownMenuSeparator />\n                    {momentsByType.checkmate.map((moment, idx) => (\n                      <DropdownMenuItem\n                        key={`checkmate-${idx}`}\n                        onClick={() => onMoveChange(moment.moveNumber)}\n                        className="flex items-center gap-2 text-red-400"\n                      >\n                        <Crown className="h-3.5 w-3.5" />\n                        <span className="font-semibold">Checkmate!</span>\n                        <span className="font-mono text-xs ml-auto">{formatMoveDisplay(moment)}</span>\n                      </DropdownMenuItem>\n                    ))}\n                  </>\n                )}\n              </DropdownMenuContent>\n            </DropdownMenu>\n          )}\n        </div>\n\n        {/* Keyboard shortcut hint */}\n        <AnimatePresence>\n          {showShortcutHint && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \'auto\' }}\n              exit={{ opacity: 0, height: 0 }}\n              className="flex items-center justify-center gap-2 text-[10px] text-muted-foreground"\n            >\n              <Keyboard className="w-3 h-3" />\n              <span>Space: Play/Pause ‚Ä¢ ‚Üê/‚Üí: Step ‚Ä¢ Home/End: Jump</span>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Progress bar during playback */}\n        <AnimatePresence>\n          {isPlaying && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: 4 }}\n              exit={{ opacity: 0, height: 0 }}\n              className="bg-muted rounded-full overflow-hidden"\n            >\n              <motion.div\n                className="h-full bg-gradient-to-r from-sky-500 via-purple-500 to-rose-500"\n                style={{ width: `${(currentMove / totalMoves) * 100}%` }}\n                transition={{ duration: 0.1 }}\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    </TooltipProvider>\n  );\n};\n\nexport default UniversalTimeline;\n';export{n as default};
