const n="/**\n * Hook for Hybrid Prediction System\n * \n * Combines Stockfish tactical analysis with Color Flow strategic trajectories\n */\n\nimport { useState, useCallback } from 'react';\nimport { \n  HybridPrediction, \n  generateHybridPrediction \n} from '@/lib/chess/hybridPrediction';\nimport { \n  PatternPrediction, \n  predictFromPatterns\n} from '@/lib/chess/patternLearning';\nimport { \n  ColorFlowSignature, \n  extractColorFlowSignature \n} from '@/lib/chess/colorFlowAnalysis';\nimport { simulateGame } from '@/lib/chess/gameSimulator';\n\nexport interface HybridAnalysisProgress {\n  stage: string;\n  percent: number;\n  details?: string;\n}\n\nexport interface HybridAnalysisResult {\n  hybridPrediction: HybridPrediction | null;\n  patternPrediction: PatternPrediction | null;\n  colorFlowSignature: ColorFlowSignature | null;\n}\n\nexport function useHybridPrediction() {\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [progress, setProgress] = useState<HybridAnalysisProgress | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [result, setResult] = useState<HybridAnalysisResult>({\n    hybridPrediction: null,\n    patternPrediction: null,\n    colorFlowSignature: null,\n  });\n\n  const analyzeGame = useCallback(async (pgn: string, options?: { depth?: number }) => {\n    if (!pgn) {\n      setError('No PGN provided');\n      return;\n    }\n\n    setIsAnalyzing(true);\n    setError(null);\n    setProgress({ stage: 'Initializing hybrid analysis', percent: 0 });\n\n    try {\n      // Step 1: Extract Color Flow Signature\n      setProgress({ stage: 'Extracting color flow signature', percent: 10 });\n      const simulation = simulateGame(pgn);\n      const colorFlowSignature = extractColorFlowSignature(\n        simulation.board, \n        simulation.gameData, \n        simulation.totalMoves\n      );\n\n      // Step 2: Get pattern prediction (fast, no Stockfish needed)\n      setProgress({ stage: 'Matching historical patterns', percent: 25 });\n      const patternPrediction = predictFromPatterns(pgn);\n\n      // Step 3: Generate full hybrid prediction (includes Lichess Cloud Stockfish)\n      // v6.80-PATIENT: Longer delay before cloud API - quality over speed\n      setProgress({ stage: 'Preparing Stockfish tactical analysis', percent: 35 });\n      await new Promise(r => setTimeout(r, 1000)); // 1s buffer before cloud API\n      \n      setProgress({ stage: 'Running Stockfish tactical analysis (Cloud)', percent: 40 });\n      const hybridPrediction = await generateHybridPrediction(pgn, {\n        depth: options?.depth || 18,\n        onProgress: (stage, percent) => {\n          setProgress({ \n            stage, \n            percent: 40 + (percent * 0.5),\n            details: `Depth: ${options?.depth || 18}`\n          });\n        },\n      });\n\n      // Step 4: Learn from this game for future predictions (if outcome is determinable)\n      setProgress({ stage: 'Updating pattern database', percent: 95 });\n      // Note: We'd need the game result to properly learn - skip for now during analysis\n      // learnFromGame(pgn, outcome) would be called after game completion\n\n      setProgress({ stage: 'Analysis complete', percent: 100 });\n      setResult({\n        hybridPrediction,\n        patternPrediction,\n        colorFlowSignature,\n      });\n\n    } catch (err) {\n      console.error('Hybrid analysis error:', err);\n      setError(err instanceof Error ? err.message : 'Analysis failed');\n    } finally {\n      setIsAnalyzing(false);\n    }\n  }, []);\n\n  const clearResults = useCallback(() => {\n    setResult({\n      hybridPrediction: null,\n      patternPrediction: null,\n      colorFlowSignature: null,\n    });\n    setError(null);\n    setProgress(null);\n  }, []);\n\n  return {\n    isAnalyzing,\n    progress,\n    error,\n    result,\n    analyzeGame,\n    clearResults,\n  };\n}\n";export{n as default};
