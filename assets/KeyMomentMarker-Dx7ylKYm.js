const e="/**\n * KeyMomentMarker Component\n * \n * Enhanced timeline marker with deep analysis integration.\n * On hover, highlights relevant squares and pieces on the board,\n * shows tactical annotations, and integrates with move quality metrics.\n */\n\nimport React, { useCallback, useMemo } from 'react';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Crown,\n  Zap,\n  Target,\n  Castle,\n  Star,\n  AlertTriangle,\n  TrendingUp,\n  Sparkles,\n  Crosshair,\n  ArrowUpRight,\n  Swords,\n  Shield,\n  Trophy,\n  MapPin,\n} from 'lucide-react';\nimport { useLegendHighlight, HighlightedPiece, HoveredMoveInfo } from '@/contexts/LegendHighlightContext';\nimport { PieceType, PieceColor } from '@/lib/chess/pieceColors';\nimport { MoveQuality, MOVE_QUALITY_INFO, ClassifiedMove } from '@/lib/chess/moveQuality';\nimport { TacticalMotif, SpecialMove } from '@/lib/chess/chessAnalysis';\n\n// ===================== TYPES =====================\n\nexport type KeyMomentType = \n  | 'capture' | 'check' | 'checkmate' | 'castling' \n  | 'brilliant' | 'great' | 'blunder' | 'mistake' | 'inaccuracy'\n  | 'fork' | 'pin' | 'skewer' | 'discovery' | 'sacrifice'\n  | 'en_passant' | 'promotion' | 'underpromotion';\n\nexport interface KeyMoment {\n  moveNumber: number;\n  type: KeyMomentType;\n  move: string;\n  player: 'white' | 'black';\n  quality?: MoveQuality;\n  tactic?: TacticalMotif;\n  specialMove?: SpecialMove;\n  description?: string;\n  // Deep analysis data\n  classifiedMove?: ClassifiedMove;\n  targetSquare?: string;\n  fromSquare?: string;\n  capturedPiece?: string;\n  pieceType?: PieceType;\n  pieceColor?: PieceColor;\n}\n\n// ===================== CONFIGURATION =====================\n\nconst MOMENT_CONFIG: Record<KeyMomentType, { \n  icon: React.ComponentType<{ className?: string }>; \n  color: string; \n  bgColor: string;\n  borderColor: string;\n  label: string;\n  description: string;\n  tacticalInsight: string;\n  emoji: string;\n}> = {\n  // Events\n  capture: { \n    icon: Target, \n    color: 'text-orange-400', \n    bgColor: 'bg-orange-500',\n    borderColor: 'border-orange-500/50',\n    label: 'Capture',\n    description: 'A piece was captured, shifting the material balance.',\n    tacticalInsight: 'Material changes can dramatically alter the strategic landscape. Evaluate if this trade favors one side.',\n    emoji: 'âš”ï¸',\n  },\n  check: { \n    icon: Zap, \n    color: 'text-yellow-400', \n    bgColor: 'bg-yellow-500',\n    borderColor: 'border-yellow-500/50',\n    label: 'Check',\n    description: 'The king is under attack and must escape.',\n    tacticalInsight: 'Checks force immediate response, often disrupting the opponent\\'s plans.',\n    emoji: 'âš¡',\n  },\n  checkmate: { \n    icon: Crown, \n    color: 'text-red-400', \n    bgColor: 'bg-red-500',\n    borderColor: 'border-red-500/50',\n    label: 'Checkmate',\n    description: 'Game over! The king cannot escape.',\n    tacticalInsight: 'The ultimate goal achieved. Study the mating pattern for future games.',\n    emoji: 'ðŸ‘‘',\n  },\n  castling: { \n    icon: Castle, \n    color: 'text-blue-400', \n    bgColor: 'bg-blue-500',\n    borderColor: 'border-blue-500/50',\n    label: 'Castle',\n    description: 'King moves to safety while activating the rook.',\n    tacticalInsight: 'A crucial developmental move that addresses king safety and rook activation.',\n    emoji: 'ðŸ°',\n  },\n  \n  // Move quality\n  brilliant: { \n    icon: Sparkles, \n    color: 'text-cyan-400', \n    bgColor: 'bg-cyan-500',\n    borderColor: 'border-cyan-500/50',\n    label: 'Brilliant',\n    description: 'An exceptional move that dramatically improves the position.',\n    tacticalInsight: 'Often involves a sacrifice or counterintuitive play that creates winning chances.',\n    emoji: 'ðŸ’Ž',\n  },\n  great: { \n    icon: TrendingUp, \n    color: 'text-green-400', \n    bgColor: 'bg-green-500',\n    borderColor: 'border-green-500/50',\n    label: 'Great Move',\n    description: 'A strong move that significantly improves the position.',\n    tacticalInsight: 'Demonstrates deep understanding of the position\\'s requirements.',\n    emoji: 'âœ¨',\n  },\n  blunder: { \n    icon: AlertTriangle, \n    color: 'text-red-400', \n    bgColor: 'bg-red-600',\n    borderColor: 'border-red-600/50',\n    label: 'Blunder',\n    description: 'A severe error that often loses the game.',\n    tacticalInsight: 'Critical mistake to avoid. Study what the better alternative was.',\n    emoji: 'âš ï¸',\n  },\n  mistake: { \n    icon: AlertTriangle, \n    color: 'text-orange-400', \n    bgColor: 'bg-orange-600',\n    borderColor: 'border-orange-600/50',\n    label: 'Mistake',\n    description: 'A clear error that loses material or advantage.',\n    tacticalInsight: 'An oversight that changes the evaluation. Consider what was missed.',\n    emoji: 'âŒ',\n  },\n  inaccuracy: { \n    icon: Target, \n    color: 'text-yellow-400', \n    bgColor: 'bg-yellow-600',\n    borderColor: 'border-yellow-600/50',\n    label: 'Inaccuracy',\n    description: 'Slightly imprecise, giving up some advantage.',\n    tacticalInsight: 'A minor slip. The difference between good and best moves.',\n    emoji: 'âšª',\n  },\n  \n  // Tactical motifs\n  fork: { \n    icon: Crosshair, \n    color: 'text-purple-400', \n    bgColor: 'bg-purple-500',\n    borderColor: 'border-purple-500/50',\n    label: 'Fork',\n    description: 'One piece attacks two or more enemy pieces simultaneously.',\n    tacticalInsight: 'A classic double attack. One of the most common tactical patterns.',\n    emoji: 'ðŸ”±',\n  },\n  pin: { \n    icon: Shield, \n    color: 'text-indigo-400', \n    bgColor: 'bg-indigo-500',\n    borderColor: 'border-indigo-500/50',\n    label: 'Pin',\n    description: 'A piece cannot move without exposing a more valuable piece behind it.',\n    tacticalInsight: 'Pins restrict movement and can lead to material wins or positional advantages.',\n    emoji: 'ðŸ“Œ',\n  },\n  skewer: { \n    icon: ArrowUpRight, \n    color: 'text-pink-400', \n    bgColor: 'bg-pink-500',\n    borderColor: 'border-pink-500/50',\n    label: 'Skewer',\n    description: 'Attacking a piece through another, forcing it to move.',\n    tacticalInsight: 'The reverse of a pin. The more valuable piece must move, exposing the lesser one.',\n    emoji: 'ðŸ“',\n  },\n  discovery: { \n    icon: Zap, \n    color: 'text-amber-400', \n    bgColor: 'bg-amber-500',\n    borderColor: 'border-amber-500/50',\n    label: 'Discovery',\n    description: 'Moving one piece to reveal an attack from another.',\n    tacticalInsight: 'Discovered attacks can be devastating as they create multiple threats.',\n    emoji: 'ðŸŽ¯',\n  },\n  sacrifice: { \n    icon: Star, \n    color: 'text-cyan-400', \n    bgColor: 'bg-cyan-600',\n    borderColor: 'border-cyan-600/50',\n    label: 'Sacrifice',\n    description: 'Intentionally giving up material for advantage.',\n    tacticalInsight: 'Sacrifices require deep calculation but can lead to brilliant victories.',\n    emoji: 'ðŸ’«',\n  },\n  \n  // Special moves\n  en_passant: { \n    icon: Swords, \n    color: 'text-emerald-400', \n    bgColor: 'bg-emerald-500',\n    borderColor: 'border-emerald-500/50',\n    label: 'En Passant',\n    description: 'Special pawn capture immediately after opponent\\'s two-square move.',\n    tacticalInsight: 'A unique rule that prevents pawns from escaping capture by advancing two squares.',\n    emoji: 'âš¡',\n  },\n  promotion: { \n    icon: Crown, \n    color: 'text-amber-400', \n    bgColor: 'bg-amber-500',\n    borderColor: 'border-amber-500/50',\n    label: 'Promotion',\n    description: 'Pawn reaches the eighth rank and transforms.',\n    tacticalInsight: 'Promotion often decides the game. Queen promotion is most common.',\n    emoji: 'ðŸ‘¸',\n  },\n  underpromotion: { \n    icon: Trophy, \n    color: 'text-violet-400', \n    bgColor: 'bg-violet-500',\n    borderColor: 'border-violet-500/50',\n    label: 'Underpromotion',\n    description: 'Strategic promotion to knight, bishop, or rook instead of queen.',\n    tacticalInsight: 'Rare but sometimes necessary to avoid stalemate or deliver mate.',\n    emoji: 'ðŸ†',\n  },\n};\n\n// ===================== HELPER FUNCTIONS =====================\n\n/**\n * Parse SAN notation to extract piece type and squares\n */\nfunction parseMoveNotation(san: string, isWhiteMove: boolean): { \n  pieceType: PieceType; \n  pieceColor: PieceColor;\n  targetSquare: string;\n  fromHint?: string;\n  isCapture: boolean;\n} | null {\n  if (!san) return null;\n  \n  const cleanSan = san.replace(/[+#!?]/g, '');\n  const pieceColor: PieceColor = isWhiteMove ? 'w' : 'b';\n  \n  // Handle castling\n  if (cleanSan === 'O-O' || cleanSan === 'O-O-O') {\n    const targetSquare = cleanSan === 'O-O' \n      ? (isWhiteMove ? 'g1' : 'g8') \n      : (isWhiteMove ? 'c1' : 'c8');\n    return { pieceType: 'k', pieceColor, targetSquare, isCapture: false };\n  }\n  \n  const isCapture = cleanSan.includes('x');\n  let pieceType: PieceType = 'p';\n  let remaining = cleanSan;\n  \n  // Extract piece type\n  if (/^[KQRBN]/.test(cleanSan)) {\n    pieceType = cleanSan[0].toLowerCase() as PieceType;\n    remaining = cleanSan.slice(1);\n  }\n  \n  // Handle disambiguation and capture\n  remaining = remaining.replace('x', '');\n  \n  // Handle promotion\n  const promotionMatch = remaining.match(/=([QRBN])$/i);\n  if (promotionMatch) {\n    remaining = remaining.slice(0, -2);\n  }\n  \n  // Extract from hint (disambiguation)\n  let fromHint: string | undefined;\n  if (remaining.length > 2) {\n    fromHint = remaining.slice(0, -2);\n    remaining = remaining.slice(-2);\n  }\n  \n  const targetSquare = remaining;\n  \n  if (!/^[a-h][1-8]$/.test(targetSquare)) {\n    return null;\n  }\n  \n  return { pieceType, pieceColor, targetSquare, fromHint, isCapture };\n}\n\n// ===================== COMPONENT =====================\n\ninterface KeyMomentMarkerProps {\n  moment: KeyMoment;\n  position: number; // Percentage position on timeline\n  totalMoves: number;\n  onClick: (moveNumber: number) => void;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport const KeyMomentMarker: React.FC<KeyMomentMarkerProps> = ({\n  moment,\n  position,\n  totalMoves,\n  onClick,\n  size = 'md'\n}) => {\n  const config = MOMENT_CONFIG[moment.type];\n  const Icon = config.icon;\n  \n  // Try to use legend highlight context for hover interactions\n  let highlightContext: ReturnType<typeof useLegendHighlight> | null = null;\n  try {\n    highlightContext = useLegendHighlight();\n  } catch {\n    // Context not available\n  }\n  \n  const sizeClasses = {\n    sm: 'w-3.5 h-3.5',\n    md: 'w-4 h-4',\n    lg: 'w-5 h-5',\n  };\n  \n  const iconSizes = {\n    sm: 'w-2 h-2',\n    md: 'w-2.5 h-2.5',\n    lg: 'w-3 h-3',\n  };\n\n  const moveIndex = moment.moveNumber - 1;\n  const moveNum = Math.floor(moveIndex / 2) + 1;\n  const isWhiteMove = moveIndex % 2 === 0;\n  \n  // Parse move for highlighting\n  const parsedMove = useMemo(() => {\n    return parseMoveNotation(moment.move, isWhiteMove);\n  }, [moment.move, isWhiteMove]);\n\n  // Create highlighted piece data\n  const highlightedPiece: HighlightedPiece | null = useMemo(() => {\n    if (!parsedMove) return null;\n    return {\n      pieceType: parsedMove.pieceType,\n      pieceColor: parsedMove.pieceColor,\n    };\n  }, [parsedMove]);\n\n  // Create hovered move info for board highlighting\n  const hoveredMoveInfo: HoveredMoveInfo | null = useMemo(() => {\n    if (!parsedMove || !highlightedPiece) return null;\n    return {\n      moveNumber: moment.moveNumber,\n      san: moment.move,\n      piece: highlightedPiece,\n      targetSquare: parsedMove.targetSquare,\n      isCapture: parsedMove.isCapture,\n    };\n  }, [parsedMove, highlightedPiece, moment.moveNumber, moment.move]);\n\n  // Handle hover enter - highlight piece and square on board\n  const handleMouseEnter = useCallback(() => {\n    if (!highlightContext) return;\n    \n    // Set hovered move to highlight the target square\n    if (hoveredMoveInfo) {\n      highlightContext.setHoveredMove(hoveredMoveInfo);\n    }\n    \n    // Also set the highlighted piece for legend sync\n    if (highlightedPiece) {\n      highlightContext.setHighlightedPiece(highlightedPiece);\n    }\n  }, [highlightContext, hoveredMoveInfo, highlightedPiece]);\n\n  // Handle hover leave - clear highlights\n  const handleMouseLeave = useCallback(() => {\n    if (!highlightContext) return;\n    highlightContext.setHoveredMove(null);\n    highlightContext.setHighlightedPiece(null);\n  }, [highlightContext]);\n\n  // Handle click - jump to move\n  const handleClick = useCallback(() => {\n    // Clear hover state before jumping\n    if (highlightContext) {\n      highlightContext.setHoveredMove(null);\n      highlightContext.setHighlightedPiece(null);\n    }\n    onClick(moment.moveNumber);\n  }, [onClick, moment.moveNumber, highlightContext]);\n\n  // Get quality info if available\n  const qualityInfo = moment.quality ? MOVE_QUALITY_INFO[moment.quality] : null;\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <button\n          onMouseEnter={handleMouseEnter}\n          onMouseLeave={handleMouseLeave}\n          onClick={handleClick}\n          className={`absolute -translate-x-1/2 -top-1 ${sizeClasses[size]} rounded-full ${config.bgColor} \n            flex items-center justify-center cursor-pointer\n            hover:scale-125 transition-all duration-200 shadow-lg ring-1 ring-black/20\n            ${moment.player === 'white' ? 'ring-white/30' : 'ring-black/50'}\n            hover:ring-2 hover:ring-primary/50`}\n          style={{ left: `${position}%` }}\n        >\n          <Icon className={`${iconSizes[size]} text-white`} />\n        </button>\n      </TooltipTrigger>\n      <TooltipContent \n        side=\"top\" \n        className=\"max-w-[300px] p-0 overflow-hidden\"\n        onPointerDownOutside={(e) => e.preventDefault()}\n      >\n        {/* Header with gradient */}\n        <div className={`${config.bgColor} px-3 py-2`}>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-lg\">{config.emoji}</span>\n            <Icon className=\"w-4 h-4 text-white\" />\n            <span className=\"font-semibold text-white\">{config.label}</span>\n            <Badge \n              variant=\"outline\" \n              className={`ml-auto text-[9px] bg-white/20 border-white/30 text-white`}\n            >\n              {moment.player === 'white' ? 'White' : 'Black'}\n            </Badge>\n          </div>\n        </div>\n        \n        <div className=\"p-3 space-y-3 bg-popover\">\n          {/* Move notation with square highlight hint */}\n          <div className=\"flex items-center gap-2\">\n            <div className={`w-2.5 h-2.5 rounded-full ${moment.player === 'white' ? 'bg-sky-400' : 'bg-rose-400'}`} />\n            <span className=\"font-mono text-sm font-medium\">\n              {moveNum}.{isWhiteMove ? '' : '..'} {moment.move}\n            </span>\n            {parsedMove && (\n              <Badge variant=\"secondary\" className=\"text-[9px] gap-1\">\n                <MapPin className=\"w-2.5 h-2.5\" />\n                {parsedMove.targetSquare}\n              </Badge>\n            )}\n          </div>\n          \n          {/* Description */}\n          <p className=\"text-xs text-muted-foreground leading-relaxed\">\n            {moment.description || config.description}\n          </p>\n          \n          {/* Tactical insight */}\n          <div className={`text-xs p-2 rounded-md border ${config.borderColor} bg-muted/30`}>\n            <div className=\"font-medium text-muted-foreground mb-1 flex items-center gap-1\">\n              <Sparkles className=\"w-3 h-3\" />\n              Tactical Insight\n            </div>\n            <p className=\"leading-relaxed\">{config.tacticalInsight}</p>\n          </div>\n          \n          {/* Move quality badge if available */}\n          {qualityInfo && (\n            <div className=\"flex items-center gap-2 pt-1 border-t border-border/50\">\n              <span className=\"text-xs text-muted-foreground\">Engine Analysis:</span>\n              <Badge \n                style={{ backgroundColor: qualityInfo.color }}\n                className=\"text-white text-[10px]\"\n              >\n                {qualityInfo.symbol} {qualityInfo.label}\n              </Badge>\n            </div>\n          )}\n          \n          {/* Tactic details if available */}\n          {moment.tactic && (\n            <div className=\"pt-2 border-t border-border/50\">\n              <div className=\"text-[10px] font-medium text-muted-foreground mb-1.5\">Tactical Details</div>\n              <div className=\"grid grid-cols-2 gap-x-3 gap-y-1 text-xs\">\n                <span className=\"text-muted-foreground\">Attacker:</span>\n                <span className=\"font-mono\">\n                  {moment.tactic.attacker.piece.toUpperCase()} @ {moment.tactic.attacker.square}\n                </span>\n                <span className=\"text-muted-foreground\">Targets:</span>\n                <span className=\"font-mono text-[10px]\">\n                  {moment.tactic.targets.map(t => `${t.piece.toUpperCase()}@${t.square}`).join(', ')}\n                </span>\n                {moment.tactic.value && (\n                  <>\n                    <span className=\"text-muted-foreground\">Value:</span>\n                    <span className=\"text-primary font-medium\">{moment.tactic.value} cp</span>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n          \n          {/* Hover hint */}\n          <div className=\"flex items-center gap-2 pt-1 text-[9px] text-muted-foreground/70\">\n            <div className=\"flex-1 flex items-center gap-1\">\n              <Target className=\"w-2.5 h-2.5\" />\n              <span>Hover highlights board</span>\n            </div>\n            <span className=\"text-primary/70\">Click to jump</span>\n          </div>\n        </div>\n      </TooltipContent>\n    </Tooltip>\n  );\n};\n\nexport default KeyMomentMarker;\n";export{e as default};
