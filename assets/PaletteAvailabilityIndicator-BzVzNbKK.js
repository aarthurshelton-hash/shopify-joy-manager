const e='/**\n * Palette Availability Indicator\n * \n * Shows which palettes are available or taken for the current game.\n * Allows navigation between different palette versions of the same game.\n * Users can click on any palette to:\n * - View the taken vision (navigate to its visualization menu)\n * - Apply an available palette (if in generator context)\n * - See listing details if for sale\n */\n\nimport React, { useEffect, useState, useCallback } from \'react\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Skeleton } from \'@/components/ui/skeleton\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \'@/components/ui/collapsible\';\nimport { \n  Check, \n  Lock, \n  ShoppingBag, \n  ChevronDown, \n  Palette, \n  Crown,\n  Eye,\n  ExternalLink,\n  Sparkles,\n} from \'lucide-react\';\nimport { colorPalettes, PaletteId } from \'@/lib/chess/pieceColors\';\nimport { \n  getGamePaletteAvailability, \n  GamePaletteAvailability,\n  PaletteAvailabilityInfo,\n} from \'@/lib/visualizations/paletteAvailability\';\n\ninterface PaletteAvailabilityIndicatorProps {\n  pgn?: string;\n  currentUserId?: string;\n  currentPaletteId?: PaletteId;\n  /** Called when user wants to apply a different palette (generator context) */\n  onPaletteSelect?: (paletteId: PaletteId) => void;\n  /** Called for seamless palette switching with full info */\n  onSeamlessSwitch?: (info: PaletteAvailabilityInfo) => void;\n  /** Context determines navigation behavior */\n  context?: \'generator\' | \'gallery\' | \'marketplace\' | \'shared\' | \'scanner\' | \'postgame\';\n  compact?: boolean;\n  showAllPalettes?: boolean;\n}\n\nconst PaletteAvailabilityIndicator: React.FC<PaletteAvailabilityIndicatorProps> = ({\n  pgn,\n  currentUserId,\n  currentPaletteId,\n  onPaletteSelect,\n  onSeamlessSwitch,\n  context = \'generator\',\n  compact = false,\n  showAllPalettes = false,\n}) => {\n  const [availability, setAvailability] = useState<GamePaletteAvailability | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  useEffect(() => {\n    if (!pgn) return;\n    \n    setIsLoading(true);\n    getGamePaletteAvailability(pgn, currentUserId)\n      .then(setAvailability)\n      .finally(() => setIsLoading(false));\n  }, [pgn, currentUserId]);\n\n  // Handle clicking on a palette chip\n  const handlePaletteClick = useCallback((info: PaletteAvailabilityInfo) => {\n    // If seamless switch is provided, use it for all palette changes (in-place update)\n    if (onSeamlessSwitch) {\n      onSeamlessSwitch(info);\n      return;\n    }\n    \n    // Fallback navigation (shouldn\'t happen in unified system, but kept for safety)\n    if (!info.isTaken && onPaletteSelect) {\n      // Apply this palette (only in generator context)\n      onPaletteSelect(info.paletteId);\n    }\n    // Note: Navigation to taken palettes is handled by seamless switch updating URL\n  }, [onPaletteSelect, onSeamlessSwitch]);\n\n  if (!pgn) return null;\n\n  if (isLoading) {\n    return (\n      <div className="flex items-center gap-2 p-3 rounded-lg bg-muted/30 border border-border/50">\n        <Palette className="h-4 w-4 text-muted-foreground" />\n        <Skeleton className="h-4 w-32" />\n      </div>\n    );\n  }\n\n  if (!availability) return null;\n\n  const currentPaletteInfo = currentPaletteId \n    ? [...availability.availablePalettes, ...availability.takenPalettes].find(p => p.paletteId === currentPaletteId)\n    : null;\n\n  // Compact mode: just show status for current palette with click to expand\n  if (compact && currentPaletteInfo) {\n    return (\n      <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n        <CollapsibleTrigger asChild>\n          <button className="w-full flex items-center justify-between p-2 rounded-lg bg-muted/30 border border-border/50 hover:bg-muted/50 transition-colors">\n            <div className="flex items-center gap-2">\n              {currentPaletteInfo.isTaken ? (\n                currentPaletteInfo.isOwnedByCurrentUser ? (\n                  <Badge variant="outline" className="gap-1 bg-green-500/10 text-green-600 border-green-500/30">\n                    <Crown className="h-3 w-3" />\n                    You Own This\n                  </Badge>\n                ) : currentPaletteInfo.isListedForSale ? (\n                  <Badge variant="outline" className="gap-1 bg-amber-500/10 text-amber-600 border-amber-500/30">\n                    <ShoppingBag className="h-3 w-3" />\n                    For Sale\n                  </Badge>\n                ) : (\n                  <Badge variant="outline" className="gap-1 bg-muted text-muted-foreground">\n                    <Lock className="h-3 w-3" />\n                    Owned\n                  </Badge>\n                )\n              ) : (\n                <Badge variant="outline" className="gap-1 bg-primary/10 text-primary border-primary/30">\n                  <Check className="h-3 w-3" />\n                  Available\n                </Badge>\n              )}\n              <span className="text-xs text-muted-foreground">\n                {availability.totalTaken > 0 && `${availability.totalTaken} colorway${availability.totalTaken > 1 ? \'s\' : \'\'} taken`}\n              </span>\n            </div>\n            <div className="flex items-center gap-1 text-xs text-muted-foreground">\n              <span>Browse palettes</span>\n              <ChevronDown className={`h-3 w-3 transition-transform ${isExpanded ? \'rotate-180\' : \'\'}`} />\n            </div>\n          </button>\n        </CollapsibleTrigger>\n        \n        <CollapsibleContent className="mt-2">\n          <PaletteGrid\n            availability={availability}\n            currentPaletteId={currentPaletteId}\n            context={context}\n            onPaletteClick={handlePaletteClick}\n          />\n        </CollapsibleContent>\n      </Collapsible>\n    );\n  }\n\n  // Full mode: show all palette availability\n  return (\n    <Collapsible open={isExpanded || showAllPalettes} onOpenChange={setIsExpanded}>\n      <div className="p-3 rounded-lg bg-muted/30 border border-border/50 space-y-3">\n        <CollapsibleTrigger asChild>\n          <button className="flex items-center justify-between w-full text-left">\n            <div className="flex items-center gap-2">\n              <Palette className="h-4 w-4 text-primary" />\n              <span className="text-sm font-medium">Browse All Colorways</span>\n            </div>\n            <div className="flex items-center gap-2">\n              <Badge variant="secondary" className="text-xs">\n                {availability.totalAvailable} available\n              </Badge>\n              {availability.totalTaken > 0 && (\n                <Badge variant="outline" className="text-xs">\n                  {availability.totalTaken} owned\n                </Badge>\n              )}\n              {!showAllPalettes && (\n                <ChevronDown className={`h-4 w-4 transition-transform ${isExpanded ? \'rotate-180\' : \'\'}`} />\n              )}\n            </div>\n          </button>\n        </CollapsibleTrigger>\n\n        <CollapsibleContent>\n          <PaletteGrid\n            availability={availability}\n            currentPaletteId={currentPaletteId}\n            context={context}\n            onPaletteClick={handlePaletteClick}\n          />\n        </CollapsibleContent>\n      </div>\n    </Collapsible>\n  );\n};\n\n// Grid of palette chips - shows all palettes with their status\nconst PaletteGrid: React.FC<{\n  availability: GamePaletteAvailability;\n  currentPaletteId?: PaletteId;\n  context: string;\n  onPaletteClick: (info: PaletteAvailabilityInfo) => void;\n}> = ({ availability, currentPaletteId, context, onPaletteClick }) => {\n  const isGeneratorContext = context === \'generator\' || context === \'postgame\';\n  \n  return (\n    <div className="space-y-3">\n      {/* Available Palettes - Claimable */}\n      {availability.availablePalettes.length > 0 && (\n        <div className="space-y-2">\n          <div className="flex items-center gap-2">\n            <Sparkles className="h-3 w-3 text-primary" />\n            <p className="text-xs text-muted-foreground uppercase tracking-wide">\n              Available to Claim ({availability.availablePalettes.length})\n            </p>\n          </div>\n          <div className="flex flex-wrap gap-1.5">\n            {availability.availablePalettes.map((p) => (\n              <PaletteChip \n                key={p.paletteId} \n                info={p} \n                isSelected={p.paletteId === currentPaletteId}\n                isGeneratorContext={isGeneratorContext}\n                onClick={() => onPaletteClick(p)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Taken Palettes - Viewable */}\n      {availability.takenPalettes.length > 0 && (\n        <div className="space-y-2">\n          <div className="flex items-center gap-2">\n            <Eye className="h-3 w-3 text-muted-foreground" />\n            <p className="text-xs text-muted-foreground uppercase tracking-wide">\n              Already Owned - Click to View ({availability.takenPalettes.length})\n            </p>\n          </div>\n          <div className="flex flex-wrap gap-1.5">\n            {availability.takenPalettes.map((p) => (\n              <PaletteChip \n                key={p.paletteId} \n                info={p} \n                isSelected={p.paletteId === currentPaletteId}\n                isGeneratorContext={false}\n                onClick={() => onPaletteClick(p)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Helpful tip */}\n      <p className="text-[10px] text-muted-foreground/70 italic pt-2 border-t border-border/30">\n        {isGeneratorContext \n          ? "Click available palettes to apply them. Click owned palettes to view that vision."\n          : "Click any palette to view that colorway\'s visualization menu."\n        }\n      </p>\n    </div>\n  );\n};\n\n// Individual palette chip component\nconst PaletteChip: React.FC<{\n  info: PaletteAvailabilityInfo;\n  isSelected: boolean;\n  isGeneratorContext: boolean;\n  onClick: () => void;\n}> = ({ info, isSelected, isGeneratorContext, onClick }) => {\n  const palette = colorPalettes.find(p => p.id === info.paletteId);\n  if (!palette) return null;\n\n  // Get a sample color from the palette for the visual indicator\n  const sampleColor = palette.white.q;\n\n  const isClickable = !info.isTaken || info.visualizationId;\n  const showViewIcon = info.isTaken && info.visualizationId;\n\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <button\n            onClick={onClick}\n            disabled={!isClickable}\n            className={`\n              inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-xs\n              transition-all border font-medium\n              ${isSelected \n                ? \'bg-primary/20 border-primary text-primary ring-2 ring-primary/20\' \n                : info.isTaken \n                  ? info.isListedForSale\n                    ? \'bg-amber-500/5 border-amber-500/30 text-amber-700 hover:bg-amber-500/10 hover:border-amber-500/50\'\n                    : \'bg-muted/50 border-border text-muted-foreground hover:bg-muted hover:border-border\'\n                  : \'bg-background border-primary/30 text-foreground hover:border-primary hover:bg-primary/5\'\n              }\n              ${isClickable ? \'cursor-pointer\' : \'cursor-not-allowed opacity-50\'}\n            `}\n          >\n            <span \n              className="w-3.5 h-3.5 rounded-full border border-black/10 shadow-sm"\n              style={{ backgroundColor: sampleColor }}\n            />\n            <span className="truncate max-w-[100px]">{palette.name}</span>\n            {info.isTaken && (\n              info.isOwnedByCurrentUser ? (\n                <Crown className="h-3 w-3 text-green-600 flex-shrink-0" />\n              ) : info.isListedForSale ? (\n                <ShoppingBag className="h-3 w-3 text-amber-500 flex-shrink-0" />\n              ) : showViewIcon ? (\n                <ExternalLink className="h-3 w-3 text-muted-foreground flex-shrink-0" />\n              ) : (\n                <Lock className="h-3 w-3 flex-shrink-0" />\n              )\n            )}\n            {!info.isTaken && isGeneratorContext && (\n              <Check className="h-3 w-3 text-primary flex-shrink-0" />\n            )}\n          </button>\n        </TooltipTrigger>\n        <TooltipContent className="max-w-[200px]">\n          {info.isTaken ? (\n            <div className="text-center space-y-1">\n              <p className="font-medium">{palette.name}</p>\n              <p className="text-xs text-muted-foreground">\n                {info.isOwnedByCurrentUser \n                  ? \'You own this colorway\' \n                  : `Owned by ${info.ownerDisplayName}`}\n              </p>\n              {info.isListedForSale && (\n                <p className="text-xs text-amber-500">\n                  For sale: ${(info.listingPriceCents! / 100).toFixed(2)}\n                </p>\n              )}\n              <p className="text-[10px] text-primary mt-1">\n                Click to view this vision â†’\n              </p>\n            </div>\n          ) : (\n            <div className="text-center space-y-1">\n              <p className="font-medium">{palette.name}</p>\n              <p className="text-xs text-primary">Available to claim!</p>\n              {isGeneratorContext && (\n                <p className="text-[10px] text-muted-foreground">\n                  Click to apply this palette\n                </p>\n              )}\n            </div>\n          )}\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  );\n};\n\nexport default PaletteAvailabilityIndicator;\n';export{e as default};
