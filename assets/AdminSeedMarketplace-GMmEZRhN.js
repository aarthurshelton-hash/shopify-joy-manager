import{d6 as e,d7 as t,cp as s,a as n,u as r,r as a,J as i,o,s as l,aH as c,aa as u,cM as d,j as m,L as h,C as f,x,D as p,B as g,A as v,p as w,t as j,cN as y,bC as N,S as b,a6 as z,P as M,y as C,bG as D,T as E,aq as A,z as L,cU as B,aj as q,aT as G,ca as S,b as _,d8 as k}from"./index-CN5tH3TC.js";!function(){const e=W,t=P();for(;;)try{if(427327===parseInt(e(534))/1+parseInt(e(563))/2+parseInt(e(393))/3*(-parseInt(e(463))/4)+-parseInt(e(548))/5*(parseInt(e(438))/6)+parseInt(e(442))/7+parseInt(e(444))/8+-parseInt(e(412))/9)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const I=function(){let e=!0;return function(t,s){const n=W;if(n(526)!==n(405)){const r=e?function(){if(s){const e=s[n(488)](t,arguments);return s=null,e}}:function(){};return e=!1,r}if(_0x21cc76){const e=_0x3a6ced.apply(_0xff1b42,arguments);return _0x591994=null,e}}}()(void 0,function(){const e=W;return I[e(361)]()[e(459)]("(((.+)+)+)+$").toString()[e(382)+"r"](I).search(e(370)+"+$")});function W(e,t){e-=352;const s=P();let n=s[e];if(void 0===W.ubEuKc){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};W.sGNLYs=r,W.UCkIGT={},W.ubEuKc=!0}const a=e+s[0],i=W.UCkIGT[a];if(i)n=i;else{const e=function(e){this.uOLXlZ=e,this.wnxonO=[1,0,0],this.zoBWUj=function(){return"newState"},this.OXEbNE="\\w+ *\\(\\) *{\\w+ *",this.uVzdno="['|\"].+['|\"];? *}"};e.prototype.aLMJWs=function(){const e=new RegExp(this.OXEbNE+this.uVzdno).test(this.zoBWUj.toString())?--this.wnxonO[1]:--this.wnxonO[0];return this.rDVvyL(e)},e.prototype.rDVvyL=function(e){return Boolean(~e)?this.lxFRJg(this.uOLXlZ):e},e.prototype.lxFRJg=function(e){for(let t=0,s=this.wnxonO.length;t<s;t++)this.wnxonO.push(Math.round(Math.random())),s=this.wnxonO.length;return e(this.wnxonO[0])},new e(W).aLMJWs(),n=W.sGNLYs(n),W.UCkIGT[a]=n}return n}I();const O=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s.apply(t,arguments);return s=null,e}}:function(){};return e=!1,n}}();O(void 0,function(){const e=W,t={XaLfs:function(e,t){return e(t)},hFMfC:"log",VKEvm:e(491),rGnUw:"info",PAoTp:e(429),igHhm:e(500)},s=function(){const s=e;let n;try{n=t[s(566)](Function,s(497)+s(486)+(s(355)+s(523)+s(409)+" ));"))()}catch(r){n=window}return n}(),n=s[e(466)]=s.console||{},r=[t[e(496)],t[e(375)],t[e(465)],e(427),t[e(424)],t[e(443)],e(386)];for(let a=0;a<r.length;a++){const t=O.constructor[e(371)].bind(O),s=r[a],i=n[s]||t;t.__proto__=O[e(368)](O),t.toString=i[e(361)][e(368)](i),n[s]=t}})();function P(){const e=["qMXHy2S","mtyXodiWv2XmzMX4","zMLSBfn0EwXL","rwzYr1a","iJaGmca","qw9jqva","Bw92zxm","pZ8/pY4/pY4/pW","y3rvuKW","BwvZlcbZzxjPzG","CMvKDwnL","ChvZAa","y29T","zKfiCxi","vuTcvKy","mJe0oduWvM5fA2rX","mc45nsK","iIbOzwLNAhq9iG","yxf0D2e","AM1tEwW","CxjJB2rL","mJu1lcaYntuSia","mhW0Fdf8m3WY","Ahr0Chm6lY9LBG","y3jVC3npCMLNAq","A2fwD2y","ntaWideXChGGjW","CMv2B2TLt2jQzq","zMLSBfjLy3q","z1zWCMO","mtmWnZGWnhjwyNfMrG","vgLTzxmGtMv3ia","D2HPDgu","wgfmzNm","iIb3Awr0Ad0I","iZC4nZe2yW","y2fUDMfZ","rgzPsM0","BgvUz3rO","yu5uBeK","BgLUzvDPzhrO","E30Uy29UC3rYDq","zhjHD0LTywDL","icdIGkiGia","EKvyuNi","zgvMyxvSDa","i0zerKngqG","Dg9tDhjPBMC","Agn0B1i","zw5Wzw5Zzw50lG","zhrOpsi","yM9YzgvY","CMvHzhK","qvzoEgm","yMLUza","A2H2s24","kcGOlISPkYKRkq","ChjVDg90ExbL","qKLXsxq","qLLStNC","B3fbugW","vKTfDM0","DMLZAxrZ","CMvZDg9Yzq","y2vUDgvY","CMLM","s1LlAuy","BwLU","y29UC3rYDwn0BW","iIb5psiWiIb3Aq","iIbMAwXSpsi","zMLSBfrLEhq","DhjHy2u","ru4Guevou0vova","tMHkELG","BgTMqve","swr4EuO","ANrithi","qvLbyuu","mtjNzLHvDfq","BeniDxe","mJaWmc9ZDMCIia","C3rYB2TL","y2XPCa","psjODhrWoI8VDW","EKL2zgy","C2f2zq","r0jKvxO","i2zHzMfMoq","EejZywy","yMXHy2S","tKfMwuG","Dd11DgyToa","B0jnr20","Bw92zvrV","CM4GDgHPCYiPka","DhLWzq","Au9Wvum","nte0ote3owP1vKjHqG","ywXWAgfIzxrPyW","AxrHBgLJiduWma","Axnozu4","i0zbrKfgqq","Aw1Hz2uVC3zNkW","uefIqxG","phjLy3qGEd0Ima","CgLLy2u","t2TSyKK","iIb5psi","BwvHC3vYzvrLEa","uefVvha","zw50","Cg1tseu","zxjYB3i","AKHOsNK","zxHJzxb0Aw9U","CuPjEey","AM9PBG","AMvgC2i","txzVAhy","venSwxm","BwLKzgXL","idiWChGGj0nVCG","C3bSAxq","nLPoq2PkCW","q2LUEMvSjYWGjW","v2HPDgu","Bw9Yyw50jYWGrW","ntGZndy4owzmq3zuva","AwDiAg0","mti0ote0nhPmr2DnvG","Aw5JBhvKzxm","DhjHBNnWyxjLBG","AgLUz0vUywjSzq","BgvMDa","Dgv4DefSAwDU","v3bQuwq","wvLUBw0","DK9uB0W","yMvNAw5qyxrO","CM91BMrszwn0","C3jJ","y29SB3i","iIb2Awv3qM94pq","C3rYB2TLu3r5Ba","C2vHCMnO","ide4ChGGj0nVCG","ihzZia","AxnmAwDODa","nZyYoty0vgzHqMLg","yM9AEu4","CKDUvxC","y29UC29Szq","wvDfr1e","i2u3ztvLna","EgjkuuG","rvjftKC","uK1Hyu8","D3CUDZmUB3jNlW","whjMEey","AgLNAa","yuf6s3m","AgvPz2H0","zvjYu3u","twnMEMq","C2nHBgu","Eg1So2nOyxjZzq","BNmTC2vYAwy","BeHIqNq","nJaWidi0ChGGjW","uM9Tyw4NlcbZzq","B25LCNjVCG","BMn0Aw9UkcKG","y3jLyxrLrwXLBq","yxbWBhK","pc9ZDMC+","iZfbmueXqq","D2fYBG","Aw1Hz2vtBw9VDa","z2v0q29UDgv4Da","zxzLBNq","zMLSBa","AeznzKm","CMv0DxjUicHMDq","z3nwte0","DNP0A3i","DgfIBgu","B25SB2fK","D2LKDgG9iG","AhjqCuK","nJaWideZChGGjW","iI8+","Dg9eyxrHvvjm","yxjJ","tNvfBuO","yxrqyKi","zgf0zq","tLztDgi","i2e4yti5zq","ywXS","Bgf5zxjtAxPL","BgLNAhq","zM9UDa","4PMuievoifbftLnf","phjLy3qGEd0I","zM9UDhm","ndaWideXChGGjW","Dgv4DejHC2vSAq","AgLUz1f1ywXPDa","y3rVCIGICMv0Dq","vw5RBM93BG","sw50zxiNlcbZyq","sgjgq1a","CgvUC2vUDc5JBW","qMXlA3C","ufnxAeO","qLbJwNu","D2LKDgG","wuPpv2i"];return(P=function(){return e})()}async function U(e){const t=W,s={};s[t(546)]=t(553),s[t(498)]=t(556)+t(527)+"m",s[t(374)]=t(416);const n=s;return(await import(n[t(546)]))[t(359)][t(506)](n[t(498)],{width:200,margin:1,color:{dark:e?n[t(374)]:t(490),light:t(446)+"t"},errorCorrectionLevel:"M"})}async function H(){const e=W,t={};t[e(434)]="anonymous";const n=t;return new Promise((t,r)=>{const a=e,i=new Image;i[a(557)+"n"]=n[a(434)],i[a(501)]=()=>t(i),i[a(485)]=r,i[a(455)]=s})}async function K(s,n,r={}){const a=W,i={Mcfzd:function(e,t){return e+t},kaVwf:function(e,t){return e*t},aNTlI:function(e,t){return e*t},wsIqY:a(474),BIqIt:a(360),oBMGm:"#292524",ERENG:a(468),jHhJy:function(e,t){return e-t},isNeN:a(568),YYnmm:a(512),BPcZu:function(e,t){return e+t},lCHuq:a(533),jeFsb:a(483)+a(439)+a(564)+a(484)+a(379),khvKn:a(414)+a(436)+a(441)+"eorgia, se"+a(379),aqtwa:a(461),PSWhJ:function(e,t){return e+t},hrPqI:a(448),lkfAQ:function(e,t){return e+t},IdxyJ:function(e,t){return e+t},lScOf:function(e,t){return e!==t},BlKkw:a(524),KYKiF:"center",aAzKs:function(e,t){return e!==t},lHbBt:"jHPej",MIkzp:"ozkhE",iOpUC:function(e,t){return e/t},YWEGQ:function(e,t){return e>t},nKSmY:"400 10px '"+a(564)+"Roman', Ti"+a(542),vOToL:function(e,t){return e-t},XrfxF:function(e,t){return e<t},BYlNw:function(e,t){return e-t},UKBVF:function(e,t){return e/t},zIvdf:function(e,t){return e+t},zEXRr:function(e,t){return e(t)},NVStb:function(e,t){return e+t},WpjQd:function(e,t){return e-t},fgqZM:function(e,t){return e+t},qJIxF:function(e,t){return e/t},jtHLr:function(e,t){return e*t},boZyN:function(e,t){return e+t},kPESG:function(e,t){return e+t},WmruU:a(413),xbJQH:a(387),YJOWb:a(520)+a(525)+a(481),OklbI:function(e,t){return e+t}};await async function(){const e=W,t={GBdUz:function(e,t){return e-t},fNiDw:function(e,t){return e!==t}};if(document[e(519)]&&document[e(519)][e(366)])if(t.fNiDw(e(509),e(362)))await document[e(519)].ready;else{const s=t[e(401)](_0x5754cb,_0x39223[e(514)])/2;_0x12efd9+=e(518)+(_0x49d0a3+s)+e(422)+(_0x1fd678+s)+'" width="'+_0x41aadb[e(514)]+'" height="'+_0x593e4f[e(514)]+e(384)+_0x3136f8[e(456)]+e(505)}await new Promise(e=>setTimeout(e,150))}();const{boardSize:o=600,darkMode:l=!1,withWatermark:c=!1,title:u}=r,d=function(s,n){const r=W,a={xBsaf:function(e,t){return e/t},DgNWX:function(e,t){return e*t},AoIAP:function(e,t){return e<t},NhJzX:function(e,t){return e*t},gVprj:function(e,t){return e+t},RMaaO:function(e,t){return e*t},GhdQA:function(e,t,s){return e(t,s)},vztkr:function(e,t){return e-t},AYAaE:function(e,t){return e*t},pmSHE:function(e,t){return e*t},NuEmJ:"Mvohv",EfrGP:function(e,t){return e-t},PAbAx:function(e,t){return e+t},jmSyl:r(489)},i=a[r(403)](n,8),o=.02*n,l=n+a.DgNWX(o,2);let c="<svg xmlns"+r(398)+r(472)+r(395)+r(502)+l+'" height="'+l+(r(457)+r(537))+l+" "+l+'">';c+=r(419)+r(383)+r(364)+l+r(550)+l+r(384)+e[r(365)]+r(505);for(let u=0;u<8;u++){const n=7-u;for(let l=0;a[r(538)](l,8);l++){const d=s[n][l],m=d[r(462)]?e[r(515)]:e.dark,h=o+a[r(388)](l,i),f=a[r(562)](o,u*i);if(c+=r(518)+h+r(422)+f+'" width="'+i+r(550)+i+r(384)+m+r(505),d[r(376)].length>0){const e=a[r(471)](i,.08),s=[];for(const i of d[r(376)]){const e=a.GhdQA(t,i[r(420)],i.color);!s[r(445)](e)&&s[r(544)](e)}const n=Math[r(381)](s[r(352)],6),o=[];let l=a[r(499)](i,a[r(392)](e,2));const u=a[r(403)](a[r(426)](l,.7),n);for(let t=0;a.AoIAP(t,n);t++){const e={};if(e.color=s[t],e[r(514)]=l,o.push(e),l-=u,l<a[r(392)](i,.1))break}for(const t of o)if(a[r(508)]!==r(433))_0x4ae1ed=_0x39c81d;else{const e=a[r(536)](i,t[r(514)])/2;c+=r(518)+a[r(418)](h,e)+r(422)+(f+e)+r(567)+t[r(514)]+r(550)+t[r(514)]+r(384)+t.color+r(505)}}}}return c+=a[r(552)],c}(s,o),m=o+2*(.02*o),h=await async function(e,t,s){const n=W,r={HFyJq:n(569),pOOwv:function(e,t){return e*t},AVNxc:function(e,t){return e(t)},DfiJm:function(e,t){return e(t)},eRrSu:"Failed to load SVG"};return new Promise((a,i)=>{const o=n,l=new Image,c={};c[o(410)]=o(417)+o(480)+o(406);const u=new Blob([e],c),d=URL["createObje"+o(541)](u);l[o(501)]=()=>{const e=o,n=document["createElem"+e(425)](r.HFyJq);n[e(531)]=r.pOOwv(t,5),n.height=5*s;const i=n[e(493)]("2d");i.scale(5,5),i[e(356)](l,0,0,t,s),URL[e(560)+e(541)](d),r[e(367)](a,n)},l.onerror=()=>{const e=o;URL["revokeObje"+e(541)](d),r[e(570)](i,new Error(r[e(477)]))},l.src=d})}(d,m,m),f=60,x=i[a(478)](m,i[a(558)](f,2)),p=i[a(478)](i[a(478)](m,220),60)+120,g=document[a(487)+a(425)]("canvas");g[a(531)]=i[a(353)](x,5),g[a(476)]=5*p;const v=g.getContext("2d");v[a(479)](5,5),v["imageSmoot"+a(447)+"d"]=!0,v[a(492)+a(522)+"y"]=i.wsIqY,v[a(535)]=l?"#0A0A0A":i[a(372)],v[a(561)](0,0,x,p),v[a(356)](h,0,0,h.width,h.height,f,f,m,m);const w=i[a(478)](i.Mcfzd(f,m),28);v.strokeStyle=l?i[a(407)]:i[a(470)],v.lineWidth=1,v.beginPath(),v[a(408)](f,w),v.lineTo(i.jHhJy(x,f),w),v.stroke();const j=l?a(402):i[a(407)],y=l?a(512):i[a(415)],N=l?i[a(415)]:i[a(451)],b=a(l?568:512),z=x/2;let M=i[a(530)](w,55);const C=n[a(565)]||a(440),D=n[a(404)]||i[a(394)];v[a(521)+"ne"]=a(435),v[a(516)]=i[a(432)];const E=v.measureText(C)[a(531)],A=v[a(423)+"t"](D)[a(531)];v[a(516)]=i[a(369)];const L=i[a(551)],B=v[a(423)+"t"](L)[a(531)],q=i[a(529)](E,B)+A,G=i[a(428)](z,q/2);if(v[a(516)]=a(483)+a(439)+a(564)+"Roman', se"+a(379),v[a(535)]=j,v[a(449)]=i.hrPqI,v[a(385)](C,G,M),v[a(516)]="italic 500"+a(436)+a(441)+"eorgia, se"+a(379),v[a(535)]=b,v[a(385)](L,i[a(389)](G,E),M),v[a(516)]=i[a(432)],v[a(535)]=j,v.fillText(D,i[a(390)](G+E,B),M),M+=36,n[a(494)]&&i.lScOf(n.event,i[a(528)])){const e=a(555)[a(437)]("|");let t=0;for(;;){switch(e[t++]){case"0":v[a(535)]=y;continue;case"1":v[a(449)]=i[a(380)];continue;case"2":M+=32;continue;case"3":v[a(385)](n[a(494)],z,M);continue;case"4":v[a(516)]=a(414)+a(460)+a(441)+"eorgia, se"+a(379);continue}break}}const S=u,_=n[a(510)]||"";if(S||_)if(i[a(475)](i[a(482)],i.MIkzp)){v[a(535)]=N,v[a(516)]="500 12px '"+a(525)+a(481),v[a(449)]=a(378);let e="";S?(e=S.toUpperCase(),_&&(e+=a(357)+_)):e=_;const t=2,s=e[a(437)](""),n=s[a(543)]((e,t)=>e+v.measureText(t)[a(531)],0),r=i[a(558)](i[a(428)](s[a(352)],1),t);let o=z-i[a(411)](n+r,2);for(const l of s)v[a(449)]=a(448),v.fillText(l,o,M),o+=i[a(478)](v.measureText(l)[a(531)],t);M+=28}else _0x87b9f8[a(356)](_0x1fedd0,_0x102ac4,_0x34815a,_0x244281,_0x201a26),_0x2b79ab();if(n.moves&&i[a(467)](n[a(539)][a(352)],0)){v[a(535)]=N,v[a(516)]=i.nKSmY,v[a(449)]=a(378);const e=n[a(539)][a(431)](" "),t=e.length>400?i[a(530)](e.substring(0,400),"..."):e,s=i[a(452)](i[a(428)](x,120),40),r=t[a(437)](" ");let o="",l=M;const c=15,u=4;let d=0;for(const n of r){const e=i[a(478)](i[a(530)](o,o?" ":""),n);if(v[a(423)+"t"](e)[a(531)]>s&&o){if(v[a(385)](o,z,l),o=n,l+=c,d++,d>=u)break}else o=e}o&&i[a(473)](d,u)&&v.fillText(o,z,l)}const k=i[a(373)](p-f,20);v.fillStyle=N,v[a(516)]=a(559)+a(525)+"ns-serif",v[a(449)]="center";const I=(a(517)+"NT â™š").split(""),O=I[a(543)]((e,t)=>e+v[a(423)+"t"](t).width,0),P=i[a(530)](O,i[a(353)](I[a(352)]-1,4));let K=i[a(373)](z,i[a(547)](P,2));for(const e of I)v[a(449)]=i[a(503)],v[a(385)](e,K,k),K+=i[a(399)](v[a(423)+"t"](e)[a(531)],4);if(c){const[e,t]=await Promise[a(513)]([i[a(358)](U,!1),H()]),s=220,n=65,r=i[a(373)](i.NVStb(f,m),s)-12,o=i[a(452)](i[a(511)](f,m),n)-12;v[a(535)]="rgba(255, "+a(554)+a(549),v[a(453)](),v[a(454)](r,o,s,n,6),v[a(495)](),v[a(458)+"e"]=a(468),v[a(354)]=1,v[a(396)]();const l=48,c=r+12,u=o+i.UKBVF(i[a(450)](n,l),2);v[a(400)](),v[a(453)](),v[a(507)](c+l/2,i.fgqZM(u,i[a(430)](l,2)),l/2,0,i[a(391)](Math.PI,2)),v[a(397)](),v[a(356)](t,c,u,l,l),v[a(377)]();const d=i[a(464)](i.kPESG(c,l),10);v.textAlign=i[a(503)],v[a(521)+"ne"]=i.WmruU,v.fillStyle="#44403c",v[a(516)]=a(504)+a(525)+a(481),v[a(385)](i[a(469)],d,i[a(390)](o,28)),v[a(535)]=a(568),v[a(516)]=i[a(532)],v[a(385)](a(363)+a(545),d,o+46);const h=50,x=i[a(450)](r+s,h)-10,p=i[a(421)](o,i[a(411)](n-h,2)),g=new Image;await new Promise(t=>{const s=a;g[s(501)]=()=>{v[s(356)](g,x,p,h,h),t()},g[s(485)]=()=>t(),g[s(455)]=e})}return g}const T=S.filter(e=>"custom"!==e.id);const Y=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const V=()=>{const e=n(),{user:t,isLoading:s}=r(),[I,W]=a.useState(null),[O,P]=a.useState(!1),[U,H]=a.useState(0),[V,J]=a.useState(""),[Z,X]=a.useState([]),[F,$]=a.useState(50),[R,Q]=a.useState(!0),[ee,te]=a.useState(!1),[se,ne]=a.useState(null);a.useEffect(()=>{s||(async()=>{if(!t)return void W(!1);const{data:e}=await l.rpc("has_role",{_user_id:t.id,_role:"admin"});W(!0===e)})()},[t,s]);const re=a.useCallback(async(e,s,n,r,a=!0)=>{try{const m=i(e.pgn),h=a?T[Math.floor(Math.random()*T.length)]:T[n%T.length],f=function(e,t){const s=S.find(e=>e.id===t)||S[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,h.id);o(h.id);const x=await K(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),g=Date.now(),v=`${t.id}/${g}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await l.storage.from("visualizations").upload(v,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:j}=l.storage.from("visualizations").getPublicUrl(v),y=c(e.pgn),N={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:h.id,paletteName:h.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:y}},{data:b,error:z}=await l.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:N,image_path:j.publicUrl}).select().single();if(z)throw z;const M=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:C,error:D}=await u(b.id,M);if(D)throw D;const E=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<E.viewCount;e++)await l.rpc("record_vision_interaction",{p_visualization_id:b.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const A=d(e.pgn),L=a?"premium":"genesis";return{title:s,success:!0,visualizationId:b.id,listingId:null==C?void 0:C.id,isExemplar:r,paletteId:h.id,paletteName:h.name,gameHash:y,tier:L,openingName:null==A?void 0:A.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:r}}},[t]),ae=Z.filter(e=>e.success).length,ie=Z.filter(e=>!e.success).length;return Z.filter(e=>e.success&&e.isExemplar).length,s||null===I?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}):t&&I?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(g,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(j,{className:"flex items-center gap-3",children:[m.jsx(y,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(x,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(N,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",F," visions: ",Math.min(25,F)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,F-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:F,onChange:e=>$(Number(e.target.value)),disabled:O,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(b,{id:"use-official-palettes",checked:R,onCheckedChange:Q,disabled:O}),m.jsxs(z,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(M,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),R&&m.jsxs(C,{variant:"secondary",className:"text-xs",children:[T.length," palettes"]})]})]}),m.jsx(g,{onClick:async()=>{if(!t)return void _.error("You must be logged in as the CEO account");P(!0),X([]),H(0);const e=[],s=k.slice(0,Math.min(F,k.length)),n=[];for(let t=0;t<F;t++){const e=t%s.length,r=t<25,a=Y[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];J(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,R);e.push(i),X([...e]),H((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}P(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?_.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):_.error("Failed to create any visions")},disabled:O||!t,className:"w-full",size:"lg",children:O?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(D,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(E,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(g,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await l.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return _.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await l.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),c=n.filter(e=>i.has(e));if(0===o.length)return _.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:c.length}),void te(!1);await l.from("visualization_listings").delete().in("visualization_id",o),await l.from("vision_scores").delete().in("visualization_id",o),await l.from("vision_interactions").delete().in("visualization_id",o),await l.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await l.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await l.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:c.length}),_.success(`Deleted ${o.length} test visions`,{description:c.length>0?`${c.length} visions with natural value preserved`:void 0})}catch(e){_.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||O||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(E,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),O&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{value:U,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:V})]}),Z.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(L,{className:"h-4 w-4"}),ae," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(B,{className:"h-4 w-4"}),Z.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(q,{className:"h-4 w-4"}),Z.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:Z.map((e,t)=>m.jsxs(G.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(B,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(q,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(C,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(C,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(M,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(x,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(g,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{V as default};
