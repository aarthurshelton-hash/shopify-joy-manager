import{ca as e,cb as t,bN as s,c7 as a,a as i,u as r,r as n,cc as l,o,s as c,ak as d,cd as m,ce as h,j as x,L as u,a5 as p,a6 as f,aM as g,B as v,A as w,af as N,ag as b,cf as j,am as y,S as E,b0 as S,P as _,ah as k,ad as T,T as C,bH as M,aL as $,cg as z,I as D,x as A,b6 as P,b as I,ch as R}from"./index-1k5cZzy0.js";async function F(e){return(await s(async()=>{const{default:e}=await import("./browser-DhmD84ER.js").then(e=>e.b);return{default:e}},[])).default.toDataURL("https://enpensent.com",{width:200,margin:1,color:{dark:"#1A1A1A",light:"transparent"},errorCorrectionLevel:"M"})}async function O(){return new Promise((e,t)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=t,s.src=a})}async function L(s,a,i={}){await async function(){document.fonts&&document.fonts.ready&&await document.fonts.ready,await new Promise(e=>setTimeout(e,150))}();const{boardSize:r=600,darkMode:n=!1,withWatermark:l=!1,title:o}=i,c=function(s,a){const i=a/8,r=.02*a,n=a+2*r;let l=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">`;l+=`<rect x="0" y="0" width="${n}" height="${n}" fill="${e.border}"/>`;for(let o=0;o<8;o++){const a=7-o;for(let n=0;n<8;n++){const c=s[a][n],d=r+n*i,m=r+o*i;if(l+=`<rect x="${d}" y="${m}" width="${i}" height="${i}" fill="${c.isLight?e.light:e.dark}"/>`,c.visits.length>0){const e=.08*i,s=[];for(const i of c.visits){const e=t(i.piece,i.color);s.includes(e)||s.push(e)}const a=Math.min(s.length,6),r=[];let n=i-2*e;const o=.7*n/a;for(let t=0;t<a&&(r.push({color:s[t],layerSize:n}),n-=o,!(n<.1*i));t++);for(const t of r){const e=(i-t.layerSize)/2;l+=`<rect x="${d+e}" y="${m+e}" width="${t.layerSize}" height="${t.layerSize}" fill="${t.color}"/>`}}}}return l+="</svg>",l}(s,r),d=r+2*(.02*r),m=await async function(e,t,s){return new Promise((a,i)=>{const r=new Image,n=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(n);r.onload=()=>{const e=document.createElement("canvas");e.width=5*t,e.height=5*s;const i=e.getContext("2d");i.scale(5,5),i.drawImage(r,0,0,t,s),URL.revokeObjectURL(l),a(e)},r.onerror=()=>{URL.revokeObjectURL(l),i(new Error("Failed to load SVG"))},r.src=l})}(c,d,d),h=60,x=d+120,u=d+220+60+120,p=document.createElement("canvas");p.width=5*x,p.height=5*u;const f=p.getContext("2d");f.scale(5,5),f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.fillStyle=n?"#0A0A0A":"#FDFCFB",f.fillRect(0,0,x,u),f.drawImage(m,0,0,m.width,m.height,h,h,d,d);const g=h+d+28;f.strokeStyle=n?"#292524":"#e7e5e4",f.lineWidth=1,f.beginPath(),f.moveTo(h,g),f.lineTo(x-h,g),f.stroke();const v=n?"#fafaf9":"#292524",w=n?"#a8a29e":"#78716c",N=n?"#78716c":"#a8a29e",b=n?"#78716c":"#a8a29e",j=x/2;let y=g+55;const E=a.white||"White",S=a.black||"Black";f.textBaseline="middle",f.font="600 24px 'Cinzel', 'Times New Roman', serif";const _=f.measureText(E).width,k=f.measureText(S).width;f.font="italic 500 20px 'Cormorant', Georgia, serif";const T=" vs ",C=f.measureText(T).width,M=j-(_+C+k)/2;f.font="600 24px 'Cinzel', 'Times New Roman', serif",f.fillStyle=v,f.textAlign="left",f.fillText(E,M,y),f.font="italic 500 20px 'Cormorant', Georgia, serif",f.fillStyle=b,f.fillText(T,M+_,y),f.font="600 24px 'Cinzel', 'Times New Roman', serif",f.fillStyle=v,f.fillText(S,M+_+C,y),y+=36,a.event&&"Unknown"!==a.event&&(f.fillStyle=w,f.font="italic 500 18px 'Cormorant', Georgia, serif",f.textAlign="center",f.fillText(a.event,j,y),y+=32);const $=o,z=a.date||"";if($||z){f.fillStyle=N,f.font="500 12px 'Inter', sans-serif",f.textAlign="center";let e="";$?(e=$.toUpperCase(),z&&(e+="  â€¢  "+z)):e=z;const t=2,s=e.split("");let a=j-(s.reduce((e,t)=>e+f.measureText(t).width,0)+(s.length-1)*t)/2;for(const i of s)f.textAlign="left",f.fillText(i,a,y),a+=f.measureText(i).width+t;y+=28}if(a.moves&&a.moves.length>0){f.fillStyle=N,f.font="400 10px 'Times New Roman', Times, serif",f.textAlign="center";const e=a.moves.join(" "),t=x-120-40,s=(e.length>400?e.substring(0,400)+"...":e).split(" ");let i="",r=y;const n=15,l=4;let o=0;for(const a of s){const e=i+(i?" ":"")+a;if(f.measureText(e).width>t&&i){if(f.fillText(i,j,r),i=a,r+=n,o++,o>=l)break}else i=e}i&&o<l&&f.fillText(i,j,r)}const D=u-h-20;f.fillStyle=N,f.font="500 11px 'Inter', sans-serif",f.textAlign="center";const A="â™” EN PENSENT â™š".split("");let P=j-(A.reduce((e,t)=>e+f.measureText(t).width,0)+4*(A.length-1))/2;for(const e of A)f.textAlign="left",f.fillText(e,P,D),P+=f.measureText(e).width+4;if(l){const[e,t]=await Promise.all([F(),O()]),s=220,a=65,i=h+d-s-12,r=h+d-a-12;f.fillStyle="rgba(255, 255, 255, 0.95)",f.beginPath(),f.roundRect(i,r,s,a,6),f.fill(),f.strokeStyle="#e7e5e4",f.lineWidth=1,f.stroke();const n=48,l=i+12,o=r+(a-n)/2;f.save(),f.beginPath(),f.arc(l+n/2,o+n/2,n/2,0,2*Math.PI),f.clip(),f.drawImage(t,l,o,n,n),f.restore();const c=l+n+10;f.textAlign="left",f.textBaseline="alphabetic",f.fillStyle="#44403c",f.font="600 13px 'Inter', sans-serif",f.fillText("EN PENSENT",c,r+28),f.fillStyle="#78716c",f.font="400 11px 'Inter', sans-serif",f.fillText("enpensent.com",c,r+46);const m=50,x=i+s-m-10,u=r+(a-m)/2,p=new Image;await new Promise(t=>{p.onload=()=>{f.drawImage(p,x,u,m,m),t()},p.onerror=()=>t(),p.src=e})}return p}const B=P.filter(e=>"custom"!==e.id);const U=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const V=()=>{const e=i(),{user:t,isLoading:s}=r(),[a,F]=n.useState(null),[O,V]=n.useState(!1),[G,H]=n.useState(0),[W,Y]=n.useState(""),[q,Q]=n.useState([]),[Z,J]=n.useState(50),[K,X]=n.useState(!0),[ee,te]=n.useState(!1),[se,ae]=n.useState(null);n.useEffect(()=>{s||(async()=>{if(!t)return void F(!1);const{data:e}=await c.rpc("has_role",{_user_id:t.id,_role:"admin"});F(!0===e)})()},[t,s]);const ie=n.useCallback(async(e,s,a,i,r=!0)=>{try{const n=l(e.pgn),x=r?B[Math.floor(Math.random()*B.length)]:B[a%B.length],u=function(e,t){const s=P.find(e=>e.id===t)||P[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(n.board,x.id);o(x.id);const p=await L(u,n.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),f=await new Promise((e,t)=>{p.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),g=Date.now(),v=`${t.id}/${g}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await c.storage.from("visualizations").upload(v,f,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:N}=c.storage.from("visualizations").getPublicUrl(v),b=d(e.pgn),j={white:n.gameData.white,black:n.gameData.black,event:n.gameData.event,date:n.gameData.date,result:n.gameData.result,pgn:n.gameData.pgn,moves:n.gameData.moves,board:u,totalMoves:n.totalMoves,visualizationState:{paletteId:x.id,paletteName:x.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:i,exemplarNumber:i?a+1:void 0,gameHash:b}},{data:y,error:E}=await c.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:j,image_path:N.publicUrl}).select().single();if(E)throw E;const S=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(i,a),{data:_,error:k}=await m(y.id,S);if(k)throw k;const T=function(e,t){const s=e?1.5:1,a=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*a),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(i,a);for(let e=0;e<T.viewCount;e++)await c.rpc("record_vision_interaction",{p_visualization_id:y.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const C=h(e.pgn),M=r?"premium":"genesis";return{title:s,success:!0,visualizationId:y.id,listingId:null==_?void 0:_.id,isExemplar:i,paletteId:x.id,paletteName:x.name,gameHash:b,tier:M,openingName:null==C?void 0:C.fullName}}catch(n){return{title:s,success:!1,error:n.message,isExemplar:i}}},[t]),re=q.filter(e=>e.success).length,ne=q.filter(e=>!e.success).length;return q.filter(e=>e.success&&e.isExemplar).length,s||null===a?x.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:x.jsx(u,{className:"h-8 w-8 animate-spin text-primary"})}):t&&a?x.jsx("div",{className:"min-h-screen bg-background p-8",children:x.jsxs("div",{className:"max-w-4xl mx-auto",children:[x.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[x.jsx(w,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),x.jsxs(p,{children:[x.jsx(N,{children:x.jsxs(b,{className:"flex items-center gap-3",children:[x.jsx(j,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),x.jsxs(f,{className:"space-y-6",children:[x.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx(y,{className:"h-5 w-5 text-amber-500 mt-0.5"}),x.jsxs("div",{children:[x.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",Z," visions: ",Math.min(25,Z)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,Z-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),x.jsxs("div",{className:"flex items-center justify-between gap-4",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),x.jsxs("select",{value:Z,onChange:e=>J(Number(e.target.value)),disabled:O,className:"bg-muted border border-border rounded px-3 py-2",children:[x.jsx("option",{value:5,children:"5 (test)"}),x.jsx("option",{value:10,children:"10"}),x.jsx("option",{value:25,children:"25"}),x.jsx("option",{value:50,children:"50"})]})]}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(E,{id:"use-official-palettes",checked:K,onCheckedChange:X,disabled:O}),x.jsxs(S,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[x.jsx(_,{className:"h-4 w-4 text-primary"}),x.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),K&&x.jsxs(k,{variant:"secondary",className:"text-xs",children:[B.length," palettes"]})]})]}),x.jsx(v,{onClick:async()=>{if(!t)return void I.error("You must be logged in as the CEO account");V(!0),Q([]),H(0);const e=[],s=R.slice(0,Math.min(Z,R.length)),a=[];for(let t=0;t<Z;t++){const e=t%s.length,i=t<25,r=U[t]||`Vision ${t+1}`;a.push({game:s[e],title:r,isExemplar:i})}for(let t=0;t<a.length;t++){const{game:s,title:i,isExemplar:r}=a[t];Y(`${r?"ðŸ†":"ðŸŽ¨"} ${i} (${t+1}/${a.length})`);const n=await ie(s,i,t,r,K);e.push(n),Q([...e]),H((t+1)/a.length*100),await new Promise(e=>setTimeout(e,300))}V(!1);const i=e.filter(e=>e.success).length,r=e.filter(e=>!e.success).length,n=e.filter(e=>e.success&&e.isExemplar).length;i>0?I.success(`Created ${i} visions`,{description:`${n} Exemplars, ${i-n} Creative${r>0?` (${r} failed)`:""}`}):I.error("Failed to create any visions")},disabled:O||!t,className:"w-full",size:"lg",children:O?x.jsxs(x.Fragment,{children:[x.jsx(u,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):x.jsxs(x.Fragment,{children:[x.jsx(T,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),x.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[x.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx(C,{className:"h-5 w-5 text-destructive mt-0.5"}),x.jsxs("div",{children:[x.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),x.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ae(null);try{const{data:e,error:s}=await c.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return I.info("No visions to delete"),void te(!1);const a=e.map(e=>e.id),{data:i,error:r}=await c.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",a);if(r)throw r;const n=new Set((i||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),l=a.filter(e=>!n.has(e)),o=a.filter(e=>n.has(e));if(0===l.length)return I.info("All your visions have accrued natural value - none deleted"),ae({deleted:0,preserved:o.length}),void te(!1);await c.from("visualization_listings").delete().in("visualization_id",l),await c.from("vision_scores").delete().in("visualization_id",l),await c.from("vision_interactions").delete().in("visualization_id",l),await c.from("visualization_transfers").delete().in("visualization_id",l);const{error:d}=await c.from("saved_visualizations").delete().in("id",l);if(d)throw d;for(const m of e.filter(e=>l.includes(e.id)))await c.storage.from("visualizations").remove([`${t.id}/`]);ae({deleted:l.length,preserved:o.length}),I.success(`Deleted ${l.length} test visions`,{description:o.length>0?`${o.length} visions with natural value preserved`:void 0})}catch(e){I.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||O||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?x.jsxs(x.Fragment,{children:[x.jsx(u,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):x.jsxs(x.Fragment,{children:[x.jsx(C,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&x.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&x.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),O&&x.jsxs("div",{className:"space-y-2",children:[x.jsx(M,{value:G,className:"h-2"}),x.jsx("p",{className:"text-sm text-muted-foreground text-center",children:W})]}),q.length>0&&x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[x.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[x.jsx($,{className:"h-4 w-4"}),re," successful"]}),x.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[x.jsx(z,{className:"h-4 w-4"}),q.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),x.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[x.jsx(D,{className:"h-4 w-4"}),q.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ne>0&&x.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[x.jsx(g,{className:"h-4 w-4"}),ne," failed"]})]}),x.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:q.map((e,t)=>x.jsxs(A.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[x.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?x.jsx(z,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):x.jsx(D,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):x.jsx(g,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),x.jsx("span",{className:"truncate",children:e.title}),e.openingName&&x.jsx(k,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&x.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&x.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[x.jsxs(k,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[x.jsx(_,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&x.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):x.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:x.jsx(p,{className:"max-w-md",children:x.jsxs(f,{className:"pt-6 text-center",children:[x.jsx(g,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),x.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),x.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),x.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{V as default};
