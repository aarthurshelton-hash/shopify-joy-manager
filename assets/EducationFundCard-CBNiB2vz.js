const e='import React from \'react\';\nimport { Link } from \'react-router-dom\';\nimport { \n  GraduationCap, \n  Heart, \n  Users, \n  TrendingUp,\n  Sparkles,\n  BookOpen,\n  Globe,\n  ChevronRight\n} from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Progress } from \'@/components/ui/progress\';\nimport { Button } from \'@/components/ui/button\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { supabase } from \'@/integrations/supabase/client\';\n\ninterface FundStats {\n  total_contributions: number;\n  total_forfeited_value_cents: number;\n  total_platform_fee_cents: number;\n  total_fund_cents: number;\n  total_visions_released: number;\n  scholarships_funded: number;\n}\n\nconst EducationFundCard = React.forwardRef<HTMLDivElement, Record<string, never>>(function EducationFundCard(_props, ref) {\n  const { data: stats, isLoading } = useQuery({\n    queryKey: [\'education-fund-stats\'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\'education_fund\')\n        .select(\'forfeited_value_cents, platform_fee_cents, fund_contribution_cents, visions_released\');\n      \n      if (error) throw error;\n      \n      // Calculate stats client-side since view might have issues\n      const totals = (data || []).reduce((acc, row) => ({\n        total_contributions: acc.total_contributions + 1,\n        total_forfeited_value_cents: acc.total_forfeited_value_cents + (row.forfeited_value_cents || 0),\n        total_platform_fee_cents: acc.total_platform_fee_cents + (row.platform_fee_cents || 0),\n        total_fund_cents: acc.total_fund_cents + (row.fund_contribution_cents || 0),\n        total_visions_released: acc.total_visions_released + (row.visions_released || 0),\n        scholarships_funded: 0\n      }), {\n        total_contributions: 0,\n        total_forfeited_value_cents: 0,\n        total_platform_fee_cents: 0,\n        total_fund_cents: 0,\n        total_visions_released: 0,\n        scholarships_funded: 0\n      });\n      \n      // Each scholarship = $7 (one month of premium)\n      totals.scholarships_funded = Math.floor(totals.total_fund_cents / 700);\n      \n      return totals as FundStats;\n    },\n    staleTime: 60000, // Refresh every minute\n  });\n\n  const fundDollars = ((stats?.total_fund_cents || 0) / 100).toFixed(2);\n  const nextScholarshipProgress = stats ? \n    ((stats.total_fund_cents % 700) / 700) * 100 : 0;\n\n  return (\n    <div ref={ref} className="animate-fade-in">\n      <Card className="border-purple-500/30 bg-gradient-to-br from-purple-500/5 via-background to-pink-500/5 overflow-hidden">\n        <CardHeader className="pb-3">\n          <CardTitle className="flex items-center gap-2 text-lg">\n            <div className="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">\n              <GraduationCap className="h-4 w-4 text-white" />\n            </div>\n            <span>Chess Education Fund</span>\n            <Badge variant="outline" className="ml-auto bg-purple-500/10 text-purple-600 border-purple-500/30">\n              <Heart className="h-3 w-3 mr-1" />\n              Giving Back\n            </Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className="space-y-4">\n          <p className="text-sm text-muted-foreground">\n            When subscriptions lapse, <strong>85% of forfeited vision value</strong> is pooled \n            to provide free Visionary memberships to students from underprivileged backgrounds. \n            Chess education for all.\n          </p>\n\n          {/* Stats Grid */}\n          <div className="grid grid-cols-2 gap-3">\n            <div className="p-3 rounded-lg bg-muted/50 text-center">\n              <div className="text-2xl font-bold text-primary">${fundDollars}</div>\n              <div className="text-xs text-muted-foreground">Total Fund</div>\n            </div>\n            <div className="p-3 rounded-lg bg-muted/50 text-center">\n              <div className="text-2xl font-bold text-purple-500">{stats?.scholarships_funded || 0}</div>\n              <div className="text-xs text-muted-foreground">Scholarships Given</div>\n            </div>\n          </div>\n\n          {/* Progress to next scholarship */}\n          <div className="space-y-2">\n            <div className="flex justify-between text-xs">\n              <span className="text-muted-foreground">Next scholarship</span>\n              <span className="text-primary font-medium">\n                ${((stats?.total_fund_cents || 0) % 700 / 100).toFixed(2)} / $7.00\n              </span>\n            </div>\n            <Progress value={nextScholarshipProgress} className="h-2" />\n          </div>\n\n          {/* Transparency breakdown */}\n          <div className="p-3 rounded-lg bg-background/50 border border-border/50 space-y-2">\n            <div className="flex items-center gap-2 text-xs font-medium text-muted-foreground">\n              <Globe className="h-3 w-3" />\n              Transparent Allocation\n            </div>\n            <div className="grid grid-cols-3 gap-2 text-center">\n              <div>\n                <div className="text-sm font-bold text-purple-500">85%</div>\n                <div className="text-[10px] text-muted-foreground">Education Fund</div>\n              </div>\n              <div>\n                <div className="text-sm font-bold text-muted-foreground">15%</div>\n                <div className="text-[10px] text-muted-foreground">Platform</div>\n              </div>\n              <div>\n                <div className="text-sm font-bold text-green-500">{stats?.total_visions_released || 0}</div>\n                <div className="text-[10px] text-muted-foreground">Visions Recycled</div>\n              </div>\n            </div>\n          </div>\n\n          {/* How value is calculated */}\n          <div className="text-xs text-muted-foreground space-y-1">\n            <div className="flex items-center gap-1">\n              <Sparkles className="h-3 w-3 text-primary" />\n              <span className="font-medium">How value is calculated:</span>\n            </div>\n            <ul className="ml-4 space-y-0.5 text-[10px]">\n              <li>• Vision Score × $0.10 per point</li>\n              <li>• Plus 100% of earned print royalties</li>\n              <li>• Calculated at moment of grace period expiry</li>\n            </ul>\n          </div>\n\n          {/* Impact callout */}\n          <div className="flex items-start gap-2 p-3 bg-green-500/10 rounded-lg border border-green-500/30">\n            <BookOpen className="h-4 w-4 text-green-500 mt-0.5 shrink-0" />\n            <p className="text-xs text-green-600">\n              <strong>Impact:</strong> Every $7 raised provides one month of premium access to a \n              student who couldn\'t otherwise afford chess education tools.\n            </p>\n          </div>\n\n          {/* Link to full page */}\n          <Link to="/education-fund">\n            <Button variant="outline" size="sm" className="w-full gap-2">\n              View Full Transparency Report\n              <ChevronRight className="h-4 w-4" />\n            </Button>\n          </Link>\n        </CardContent>\n      </Card>\n    </div>\n  );\n});\n\nEducationFundCard.displayName = \'EducationFundCard\';\n\nexport default EducationFundCard;\n';export{e as default};
