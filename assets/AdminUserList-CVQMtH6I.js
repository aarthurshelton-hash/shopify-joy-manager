const e='import React from \'react\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { \n  Search,\n  Crown,\n  MapPin,\n  Calendar,\n  Eye,\n  Image,\n  Wallet,\n  Mail,\n  Phone,\n  ChevronRight,\n  User,\n  TrendingUp,\n} from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Button } from \'@/components/ui/button\';\nimport { Input } from \'@/components/ui/input\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Avatar, AvatarImage, AvatarFallback } from \'@/components/ui/avatar\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { formatDistanceToNow } from \'date-fns\';\n\ninterface AdminUserListProps {\n  searchQuery: string;\n  setSearchQuery: (query: string) => void;\n  onSelectUser: (userId: string) => void;\n}\n\ninterface UserWithDetails {\n  user_id: string;\n  display_name: string | null;\n  avatar_url: string | null;\n  email: string;\n  phone: string | null;\n  created_at: string;\n  is_premium: boolean;\n  vision_count: number;\n  wallet_balance: number;\n  total_orders: number;\n  total_spent: number;\n  last_activity: string | null;\n}\n\nexport const AdminUserList: React.FC<AdminUserListProps> = ({\n  searchQuery,\n  setSearchQuery,\n  onSelectUser,\n}) => {\n  // Fetch all users with their details\n  const { data: users, isLoading } = useQuery({\n    queryKey: [\'admin-users-list\', searchQuery],\n    queryFn: async () => {\n      // Get all profiles\n      const { data: profiles, error: profilesError } = await supabase\n        .from(\'profiles\')\n        .select(\'user_id, display_name, avatar_url, created_at\');\n\n      if (profilesError) throw profilesError;\n\n      // Get subscription status for all users\n      const { data: subscriptions } = await supabase\n        .from(\'user_subscriptions\')\n        .select(\'user_id, subscription_status\');\n\n      // Get vision counts\n      const { data: visions } = await supabase\n        .from(\'saved_visualizations\')\n        .select(\'user_id\');\n\n      // Get wallet data\n      const { data: wallets } = await supabase\n        .from(\'user_wallets\')\n        .select(\'user_id, balance_cents, total_spent_cents\');\n\n      // Get order counts\n      const { data: orders } = await supabase\n        .from(\'order_financials\')\n        .select(\'user_id\');\n\n      // Get recent activity\n      const { data: interactions } = await supabase\n        .from(\'vision_interactions\')\n        .select(\'user_id, created_at\')\n        .order(\'created_at\', { ascending: false });\n\n      // Combine data\n      const usersWithDetails: UserWithDetails[] = (profiles || []).map(profile => {\n        const subscription = subscriptions?.find(s => s.user_id === profile.user_id);\n        const userVisions = visions?.filter(v => v.user_id === profile.user_id) || [];\n        const wallet = wallets?.find(w => w.user_id === profile.user_id);\n        const userOrders = orders?.filter(o => o.user_id === profile.user_id) || [];\n        const lastInteraction = interactions?.find(i => i.user_id === profile.user_id);\n\n        return {\n          user_id: profile.user_id,\n          display_name: profile.display_name,\n          avatar_url: profile.avatar_url,\n          email: profile.display_name || \'Unknown\',\n          phone: null,\n          created_at: profile.created_at,\n          is_premium: subscription?.subscription_status === \'active\',\n          vision_count: userVisions.length,\n          wallet_balance: wallet?.balance_cents || 0,\n          total_orders: userOrders.length,\n          total_spent: wallet?.total_spent_cents || 0,\n          last_activity: lastInteraction?.created_at || null,\n        };\n      });\n\n      // Filter by search query\n      if (searchQuery) {\n        const query = searchQuery.toLowerCase();\n        return usersWithDetails.filter(u => \n          u.display_name?.toLowerCase().includes(query) ||\n          u.email?.toLowerCase().includes(query) ||\n          u.user_id.toLowerCase().includes(query)\n        );\n      }\n\n      // Sort by most recent activity\n      return usersWithDetails.sort((a, b) => {\n        if (!a.last_activity) return 1;\n        if (!b.last_activity) return -1;\n        return new Date(b.last_activity).getTime() - new Date(a.last_activity).getTime();\n      });\n    },\n    staleTime: 30000,\n  });\n\n  const formatCents = (cents: number) => `$${(cents / 100).toFixed(2)}`;\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">\n          <div>\n            <CardTitle className="flex items-center gap-2">\n              <User className="h-5 w-5" />\n              User Database\n            </CardTitle>\n            <CardDescription>\n              Click on any user to view their complete profile and holdings\n            </CardDescription>\n          </div>\n          <div className="relative w-full md:w-80">\n            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n            <Input \n              placeholder="Search users by name, email, or ID..."\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className="pl-10"\n            />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className="flex items-center justify-center py-12">\n            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary" />\n          </div>\n        ) : (\n          <ScrollArea className="h-[600px]">\n            <div className="space-y-2">\n              {users?.map((user) => (\n                <div\n                  key={user.user_id}\n                  onClick={() => onSelectUser(user.user_id)}\n                  className="flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-muted/50 cursor-pointer transition-colors group"\n                >\n                  <div className="flex items-center gap-4">\n                    <Avatar className="h-12 w-12">\n                      <AvatarImage src={user.avatar_url || undefined} />\n                      <AvatarFallback className="bg-primary/10 text-primary">\n                        {user.display_name?.charAt(0).toUpperCase() || \'U\'}\n                      </AvatarFallback>\n                    </Avatar>\n\n                    <div>\n                      <div className="flex items-center gap-2">\n                        <p className="font-medium">{user.display_name || \'Anonymous\'}</p>\n                        {user.is_premium ? (\n                          <Badge className="bg-primary/20 text-primary border-primary/30">\n                            <Crown className="h-3 w-3 mr-1" />\n                            Premium\n                          </Badge>\n                        ) : (\n                          <Badge variant="outline" className="text-muted-foreground">\n                            Free\n                          </Badge>\n                        )}\n                      </div>\n                      <div className="flex items-center gap-3 text-sm text-muted-foreground mt-1">\n                        <span className="flex items-center gap-1">\n                          <Calendar className="h-3 w-3" />\n                          Joined {formatDistanceToNow(new Date(user.created_at), { addSuffix: true })}\n                        </span>\n                        {user.last_activity && (\n                          <span className="flex items-center gap-1">\n                            <Eye className="h-3 w-3" />\n                            Active {formatDistanceToNow(new Date(user.last_activity), { addSuffix: true })}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className="flex items-center gap-6">\n                    <div className="text-right">\n                      <p className="text-sm text-muted-foreground">Visions</p>\n                      <p className="font-medium flex items-center gap-1 justify-end">\n                        <Image className="h-3 w-3" />\n                        {user.vision_count}\n                      </p>\n                    </div>\n\n                    <div className="text-right">\n                      <p className="text-sm text-muted-foreground">Wallet</p>\n                      <p className="font-medium text-green-500">{formatCents(user.wallet_balance)}</p>\n                    </div>\n\n                    <div className="text-right">\n                      <p className="text-sm text-muted-foreground">Orders</p>\n                      <p className="font-medium">{user.total_orders}</p>\n                    </div>\n\n                    <div className="text-right">\n                      <p className="text-sm text-muted-foreground">Spent</p>\n                      <p className="font-medium">{formatCents(user.total_spent)}</p>\n                    </div>\n\n                    <ChevronRight className="h-5 w-5 text-muted-foreground group-hover:text-primary transition-colors" />\n                  </div>\n                </div>\n              ))}\n\n              {users?.length === 0 && (\n                <div className="text-center py-12 text-muted-foreground">\n                  <User className="h-12 w-12 mx-auto mb-4 opacity-50" />\n                  <p>No users found matching your search</p>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n';export{e as default};
