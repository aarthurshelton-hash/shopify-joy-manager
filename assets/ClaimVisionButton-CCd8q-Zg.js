const n='import React, { useState, useEffect } from \'react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \'@/components/ui/dialog\';\nimport { Crown, AlertTriangle, Check, Loader2, User, Sparkles } from \'lucide-react\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { checkVisualizationSimilarity, SimilarityCheckResult, PaletteColors } from \'@/lib/visualizations/similarityDetection\';\nimport { GameData } from \'@/lib/chess/gameSimulator\';\nimport { colorPalettes, PaletteId } from \'@/lib/chess/pieceColors\';\nimport { toast } from \'sonner\';\nimport { Link } from \'react-router-dom\';\n\ninterface ClaimVisionButtonProps {\n  pgn?: string;\n  gameData: GameData;\n  paletteId?: PaletteId;\n  customColors?: PaletteColors;\n  visualizationId?: string;\n  isOwner?: boolean;\n  isPremium?: boolean;\n  onClaim?: () => Promise<string | null>;\n  onUpgradePrompt?: () => void;\n  compact?: boolean;\n  className?: string;\n}\n\ninterface OwnershipStatus {\n  isChecking: boolean;\n  isOwned: boolean;\n  ownedByCurrentUser: boolean;\n  ownerDisplayName?: string;\n  isTooSimilar: boolean;\n  similarityResult?: SimilarityCheckResult;\n}\n\nexport const ClaimVisionButton: React.FC<ClaimVisionButtonProps> = ({\n  pgn,\n  gameData,\n  paletteId = \'modern\',\n  customColors,\n  visualizationId,\n  isOwner = false,\n  isPremium = false,\n  onClaim,\n  onUpgradePrompt,\n  compact = false,\n  className = \'\',\n}) => {\n  const { user } = useAuth();\n  const [status, setStatus] = useState<OwnershipStatus>({\n    isChecking: true,\n    isOwned: false,\n    ownedByCurrentUser: false,\n    isTooSimilar: false,\n  });\n  const [isClaiming, setIsClaiming] = useState(false);\n  const [showSimilarityDialog, setShowSimilarityDialog] = useState(false);\n\n  // Check ownership and similarity status\n  useEffect(() => {\n    const checkStatus = async () => {\n      if (!user?.id) {\n        setStatus({\n          isChecking: false,\n          isOwned: false,\n          ownedByCurrentUser: false,\n          isTooSimilar: false,\n        });\n        return;\n      }\n\n      setStatus(prev => ({ ...prev, isChecking: true }));\n\n      try {\n        // Check similarity\n        const similarityResult = await checkVisualizationSimilarity(\n          user.id,\n          pgn,\n          gameData,\n          paletteId,\n          customColors\n        );\n\n        if (similarityResult.isTooSimilar) {\n          setStatus({\n            isChecking: false,\n            isOwned: true,\n            ownedByCurrentUser: similarityResult.ownedByCurrentUser || false,\n            ownerDisplayName: similarityResult.ownerDisplayName,\n            isTooSimilar: true,\n            similarityResult,\n          });\n        } else {\n          setStatus({\n            isChecking: false,\n            isOwned: false,\n            ownedByCurrentUser: false,\n            isTooSimilar: false,\n            similarityResult,\n          });\n        }\n      } catch (error) {\n        console.error(\'Error checking ownership status:\', error);\n        setStatus({\n          isChecking: false,\n          isOwned: false,\n          ownedByCurrentUser: false,\n          isTooSimilar: false,\n        });\n      }\n    };\n\n    checkStatus();\n  }, [user?.id, pgn, gameData, paletteId, customColors]);\n\n  // Handle claim action\n  const handleClaim = async () => {\n    if (!user) {\n      toast.error(\'Please sign in to claim this vision\');\n      return;\n    }\n\n    if (!isPremium) {\n      onUpgradePrompt?.();\n      return;\n    }\n\n    if (status.isTooSimilar) {\n      setShowSimilarityDialog(true);\n      return;\n    }\n\n    if (!onClaim) {\n      toast.error(\'Claim functionality not available\');\n      return;\n    }\n\n    setIsClaiming(true);\n    try {\n      const id = await onClaim();\n      if (id) {\n        toast.success(\'Vision claimed successfully!\', {\n          description: \'This unique colorway is now in your gallery\',\n        });\n        setStatus(prev => ({\n          ...prev,\n          isOwned: true,\n          ownedByCurrentUser: true,\n        }));\n      }\n    } catch (error) {\n      console.error(\'Error claiming vision:\', error);\n      toast.error(\'Failed to claim vision\');\n    } finally {\n      setIsClaiming(false);\n    }\n  };\n\n  // Already owned by current user\n  if (isOwner || status.ownedByCurrentUser) {\n    return (\n      <Badge \n        variant="outline" \n        className={`bg-green-500/10 text-green-600 border-green-500/30 ${className}`}\n      >\n        <Check className="h-3 w-3 mr-1" />\n        Your Vision\n      </Badge>\n    );\n  }\n\n  // Loading state\n  if (status.isChecking) {\n    return (\n      <Button variant="outline" size={compact ? "sm" : "default"} disabled className={className}>\n        <Loader2 className="h-4 w-4 animate-spin mr-2" />\n        Checking...\n      </Button>\n    );\n  }\n\n  // Too similar to existing vision\n  if (status.isTooSimilar && status.isOwned) {\n    return (\n      <>\n        <TooltipProvider>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button \n                variant="outline" \n                size={compact ? "sm" : "default"} \n                onClick={() => setShowSimilarityDialog(true)}\n                className={`border-amber-500/50 text-amber-600 hover:bg-amber-500/10 ${className}`}\n              >\n                <AlertTriangle className="h-4 w-4 mr-2" />\n                {compact ? \'Similar\' : \'Too Similar\'}\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent className="max-w-xs">\n              <p>This vision is too similar to one already in {status.ownerDisplayName || "someone\'s"} gallery.</p>\n            </TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n\n        {/* Similarity Dialog */}\n        <Dialog open={showSimilarityDialog} onOpenChange={setShowSimilarityDialog}>\n          <DialogContent className="max-w-md">\n            <DialogHeader>\n              <DialogTitle className="flex items-center gap-2">\n                <AlertTriangle className="h-5 w-5 text-amber-500" />\n                Vision Already Exists\n              </DialogTitle>\n              <DialogDescription>\n                This exact colorway of this game is already owned by another collector.\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className="space-y-4">\n              {/* Owner info */}\n              <div className="flex items-center gap-3 p-3 rounded-lg bg-muted/50">\n                <div className="p-2 rounded-full bg-primary/10">\n                  <User className="h-4 w-4 text-primary" />\n                </div>\n                <div>\n                  <p className="font-medium">{status.ownerDisplayName || \'Another collector\'}</p>\n                  <p className="text-sm text-muted-foreground">\n                    {status.similarityResult?.colorSimilarity \n                      ? `${Math.round(status.similarityResult.colorSimilarity)}% color similarity`\n                      : \'Owns this colorway\'\n                    }\n                  </p>\n                </div>\n              </div>\n\n              {/* Suggestions */}\n              <div className="space-y-2">\n                <p className="text-sm font-medium">To claim your own unique vision:</p>\n                <ul className="text-sm text-muted-foreground space-y-1.5">\n                  <li className="flex items-center gap-2">\n                    <div className="w-1 h-1 rounded-full bg-primary" />\n                    Change at least 8 colors to make it unique\n                  </li>\n                  <li className="flex items-center gap-2">\n                    <div className="w-1 h-1 rounded-full bg-primary" />\n                    Try a different palette for a fresh look\n                  </li>\n                  <li className="flex items-center gap-2">\n                    <div className="w-1 h-1 rounded-full bg-primary" />\n                    Use Creative Mode to customize colors\n                  </li>\n                </ul>\n              </div>\n\n              {/* Actions */}\n              <div className="flex gap-2 pt-2">\n                <Button \n                  variant="outline" \n                  className="flex-1"\n                  onClick={() => setShowSimilarityDialog(false)}\n                >\n                  Close\n                </Button>\n                <Button \n                  className="flex-1 gap-2"\n                  asChild\n                >\n                  <Link to="/creative">\n                    <Sparkles className="h-4 w-4" />\n                    Open Creative\n                  </Link>\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </>\n    );\n  }\n\n  // Available to claim\n  return (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            size={compact ? "sm" : "default"}\n            onClick={handleClaim}\n            disabled={isClaiming}\n            className={`gap-2 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 ${className}`}\n          >\n            {isClaiming ? (\n              <Loader2 className="h-4 w-4 animate-spin" />\n            ) : (\n              <Crown className="h-4 w-4" />\n            )}\n            {compact ? \'Claim\' : \'Claim This Vision\'}\n            {!isPremium && <Crown className="h-3 w-3 opacity-70" />}\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent>\n          {isPremium \n            ? \'Add this unique colorway to your gallery\' \n            : \'Premium members can claim unique visions\'\n          }\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  );\n};\n\nexport default ClaimVisionButton;\n';export{n as default};
