const e="import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { SquareData, GameData, SimulationResult } from '@/lib/chess/gameSimulator';\nimport { PieceType, PieceColor } from '@/lib/chess/pieceColors';\nimport { GamePhase } from '@/contexts/TimelineContext';\n\n/**\n * Active Vision Store - Persists the current vision experience across page refreshes\n * Uses localStorage to survive browser refresh/close\n */\n\nexport interface ActiveVisionState {\n  // Route information\n  route: string;\n  gameHash?: string;\n  paletteId?: string;\n  \n  // Game data for reconstruction\n  pgn?: string;\n  gameTitle?: string;\n  \n  // Visualization state\n  currentMove: number;\n  selectedPhase: GamePhase;\n  lockedPieces: Array<{ pieceType: PieceType; pieceColor: PieceColor }>;\n  compareMode: boolean;\n  darkMode: boolean;\n  showPieces: boolean;\n  pieceOpacity: number;\n  \n  // Timestamps\n  savedAt: number;\n  expiresAt: number; // Auto-expire after 24 hours to prevent stale data\n}\n\ninterface ActiveVisionStore {\n  // Current active vision\n  activeVision: ActiveVisionState | null;\n  \n  // Flag to track if we should restore on next navigation\n  shouldRestoreOnMount: boolean;\n  \n  // Actions\n  saveActiveVision: (state: Omit<ActiveVisionState, 'savedAt' | 'expiresAt'>) => void;\n  clearActiveVision: () => void;\n  markRestored: () => void;\n  \n  // Check if we have a valid vision to restore\n  hasValidVision: () => boolean;\n  \n  // Get the restore route\n  getRestoreRoute: () => string | null;\n}\n\nconst VISION_EXPIRY_MS = 24 * 60 * 60 * 1000; // 24 hours\n\nexport const useActiveVisionStore = create<ActiveVisionStore>()(\n  persist(\n    (set, get) => ({\n      activeVision: null,\n      shouldRestoreOnMount: false, // Disabled: users should always land on homepage\n      \n      saveActiveVision: (state) => {\n        const now = Date.now();\n        set({\n          activeVision: {\n            ...state,\n            savedAt: now,\n            expiresAt: now + VISION_EXPIRY_MS,\n          },\n          shouldRestoreOnMount: false, // Never auto-restore\n        });\n      },\n      \n      clearActiveVision: () => {\n        set({ activeVision: null, shouldRestoreOnMount: false });\n      },\n      \n      markRestored: () => {\n        set({ shouldRestoreOnMount: false });\n      },\n      \n      hasValidVision: () => {\n        const { activeVision } = get();\n        if (!activeVision) return false;\n        \n        // Check if expired\n        if (Date.now() > activeVision.expiresAt) {\n          set({ activeVision: null });\n          return false;\n        }\n        \n        // Must have a route\n        return !!activeVision.route;\n      },\n      \n      getRestoreRoute: () => {\n        const { activeVision, hasValidVision } = get();\n        if (!hasValidVision()) return null;\n        return activeVision?.route || null;\n      },\n    }),\n    {\n      name: 'en-pensent-active-vision',\n      storage: createJSONStorage(() => localStorage),\n      partialize: (state) => ({\n        activeVision: state.activeVision,\n        shouldRestoreOnMount: state.shouldRestoreOnMount,\n      }),\n    }\n  )\n);\n";export{e as default};
