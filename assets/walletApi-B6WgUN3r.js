const r="import { supabase } from '@/integrations/supabase/client';\n\nexport interface UserWallet {\n  id: string;\n  user_id: string;\n  balance_cents: number;\n  total_deposited_cents: number;\n  total_withdrawn_cents: number;\n  total_earned_cents: number;\n  total_spent_cents: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface WalletTransaction {\n  id: string;\n  user_id: string;\n  transaction_type: 'deposit' | 'withdrawal' | 'sale' | 'purchase' | 'platform_fee';\n  amount_cents: number;\n  balance_after_cents: number;\n  related_listing_id: string | null;\n  counterparty_id: string | null;\n  description: string | null;\n  created_at: string;\n}\n\n// Get or create user wallet\nexport async function getUserWallet(): Promise<{\n  data: UserWallet | null;\n  error: Error | null;\n}> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not authenticated');\n\n    const { data, error } = await supabase\n      .rpc('get_or_create_wallet', { p_user_id: user.id });\n\n    if (error) throw error;\n    return { data: data as UserWallet, error: null };\n  } catch (error) {\n    return { data: null, error: error as Error };\n  }\n}\n\n// Get wallet transaction history\nexport async function getWalletTransactions(limit = 50): Promise<{\n  data: WalletTransaction[];\n  error: Error | null;\n}> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not authenticated');\n\n    const { data, error } = await supabase\n      .from('wallet_transactions')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false })\n      .limit(limit);\n\n    if (error) throw error;\n    return { data: (data || []) as WalletTransaction[], error: null };\n  } catch (error) {\n    return { data: [], error: error as Error };\n  }\n}\n\n// Purchase a listing using wallet balance\nexport async function purchaseWithWallet(\n  listingId: string,\n  agreedPriceCents: number\n): Promise<{\n  success: boolean;\n  error: Error | null;\n}> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not authenticated');\n\n    const { data, error } = await supabase\n      .rpc('process_marketplace_sale', {\n        p_listing_id: listingId,\n        p_buyer_id: user.id,\n        p_sale_price_cents: agreedPriceCents,\n      });\n\n    if (error) throw error;\n    return { success: data === true, error: null };\n  } catch (error) {\n    return { success: false, error: error as Error };\n  }\n}\n\n// Format balance for display\nexport function formatBalance(cents: number): string {\n  return `$${(cents / 100).toFixed(2)}`;\n}\n";export{r as default};
