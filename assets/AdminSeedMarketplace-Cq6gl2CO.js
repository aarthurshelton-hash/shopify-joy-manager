import{d6 as e,d7 as t,cp as s,a as n,u as r,r as a,J as i,o,s as l,aH as c,aa as u,cM as d,j as m,L as h,C as f,x,D as p,B as v,A as g,p as w,t as y,cN as j,bC as C,S as N,a6 as b,P as z,y as D,bG as M,T as B,aq as L,z as S,cU as E,aj as q,aT as A,ca as G,b as U,d8 as H}from"./index-DxnJiuLa.js";!function(){const e=_,t=W();for(;;)try{if(460774===-parseInt(e(194))/1*(-parseInt(e(270))/2)+-parseInt(e(197))/3+parseInt(e(279))/4*(-parseInt(e(328))/5)+parseInt(e(159))/6*(-parseInt(e(254))/7)+parseInt(e(202))/8*(-parseInt(e(252))/9)+parseInt(e(203))/10+parseInt(e(227))/11*(parseInt(e(215))/12))break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const I=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[_(148)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}()(void 0,function(){const e=_,t={JxEdK:"(((.+)+)+)+$"},s=t;return I.toString()[e(150)](s[e(340)]).toString()[e(282)+"r"](I)[e(150)]("(((.+)+)+)+$")});function W(){const e=["zMLSBfrLEhq","uhrPC1u","Bw92zvrV","r1LZAvi","BvfYBLa","C3rYB2TL","DKnjuM8","iIb5psiWiIb3Aq","BgvMDa","q1v4t1O","zw50","Bg9HzcbtvKC","iIb3Awr0Ad0I","z2v0q29UDgv4Da","rMfPBgvKihrVia","zLjHq2C","y3rVCIGICMv0Dq","wffzr3y","Aw9Kyw0","zerrzhu","nJaWideZChGGjW","D2LKDgG","C3vIC3rYAw5N","mtGYnJnXtNb4t3K","Aw5JBhvKzxm","Bw9Yyw50jYWGrW","mtG3mZiWm3z4qvnHCG","iZfbmueXqq","D2HPDgu","Dg9vChbLCKnHCW","iZC4nZe2yW","ofnzBvfuzq","mZi1nZa0mgjyEuv4BW","vw5RBM93BG","yw5VBNLTB3vZ","AM9PBG","CMv2B2TLt2jQzq","x19WCM90B19F","Dgv4DefSAwDU","CgvUC2vUDc5JBW","rxfzA1C","B25LCNjVCG","CwflB0C","BgLNAhq","mJa4nJH6wKPvD2O","idiWChGGj0nVCG","y29T","q0fgBLa","Bg9N","icdIGkiGia","ndaWideXChGGjW","iIb5psi","B1rKBNO","rK5bBKS","B2rwCwq","mJaWmc9ZDMCIia","mte5mZvRvK5xtxC","vfvnDgS","i2zHzMfMoq","z09Vu2e","A2vyEwS","Dgv4DejHC2vSAq","z3bXwLu","u1HUEvm","zuLSruq","DfbZuKi","C2f2zq","DhjHBNnWyxjLBG","ChvZAa","CwjRA2O","ntaWideYChGGjW","vKHVBvy","r0rVwKe","iI8+","AgLUz1f1ywXPDa","EMvVvxe","ueTUC0K","Aw5MBW","DMLZAxrZ","CMv0DxjUicHMDq","BwLU","ndK2nte4m1rKs3bMCG","y05rugO","n3DNvw9yqW","AgvPz2H0","Bgf5zxjtAxPL","uNfxyvu","y3jLyxrLt2jQzq","y29UC29Szq","vgvqDfC","zMLSBfn0EwXL","CMDIysGYntuSia","AgLUz0vUywjSzq","BwvHC3vYzvrLEa","4PMuievoifbftLnf","BgLUzvDPzhrO","venOtui","D09oy1e","Dd11DgyToa","ofjpvwzQAG","B2TTDMC","iJaGmca","BgvUz3rO","t3HNuMK","CxjJB2rL","D2fYBG","Aw1Hz2vtBw9VDa","BMn0Aw9UkcKG","mtuZmMX4EeHwyq","DuTHrgy","zgfYAW","y29UC3rYDwn0BW","phjLy3qGEd0I","tLqG4PMA","sw50zxiNlcbZyq","qMXHy2S","uMvJBwC","y3rPB25mzxzLBa","iIbOzwLNAhq9iG","vNjeuwS","t1zbsxC","CKvnt3G","yMLUza","DhLWzq","uKTds3C","t1vjBfG","D3CUDZmUB3jNlW","yNjdugm","i0zerKngqG","CMLM","EejlrKG","B0HjrxC","i2e4yti5zq","r1DnD2m","BLLPu3O","CMvZDg9Yzq","yMXHy2S","Ahr0Chm6lY9LBG","iIb2Awv3qM94pq","iIbMAwXSpsi","nJaWidi0ChGGjW","yMvNAw5qyxrO","ywXS","q2LUEMvSjYWGjW","zMLSBfjLy3q","uNv4vNq","Dg9tDhjPBMC","AxnmAwDODa","B25SB2fK","ntaWideXChGGjW","Eg1So2nOyxjZzq","Ae9hwNq","D3btEvm","Ahn3EwK","iZbbmeeWqq","ruPJwMC","qxndA2u","mZGZmgj5zefYDq","i0zbrKfgqq","vhDbC2i","BwLKzgXL","zw9Yz2LHlcbZzq","Bw92zxm","suvAELu","zxjYB3jdB3jYzq","y3rvuKW","quH4we0","CvLZrxa","DNvry20","sNHfzeS","C2nHBgu","BNmTC2vYAwy","ywXWAgfIzxrPyW","AxrHBgLJiduWma","zM9UDhm","CMvHzhK","Aw1Hz2uVC3zNkW","zgvMyxvSDa","i2u3ztvLna","ndaWideWChGGjW","qxDNv2G","y3jLyxrLrwXLBq","zKXjuw8","v2HPDgu","sNvXtMC","y2vUDgvY","zw5Wzw5Zzw50lG","iZi5mJuYna","E30Uy29UC3rYDq","zgf0zq","DuLiANa","D1viD2i","y29SB3i","BwfYz2LU","rLPcv0m","C3bSAxq","yxbWBhK","C3rYB2TLu3r5Ba","C2vHCMnO","uwvdBxe","z3zUug4","uM9Tyw4NlcbZzq","BwvZlcbZzxjPzG","pc9ZDMC+","ueLeq08","zxzLBNq","CvbpEeC","mJeZmtK4nMniqu1lwq","y2fUDMfZ","phjLy3qGEd0Ima","DgfIBgu","zM9UDa","ihzZia","C3jJ","CMvKDwnL","zhjHD0LTywDL","se9vCxy","vgLTzxmGtMv3ia","yM9YzgvY"];return(W=function(){return e})()}I();const k=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[_(148)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}();k(void 0,function(){const e=_,t={PIDCO:function(e,t){return e+t},mQrnP:e(250)+e(278),SXnyS:function(e){return e()},GYsiR:"error",TUMtk:"exception",EqYkW:function(e,t){return e<t}};let s;try{const n=Function(t[e(156)](t[e(175)],e(140)+e(187)+'rn this")( )')+");");s=t[e(234)](n)}catch(a){s=window}const n=s[e(259)]=s[e(259)]||{},r=[e(219),e(276),e(248),t[e(174)],t[e(228)],e(162),"trace"];for(let i=0;t[e(211)](i,r.length);i++){const t=k[e(282)+"r"].prototype[e(293)](k),s=r[i],a=n[s]||t;t[e(208)]=k[e(293)](k),t.toString=a[e(317)].bind(a),n[s]=t}})();function _(e,t){e-=132;const s=W();let n=s[e];if(void 0===_.iJIwJo){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};_.RcRzsl=r,_.igTLiA={},_.iJIwJo=!0}const a=e+s[0],i=_.igTLiA[a];if(i)n=i;else{const e=function(e){this.yYLkWR=e,this.aCHnyS=[1,0,0],this.tkeQMW=function(){return"newState"},this.FECQcU="\\w+ *\\(\\) *{\\w+ *",this.eAEUJv="['|\"].+['|\"];? *}"};e.prototype.ISTbyu=function(){const e=new RegExp(this.FECQcU+this.eAEUJv).test(this.tkeQMW.toString())?--this.aCHnyS[1]:--this.aCHnyS[0];return this.QKggjT(e)},e.prototype.QKggjT=function(e){return Boolean(~e)?this.sKNede(this.yYLkWR):e},e.prototype.sKNede=function(e){for(let t=0,s=this.aCHnyS.length;t<s;t++)this.aCHnyS.push(Math.round(Math.random())),s=this.aCHnyS.length;return e(this.aCHnyS[0])},new e(_).ISTbyu(),n=_.RcRzsl(n),_.igTLiA[a]=n}return n}async function P(){const e=_;document.fonts&&document[e(345)][e(346)]&&await document[e(345)].ready,await new Promise(e=>setTimeout(e,150))}function T(s,n){const r=_,a={qPOxG:function(e,t){return e+t},wUHwb:function(e,t){return e*t},oTdnz:function(e,t){return e-t},gpqZU:function(e,t){return e*t},AwgWh:function(e,t){return e+t},odVqd:function(e,t){return e*t},iodam:function(e,t,s){return e(t,s)},TwAsb:r(243),dDQdu:function(e,t){return e*t},zeoUq:function(e,t){return e<t},wONcQ:function(e,t){return e*t},TePtW:function(e,t){return e-t},paEoU:function(e,t){return e+t}},i=n/8,o=.02*n,l=a[r(158)](n,a[r(143)](o,2));let c='<svg xmlns="http://w'+r(297)+r(226)+'width="'+l+r(289)+l+(r(309)+r(272))+l+" "+l+'">';c+=r(161)+r(178)+'dth="'+l+'" height="'+l+r(310)+e[r(170)]+r(244);for(let u=0;u<8;u++){const n=a[r(223)](7,u);for(let l=0;l<8;l++){const d=s[n][l],m=d[r(318)]?e[r(214)]:e[r(281)],h=o+a[r(233)](l,i),f=a[r(132)](o,u*i);if(c+=r(283)+h+r(222)+f+r(183)+i+r(289)+i+r(310)+m+r(244),d[r(249)].length>0){const e=a[r(225)](i,.08),s=[];for(const i of d[r(249)]){const e=a[r(189)](t,i.piece,i[r(144)]);!s[r(195)](e)&&(a[r(330)]!==r(213)?s[r(239)](e):_0x57a46d[r(171)](_0x385c4d,_0x47f5e6,_0x1a7341))}const n=Math[r(251)](s[r(273)],6),o=[];let l=i-a[r(190)](e,2);const u=a[r(143)](l,.7)/n;for(let t=0;a[r(246)](t,n);t++){const e={};if(e.color=s[t],e[r(256)]=l,o[r(239)](e),l-=u,l<a[r(268)](i,.1))break}for(const t of o){const e=a[r(260)](i,t[r(256)])/2;c+=r(283)+a.paEoU(h,e)+r(222)+(f+e)+r(183)+t.layerSize+r(289)+t.layerSize+'" fill="'+t[r(144)]+r(244)}}}}return c+=r(155),c}async function K(e){const t=_,s={};s.wpSyS=t(329);const n=s,r=(await import(t(275)))[t(348)],a={};a.dark=e?n[t(323)]:t(198),a.light=t(238)+"t";const i={};return i[t(192)]=200,i[t(145)]=1,i[t(144)]=a,i[t(335)+t(288)]="M",r.toDataURL(t(308)+t(210)+"m",i)}async function O(){const e=_,t={};t[e(236)]=e(205);const n=t;return new Promise((t,r)=>{const a=e,i=new Image;i.crossOrigin=n[a(236)],i.onload=()=>t(i),i[a(212)]=r,i[a(165)]=s})}async function Z(e,t,s={}){const n=_,r={SODhD:function(e){return e()},VHomV:function(e){return e()},PtisU:function(e,t,s){return e(t,s)},gvnPn:function(e,t){return e*t},xBKFH:function(e,t){return e+t},vuQcm:function(e,t){return e*t},IEZzU:n(160),CUxOZ:function(e,t){return e*t},brCPc:n(325),XQYGv:n(229),zcQtu:n(139),FZBWC:"#a8a29e",uKaDf:n(286),fRaCg:n(311)+n(314)+"Times New "+n(153)+n(300),eIlED:n(344)+n(216)+"morant', G"+n(332)+n(300),RqWaU:function(e,t){return e-t},hswyi:function(e,t){return e/t},EJcZg:n(179),RKCKw:function(e,t){return e!==t},TChMB:"italic 500 18px 'Cor"+n(196)+n(332)+n(300),OVAIw:n(220),OxgRi:function(e,t){return e-t},JuqNg:n(137),okmvg:"...",yQgzt:function(e,t){return e>=t},cNQPj:function(e,t){return e<t},oHIEw:n(265)+n(284),AHxXM:function(e,t){return e+t},GWMwc:function(e,t){return e-t},hOGZt:function(e,t){return e-t},AsCke:function(e,t){return e/t},mQjDA:function(e,t){return e(t)},HOUqv:function(e,t){return e-t},StQda:function(e,t){return e-t},vCIRo:n(262)+"255, 255, 0.95)",Recmg:function(e,t){return e-t},keXyk:function(e,t){return e/t},qbkkj:n(343),LRDng:n(191)+n(285)+"ns-serif",QeCmq:function(e,t){return e+t},nYiSz:n(221)+n(285)+n(342)};await r[n(242)](P);const{boardSize:a=600,darkMode:i=!1,withWatermark:o=!1,title:l}=s,c=r[n(172)](T,e,a),u=r[n(152)](a,.02),d=a+r.gvnPn(u,2),m=await async function(e,t,s){const n=_,r={PKnsI:function(e,t){return e(t)},rEMOx:function(e,t){return e*t},RuxVt:n(347)+n(321)+n(269)};return new Promise((a,i)=>{const o=n,l={FNAnK:function(e,t){return r[_(292)](e,t)}},c=new Image,u={};u[o(294)]=r[o(316)];const d=new Blob([e],u),m=URL[o(258)+"ctURL"](d);c.onload=()=>{const e=o,n=document[e(133)+e(181)](e(160));n[e(192)]=l[e(224)](t,5),n.height=5*s;const r=n[e(184)]("2d");r[e(341)](5,5),r[e(167)](c,0,0,t,s),URL[e(207)+"ctURL"](m),a(n)},c[o(212)]=()=>{const e=o;URL[e(207)+e(336)](m),r[e(247)](i,new Error(e(185)+e(182)))},c[o(165)]=m})}(c,d,d),h=60,f=r[n(301)](d,r[n(339)](h,2)),x=d+220+60+120,p=document[n(133)+n(181)](r[n(334)]);p[n(192)]=r[n(180)](f,5),p[n(255)]=r.vuQcm(x,5);const v=p[n(184)]("2d");v[n(341)](5,5),v[n(277)+n(263)+"d"]=!0,v[n(277)+n(245)+"y"]="high",v[n(261)]=i?r[n(298)]:n(299),v[n(315)](0,0,f,x),v.drawImage(m,0,0,m[n(192)],m[n(255)],h,h,d,d);const g=h+d+28;v.strokeStyle=n(i?139:349),v.lineWidth=1,v[n(312)](),v[n(173)](h,g),v.lineTo(f-h,g),v[n(176)]();const w=i?r[n(188)]:r.zcQtu,y=i?r[n(146)]:"#78716c",j=n(i?201:303),C=i?"#78716c":r[n(146)],N=f/2;let b=g+55;const z=t[n(199)]||n(135),D=t[n(307)]||r[n(280)];v[n(232)+"ne"]=n(331),v[n(163)]=r[n(186)];const M=v[n(264)+"t"](z).width,B=v[n(264)+"t"](D).width;v[n(163)]=r[n(235)];const L=n(164),S=v.measureText(L)[n(192)],E=M+S+B,q=r[n(257)](N,r[n(324)](E,2));v[n(163)]=r[n(186)],v[n(261)]=w,v[n(209)]=r[n(326)],v[n(171)](z,q,b),v.font=r[n(235)],v[n(261)]=C,v[n(171)](L,q+M,b),v[n(163)]=r[n(186)],v[n(261)]=w,v.fillText(D,q+M+S,b),b+=36,t[n(157)]&&r[n(295)](t.event,"Unknown")&&(v.fillStyle=y,v[n(163)]=r[n(267)],v[n(209)]=n(137),v[n(171)](t.event,N,b),b+=32);const A=l,G=t[n(141)]||"";if(A||G){v.fillStyle=j,v[n(163)]=n(241)+n(285)+n(342),v[n(209)]=n(137);let e="";A?(e=A[n(200)+"e"](),G&&(e+=r[n(291)]+G)):e=G;const t=2,s=e[n(147)]("");let a=N-(s.reduce((e,t)=>e+v[n(264)+"t"](t).width,0)+r[n(274)](s[n(273)],1)*t)/2;for(const r of s)v[n(209)]=n(179),v[n(171)](r,a,b),a+=v[n(264)+"t"](r)[n(192)]+t;b+=28}if(t[n(333)]&&t[n(333)].length>0){v[n(261)]=j,v[n(163)]=n(350)+n(169)+"Roman', Ti"+n(154),v[n(209)]=r[n(136)];const e=t.moves[n(206)](" "),s=e[n(273)]>400?e[n(193)](0,400)+r[n(271)]:e,a=r[n(257)](f-120,40),i=s[n(147)](" ");let o="",l=b;const c=15,u=4;let d=0;for(const t of i){const e=o+(o?" ":"")+t;if(v[n(264)+"t"](e)[n(192)]>a&&o){if(v[n(171)](o,N,l),o=t,l+=c,d++,r.yQgzt(d,u))break}else o=e}o&&r[n(253)](d,u)&&v.fillText(o,N,l)}const U=r[n(257)](x,h)-20;v[n(261)]=j,v[n(163)]=n(320)+n(285)+"ns-serif",v[n(209)]=n(137);const H=r[n(302)].split(""),I=H[n(166)]((e,t)=>e+v[n(264)+"t"](t).width,0),W=r.AHxXM(I,4*r[n(304)](H[n(273)],1));let k=r[n(322)](N,r[n(327)](W,2));for(const _ of H)v.textAlign=r[n(326)],v[n(171)](_,k,U),k+=r.xBKFH(v[n(264)+"t"](_)[n(192)],4);if(o){const[e,t]=await Promise[n(313)]([r.mQjDA(K,!1),O()]),s=220,a=65,i=r[n(168)](r[n(337)](h,d),s)-12,o=r.StQda(h+d-a,12);v[n(261)]=r[n(177)],v.beginPath(),v.roundRect(i,o,s,a,6),v.fill(),v[n(149)+"e"]="#e7e5e4",v[n(266)]=1,v.stroke();const l=48,c=r.AHxXM(i,12),u=r[n(301)](o,r[n(327)](r[n(287)](a,l),2));v[n(237)](),v[n(312)](),v.arc(r[n(301)](c,r[n(231)](l,2)),r[n(337)](u,l/2),l/2,0,2*Math.PI),v.clip(),v[n(167)](t,c,u,l,l),v[n(306)]();const m=r[n(337)](c+l,10);v[n(209)]=n(179),v[n(232)+"ne"]=r[n(240)],v[n(261)]="#44403c",v.font=r.LRDng,v[n(171)]("EN PENSENT",m,r[n(151)](o,28)),v.fillStyle=n(201),v.font=r[n(305)],v[n(171)](n(138)+n(217),m,o+46);const f=50,x=i+s-f-10,p=o+r[n(231)](a-f,2),g=new Image;await new Promise(t=>{const s=n,a={gOoSa:function(e){return r.SODhD(e)}};g[s(319)]=()=>{const e=s,n={uIHjp:function(e){return a[_(230)](e)}};e(218)==e(218)?(v[e(167)](g,x,p,f,f),t()):(_0x5728f1[e(167)](_0x51bbad,_0x214886,_0x435e4e,_0x39c9c5,_0x4cca67),n[e(142)](_0x1ada45))},g[s(212)]=()=>t(),g.src=e})}return p}const Y=G.filter(e=>"custom"!==e.id);const R=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const V=()=>{const e=n(),{user:t,isLoading:s}=r(),[I,W]=a.useState(null),[k,_]=a.useState(!1),[P,T]=a.useState(0),[K,O]=a.useState(""),[V,J]=a.useState([]),[Q,X]=a.useState(50),[$,F]=a.useState(!0),[ee,te]=a.useState(!1),[se,ne]=a.useState(null);a.useEffect(()=>{s||(async()=>{if(!t)return void W(!1);const{data:e}=await l.rpc("has_role",{_user_id:t.id,_role:"admin"});W(!0===e)})()},[t,s]);const re=a.useCallback(async(e,s,n,r,a=!0)=>{try{const m=i(e.pgn),h=a?Y[Math.floor(Math.random()*Y.length)]:Y[n%Y.length],f=function(e,t){const s=G.find(e=>e.id===t)||G[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,h.id);o(h.id);const x=await Z(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),v=Date.now(),g=`${t.id}/${v}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await l.storage.from("visualizations").upload(g,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:y}=l.storage.from("visualizations").getPublicUrl(g),j=c(e.pgn),C={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:h.id,paletteName:h.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:j}},{data:N,error:b}=await l.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:C,image_path:y.publicUrl}).select().single();if(b)throw b;const z=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:D,error:M}=await u(N.id,z);if(M)throw M;const B=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<B.viewCount;e++)await l.rpc("record_vision_interaction",{p_visualization_id:N.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const L=d(e.pgn),S=a?"premium":"genesis";return{title:s,success:!0,visualizationId:N.id,listingId:null==D?void 0:D.id,isExemplar:r,paletteId:h.id,paletteName:h.name,gameHash:j,tier:S,openingName:null==L?void 0:L.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:r}}},[t]),ae=V.filter(e=>e.success).length,ie=V.filter(e=>!e.success).length;return V.filter(e=>e.success&&e.isExemplar).length,s||null===I?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}):t&&I?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(y,{className:"flex items-center gap-3",children:[m.jsx(j,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(x,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(C,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",Q," visions: ",Math.min(25,Q)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,Q-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:Q,onChange:e=>X(Number(e.target.value)),disabled:k,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(N,{id:"use-official-palettes",checked:$,onCheckedChange:F,disabled:k}),m.jsxs(b,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(z,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),$&&m.jsxs(D,{variant:"secondary",className:"text-xs",children:[Y.length," palettes"]})]})]}),m.jsx(v,{onClick:async()=>{if(!t)return void U.error("You must be logged in as the CEO account");_(!0),J([]),T(0);const e=[],s=H.slice(0,Math.min(Q,H.length)),n=[];for(let t=0;t<Q;t++){const e=t%s.length,r=t<25,a=R[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];O(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,$);e.push(i),J([...e]),T((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}_(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?U.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):U.error("Failed to create any visions")},disabled:k||!t,className:"w-full",size:"lg",children:k?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(M,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(B,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await l.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return U.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await l.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),c=n.filter(e=>i.has(e));if(0===o.length)return U.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:c.length}),void te(!1);await l.from("visualization_listings").delete().in("visualization_id",o),await l.from("vision_scores").delete().in("visualization_id",o),await l.from("vision_interactions").delete().in("visualization_id",o),await l.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await l.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await l.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:c.length}),U.success(`Deleted ${o.length} test visions`,{description:c.length>0?`${c.length} visions with natural value preserved`:void 0})}catch(e){U.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||k||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(B,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),k&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(L,{value:P,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:K})]}),V.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(S,{className:"h-4 w-4"}),ae," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(E,{className:"h-4 w-4"}),V.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(q,{className:"h-4 w-4"}),V.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:V.map((e,t)=>m.jsxs(A.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(E,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(q,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(D,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(D,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(z,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(x,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{V as default};
