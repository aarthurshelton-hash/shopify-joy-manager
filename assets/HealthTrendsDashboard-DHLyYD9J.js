const e='import React, { useState } from \'react\';\nimport { useQuery, useMutation, useQueryClient } from \'@tanstack/react-query\';\nimport { \n  Activity, AlertTriangle, Bell, BellOff, CheckCircle, Clock, \n  RefreshCw, Shield, TrendingDown, TrendingUp, XCircle, Zap \n} from \'lucide-react\';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Skeleton } from \'@/components/ui/skeleton\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { toast } from \'sonner\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { \n  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\n  BarChart, Bar, Legend, AreaChart, Area\n} from \'recharts\';\n\ninterface HealthTrends {\n  daily_trends: Array<{\n    date: string;\n    errors_reported: number;\n    errors_resolved: number;\n    issues_found: number;\n    issues_fixed: number;\n    api_requests: number;\n    rate_limited: number;\n  }>;\n  hourly_trends: Array<{\n    date: string;\n    hour: number;\n    errors: number;\n    fixed: number;\n    requests: number;\n  }>;\n  totals: {\n    total_errors: number;\n    total_resolved: number;\n    total_issues_found: number;\n    total_issues_fixed: number;\n    total_requests: number;\n    total_rate_limited: number;\n  };\n  active_alerts: number;\n  critical_alerts: number;\n}\n\ninterface SystemAlert {\n  id: string;\n  alert_type: string;\n  severity: \'info\' | \'warning\' | \'critical\';\n  title: string;\n  message: string;\n  metadata: Record<string, unknown>;\n  acknowledged_at: string | null;\n  resolved_at: string | null;\n  created_at: string;\n}\n\nexport function HealthTrendsDashboard() {\n  const [timeRange, setTimeRange] = useState(7);\n  const queryClient = useQueryClient();\n\n  const { data: trends, isLoading: trendsLoading } = useQuery({\n    queryKey: [\'health-trends\', timeRange],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc(\'get_health_trends\', { p_days: timeRange });\n      if (error) throw error;\n      return data as unknown as HealthTrends;\n    },\n    refetchInterval: 60000,\n  });\n\n  const { data: alerts, isLoading: alertsLoading } = useQuery({\n    queryKey: [\'system-alerts\'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc(\'get_system_alerts\', { \n        p_include_resolved: false,\n        p_limit: 50 \n      });\n      if (error) throw error;\n      return (data as unknown as SystemAlert[]) || [];\n    },\n    refetchInterval: 30000,\n  });\n\n  const acknowledgeAlert = useMutation({\n    mutationFn: async (alertId: string) => {\n      const { error } = await supabase.rpc(\'acknowledge_alert\', { p_alert_id: alertId });\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      toast.success(\'Alert acknowledged\');\n      queryClient.invalidateQueries({ queryKey: [\'system-alerts\'] });\n    },\n  });\n\n  const resolveAlert = useMutation({\n    mutationFn: async (alertId: string) => {\n      const { error } = await supabase.rpc(\'resolve_alert\', { p_alert_id: alertId });\n      if (error) throw error;\n    },\n    onSuccess: () => {\n      toast.success(\'Alert resolved\');\n      queryClient.invalidateQueries({ queryKey: [\'system-alerts\'] });\n      queryClient.invalidateQueries({ queryKey: [\'health-trends\'] });\n    },\n  });\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case \'critical\': return \'destructive\';\n      case \'warning\': return \'secondary\';\n      default: return \'outline\';\n    }\n  };\n\n  const getSeverityIcon = (severity: string) => {\n    switch (severity) {\n      case \'critical\': return <XCircle className="h-4 w-4 text-destructive" />;\n      case \'warning\': return <AlertTriangle className="h-4 w-4 text-yellow-500" />;\n      default: return <Bell className="h-4 w-4 text-muted-foreground" />;\n    }\n  };\n\n  if (trendsLoading) {\n    return (\n      <div className="space-y-4">\n        <Skeleton className="h-32 w-full" />\n        <Skeleton className="h-64 w-full" />\n      </div>\n    );\n  }\n\n  const totals = trends?.totals || {\n    total_errors: 0,\n    total_resolved: 0,\n    total_issues_found: 0,\n    total_issues_fixed: 0,\n    total_requests: 0,\n    total_rate_limited: 0,\n  };\n\n  const resolutionRate = totals.total_errors > 0 \n    ? Math.round((totals.total_resolved / totals.total_errors) * 100) \n    : 100;\n\n  const fixRate = totals.total_issues_found > 0\n    ? Math.round((totals.total_issues_fixed / totals.total_issues_found) * 100)\n    : 100;\n\n  return (\n    <div className="space-y-6">\n      {/* Alert Banner */}\n      {(trends?.critical_alerts || 0) > 0 && (\n        <Card className="border-destructive bg-destructive/10">\n          <CardContent className="py-4">\n            <div className="flex items-center gap-3">\n              <XCircle className="h-6 w-6 text-destructive" />\n              <div>\n                <p className="font-semibold text-destructive">\n                  {trends?.critical_alerts} Critical Alert{trends?.critical_alerts !== 1 ? \'s\' : \'\'} Require Attention\n                </p>\n                <p className="text-sm text-muted-foreground">\n                  Review and resolve critical issues immediately\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Summary Cards */}\n      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">\n        <Card>\n          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">\n            <CardTitle className="text-sm font-medium">Error Resolution</CardTitle>\n            {resolutionRate >= 80 ? (\n              <TrendingUp className="h-4 w-4 text-green-500" />\n            ) : (\n              <TrendingDown className="h-4 w-4 text-destructive" />\n            )}\n          </CardHeader>\n          <CardContent>\n            <div className="text-2xl font-bold">{resolutionRate}%</div>\n            <p className="text-xs text-muted-foreground">\n              {totals.total_resolved} / {totals.total_errors} errors resolved\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">\n            <CardTitle className="text-sm font-medium">Issues Fixed</CardTitle>\n            <CheckCircle className="h-4 w-4 text-green-500" />\n          </CardHeader>\n          <CardContent>\n            <div className="text-2xl font-bold">{fixRate}%</div>\n            <p className="text-xs text-muted-foreground">\n              {totals.total_issues_fixed} / {totals.total_issues_found} auto-fixed\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">\n            <CardTitle className="text-sm font-medium">API Requests</CardTitle>\n            <Zap className="h-4 w-4 text-primary" />\n          </CardHeader>\n          <CardContent>\n            <div className="text-2xl font-bold">\n              {totals.total_requests.toLocaleString()}\n            </div>\n            <p className="text-xs text-muted-foreground">\n              Last {timeRange} days\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">\n            <CardTitle className="text-sm font-medium">Rate Limited</CardTitle>\n            <Shield className="h-4 w-4 text-yellow-500" />\n          </CardHeader>\n          <CardContent>\n            <div className="text-2xl font-bold">{totals.total_rate_limited}</div>\n            <p className="text-xs text-muted-foreground">\n              {totals.total_requests > 0 \n                ? ((totals.total_rate_limited / totals.total_requests) * 100).toFixed(2)\n                : 0}% of requests\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue="trends" className="space-y-4">\n        <TabsList>\n          <TabsTrigger value="trends">Trends</TabsTrigger>\n          <TabsTrigger value="alerts" className="relative">\n            Alerts\n            {(trends?.active_alerts || 0) > 0 && (\n              <Badge variant="destructive" className="ml-2 h-5 w-5 p-0 text-xs">\n                {trends?.active_alerts}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value="hourly">Hourly</TabsTrigger>\n        </TabsList>\n\n        {/* Trends Tab */}\n        <TabsContent value="trends" className="space-y-4">\n          <Card>\n            <CardHeader className="flex flex-row items-center justify-between">\n              <div>\n                <CardTitle>Error & Issue Trends</CardTitle>\n                <CardDescription>Daily error rates and auto-fix performance</CardDescription>\n              </div>\n              <div className="flex gap-2">\n                {[7, 14, 30].map((days) => (\n                  <Button\n                    key={days}\n                    size="sm"\n                    variant={timeRange === days ? \'default\' : \'outline\'}\n                    onClick={() => setTimeRange(days)}\n                  >\n                    {days}d\n                  </Button>\n                ))}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className="h-[300px]">\n                <ResponsiveContainer width="100%" height="100%">\n                  <AreaChart data={trends?.daily_trends?.slice().reverse() || []}>\n                    <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />\n                    <XAxis \n                      dataKey="date" \n                      tickFormatter={(value) => new Date(value).toLocaleDateString(\'en-US\', { month: \'short\', day: \'numeric\' })}\n                      className="text-xs"\n                    />\n                    <YAxis className="text-xs" />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: \'hsl(var(--card))\', \n                        border: \'1px solid hsl(var(--border))\' \n                      }}\n                      labelFormatter={(value) => new Date(value).toLocaleDateString()}\n                    />\n                    <Legend />\n                    <Area \n                      type="monotone" \n                      dataKey="errors_reported" \n                      name="Errors" \n                      stackId="1"\n                      stroke="hsl(var(--destructive))" \n                      fill="hsl(var(--destructive)/0.3)"\n                    />\n                    <Area \n                      type="monotone" \n                      dataKey="errors_resolved" \n                      name="Resolved" \n                      stackId="2"\n                      stroke="hsl(142, 76%, 36%)" \n                      fill="hsl(142, 76%, 36%, 0.3)"\n                    />\n                    <Area \n                      type="monotone" \n                      dataKey="issues_fixed" \n                      name="Auto-Fixed" \n                      stackId="3"\n                      stroke="hsl(var(--primary))" \n                      fill="hsl(var(--primary)/0.3)"\n                    />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>API Traffic & Rate Limiting</CardTitle>\n              <CardDescription>Request volume and protection metrics</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className="h-[250px]">\n                <ResponsiveContainer width="100%" height="100%">\n                  <BarChart data={trends?.daily_trends?.slice().reverse() || []}>\n                    <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />\n                    <XAxis \n                      dataKey="date" \n                      tickFormatter={(value) => new Date(value).toLocaleDateString(\'en-US\', { month: \'short\', day: \'numeric\' })}\n                      className="text-xs"\n                    />\n                    <YAxis className="text-xs" />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: \'hsl(var(--card))\', \n                        border: \'1px solid hsl(var(--border))\' \n                      }}\n                    />\n                    <Legend />\n                    <Bar \n                      dataKey="api_requests" \n                      name="API Requests" \n                      fill="hsl(var(--primary))" \n                      radius={[4, 4, 0, 0]}\n                    />\n                    <Bar \n                      dataKey="rate_limited" \n                      name="Rate Limited" \n                      fill="hsl(var(--destructive))" \n                      radius={[4, 4, 0, 0]}\n                    />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Alerts Tab */}\n        <TabsContent value="alerts">\n          <Card>\n            <CardHeader>\n              <CardTitle className="flex items-center gap-2">\n                <Bell className="h-5 w-5" />\n                Active Alerts\n              </CardTitle>\n              <CardDescription>\n                {(alerts?.length || 0)} unresolved alerts\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {alertsLoading ? (\n                <Skeleton className="h-32 w-full" />\n              ) : alerts && alerts.length > 0 ? (\n                <ScrollArea className="h-[400px]">\n                  <div className="space-y-3">\n                    {alerts.map((alert) => (\n                      <div\n                        key={alert.id}\n                        className={`p-4 rounded-lg border ${\n                          alert.severity === \'critical\' \n                            ? \'border-destructive bg-destructive/5\' \n                            : alert.severity === \'warning\'\n                            ? \'border-yellow-500/50 bg-yellow-500/5\'\n                            : \'border-border bg-muted/30\'\n                        }`}\n                      >\n                        <div className="flex items-start justify-between gap-4">\n                          <div className="flex items-start gap-3">\n                            {getSeverityIcon(alert.severity)}\n                            <div className="space-y-1">\n                              <div className="flex items-center gap-2">\n                                <p className="font-medium">{alert.title}</p>\n                                <Badge variant={getSeverityColor(alert.severity)}>\n                                  {alert.severity}\n                                </Badge>\n                                <Badge variant="outline" className="text-xs">\n                                  {alert.alert_type}\n                                </Badge>\n                              </div>\n                              <p className="text-sm text-muted-foreground">\n                                {alert.message}\n                              </p>\n                              <p className="text-xs text-muted-foreground">\n                                {new Date(alert.created_at).toLocaleString()}\n                                {alert.acknowledged_at && (\n                                  <span className="ml-2 text-green-600">\n                                    â€¢ Acknowledged\n                                  </span>\n                                )}\n                              </p>\n                            </div>\n                          </div>\n                          <div className="flex gap-2 shrink-0">\n                            {!alert.acknowledged_at && (\n                              <Button\n                                size="sm"\n                                variant="outline"\n                                onClick={() => acknowledgeAlert.mutate(alert.id)}\n                                disabled={acknowledgeAlert.isPending}\n                              >\n                                <BellOff className="h-3 w-3 mr-1" />\n                                Ack\n                              </Button>\n                            )}\n                            <Button\n                              size="sm"\n                              variant="default"\n                              onClick={() => resolveAlert.mutate(alert.id)}\n                              disabled={resolveAlert.isPending}\n                            >\n                              <CheckCircle className="h-3 w-3 mr-1" />\n                              Resolve\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </ScrollArea>\n              ) : (\n                <div className="flex flex-col items-center justify-center py-12 text-center">\n                  <CheckCircle className="h-12 w-12 text-green-500 mb-4" />\n                  <p className="text-lg font-medium">All Clear!</p>\n                  <p className="text-muted-foreground">No active alerts</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Hourly Tab */}\n        <TabsContent value="hourly">\n          <Card>\n            <CardHeader>\n              <CardTitle>Hourly Activity (Last 48 Hours)</CardTitle>\n              <CardDescription>Granular view of system activity</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className="h-[300px]">\n                <ResponsiveContainer width="100%" height="100%">\n                  <LineChart data={trends?.hourly_trends?.slice().reverse() || []}>\n                    <CartesianGrid strokeDasharray="3 3" className="stroke-muted" />\n                    <XAxis \n                      dataKey="hour" \n                      tickFormatter={(value, index) => {\n                        const item = trends?.hourly_trends?.slice().reverse()[index];\n                        if (!item) return \'\';\n                        return `${value}:00`;\n                      }}\n                      className="text-xs"\n                    />\n                    <YAxis className="text-xs" />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: \'hsl(var(--card))\', \n                        border: \'1px solid hsl(var(--border))\' \n                      }}\n                      labelFormatter={(_, payload) => {\n                        if (payload && payload[0]) {\n                          const item = payload[0].payload;\n                          return `${item.date} ${item.hour}:00`;\n                        }\n                        return \'\';\n                      }}\n                    />\n                    <Legend />\n                    <Line \n                      type="monotone" \n                      dataKey="errors" \n                      name="Errors" \n                      stroke="hsl(var(--destructive))" \n                      strokeWidth={2}\n                      dot={false}\n                    />\n                    <Line \n                      type="monotone" \n                      dataKey="fixed" \n                      name="Fixed" \n                      stroke="hsl(142, 76%, 36%)" \n                      strokeWidth={2}\n                      dot={false}\n                    />\n                    <Line \n                      type="monotone" \n                      dataKey="requests" \n                      name="Requests" \n                      stroke="hsl(var(--primary))" \n                      strokeWidth={2}\n                      dot={false}\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}';export{e as default};
