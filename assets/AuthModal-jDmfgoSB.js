const e='import React, { useState, forwardRef } from \'react\';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \'@/components/ui/dialog\';\nimport { Button } from \'@/components/ui/button\';\nimport { Input } from \'@/components/ui/input\';\nimport { Label } from \'@/components/ui/label\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { toast } from \'sonner\';\nimport { Loader2, Mail, Lock, User, Phone, Crown, Sparkles, Gift, Check } from \'lucide-react\';\nimport { Badge } from \'@/components/ui/badge\';\nimport MFAVerification from \'./MFAVerification\';\nimport { useAuthRateLimit } from \'@/hooks/useRateLimitV2\';\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  defaultMode?: \'signin\' | \'signup\';\n}\n\ntype AuthMode = \'signin\' | \'signup\';\n\nconst FREE_ACCOUNT_BENEFITS = [\n  \'Save email for personalized experience\',\n  \'Track your visualization views\',\n  \'Get notified about new features\',\n  \'One-click upgrade to Premium anytime\',\n];\n\nconst AuthModal = forwardRef<HTMLDivElement, AuthModalProps>(({ isOpen, onClose, defaultMode = \'signin\' }, ref) => {\n  const [mode, setMode] = useState<AuthMode>(defaultMode);\n  const [email, setEmail] = useState(\'\');\n  const [password, setPassword] = useState(\'\');\n  const [displayName, setDisplayName] = useState(\'\');\n  const [phone, setPhone] = useState(\'\');\n  const [isLoading, setIsLoading] = useState(false);\n  const [showMFAVerification, setShowMFAVerification] = useState(false);\n  const { signIn, signUp } = useAuth();\n  const { check: checkLimit, isLimited, resetInMs } = useAuthRateLimit();\n  const retryAfter = resetInMs ? Math.ceil(resetInMs / 1000) : null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Check rate limit before proceeding (V2 is synchronous)\n    const result = checkLimit();\n    if (!result.allowed) return;\n    \n    setIsLoading(true);\n\n    try {\n      if (mode === \'signin\') {\n        const { error, requiresMFA } = await signIn(email, password);\n        if (error) {\n          toast.error(\'Sign in failed\', { description: error.message });\n        } else if (requiresMFA) {\n          setShowMFAVerification(true);\n        } else {\n          toast.success(\'Welcome back!\');\n          onClose();\n          resetForm();\n        }\n      } else {\n        const { error } = await signUp(email, password, displayName, phone || undefined);\n        if (error) {\n          toast.error(\'Sign up failed\', { description: error.message });\n        } else {\n          toast.success(\'Free account created!\', { \n            description: \'Upgrade to Premium anytime to unlock all features.\',\n            icon: <Gift className="h-4 w-4" />,\n          });\n          onClose();\n          resetForm();\n        }\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleMFASuccess = () => {\n    toast.success(\'Welcome back!\');\n    onClose();\n    resetForm();\n    setShowMFAVerification(false);\n  };\n\n  const resetForm = () => {\n    setEmail(\'\');\n    setPassword(\'\');\n    setDisplayName(\'\');\n    setPhone(\'\');\n  };\n\n  const toggleMode = () => {\n    setMode(mode === \'signin\' ? \'signup\' : \'signin\');\n    resetForm();\n  };\n\n  return (\n    <div ref={ref}>\n      <Dialog open={isOpen && !showMFAVerification} onOpenChange={(open) => !open && onClose()}>\n        <DialogContent className="sm:max-w-md bg-card border-border">\n          <DialogHeader>\n            <DialogTitle className="font-display text-xl text-center">\n              {mode === \'signin\' ? \'Welcome Back\' : \'Create Free Account\'}\n            </DialogTitle>\n            {mode === \'signup\' && (\n              <DialogDescription className="text-center">\n                Start with a free account • Upgrade anytime\n              </DialogDescription>\n            )}\n          </DialogHeader>\n\n          {mode === \'signup\' && (\n            <div className="bg-muted/30 rounded-lg p-4 border border-border/50">\n              <div className="flex items-center gap-2 mb-3">\n                <Gift className="h-4 w-4 text-primary" />\n                <span className="text-sm font-medium">Free Account Includes:</span>\n              </div>\n              <ul className="space-y-2">\n                {FREE_ACCOUNT_BENEFITS.map((benefit, idx) => (\n                  <li key={idx} className="flex items-center gap-2 text-xs text-muted-foreground">\n                    <Check className="h-3 w-3 text-green-500 flex-shrink-0" />\n                    {benefit}\n                  </li>\n                ))}\n              </ul>\n              <div className="mt-3 pt-3 border-t border-border/50 flex items-center gap-2">\n                <Crown className="h-4 w-4 text-primary" />\n                <span className="text-xs text-primary">\n                  <span className="font-medium">Premium features</span> unlock after payment\n                </span>\n              </div>\n            </div>\n          )}\n\n          <form onSubmit={handleSubmit} className="space-y-4 mt-4">\n            {mode === \'signup\' && (\n              <div className="space-y-2">\n                <Label htmlFor="displayName" className="text-sm font-medium">\n                  Display Name\n                </Label>\n                <div className="relative">\n                  <User className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n                  <Input\n                    id="displayName"\n                    type="text"\n                    placeholder="Your name"\n                    value={displayName}\n                    onChange={(e) => setDisplayName(e.target.value)}\n                    className="pl-10"\n                  />\n                </div>\n              </div>\n            )}\n\n            <div className="space-y-2">\n              <Label htmlFor="email" className="text-sm font-medium">\n                Email\n              </Label>\n              <div className="relative">\n                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n                <Input\n                  id="email"\n                  type="email"\n                  placeholder="you@example.com"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  className="pl-10"\n                />\n              </div>\n            </div>\n\n            {mode === \'signup\' && (\n              <div className="space-y-2">\n                <Label htmlFor="phone" className="text-sm font-medium flex items-center gap-2">\n                  Phone Number\n                  <Badge variant="secondary" className="text-[10px] px-1.5 py-0">Optional</Badge>\n                </Label>\n                <div className="relative">\n                  <Phone className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n                  <Input\n                    id="phone"\n                    type="tel"\n                    placeholder="+1 (555) 123-4567"\n                    value={phone}\n                    onChange={(e) => setPhone(e.target.value)}\n                    className="pl-10"\n                  />\n                </div>\n                <p className="text-[10px] text-muted-foreground">\n                  Get SMS notifications about your visions and exclusive offers\n                </p>\n              </div>\n            )}\n\n            <div className="space-y-2">\n              <Label htmlFor="password" className="text-sm font-medium">\n                Password\n              </Label>\n              <div className="relative">\n                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n                <Input\n                  id="password"\n                  type="password"\n                  placeholder="••••••••"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  minLength={6}\n                  className="pl-10"\n                />\n              </div>\n            </div>\n\n            <Button\n              type="submit"\n              disabled={isLoading || isLimited}\n              className="w-full btn-luxury"\n            >\n              {isLoading ? (\n                <Loader2 className="h-4 w-4 animate-spin" />\n              ) : isLimited ? (\n                `Try again in ${retryAfter}s`\n              ) : mode === \'signin\' ? (\n                \'Sign In\'\n              ) : (\n                <>\n                  <Sparkles className="h-4 w-4 mr-2" />\n                  Create Free Account\n                </>\n              )}\n            </Button>\n          </form>\n\n          <div className="mt-4 text-center">\n            <button\n              type="button"\n              onClick={toggleMode}\n              className="text-sm text-muted-foreground hover:text-primary transition-colors"\n            >\n              {mode === \'signin\' ? (\n                <>Don\'t have an account? <span className="font-medium text-primary">Sign up free</span></>\n              ) : (\n                <>Already have an account? <span className="font-medium text-primary">Sign in</span></>\n              )}\n            </button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <MFAVerification\n        isOpen={showMFAVerification}\n        onClose={() => setShowMFAVerification(false)}\n        onSuccess={handleMFASuccess}\n      />\n    </div>\n  );\n});\n\nAuthModal.displayName = \'AuthModal\';\n\nexport default AuthModal;';export{e as default};
