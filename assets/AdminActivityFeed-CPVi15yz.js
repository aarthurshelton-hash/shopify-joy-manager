const e="import React, { useEffect, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { \n  Activity,\n  Eye,\n  Download,\n  Printer,\n  ArrowRightLeft,\n  Crown,\n  Wallet,\n  ShoppingBag,\n  UserPlus,\n  Image,\n  Bell,\n  RefreshCw,\n} from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { supabase } from '@/integrations/supabase/client';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface ActivityItem {\n  id: string;\n  type: string;\n  description: string;\n  timestamp: string;\n  user_id?: string;\n  value?: number;\n}\n\nexport const AdminActivityFeed: React.FC = () => {\n  const [activities, setActivities] = useState<ActivityItem[]>([]);\n\n  // Fetch recent activities from multiple sources\n  const { data: activityData, isLoading, refetch } = useQuery({\n    queryKey: ['admin-activity-feed'],\n    queryFn: async () => {\n      const [\n        visionsResult,\n        interactionsResult,\n        transactionsResult,\n        subscriptionsResult,\n        listingsResult,\n        withdrawalsResult,\n      ] = await Promise.all([\n        // Recent visions created\n        supabase\n          .from('saved_visualizations')\n          .select('id, title, user_id, created_at')\n          .order('created_at', { ascending: false })\n          .limit(10),\n        \n        // Recent interactions\n        supabase\n          .from('vision_interactions')\n          .select('id, interaction_type, user_id, value_cents, created_at')\n          .order('created_at', { ascending: false })\n          .limit(20),\n        \n        // Recent wallet transactions\n        supabase\n          .from('wallet_transactions')\n          .select('id, transaction_type, amount_cents, user_id, created_at')\n          .order('created_at', { ascending: false })\n          .limit(10),\n        \n        // Recent subscriptions\n        supabase\n          .from('user_subscriptions')\n          .select('id, subscription_status, user_id, created_at, updated_at')\n          .order('updated_at', { ascending: false })\n          .limit(10),\n        \n        // Recent listings\n        supabase\n          .from('visualization_listings')\n          .select('id, status, price_cents, seller_id, created_at, sold_at')\n          .order('created_at', { ascending: false })\n          .limit(10),\n        \n        // Recent withdrawals\n        supabase\n          .from('withdrawal_requests')\n          .select('id, status, amount_cents, user_id, created_at')\n          .order('created_at', { ascending: false })\n          .limit(10),\n      ]);\n\n      const allActivities: ActivityItem[] = [];\n\n      // Vision creations\n      visionsResult.data?.forEach(v => {\n        allActivities.push({\n          id: `vision-${v.id}`,\n          type: 'vision_created',\n          description: `New vision created: \"${v.title}\"`,\n          timestamp: v.created_at,\n          user_id: v.user_id || undefined,\n        });\n      });\n\n      // Interactions\n      interactionsResult.data?.forEach(i => {\n        const desc = {\n          view: 'Vision viewed',\n          download_hd: 'HD download',\n          download_gif: 'GIF download',\n          print_order: 'Print ordered',\n          trade: 'Trade completed',\n        }[i.interaction_type] || i.interaction_type;\n\n        allActivities.push({\n          id: `interaction-${i.id}`,\n          type: i.interaction_type,\n          description: desc,\n          timestamp: i.created_at,\n          user_id: i.user_id || undefined,\n          value: i.value_cents,\n        });\n      });\n\n      // Transactions\n      transactionsResult.data?.forEach(t => {\n        allActivities.push({\n          id: `tx-${t.id}`,\n          type: `wallet_${t.transaction_type}`,\n          description: `Wallet ${t.transaction_type}: $${(Math.abs(t.amount_cents) / 100).toFixed(2)}`,\n          timestamp: t.created_at,\n          user_id: t.user_id,\n          value: t.amount_cents,\n        });\n      });\n\n      // Subscriptions\n      subscriptionsResult.data?.forEach(s => {\n        allActivities.push({\n          id: `sub-${s.id}`,\n          type: `subscription_${s.subscription_status}`,\n          description: `Subscription ${s.subscription_status}`,\n          timestamp: s.updated_at,\n          user_id: s.user_id,\n        });\n      });\n\n      // Listings\n      listingsResult.data?.forEach(l => {\n        if (l.status === 'sold' && l.sold_at) {\n          allActivities.push({\n            id: `listing-${l.id}`,\n            type: 'marketplace_sale',\n            description: `Marketplace sale: $${(l.price_cents / 100).toFixed(2)}`,\n            timestamp: l.sold_at,\n            user_id: l.seller_id,\n            value: l.price_cents,\n          });\n        } else if (l.status === 'active') {\n          allActivities.push({\n            id: `listing-${l.id}`,\n            type: 'listing_created',\n            description: `New listing: $${(l.price_cents / 100).toFixed(2)}`,\n            timestamp: l.created_at,\n            user_id: l.seller_id,\n            value: l.price_cents,\n          });\n        }\n      });\n\n      // Withdrawals\n      withdrawalsResult.data?.forEach(w => {\n        allActivities.push({\n          id: `withdrawal-${w.id}`,\n          type: `withdrawal_${w.status}`,\n          description: `Withdrawal ${w.status}: $${(w.amount_cents / 100).toFixed(2)}`,\n          timestamp: w.created_at,\n          user_id: w.user_id,\n          value: w.amount_cents,\n        });\n      });\n\n      // Sort by timestamp\n      allActivities.sort((a, b) => \n        new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n      );\n\n      return allActivities.slice(0, 50);\n    },\n    staleTime: 10000, // Refresh more frequently\n  });\n\n  // Real-time subscription for live updates\n  useEffect(() => {\n    const channel = supabase\n      .channel('admin-activity')\n      .on(\n        'postgres_changes',\n        { event: 'INSERT', schema: 'public', table: 'vision_interactions' },\n        () => refetch()\n      )\n      .on(\n        'postgres_changes',\n        { event: 'INSERT', schema: 'public', table: 'wallet_transactions' },\n        () => refetch()\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'visualization_listings' },\n        () => refetch()\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'withdrawal_requests' },\n        () => refetch()\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [refetch]);\n\n  const getActivityIcon = (type: string) => {\n    if (type.includes('view')) return <Eye className=\"h-4 w-4\" />;\n    if (type.includes('download')) return <Download className=\"h-4 w-4\" />;\n    if (type.includes('print')) return <Printer className=\"h-4 w-4\" />;\n    if (type.includes('trade') || type.includes('marketplace')) return <ArrowRightLeft className=\"h-4 w-4\" />;\n    if (type.includes('subscription')) return <Crown className=\"h-4 w-4\" />;\n    if (type.includes('wallet') || type.includes('withdrawal')) return <Wallet className=\"h-4 w-4\" />;\n    if (type.includes('vision')) return <Image className=\"h-4 w-4\" />;\n    if (type.includes('listing')) return <ShoppingBag className=\"h-4 w-4\" />;\n    return <Activity className=\"h-4 w-4\" />;\n  };\n\n  const getActivityColor = (type: string) => {\n    if (type.includes('sale') || type.includes('completed')) return 'text-green-500 bg-green-500/10';\n    if (type.includes('print')) return 'text-blue-500 bg-blue-500/10';\n    if (type.includes('subscription_active')) return 'text-primary bg-primary/10';\n    if (type.includes('canceled') || type.includes('rejected')) return 'text-red-500 bg-red-500/10';\n    if (type.includes('withdrawal_pending')) return 'text-yellow-500 bg-yellow-500/10';\n    return 'text-muted-foreground bg-muted';\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              Live Activity Feed\n            </CardTitle>\n            <CardDescription>\n              Real-time platform activity monitoring\n            </CardDescription>\n          </div>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => refetch()} className=\"gap-2\">\n            <RefreshCw className=\"h-4 w-4\" />\n            Refresh\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\n          </div>\n        ) : (\n          <ScrollArea className=\"h-[600px]\">\n            <div className=\"space-y-2\">\n              {activityData?.map((activity) => (\n                <div\n                  key={activity.id}\n                  className=\"flex items-center gap-4 p-3 rounded-lg border bg-card hover:bg-muted/30 transition-colors\"\n                >\n                  <div className={`p-2 rounded-full ${getActivityColor(activity.type)}`}>\n                    {getActivityIcon(activity.type)}\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium truncate\">{activity.description}</p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {formatDistanceToNow(new Date(activity.timestamp), { addSuffix: true })}\n                    </p>\n                  </div>\n\n                  {activity.value !== undefined && activity.value > 0 && (\n                    <Badge variant=\"outline\" className=\"text-green-500 border-green-500/30\">\n                      ${(activity.value / 100).toFixed(2)}\n                    </Badge>\n                  )}\n                </div>\n              ))}\n\n              {(!activityData || activityData.length === 0) && (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Activity className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No recent activity</p>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n";export{e as default};
