import{ap as e,r as t,fb as s,fc as a,u as r,fd as i,s as n,b as l,a1 as o,j as c,fe as d,x as m,p as u,X as p,z as h,J as x,Z as g,ff as f,N as b,fg as v,K as y,am as w,W as j,I as N,fh as k,fi as C,bW as M,bX as S,bY as _,ah as P,a4 as T,ad as E,cK as $,bV as O,em as A,ct as I,c$ as q,B as D,fj as R,fk as L,a9 as z,bL as H,aa as F,ac as G,ae as B,f4 as Y,f5 as V,fl as U,f6 as W,f7 as X,fm as K,fn as J,fo as Q,fp as Z,fq as ee,D as te,fr as se,_ as ae,$ as re,eH as ie,eI as ne,eJ as le,S as oe,E as ce,bt as de,a as me,dl as ue,a0 as pe,dY as he,a2 as xe,cj as ge,ck as fe,cl as be,cm as ve,cn as ye,fs as we,L as je,bB as Ne,b5 as ke,ft as Ce,fu as Me,bI as Se,c1 as _e,c2 as Pe,fv as Te,bP as Ee,aj as $e,H as Oe,P as Ae,b6 as Ie,bv as qe,Q as De,bw as Re,a8 as Le,bG as ze,bF as He,d as Fe,V as Ge,b1 as Be,bD as Ye,dn as Ve,O as Ue,Y as We}from"./index-BRnl98aa.js";import{c as Xe,g as Ke,p as Je}from"./eloCalculator-BBlzI_Sc.js";import{L as Qe}from"./LiveColorLegend-D-47P_L5.js";import Ze from"./html2canvas.esm-C2s7aB6S.js";import{a as et}from"./browser-DhmD84ER.js";import{S as tt,M as st}from"./sun-FQ-7jFws.js";const at=e("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),rt=e("Handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]),it=e("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]),nt=e("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),lt=e("Volume1",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}]]),ot=e("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),ct=e("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function dt(e){const t=function(e){if(e.isStalemate())return{reason:"stalemate",message:"Stalemate! No legal moves available.",shortMessage:"Stalemate!"};if(e.isThreefoldRepetition())return{reason:"threefold_repetition",message:"Draw by threefold repetition.",shortMessage:"Threefold Repetition"};if(e.isInsufficientMaterial())return{reason:"insufficient_material",message:"Draw by insufficient material.",shortMessage:"Insufficient Material"};const t=e.fen();return parseInt(t.split(" ")[4],10)>=100?{reason:"fifty_move_rule",message:"Draw by the fifty-move rule.",shortMessage:"50-Move Rule"}:{reason:"unknown",message:"Game drawn!",shortMessage:"Draw"}}(e);return t.message}const mt=(e=!0,s=.5)=>{const a=t.useRef({context:null,gainNode:null}),r=t.useCallback(()=>{if(!a.current.context)try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination),t.gain.value=s,a.current={context:e,gainNode:t}}catch(e){}},[s]);t.useEffect(()=>{a.current.gainNode&&(a.current.gainNode.gain.value=s)},[s]);const i=t.useCallback((t,s,i="sine",n=.01,l=.1,o)=>{if(!e)return;r();const{context:c,gainNode:d}=a.current;if(!c||!d)return;const m=c.createOscillator(),u=c.createGain();m.type=i,m.frequency.setValueAtTime(t,c.currentTime),o&&m.frequency.exponentialRampToValueAtTime(o,c.currentTime+s),u.gain.setValueAtTime(0,c.currentTime),u.gain.linearRampToValueAtTime(1,c.currentTime+n),u.gain.exponentialRampToValueAtTime(.01,c.currentTime+s-l),u.gain.linearRampToValueAtTime(0,c.currentTime+s),m.connect(u),u.connect(d),m.start(c.currentTime),m.stop(c.currentTime+s)},[e,r]),n=t.useCallback((t,s=1e3)=>{if(!e)return;r();const{context:i,gainNode:n}=a.current;if(!i||!n)return;const l=i.sampleRate*t,o=i.createBuffer(1,l,i.sampleRate),c=o.getChannelData(0);for(let e=0;e<l;e++)c[e]=2*Math.random()-1;const d=i.createBufferSource();d.buffer=o;const m=i.createBiquadFilter();m.type="lowpass",m.frequency.value=s;const u=i.createGain();u.gain.setValueAtTime(.3,i.currentTime),u.gain.exponentialRampToValueAtTime(.01,i.currentTime+t),d.connect(m),m.connect(u),u.connect(n),d.start(i.currentTime),d.stop(i.currentTime+t)},[e,r]),l=t.useCallback(t=>{if(e)switch(t){case"move":i(800,.08,"sine",.005,.05),i(400,.06,"triangle",.005,.04);break;case"capture":n(.12,2e3),i(300,.1,"square",.005,.08),i(150,.15,"sine",.01,.1);break;case"castle":i(600,.06,"sine",.005,.04),setTimeout(()=>i(700,.06,"sine",.005,.04),80);break;case"check":i(880,.15,"triangle",.01,.1),setTimeout(()=>i(1100,.12,"triangle",.01,.08),120);break;case"checkmate":i(880,.2,"sine",.01,.15),setTimeout(()=>i(660,.2,"sine",.01,.15),150),setTimeout(()=>i(440,.3,"sine",.01,.2),300),setTimeout(()=>i(330,.4,"sine",.01,.3),500);break;case"gameStart":i(523,.12,"sine",.01,.08),setTimeout(()=>i(659,.12,"sine",.01,.08),100),setTimeout(()=>i(784,.2,"sine",.01,.15),200);break;case"gameEnd":i(440,.15,"triangle",.01,.1),setTimeout(()=>i(349,.25,"triangle",.01,.2),150);break;case"victory":i(523,.1,"sine",.01,.08),setTimeout(()=>i(659,.1,"sine",.01,.08),100),setTimeout(()=>i(784,.1,"sine",.01,.08),200),setTimeout(()=>i(1047,.3,"sine",.01,.25),300);break;case"defeat":i(392,.2,"sine",.02,.15),setTimeout(()=>i(349,.2,"sine",.02,.15),200),setTimeout(()=>i(330,.3,"sine",.02,.25),400),setTimeout(()=>i(262,.4,"sine",.02,.35),650);break;case"draw":i(440,.15,"sine",.01,.1),setTimeout(()=>i(440,.15,"sine",.01,.1),180),setTimeout(()=>i(523,.2,"sine",.01,.15),360);break;case"illegal":i(200,.1,"square",.005,.08),i(150,.08,"sawtooth",.005,.06)}},[e,i,n]);return t.useEffect(()=>()=>{a.current.context&&a.current.context.close()},[]),{playSound:l,initAudio:r}},ut=s()(a(e=>({enabled:!0,volume:.5,setEnabled:t=>e({enabled:t}),setVolume:t=>e({volume:t}),toggleEnabled:()=>e(e=>({enabled:!e.enabled}))}),{name:"chess-sound-settings"})),pt={bullet_1:60,blitz_5:300,rapid_15:900,untimed:0},ht={light:10,medium:25,heavy:50,success:[10,50,20],error:[50,30,50,30,50],selection:5},xt=()=>{const e="undefined"!=typeof navigator&&"vibrate"in navigator,s=t.useCallback((t="light")=>{if(!e)return!1;try{const e=ht[t];return navigator.vibrate(e)}catch(s){return!1}},[e]),a={select:t.useCallback(()=>s("selection"),[s]),move:t.useCallback(()=>s("light"),[s]),capture:t.useCallback(()=>s("medium"),[s]),check:t.useCallback(()=>s("heavy"),[s]),victory:t.useCallback(()=>s("success"),[s]),error:t.useCallback(()=>s("error"),[s]),castle:t.useCallback(()=>!!e&&navigator.vibrate([15,40,15]),[e]),gameStart:t.useCallback(()=>!!e&&navigator.vibrate([10,30,10,30,20]),[e])};return{isSupported:e,vibrate:s,haptics:a}},gt={K:"â™”",Q:"â™•",R:"â™–",B:"â™—",N:"â™˜",P:"â™™",k:"â™š",q:"â™›",r:"â™œ",b:"â™",n:"â™ž",p:"â™Ÿ"},ft=(e,t)=>`${String.fromCharCode(97+t)}${8-e}`,bt=({fen:e,onMove:s,getAvailableMoves:a,isMyTurn:r,myColor:i,whitePalette:n,blackPalette:l,movedSquares:u,disabled:p=!1,onMoveResult:h,enPensentEnabled:x=!1,enPensentOpacity:g=1,moveHistory:f=[],showPieces:b=!0})=>{const[v,y]=t.useState(null),[w,j]=t.useState([]),[N,k]=t.useState(null),C=t.useRef(null),{haptics:M}=xt();let S=null;try{S=o()}catch{}const _=t.useMemo(()=>(e=>e.split(" ")[0].split("/").map(e=>{const t=[];for(const s of e)if(/\d/.test(s))for(let e=0;e<parseInt(s);e++)t.push(null);else t.push(s);return t}))(e),[e]),P="b"===i,T=t.useMemo(()=>{const e=new Map;for(const t of f){const s=e.get(t.square)||[];s.some(e=>e.pieceType===t.piece&&e.pieceColor===t.color)||(s.push({pieceType:t.piece,pieceColor:t.color}),e.set(t.square,s))}return e},[f]),E=e=>e===e.toUpperCase()?"#1a1a1a":"#f5f5f5",$=t.useCallback(async(e,t)=>{var n,l;if(p||!r)return;const o=ft(P?7-e:e,P?7-t:t),c=null==(n=_[P?7-e:e])?void 0:n[P?7-t:t];if(k(o),setTimeout(()=>k(null),150),v&&w.includes(o)){!!(null==(l=_[P?7-e:e])?void 0:l[P?7-t:t])?M.capture():M.move();return void(await s(v,o)?(y(null),j([])):M.error())}if(c){if("w"===i?c===c.toUpperCase():c===c.toLowerCase())return M.select(),y(o),void j(a(o))}y(null),j([])},[_,v,w,r,i,P,p,s,a,M]),O=t.useCallback(e=>{if(!(null==S?void 0:S.setHoveredSquare))return;const t=T.get(e);t&&t.length>0?S.setHoveredSquare({square:e,pieces:t,moveNumbers:[]}):S.setHoveredSquare(null)},[S,T]),A=t.useCallback(()=>{(null==S?void 0:S.setHoveredSquare)&&S.setHoveredSquare(null)},[S]),I=t.useCallback(e=>{if(!S)return!1;const{highlightedPiece:t,lockedPieces:s}=S,a=s.length>0?s:t?[t]:[];if(0===a.length)return!1;for(const r of f)for(const t of a)if(r.square===e&&r.piece===t.pieceType&&r.color===t.pieceColor)return!0;return!1},[S,f]),q=S&&(null!==S.highlightedPiece||S.lockedPieces.length>0);return c.jsxs("div",{className:"w-full max-w-lg mx-auto px-1 sm:px-0",children:[c.jsx("div",{className:"sm:hidden mb-2 text-center",children:c.jsx("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-display uppercase tracking-wider "+(r&&!p?"bg-primary/20 text-primary animate-pulse":"bg-muted text-muted-foreground"),children:p?"Game Over":r?"Your Turn - Tap to Move":"Opponent's Turn"})}),c.jsxs("div",{ref:C,className:"relative grid grid-cols-8 border-2 sm:border-4 border-amber-900 rounded-lg overflow-hidden shadow-2xl touch-manipulation",style:{touchAction:"none"},children:[Array.from({length:64}).map((e,t)=>((e,t)=>{var s;const a=P?7-e:e,i=P?7-t:t,n=ft(a,i),l=null==(s=_[a])?void 0:s[i],o=(e+t)%2==0,d=v===n,h=w.includes(n);u.has(n);const g=N===n,f=T.has(n),y=I(n),j=q&&f&&!y,k=q&&y;return c.jsxs(m.div,{onClick:()=>$(e,t),onMouseEnter:()=>O(n),onMouseLeave:A,onTouchEnd:e=>{x&&f&&(e.stopPropagation(),O(n),setTimeout(()=>A(),2e3))},onTouchStart:e=>{e.stopPropagation()},className:`\n          relative aspect-square cursor-pointer transition-all\n          ${o?"bg-amber-100":"bg-amber-700"}\n          ${d?"ring-4 ring-primary ring-inset z-10":""}\n          ${g?"brightness-125":""}\n          ${!r||p?"cursor-default":""}\n          ${f&&x?"hover:ring-2 hover:ring-amber-400/50":""}\n          ${j?"opacity-30":""}\n          ${k?"ring-2 ring-sky-400/70 z-5":""}\n          touch-manipulation select-none\n        `,style:{WebkitTapHighlightColor:"transparent",transition:"opacity 0.2s ease-out"},whileTap:r&&!p?{scale:.95}:{},children:[h&&c.jsx(m.div,{initial:{scale:0},animate:{scale:1},className:"absolute inset-0 flex items-center justify-center z-20",children:l?c.jsx("div",{className:"absolute inset-1 sm:inset-1.5 rounded-full border-4 sm:border-[5px] border-primary/60"}):c.jsx("div",{className:"w-1/3 h-1/3 sm:w-[30%] sm:h-[30%] rounded-full bg-primary/50"})}),l&&b&&c.jsx(m.div,{layout:!0,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"absolute inset-0 flex items-center justify-center z-10",style:{color:E(l),textShadow:l===l.toUpperCase()?"0 1px 2px rgba(0,0,0,0.3), 0 0 1px rgba(255,255,255,0.8)":"0 1px 2px rgba(0,0,0,0.5), 0 0 1px rgba(0,0,0,0.3)"},children:c.jsx("span",{className:"text-[2.5rem] sm:text-4xl md:text-5xl lg:text-6xl select-none drop-shadow-lg leading-none",children:gt[l]})}),0===t&&c.jsx("span",{className:"absolute top-0.5 left-0.5 sm:left-1 text-[10px] sm:text-xs font-display opacity-50 select-none",children:8-a}),7===e&&c.jsx("span",{className:"absolute bottom-0.5 right-0.5 sm:right-1 text-[10px] sm:text-xs font-display opacity-50 select-none",children:String.fromCharCode(97+i)})]},n)})(Math.floor(t/8),t%8)),c.jsx(d,{moveHistory:f,whitePalette:n,blackPalette:l,opacity:g,isEnabled:x,flipped:P})]}),v&&c.jsx("div",{className:"sm:hidden mt-2 text-center",children:c.jsxs("span",{className:"inline-block px-3 py-1 rounded-full bg-primary/20 text-primary text-xs font-display uppercase tracking-wider",children:[w.length," move",1!==w.length?"s":""," available"]})})]})},vt={capture:{icon:y,color:"text-orange-400",bgColor:"bg-orange-500",borderColor:"border-orange-500/50",label:"Capture",description:"A piece was captured, shifting the material balance.",tacticalInsight:"Material changes can dramatically alter the strategic landscape. Evaluate if this trade favors one side.",emoji:"âš”ï¸"},check:{icon:g,color:"text-yellow-400",bgColor:"bg-yellow-500",borderColor:"border-yellow-500/50",label:"Check",description:"The king is under attack and must escape.",tacticalInsight:"Checks force immediate response, often disrupting the opponent's plans.",emoji:"âš¡"},checkmate:{icon:p,color:"text-red-400",bgColor:"bg-red-500",borderColor:"border-red-500/50",label:"Checkmate",description:"Game over! The king cannot escape.",tacticalInsight:"The ultimate goal achieved. Study the mating pattern for future games.",emoji:"ðŸ‘‘"},castling:{icon:k,color:"text-blue-400",bgColor:"bg-blue-500",borderColor:"border-blue-500/50",label:"Castle",description:"King moves to safety while activating the rook.",tacticalInsight:"A crucial developmental move that addresses king safety and rook activation.",emoji:"ðŸ°"},brilliant:{icon:N,color:"text-cyan-400",bgColor:"bg-cyan-500",borderColor:"border-cyan-500/50",label:"Brilliant",description:"An exceptional move that dramatically improves the position.",tacticalInsight:"Often involves a sacrifice or counterintuitive play that creates winning chances.",emoji:"ðŸ’Ž"},great:{icon:j,color:"text-green-400",bgColor:"bg-green-500",borderColor:"border-green-500/50",label:"Great Move",description:"A strong move that significantly improves the position.",tacticalInsight:"Demonstrates deep understanding of the position's requirements.",emoji:"âœ¨"},blunder:{icon:w,color:"text-red-400",bgColor:"bg-red-600",borderColor:"border-red-600/50",label:"Blunder",description:"A severe error that often loses the game.",tacticalInsight:"Critical mistake to avoid. Study what the better alternative was.",emoji:"âš ï¸"},mistake:{icon:w,color:"text-orange-400",bgColor:"bg-orange-600",borderColor:"border-orange-600/50",label:"Mistake",description:"A clear error that loses material or advantage.",tacticalInsight:"An oversight that changes the evaluation. Consider what was missed.",emoji:"âŒ"},inaccuracy:{icon:y,color:"text-yellow-400",bgColor:"bg-yellow-600",borderColor:"border-yellow-600/50",label:"Inaccuracy",description:"Slightly imprecise, giving up some advantage.",tacticalInsight:"A minor slip. The difference between good and best moves.",emoji:"âšª"},fork:{icon:v,color:"text-purple-400",bgColor:"bg-purple-500",borderColor:"border-purple-500/50",label:"Fork",description:"One piece attacks two or more enemy pieces simultaneously.",tacticalInsight:"A classic double attack. One of the most common tactical patterns.",emoji:"ðŸ”±"},pin:{icon:b,color:"text-indigo-400",bgColor:"bg-indigo-500",borderColor:"border-indigo-500/50",label:"Pin",description:"A piece cannot move without exposing a more valuable piece behind it.",tacticalInsight:"Pins restrict movement and can lead to material wins or positional advantages.",emoji:"ðŸ“Œ"},skewer:{icon:f,color:"text-pink-400",bgColor:"bg-pink-500",borderColor:"border-pink-500/50",label:"Skewer",description:"Attacking a piece through another, forcing it to move.",tacticalInsight:"The reverse of a pin. The more valuable piece must move, exposing the lesser one.",emoji:"ðŸ“"},discovery:{icon:g,color:"text-amber-400",bgColor:"bg-amber-500",borderColor:"border-amber-500/50",label:"Discovery",description:"Moving one piece to reveal an attack from another.",tacticalInsight:"Discovered attacks can be devastating as they create multiple threats.",emoji:"ðŸŽ¯"},sacrifice:{icon:x,color:"text-cyan-400",bgColor:"bg-cyan-600",borderColor:"border-cyan-600/50",label:"Sacrifice",description:"Intentionally giving up material for advantage.",tacticalInsight:"Sacrifices require deep calculation but can lead to brilliant victories.",emoji:"ðŸ’«"},en_passant:{icon:h,color:"text-emerald-400",bgColor:"bg-emerald-500",borderColor:"border-emerald-500/50",label:"En Passant",description:"Special pawn capture immediately after opponent's two-square move.",tacticalInsight:"A unique rule that prevents pawns from escaping capture by advancing two squares.",emoji:"âš¡"},promotion:{icon:p,color:"text-amber-400",bgColor:"bg-amber-500",borderColor:"border-amber-500/50",label:"Promotion",description:"Pawn reaches the eighth rank and transforms.",tacticalInsight:"Promotion often decides the game. Queen promotion is most common.",emoji:"ðŸ‘¸"},underpromotion:{icon:u,color:"text-violet-400",bgColor:"bg-violet-500",borderColor:"border-violet-500/50",label:"Underpromotion",description:"Strategic promotion to knight, bishop, or rook instead of queen.",tacticalInsight:"Rare but sometimes necessary to avoid stalemate or deliver mate.",emoji:"ðŸ†"}};const yt=({moment:e,position:s,totalMoves:a,onClick:r,size:i="md"})=>{const n=vt[e.type],l=n.icon;let d=null;try{d=o()}catch{}const m=e.moveNumber-1,u=Math.floor(m/2)+1,p=m%2==0,h=t.useMemo(()=>function(e,t){if(!e)return null;const s=e.replace(/[+#!?]/g,""),a=t?"w":"b";if("O-O"===s||"O-O-O"===s)return{pieceType:"k",pieceColor:a,targetSquare:"O-O"===s?t?"g1":"g8":t?"c1":"c8",isCapture:!1};const r=s.includes("x");let i,n="p",l=s;/^[KQRBN]/.test(s)&&(n=s[0].toLowerCase(),l=s.slice(1)),l=l.replace("x",""),l.match(/=([QRBN])$/i)&&(l=l.slice(0,-2)),l.length>2&&(i=l.slice(0,-2),l=l.slice(-2));const o=l;return/^[a-h][1-8]$/.test(o)?{pieceType:n,pieceColor:a,targetSquare:o,fromHint:i,isCapture:r}:null}(e.move,p),[e.move,p]),x=t.useMemo(()=>h?{pieceType:h.pieceType,pieceColor:h.pieceColor}:null,[h]),g=t.useMemo(()=>h&&x?{moveNumber:e.moveNumber,san:e.move,piece:x,targetSquare:h.targetSquare,isCapture:h.isCapture}:null,[h,x,e.moveNumber,e.move]),f=t.useCallback(()=>{d&&(g&&d.setHoveredMove(g),x&&d.setHighlightedPiece(x))},[d,g,x]),b=t.useCallback(()=>{d&&(d.setHoveredMove(null),d.setHighlightedPiece(null))},[d]),v=t.useCallback(()=>{d&&(d.setHoveredMove(null),d.setHighlightedPiece(null)),r(e.moveNumber)},[r,e.moveNumber,d]),w=e.quality?C[e.quality]:null;return c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx("button",{onMouseEnter:f,onMouseLeave:b,onClick:v,className:`absolute -translate-x-1/2 -top-1 ${{sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"}[i]} rounded-full ${n.bgColor} \n            flex items-center justify-center cursor-pointer\n            hover:scale-125 transition-all duration-200 shadow-lg ring-1 ring-black/20\n            ${"white"===e.player?"ring-white/30":"ring-black/50"}\n            hover:ring-2 hover:ring-primary/50`,style:{left:`${s}%`},children:c.jsx(l,{className:`${{sm:"w-2 h-2",md:"w-2.5 h-2.5",lg:"w-3 h-3"}[i]} text-white`})})}),c.jsxs(_,{side:"top",className:"max-w-[300px] p-0 overflow-hidden",onPointerDownOutside:e=>e.preventDefault(),children:[c.jsx("div",{className:`${n.bgColor} px-3 py-2`,children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-lg",children:n.emoji}),c.jsx(l,{className:"w-4 h-4 text-white"}),c.jsx("span",{className:"font-semibold text-white",children:n.label}),c.jsx(P,{variant:"outline",className:"ml-auto text-[9px] bg-white/20 border-white/30 text-white",children:"white"===e.player?"White":"Black"})]})}),c.jsxs("div",{className:"p-3 space-y-3 bg-popover",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2.5 h-2.5 rounded-full "+("white"===e.player?"bg-sky-400":"bg-rose-400")}),c.jsxs("span",{className:"font-mono text-sm font-medium",children:[u,".",p?"":".."," ",e.move]}),h&&c.jsxs(P,{variant:"secondary",className:"text-[9px] gap-1",children:[c.jsx(T,{className:"w-2.5 h-2.5"}),h.targetSquare]})]}),c.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:e.description||n.description}),c.jsxs("div",{className:`text-xs p-2 rounded-md border ${n.borderColor} bg-muted/30`,children:[c.jsxs("div",{className:"font-medium text-muted-foreground mb-1 flex items-center gap-1",children:[c.jsx(N,{className:"w-3 h-3"}),"Tactical Insight"]}),c.jsx("p",{className:"leading-relaxed",children:n.tacticalInsight})]}),w&&c.jsxs("div",{className:"flex items-center gap-2 pt-1 border-t border-border/50",children:[c.jsx("span",{className:"text-xs text-muted-foreground",children:"Engine Analysis:"}),c.jsxs(P,{style:{backgroundColor:w.color},className:"text-white text-[10px]",children:[w.symbol," ",w.label]})]}),e.tactic&&c.jsxs("div",{className:"pt-2 border-t border-border/50",children:[c.jsx("div",{className:"text-[10px] font-medium text-muted-foreground mb-1.5",children:"Tactical Details"}),c.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 text-xs",children:[c.jsx("span",{className:"text-muted-foreground",children:"Attacker:"}),c.jsxs("span",{className:"font-mono",children:[e.tactic.attacker.piece.toUpperCase()," @ ",e.tactic.attacker.square]}),c.jsx("span",{className:"text-muted-foreground",children:"Targets:"}),c.jsx("span",{className:"font-mono text-[10px]",children:e.tactic.targets.map(e=>`${e.piece.toUpperCase()}@${e.square}`).join(", ")}),e.tactic.value&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-muted-foreground",children:"Value:"}),c.jsxs("span",{className:"text-primary font-medium",children:[e.tactic.value," cp"]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-2 pt-1 text-[9px] text-muted-foreground/70",children:[c.jsxs("div",{className:"flex-1 flex items-center gap-1",children:[c.jsx(y,{className:"w-2.5 h-2.5"}),c.jsx("span",{children:"Hover highlights board"})]}),c.jsx("span",{className:"text-primary/70",children:"Click to jump"})]})]})]})]})},wt={capture:{icon:y,color:"bg-orange-500 text-orange-400",label:"Capture",description:"A piece was captured, shifting material balance.",tactical:"Captures often open new tactical opportunities and change the positional landscape of the game.",emoji:"âš”ï¸"},check:{icon:g,color:"bg-yellow-500 text-yellow-400",label:"Check",description:"The king is under direct attack!",tactical:"The opponent must immediately respond to escape the threat. Checks can disrupt plans and force defensive moves.",emoji:"âš¡"},checkmate:{icon:p,color:"bg-red-500 text-red-400",label:"Checkmate",description:"Game over! The king cannot escape.",tactical:"The ultimate goal of chess. The king is in check with no legal moves to escape.",emoji:"ðŸ‘‘"},castling:{icon:k,color:"bg-blue-500 text-blue-400",label:"Castle",description:"King moves to safety, rook activates.",tactical:"A crucial defensive and developmental move. Protects the king while connecting the rooks.",emoji:"ðŸ°"},promotion:{icon:p,color:"bg-purple-500 text-purple-400",label:"Promotion",description:"Pawn promoted to a powerful piece!",tactical:"A pawn reaching the 8th rank transforms into a queen, rook, bishop, or knight. Usually decisive.",emoji:"âœ¨"}},jt={opening:{name:"Opening",description:"The first 10-15 moves where players develop pieces and fight for center control.",tips:"Control the center, develop pieces, castle early, connect rooks.",icon:L,color:"text-emerald-400",bgColor:"bg-emerald-500/20",borderColor:"border-emerald-500/30"},middlegame:{name:"Middlegame",description:"The strategic battle where tactics, attacks, and positional play dominate.",tips:"Create threats, improve piece activity, target weaknesses.",icon:R,color:"text-amber-400",bgColor:"bg-amber-500/20",borderColor:"border-amber-500/30"},endgame:{name:"Endgame",description:"Few pieces remain. King becomes active, passed pawns are crucial.",tips:"Activate the king, create passed pawns, simplify if ahead.",icon:p,color:"text-purple-400",bgColor:"bg-purple-500/20",borderColor:"border-purple-500/30"}};const Nt=({totalMoves:e,moves:s=[],moveHistory:a=[],currentMove:r,onMoveChange:i,compact:n=!1,vertical:l=!1})=>{var o;const[d,u]=t.useState(!1),[h,x]=t.useState(500),[f,b]=t.useState(!1),[v,w]=t.useState(!0),j=t.useMemo(()=>function(e,t){const s=[];return(e.length>0?e:(null==t?void 0:t.map(()=>""))||[]).forEach((e,t)=>{const a=t+1,r=t%2==0?"white":"black";e.includes("#")?s.push({moveNumber:a,type:"checkmate",move:e,player:r}):e.includes("+")&&s.push({moveNumber:a,type:"check",move:e,player:r}),e.includes("x")&&s.push({moveNumber:a,type:"capture",move:e,player:r}),(e.includes("O-O")||e.includes("0-0"))&&s.push({moveNumber:a,type:"castling",move:e,player:r}),e.includes("=")&&s.push({moveNumber:a,type:"promotion",move:e,player:r})}),s}(s,a),[s,a]),N=t.useMemo(()=>function(e){if(0===e)return[];const t=[],s=Math.min(Math.floor(.25*e),30),a=Math.max(Math.floor(.7*e),Math.min(60,e));return t.push({name:"opening",startMove:1,endMove:s,color:"text-emerald-400",bgColor:"bg-emerald-500/20",icon:L,description:"Development & center control"}),s<a-1&&t.push({name:"middlegame",startMove:s+1,endMove:a-1,color:"text-amber-400",bgColor:"bg-amber-500/20",icon:R,description:"Tactics & attacks"}),a<=e&&t.push({name:"endgame",startMove:a,endMove:e,color:"text-purple-400",bgColor:"bg-purple-500/20",icon:p,description:"King activation & pawns"}),t}(e),[e]);t.useMemo(()=>N.find(e=>r>=e.startMove&&r<=e.endMove),[N,r]);const C=t.useCallback(t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target.isContentEditable))switch(t.key){case" ":t.preventDefault(),r>=e&&i(0),u(e=>!e),w(!1);break;case"ArrowRight":t.preventDefault(),r<e&&i(r+1),w(!1);break;case"ArrowLeft":t.preventDefault(),r>0&&i(r-1),w(!1);break;case"Home":t.preventDefault(),u(!1),i(0);break;case"End":t.preventDefault(),u(!1),i(e)}},[r,e,i]);t.useEffect(()=>(window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)),[C]),t.useEffect(()=>{if(!d)return;const t=setInterval(()=>{i(r>=e?e:r+1),r>=e&&u(!1)},h);return()=>clearInterval(t)},[d,r,e,h,i]);const P=[{label:"0.25x",value:2e3},{label:"0.5x",value:1e3},{label:"1x",value:500},{label:"2x",value:250},{label:"4x",value:125}],T=(null==(o=P.find(e=>e.value===h))?void 0:o.label)||"1x",se=0===r||r>=e?null:r%2==1?"white":"black",ae=t.useMemo(()=>{const e={capture:0,check:0,checkmate:0,castling:0,promotion:0};return j.forEach(t=>e[t.type]++),e},[j]),re=t.useMemo(()=>{const e={capture:[],check:[],checkmate:[],castling:[],promotion:[]};return j.forEach(t=>e[t.type].push(t)),e},[j]),ie=e=>{const t=e.moveNumber-1;return`${Math.floor(t/2)+1}.${t%2==0?"":".."} ${e.move}`};return 0===e?null:f?c.jsxs("button",{onClick:()=>b(!1),className:"flex items-center gap-2 p-2 rounded-lg bg-card/80 backdrop-blur-sm border border-border/50 hover:bg-accent/30 transition-colors",children:[c.jsx(E,{className:"w-3 h-3 text-primary"}),c.jsx("span",{className:"text-xs font-display uppercase tracking-wider",children:"Timeline"}),c.jsx($,{className:"w-3 h-3"})]}):c.jsx(O,{children:c.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card/80 backdrop-blur-sm rounded-lg border border-border/50 p-3 space-y-3 "+(n?"max-w-xs":""),children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] font-display font-semibold uppercase tracking-widest text-muted-foreground",children:"Timeline"}),se&&c.jsx("div",{className:"w-2 h-2 rounded-full "+("white"===se?"bg-sky-400":"bg-rose-400")})]}),c.jsx("button",{onClick:()=>b(!0),className:"p-1 rounded hover:bg-accent/50 transition-colors",children:c.jsx(A,{className:"w-3 h-3 text-muted-foreground"})})]}),j.length>0&&c.jsxs("div",{className:"flex items-center gap-3 text-[10px] flex-wrap",children:[c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs("span",{className:"text-muted-foreground flex items-center gap-1 cursor-help",children:[c.jsx(I,{className:"w-3 h-3"}),"Key moments:"]})}),c.jsx(_,{className:"max-w-[220px] p-3",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"font-semibold",children:"Key Moments"}),c.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Critical events that shaped the game. Click any marker on the timeline to jump directly to that moment."}),c.jsx("p",{className:"text-[10px] text-primary italic",children:"ðŸ’¡ Hover over icons for details"})]})})]}),c.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:Object.entries(ae).map(([e,t])=>{if(0===t)return null;const s=wt[e],a=s.icon;return c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs("button",{className:`flex items-center gap-1 ${s.color.split(" ")[1]} hover:scale-110 transition-transform cursor-help`,children:[c.jsx(a,{className:"w-3 h-3"}),c.jsx("span",{children:t})]})}),c.jsx(_,{side:"bottom",className:"max-w-[240px] p-3",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[c.jsx("span",{className:"text-lg",children:s.emoji}),c.jsx(a,{className:`w-4 h-4 ${s.color.split(" ")[1]}`}),s.label]}),c.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:s.description}),c.jsx("p",{className:"text-xs leading-relaxed border-t border-border/50 pt-2",children:s.tactical}),c.jsxs("p",{className:"text-[10px] text-primary mt-1 font-medium",children:[t," occurrence",1!==t?"s":""," in this game"]})]})})]},e)})})]}),N.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx("span",{className:"text-muted-foreground flex items-center gap-1 cursor-help",children:c.jsx(q,{className:"w-3 h-3"})})}),c.jsx(_,{className:"max-w-[220px] p-3",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"font-semibold",children:"Game Phases"}),c.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Click any phase to jump to its starting position. View how the game evolved through each stage."})]})})]}),c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(D,{variant:r>=e?"secondary":"ghost",size:"sm",className:"h-6 px-2 text-[10px] font-medium",onClick:()=>i(e),children:"All Moves"})}),c.jsx(_,{className:"max-w-[200px] p-3",children:c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:"font-semibold",children:"All Moves"}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:["Show the complete visualization with all ",e," moves."]})]})})]}),N.map(t=>{const s=jt[t.name],a=s.icon,n=r>=t.startMove&&r<=t.endMove&&r<e;return c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs(D,{variant:n?"secondary":"ghost",size:"sm",className:`h-6 px-2 text-[10px] font-medium gap-1 ${n?s.bgColor:""}`,onClick:()=>i(t.startMove),children:[c.jsx(a,{className:`w-3 h-3 ${s.color}`}),c.jsx("span",{className:"hidden sm:inline capitalize",children:t.name})]})}),c.jsx(_,{className:"max-w-[240px] p-3",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[c.jsx(a,{className:`w-4 h-4 ${s.color}`}),s.name]}),c.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:s.description}),c.jsx("p",{className:"text-xs leading-relaxed border-t border-border/50 pt-2",children:s.tips}),c.jsxs("p",{className:"text-[10px] text-primary mt-1 font-medium",children:["Moves ",t.startMove," - ",t.endMove]}),c.jsxs("p",{className:"text-[10px] text-primary italic",children:["Click to jump to start of ",t.name]})]})})]},t.name)})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("div",{className:"text-sm font-medium",children:(()=>{if(r>=e||r===1/0)return`All ${e} moves`;if(0===r)return"Start";const t=r-1;if(s[t]){return`${Math.floor(t/2)+1}.${t%2==0?"":".."} ${s[t]}`}return`Move ${r}`})()}),c.jsxs("div",{className:"text-xs text-muted-foreground",children:[r>=e?e:r," / ",e]})]}),c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-x-0 top-0 h-5 pointer-events-none z-10",children:j.slice(0,20).map((t,s)=>{const a=t.moveNumber/e*100,r={moveNumber:t.moveNumber,type:t.type,move:t.move,player:t.player};return c.jsx("div",{className:"pointer-events-auto",children:c.jsx(yt,{moment:r,position:a,totalMoves:e,onClick:i,size:"md"})},`${t.moveNumber}-${t.type}-${s}`)})}),c.jsx(z,{value:[Math.min(r,e)],min:0,max:e,step:1,onValueChange:e=>{i(e[0])},className:"w-full mt-2"})]}),c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{u(!1),i(e)},className:"h-8 w-8 p-0",children:c.jsx(H,{className:"h-4 w-4"})})}),c.jsx(_,{className:"max-w-[200px] p-3",children:c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:"font-semibold",children:"Show Complete Vision"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Reset to display all moves, revealing the full artistic pattern. Press End."}),c.jsx("p",{className:"text-[10px] text-primary italic",children:"ðŸ’¡ Complete visions have higher collector value"})]})})]}),c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{r>0&&i(r-1)},disabled:r<=0,className:"h-8 w-8 p-0",children:c.jsx(F,{className:"h-4 w-4"})})}),c.jsx(_,{className:"max-w-[200px] p-3",children:c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:"font-semibold",children:"Previous Move"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Step back through the game's evolution. Use â† arrow key."}),c.jsx("p",{className:"text-[10px] text-primary italic",children:"ðŸ’¡ Watch patterns emerge in reverse"})]})})]}),c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(D,{variant:d?"secondary":"default",size:"sm",onClick:()=>{r>=e&&i(0),u(!d),w(!1)},className:"h-10 w-10 p-0 rounded-full",children:d?c.jsx(G,{className:"h-5 w-5"}):c.jsx(E,{className:"h-5 w-5 ml-0.5"})})}),c.jsx(_,{className:"max-w-[220px] p-3",children:c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:"font-semibold",children:d?"Pause Animation":"Animate Vision"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:d?"Freeze the current state for analysis or capture.":"Watch the visualization build move-by-move, revealing the game's story."}),c.jsx("p",{className:"text-[10px] text-primary italic",children:"âŒ¨ï¸ Press Space to toggle"})]})})]}),c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{r<e&&i(r+1)},disabled:r>=e,className:"h-8 w-8 p-0",children:c.jsx(B,{className:"h-4 w-4"})})}),c.jsx(_,{className:"max-w-[200px] p-3",children:c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:"font-semibold",children:"Next Move"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Advance through the game. Use â†’ arrow key."}),c.jsx("p",{className:"text-[10px] text-primary italic",children:"ðŸ’¡ Each move adds new layers to the art"})]})})]}),c.jsxs(Y,{children:[c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(V,{asChild:!0,children:c.jsxs(D,{variant:"ghost",size:"sm",className:"h-8 px-2 gap-1 text-xs",children:[c.jsx(U,{className:"h-3 w-3"}),T]})})}),c.jsx(_,{children:c.jsx("p",{className:"text-xs",children:"Playback speed"})})]}),c.jsx(W,{align:"end",className:"bg-popover",children:P.map(e=>c.jsx(X,{onClick:()=>x(e.value),className:h===e.value?"bg-accent":"",children:e.label},e.value))})]}),j.length>0&&c.jsxs(Y,{children:[c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsx(V,{asChild:!0,children:c.jsxs(D,{variant:"ghost",size:"sm",className:"h-8 px-2 gap-1 text-xs",children:[c.jsx(nt,{className:"h-3 w-3"}),c.jsx("span",{className:"hidden sm:inline",children:"Jump"})]})})}),c.jsx(_,{children:c.jsx("p",{className:"text-xs",children:"Jump to key moment"})})]}),c.jsxs(W,{align:"end",className:"w-56 bg-popover max-h-80 overflow-y-auto",children:[c.jsx(K,{className:"text-xs text-muted-foreground",children:"Jump to Key Moment"}),c.jsx(J,{}),re.capture.length>0&&c.jsxs(Q,{children:[c.jsxs(Z,{className:"flex items-center gap-2",children:[c.jsx(y,{className:"h-3.5 w-3.5 text-orange-400"}),c.jsx("span",{children:"Captures"}),c.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:re.capture.length})]}),c.jsx(ee,{className:"bg-popover max-h-60 overflow-y-auto",children:re.capture.map((e,t)=>c.jsxs(X,{onClick:()=>i(e.moveNumber),className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full "+("white"===e.player?"bg-sky-400":"bg-rose-400")}),c.jsx("span",{className:"font-mono text-xs",children:ie(e)})]},`capture-${t}`))})]}),re.check.length>0&&c.jsxs(Q,{children:[c.jsxs(Z,{className:"flex items-center gap-2",children:[c.jsx(g,{className:"h-3.5 w-3.5 text-yellow-400"}),c.jsx("span",{children:"Checks"}),c.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:re.check.length})]}),c.jsx(ee,{className:"bg-popover max-h-60 overflow-y-auto",children:re.check.map((e,t)=>c.jsxs(X,{onClick:()=>i(e.moveNumber),className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full "+("white"===e.player?"bg-sky-400":"bg-rose-400")}),c.jsx("span",{className:"font-mono text-xs",children:ie(e)})]},`check-${t}`))})]}),re.castling.length>0&&c.jsxs(Q,{children:[c.jsxs(Z,{className:"flex items-center gap-2",children:[c.jsx(k,{className:"h-3.5 w-3.5 text-blue-400"}),c.jsx("span",{children:"Castling"}),c.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:re.castling.length})]}),c.jsx(ee,{className:"bg-popover max-h-60 overflow-y-auto",children:re.castling.map((e,t)=>c.jsxs(X,{onClick:()=>i(e.moveNumber),className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full "+("white"===e.player?"bg-sky-400":"bg-rose-400")}),c.jsx("span",{className:"font-mono text-xs",children:ie(e)})]},`castling-${t}`))})]}),re.promotion.length>0&&c.jsxs(Q,{children:[c.jsxs(Z,{className:"flex items-center gap-2",children:[c.jsx(p,{className:"h-3.5 w-3.5 text-purple-400"}),c.jsx("span",{children:"Promotions"}),c.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:re.promotion.length})]}),c.jsx(ee,{className:"bg-popover max-h-60 overflow-y-auto",children:re.promotion.map((e,t)=>c.jsxs(X,{onClick:()=>i(e.moveNumber),className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full "+("white"===e.player?"bg-sky-400":"bg-rose-400")}),c.jsx("span",{className:"font-mono text-xs",children:ie(e)})]},`promotion-${t}`))})]}),re.checkmate.length>0&&c.jsxs(c.Fragment,{children:[c.jsx(J,{}),re.checkmate.map((e,t)=>c.jsxs(X,{onClick:()=>i(e.moveNumber),className:"flex items-center gap-2 text-red-400",children:[c.jsx(p,{className:"h-3.5 w-3.5"}),c.jsx("span",{className:"font-semibold",children:"Checkmate!"}),c.jsx("span",{className:"font-mono text-xs ml-auto",children:ie(e)})]},`checkmate-${t}`))]})]})]})]}),c.jsx(te,{children:v&&c.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-center justify-center gap-2 text-[10px] text-muted-foreground",children:[c.jsx(it,{className:"w-3 h-3"}),c.jsx("span",{children:"Space: Play/Pause â€¢ â†/â†’: Step â€¢ Home/End: Jump"})]})}),c.jsx(te,{children:d&&c.jsx(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:4},exit:{opacity:0,height:0},className:"bg-muted rounded-full overflow-hidden",children:c.jsx(m.div,{className:"h-full bg-gradient-to-r from-sky-500 via-purple-500 to-rose-500",style:{width:r/e*100+"%"},transition:{duration:.1}})})})]})})},kt=({oldRating:e,newRating:s,isWin:a,isDraw:r,show:i,signature:n})=>{const[l,o]=t.useState(e),[d,h]=t.useState(!1),[x,g]=t.useState(!1),f=se(n),b=s-e,v=Ke(e),y=Ke(s),w=v.name!==y.name;t.useEffect(()=>{if(!i)return o(e),h(!1),void g(!1);const t=setTimeout(()=>h(!0),500),a=s-e;let r=0;const n=setInterval(()=>{r++;const t=r/30,i=1-Math.pow(1-t,3),l=Math.round(e+a*i);o(l),r>=30&&(clearInterval(n),o(s),g(!0))},50);return()=>{clearTimeout(t),clearInterval(n)}},[i,e,s]);return c.jsx(te,{children:i&&c.jsxs(m.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{duration:.4,ease:"easeOut"},className:"p-6 rounded-xl border border-primary/30 bg-gradient-to-br from-primary/10 via-card to-primary/5 backdrop-blur-sm relative overflow-hidden",style:{borderColor:n?`${f.dominantColor}40`:void 0,boxShadow:n?`0 0 ${30*f.intensity}px ${f.dominantColor}30`:void 0},children:[n&&c.jsx(m.div,{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(circle at 50% 50%, ${f.dominantColor}15, transparent 70%)`},animate:{opacity:[.3,.6,.3],scale:[1,1.1,1]},transition:{duration:3,repeat:1/0}}),c.jsxs(m.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex items-center justify-center gap-3 mb-6",children:[a?c.jsx(u,{className:"h-8 w-8 text-yellow-500"}):r?c.jsx(ae,{className:"h-8 w-8 text-blue-400"}):null,c.jsx("h3",{className:"text-xl font-display font-bold uppercase tracking-wider",children:a?"Victory!":r?"Draw":"Defeat"})]}),c.jsxs("div",{className:"flex items-center justify-center gap-8",children:[c.jsxs(m.div,{className:"text-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3},children:[c.jsx("p",{className:"text-xs text-muted-foreground font-display uppercase tracking-wider mb-2",children:"Rating"}),c.jsx(m.div,{className:`text-5xl font-bold font-display bg-gradient-to-r ${Ke(l).color} bg-clip-text text-transparent`,children:l},l),c.jsx(m.p,{className:"text-sm font-display mt-2 uppercase tracking-wider "+(w&&x?"text-primary":"text-muted-foreground"),animate:w&&x?{scale:[1,1.1,1]}:{},transition:{duration:.3},children:Ke(l).name})]}),c.jsx(te,{children:d&&c.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0},transition:{type:"spring",stiffness:300,damping:25},className:"flex items-center gap-2 px-4 py-2 rounded-full bg-card border border-border/50 "+(b>0?"text-green-500":b<0?"text-red-500":"text-muted-foreground"),children:[b>0?c.jsx(j,{className:"h-6 w-6"}):b<0?c.jsx(re,{className:"h-6 w-6"}):c.jsx(ae,{className:"h-6 w-6"}),c.jsxs("span",{className:"text-2xl font-bold font-mono",children:[b>0?"+":"",b]})]})})]}),c.jsx(te,{children:w&&x&&c.jsxs(m.div,{initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},exit:{opacity:0},transition:{delay:.5,type:"spring",stiffness:200},className:"mt-6 text-center",children:[c.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/30",children:[c.jsx(p,{className:"h-5 w-5 text-primary"}),c.jsx("span",{className:"font-display font-bold uppercase tracking-wider text-primary",children:b>0?"Rank Up!":"Rank Down"})]}),c.jsxs("p",{className:"text-sm text-muted-foreground mt-2 font-serif",children:[v.name," â†’ ",y.name]})]})}),a&&x&&c.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 pointer-events-none overflow-hidden rounded-xl",children:[...Array(8)].map((e,t)=>c.jsx(m.div,{className:"absolute w-2 h-2 rounded-full bg-primary/60",initial:{x:"50%",y:"50%",scale:0},animate:{x:20+60*Math.random()+"%",y:10+80*Math.random()+"%",scale:[0,1,0],opacity:[0,1,0]},transition:{duration:1.5,delay:.8+.1*t,ease:"easeOut"}},t))})]})})},Ct=()=>{const{enabled:e,volume:t,setEnabled:s,setVolume:a}=ut(),r=e&&0!==t?t<.5?lt:ot:ct;return c.jsxs(ie,{children:[c.jsx(ne,{asChild:!0,children:c.jsxs(D,{variant:"outline",size:"icon",className:"relative h-9 w-9","aria-label":"Sound settings",children:[c.jsx(r,{className:"h-4 w-4"}),!e&&c.jsx("span",{className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-destructive"})]})}),c.jsxs(le,{className:"w-64 p-4 space-y-4",align:"end",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm font-display uppercase tracking-wider",children:"Game Sounds"}),c.jsx(oe,{checked:e,onCheckedChange:s,"aria-label":"Toggle sounds"})]}),c.jsx(te,{children:e&&c.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground font-serif",children:"Volume"}),c.jsxs("span",{className:"font-mono text-xs text-muted-foreground",children:[Math.round(100*t),"%"]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(ct,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),c.jsx(z,{value:[t],onValueChange:([e])=>a(e),min:0,max:1,step:.05,className:"flex-1","aria-label":"Volume"}),c.jsx(ot,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]}),c.jsx("div",{className:"pt-2 border-t border-border/50",children:c.jsx("p",{className:"text-xs text-muted-foreground font-serif",children:"Sounds include moves, captures, check, checkmate, and game results."})})]})})]})]})},Mt=({isEnabled:e,onToggle:t,totalMoves:s,showPieces:a=!0,onShowPiecesToggle:r,signature:i})=>{const n=se(i);return c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(O,{children:c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs(m.button,{onClick:t,className:`\n                relative overflow-hidden\n                flex items-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5\n                rounded-full font-display text-xs sm:text-sm uppercase tracking-wider\n                transition-all duration-300 touch-manipulation\n                ${e?"bg-gradient-to-r from-primary via-primary/90 to-primary text-primary-foreground shadow-lg shadow-primary/30":"bg-muted/80 text-muted-foreground hover:bg-muted border border-border/50"}\n              `,style:e&&i?{background:`linear-gradient(135deg, ${n.dominantColor}, ${n.secondaryColor})`,boxShadow:`0 4px 20px ${n.dominantColor}40`}:void 0,whileTap:{scale:.95},children:[e&&c.jsx(m.div,{className:"absolute inset-0",style:{background:i?`linear-gradient(90deg, transparent, ${n.secondaryColor}40, transparent)`:"linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent)"},animate:{x:["-100%","200%"]},transition:{duration:2,repeat:1/0,repeatDelay:3}}),c.jsx(te,{mode:"wait",children:e?c.jsx(m.div,{initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:180,opacity:0},transition:{duration:.2},children:c.jsx(N,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})},"on"):c.jsx(m.div,{initial:{rotate:180,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:-180,opacity:0},transition:{duration:.2},children:c.jsx(ce,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})},"off")}),c.jsx("span",{className:"relative z-10 hidden sm:inline",children:"En Pensent"}),c.jsx("span",{className:"relative z-10 sm:hidden",children:"Art"}),e&&s>0&&c.jsx(m.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full bg-background text-foreground text-[10px] font-bold border border-border shadow-sm",children:s})]})}),c.jsx(_,{side:"bottom",children:c.jsxs("p",{children:[e?"Hide":"Show"," En Pensent Art"]})})]})}),r&&c.jsx(O,{children:c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs(D,{variant:a?"default":"outline",size:"sm",onClick:r,className:`\n                  gap-1.5 h-9 sm:h-10 px-3 sm:px-4 rounded-full touch-manipulation font-display text-xs uppercase tracking-wider\n                  ${a?"bg-foreground text-background hover:bg-foreground/90":"border-border/50"}\n                `,children:[a?c.jsx(ce,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):c.jsx(de,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),c.jsx("span",{className:"hidden sm:inline",children:"Pieces"})]})}),c.jsx(_,{side:"bottom",children:c.jsxs("p",{children:[a?"Hide":"Show"," Chess Pieces"]})})]})})]})},St=({isOpen:e,onClose:s,moveHistory:a,whitePalette:i,blackPalette:n,gameInfo:o,visualizationId:u,pgn:h,signature:x=null})=>{const g=me(),{user:f,isPremium:b,isCheckingSubscription:v}=r(),{setOrderData:y}=ue(),{captureState:w,darkMode:j,setDarkMode:k,showPieces:C,pieceOpacity:M}=pe(),{setCapturedTimelineState:S,setReturningFromOrder:_}=he(),P=t.useRef(null),[T,E]=t.useState(j),[$,O]=t.useState(!1),[A,I]=t.useState(""),[q,R]=t.useState(!1),[L,z]=t.useState(!1);se(x);const H=t.useMemo(()=>x?xe(x):null,[x]),F=t.useCallback(e=>{E(e),k(e)},[k]);t.useEffect(()=>{e&&E(j)},[e,j]),t.useEffect(()=>{e&&(async()=>{try{const e=await et.toDataURL("https://enpensent.com",{width:80,margin:1,color:{dark:"#1A1A1A",light:"transparent"},errorCorrectionLevel:"M"});I(e)}catch(e){}})()},[e]);const G=async e=>{if(e&&!b)return void R(!0);if(!P.current)return;O(!0);const t=!e&&(!b||v);try{await new Promise(e=>setTimeout(e,200));const s=await Ze(P.current,{scale:4,useCORS:!0,allowTaint:!0,backgroundColor:T?"#0A0A0A":"#FDFCFB",logging:!1});if(t){const e=s.getContext("2d");if(e){e.save(),e.globalAlpha=.15,e.fillStyle=T?"#FFFFFF":"#000000",e.font="bold 32px Inter, sans-serif",e.textAlign="center",e.textBaseline="middle";const t=s.width/2,a=s.height/2;e.translate(t,a),e.rotate(-Math.PI/6),e.fillText("EN PENSENT",0,-40),e.fillText("enpensent.com",0,20),e.restore(),e.globalAlpha=.6,e.fillStyle=T?"#FFFFFF":"#000000",e.font="14px Inter, sans-serif",e.textAlign="right",e.fillText("enpensent.com",s.width-20,s.height-20)}}const a=s.toDataURL("image/png",1),r=`EnPensent-${o.white}-vs-${o.black}-${T?"dark":"light"}${e?"-HD":"-preview"}.png`,i=await fetch(a),n=await i.blob(),c=URL.createObjectURL(n),d=document.createElement("a");d.href=c,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),setTimeout(()=>URL.revokeObjectURL(c),1e3),l.success(e?"HD image downloaded!":"Preview downloaded!",{description:t?"Includes En Pensent branding.":void 0}),e&&u&&Te(u,"download_hd")}catch(s){l.error("Download failed")}finally{O(!1)}};return c.jsxs(ge,{open:e,onOpenChange:s,children:[c.jsxs(fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(be,{children:[c.jsxs(ve,{className:"flex items-center gap-2 font-display text-xl",children:[c.jsx(N,{className:"h-5 w-5 text-primary"}),"Export En Pensent Visualization"]}),c.jsx(ye,{children:"Your game has been transformed into a unique piece of chess art. Download or order a print!"})]}),c.jsxs("div",{className:"flex justify-center gap-2 py-2",children:[c.jsxs(D,{variant:T?"outline":"default",size:"sm",onClick:()=>F(!1),className:"gap-2 text-xs",children:[c.jsx(tt,{className:"h-3 w-3"}),"Light"]}),c.jsxs(D,{variant:T?"default":"outline",size:"sm",onClick:()=>F(!0),className:"gap-2 text-xs",children:[c.jsx(st,{className:"h-3 w-3"}),"Dark"]})]}),c.jsx("div",{className:"flex justify-center py-4",children:c.jsxs("div",{ref:P,className:"p-6 md:p-8 rounded-sm border shadow-2xl transition-colors "+(T?"bg-[#0A0A0A] border-stone-800":"bg-[#FDFCFB] border-stone-200"),style:{maxWidth:"420px"},children:[c.jsxs("div",{className:"relative w-64 h-64 md:w-80 md:h-80","data-board-container":"true",children:[c.jsx("div",{className:"absolute inset-0 grid grid-cols-8 grid-rows-8",children:Array.from({length:64}).map((e,t)=>{const s=(Math.floor(t/8)+t%8)%2==0;return c.jsx("div",{className:""+(s?"bg-stone-200":"bg-stone-600")},t)})}),c.jsx(d,{moveHistory:a,whitePalette:i,blackPalette:n,opacity:.85,isEnabled:!0,flipped:!1}),C&&h&&c.jsx("div",{className:"absolute inset-0",children:c.jsx(we,{pgn:h,currentMoveNumber:o.totalMoves,size:"undefined"!=typeof window&&window.innerWidth>=768?320:256,pieceOpacity:M})})]}),c.jsx("div",{className:"mt-6 pt-4 border-t "+(T?"border-stone-800":"border-stone-200"),children:c.jsxs("div",{className:"text-center max-w-md mx-auto space-y-3",children:[c.jsxs("h1",{className:"text-xl md:text-2xl font-semibold tracking-wide "+(T?"text-stone-100":"text-stone-800"),style:{fontFamily:"'Cinzel', 'Times New Roman', serif"},children:[c.jsx("span",{children:o.white}),c.jsx("span",{className:"mx-2 font-normal italic text-lg "+(T?"text-stone-500":"text-stone-400"),style:{fontFamily:"'Cormorant', Georgia, serif"},children:"vs"}),c.jsx("span",{children:o.black})]}),c.jsx("h2",{className:"text-sm md:text-base italic "+(T?"text-stone-400":"text-stone-500"),style:{fontFamily:"'Cormorant', Georgia, serif"},children:"Chess Game"}),c.jsxs("p",{className:"text-xs uppercase tracking-[0.15em] "+(T?"text-stone-500":"text-stone-400"),style:{fontFamily:"'Inter', sans-serif"},children:[o.totalMoves," moves â€¢ ",o.result||"Game Finished",H&&c.jsxs("span",{className:"ml-2 text-primary",children:["â€¢ ",H]})]})]})}),c.jsx("p",{className:"text-center mt-4 text-[10px] tracking-[0.3em] uppercase font-medium "+(T?"text-stone-500":"text-stone-400"),style:{fontFamily:"'Inter', system-ui, sans-serif"},children:"â™” En Pensent â™š"})]})}),c.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[c.jsxs(D,{onClick:()=>G(!1),disabled:$,variant:"outline",className:"gap-2",children:[$?c.jsx(je,{className:"h-4 w-4 animate-spin"}):c.jsx(Ne,{className:"h-4 w-4"}),"Download Preview"]}),c.jsxs(D,{onClick:()=>G(!0),disabled:$,className:"gap-2 btn-luxury",children:[$?c.jsx(je,{className:"h-4 w-4 animate-spin"}):b?c.jsx(Ne,{className:"h-4 w-4"}):c.jsx(p,{className:"h-4 w-4"}),b?"Download HD":"HD Download",!b&&c.jsx("span",{className:"text-xs opacity-75",children:"Premium"})]})]}),c.jsx("div",{className:"flex justify-center",children:c.jsxs(D,{variant:"outline",size:"sm",className:"gap-2 text-xs",onClick:()=>{const e=h?Ce(h,o.totalMoves):Me;navigator.clipboard.writeText(e),l.success("FEN copied to clipboard!",{description:"You can paste this position in any chess software."})},children:[c.jsx(ke,{className:"h-3 w-3"}),"Copy Final Position (FEN)"]})}),c.jsx(m.div,{className:"flex justify-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:c.jsxs(D,{onClick:()=>{const e=w(a),t=`${o.white} vs ${o.black}`;S({currentMove:e.currentMove,totalMoves:a.length,title:t,lockedPieces:e.lockedPieces,compareMode:e.compareMode,darkMode:T,showPieces:C,pieceOpacity:M}),_(!0),y({title:`${o.white} vs ${o.black}`,gameData:{white:o.white,black:o.black,result:o.result},moveHistory:a,whitePalette:i,blackPalette:n,capturedState:{...e,darkMode:T,showPieces:C,pieceOpacity:M},returnPath:window.location.pathname,pgn:h}),l.success("Board state captured for print!",{description:"Your exact visualization settings will be preserved.",icon:c.jsx(Ee,{className:"w-4 h-4"})}),s(),g("/order-print")},className:"relative overflow-hidden gap-2 bg-gradient-to-r from-amber-500 via-amber-400 to-yellow-500 text-stone-900 font-semibold shadow-lg shadow-amber-500/20 hover:shadow-amber-500/30",children:[c.jsx(m.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",initial:{x:"-100%"},animate:{x:"100%"},transition:{duration:2,repeat:1/0,repeatDelay:4}}),c.jsx(Se,{className:"h-4 w-4 relative z-10"}),c.jsx("span",{className:"relative z-10 font-display tracking-wide",children:"Order Premium Print"})]})}),c.jsx("p",{className:"text-center text-xs text-muted-foreground",children:"Turn this visualization into museum-quality wall art"})]})]}),c.jsx(_e,{isOpen:q,onClose:()=>R(!1),onAuthRequired:()=>{R(!1),z(!0)},trigger:"download"}),c.jsx(Pe,{isOpen:L,onClose:()=>z(!1)})]})},_t=()=>{l.info("Shortcuts: M=Mute, R=Resign, D=Draw, Esc=Lobby, ?=Help",{duration:4e3})},Pt={p:100,n:320,b:330,r:500,q:900,k:2e4},Tt=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],Et=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],$t=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,10,10,5,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,10,10,10,10,0,-10],[-10,10,10,10,10,10,10,-10],[-10,5,0,0,0,0,5,-10],[-20,-10,-10,-10,-10,-10,-10,-20]],Ot=[[0,0,0,0,0,0,0,0],[5,10,10,10,10,10,10,5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[0,0,0,5,5,0,0,0]],At=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,5,5,5,0,-10],[-5,0,5,5,5,5,0,-5],[0,0,5,5,5,5,0,-5],[-10,5,5,5,5,5,0,-10],[-10,0,5,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]],It=[[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-20,-30,-30,-40,-40,-30,-30,-20],[-10,-20,-20,-20,-20,-20,-20,-10],[20,20,0,0,0,0,20,20],[20,30,10,0,0,10,30,20]];function qt(e){switch(e.toLowerCase()){case"p":return Tt;case"n":return Et;case"b":return $t;case"r":return Ot;case"q":return At;case"k":return It;default:return[]}}function Dt(e){if(e.isCheckmate())return"w"===e.turn()?-1/0:1/0;if(e.isDraw()||e.isStalemate())return 0;let t=0;const s=e.board();for(let r=0;r<8;r++)for(let e=0;e<8;e++){const a=s[r][e];if(a){const s=Pt[a.type]||0,i=qt(a.type);let n=0;if(i.length>0){n=i["w"===a.color?r:7-r][e]}const l=s+n;t+="w"===a.color?l:-l}}const a=e.moves().length;return t+="w"===e.turn()?2*a:2*-a,t}function Rt(e,t,s,a,r){if(0===t||e.isGameOver())return{score:Dt(e),move:null};const i=e.moves({verbose:!0});if(i.sort((e,t)=>{let s=0,a=0;return e.captured&&(s+=Pt[e.captured]||0),t.captured&&(a+=Pt[t.captured]||0),e.san.includes("+")&&(s+=50),t.san.includes("+")&&(a+=50),a-s}),r){let r=-1/0,n=null;for(const l of i){e.move(l);const i=Rt(e,t-1,s,a,!1);if(e.undo(),i.score>r&&(r=i.score,n=l),a<=(s=Math.max(s,i.score)))break}return{score:r,move:n}}{let r=1/0,n=null;for(const l of i){e.move(l);const i=Rt(e,t-1,s,a,!0);if(e.undo(),i.score<r&&(r=i.score,n=l),(a=Math.min(a,i.score))<=s)break}return{score:r,move:n}}}function Lt(e){const t=e.moves({verbose:!0});if(0===t.length)return null;const s=t.filter(e=>e.captured);return s.length>0&&Math.random()<.3?s[Math.floor(Math.random()*s.length)]:t[Math.floor(Math.random()*t.length)]}function zt(e){return Rt(e,4,-1/0,1/0,"w"===e.turn()).move}function Ht(e,t){switch(t){case"easy":default:return Lt(e);case"medium":return function(e){const t=e.moves({verbose:!0});if(0===t.length)return null;let s=null,a="w"===e.turn()?-1/0:1/0;for(const r of t){e.move(r);const t=Dt(e);e.undo(),"w"===e.turn()?t>a&&(a=t,s=r):t<a&&(a=t,s=r)}if(Math.random()<.2){const s=t.sort((t,s)=>{e.move(t);const a=Dt(e);e.undo(),e.move(s);const r=Dt(e);return e.undo(),"w"===e.turn()?r-a:a-r}),a=s.slice(0,Math.min(3,s.length));return a[Math.floor(Math.random()*a.length)]}return s}(e);case"hard":case"stockfish":return zt(e)}}const Ft=[{id:"easy",label:"Beginner",description:"Makes random moves, occasional captures",rating:"~800"},{id:"medium",label:"Club Player",description:"Basic tactics and material awareness",rating:"~1400"},{id:"hard",label:"Master",description:"Advanced evaluation, 4-ply search depth",rating:"~2000"},{id:"stockfish",label:"Stockfish 16",description:"Real NNUE engine, grandmaster strength",rating:"~3200",enginePowered:!0}],Gt=[{id:"bullet_1",label:"Bullet",icon:g,description:"1 minute"},{id:"blitz_5",label:"Blitz",icon:Le,description:"5 minutes"},{id:"rapid_15",label:"Rapid",icon:Le,description:"15 minutes"}],Bt=["bot","create","join"],Yt=()=>{var e,s,a,o,d,u,x,f,b,v,y;me();const[w]=$e(),{user:k,isPremium:C}=r(),{haptics:P}=xt(),[T,E]=t.useState("lobby"),[$,A]=t.useState(!1),[I,q]=t.useState(!1),[R,z]=t.useState("bot"),[H,F]=t.useState("human"),[G,B]=t.useState("medium"),[Y,V]=t.useState("blitz_5"),[U,W]=t.useState("hotCold"),[X,K]=t.useState(!0),[J,Q]=t.useState(""),[Z,ee]=t.useState(null),[se,ae]=t.useState(new Set),[re,ie]=t.useState(!1),[ne,le]=t.useState(null),[oe,ce]=t.useState([]),[de,ue]=t.useState("hotCold"),[pe,he]=t.useState("hotCold"),[xe,ge]=t.useState(!0),[fe,be]=t.useState(!0),[ve,ye]=t.useState([]),{enabled:we,volume:je}=ut(),{playSound:Ne}=mt(we,je),[ke,Ce]=t.useState([]),[Me,Se]=t.useState(!1),[Te,Ee]=t.useState(1200),[Le,Ze]=t.useState(200),[et,tt]=t.useState(null),[st,it]=t.useState(null),[nt,lt]=t.useState(!1),[ot,ct]=t.useState(!1),[ht,gt]=t.useState(1/0),ft=t.useCallback(e=>{const t=Bt.indexOf(R);let s;s="left"===e?Math.min(t+1,Bt.length-1):Math.max(t-1,0),s!==t&&(P.select(),z(Bt[s]))},[R,P]);((e={})=>{const{threshold:s=50,allowMouse:a=!0,onSwipeLeft:r,onSwipeRight:i,onSwipeUp:n,onSwipeDown:l}=e,[o,c]=t.useState({x:0,y:0}),[d,m]=t.useState(!1),u=t.useRef({startX:0,startY:0,currentX:0,currentY:0,isSwiping:!1}),p=t.useCallback((e,t)=>{u.current={startX:e,startY:t,currentX:e,currentY:t,isSwiping:!0},m(!0)},[]),h=t.useCallback((e,t)=>{if(!u.current.isSwiping)return;u.current.currentX=e,u.current.currentY=t;const s=e-u.current.startX,a=t-u.current.startY;c({x:s,y:a})},[]),x=t.useCallback(()=>{if(!u.current.isSwiping)return;const e=u.current.currentX-u.current.startX,t=u.current.currentY-u.current.startY,a=Math.abs(e),o=Math.abs(t);a>o&&a>s?e>0?null==i||i():null==r||r():o>a&&o>s&&(t>0?null==l||l():null==n||n()),u.current.isSwiping=!1,m(!1),c({x:0,y:0})},[s,r,i,n,l]);t.useCallback(e=>{const t=e.touches[0];p(t.clientX,t.clientY)},[p]),t.useCallback(e=>{const t=e.touches[0];h(t.clientX,t.clientY)},[h]),t.useCallback(()=>{x()},[x]),t.useCallback(e=>{a&&p(e.clientX,e.clientY)},[a,p]),t.useCallback(e=>{a&&h(e.clientX,e.clientY)},[a,h]),t.useCallback(()=>{a&&x()},[a,x]),t.useCallback(()=>{a&&u.current.isSwiping&&x()},[a,x])})({threshold:50,allowMouse:!1,onSwipeLeft:()=>ft("left"),onSwipeRight:()=>ft("right")});const{gameState:vt,isMyTurn:yt,myColor:wt,isLoading:jt,makeMove:Pt,createGame:Tt,joinGame:Et,joinByCode:$t,resignGame:Ot,offerDraw:At,loadGame:It,getAvailableMoves:qt,movedSquares:Dt}=(()=>{const{user:e}=r(),[s,a]=t.useState(new i),[o,c]=t.useState(null),[d,m]=t.useState(!1),[u,p]=t.useState(null),[h,x]=t.useState(new Set),{enabled:g,volume:f}=ut(),{playSound:b}=mt(g,f);t.useRef("");const v=o?o.whitePlayerId===(null==e?void 0:e.id)?"w":o.blackPlayerId===(null==e?void 0:e.id)?"b":null:null,y="active"===(null==o?void 0:o.status)&&s.turn()===v;t.useEffect(()=>{if(!(null==o?void 0:o.id))return;const t=n.channel(`game-${o.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chess_games",filter:`id=eq.${o.id}`},t=>{const s=t.new;if("completed"===s.status&&"completed"!==o.status&&("draw"===s.result?b("draw"):s.winner_id===(null==e?void 0:e.id)?b("victory"):b("defeat")),c(e=>e?{...e,status:s.status,result:s.result,pgn:s.pgn,currentFen:s.current_fen,moveCount:s.move_count,whiteTimeRemaining:s.white_time_remaining,blackTimeRemaining:s.black_time_remaining,winnerId:s.winner_id,blackPlayerId:s.black_player_id,startedAt:s.started_at}:null),s.current_fen){const e=new i(s.current_fen);a(e)}}).subscribe(),s=n.channel(`moves-${o.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chess_moves",filter:`game_id=eq.${o.id}`},t=>{const s=t.new,a=s.move_uci;if(a&&a.length>=4){const e=a.substring(2,4);x(t=>new Set([...t,e]))}if(s.player_id!==(null==e?void 0:e.id)){const e=s.move_san;e.includes("#")?b("checkmate"):e.includes("+")?b("check"):e.includes("x")?b("capture"):b("O-O"===e||"O-O-O"===e?"castle":"move")}}).subscribe();return()=>{n.removeChannel(t),n.removeChannel(s)}},[null==o?void 0:o.id,null==o?void 0:o.status,null==e?void 0:e.id,b]);const w=t.useCallback(async e=>{m(!0),p(null);try{const{data:t,error:s}=await n.from("chess_games").select("*").eq("id",e).maybeSingle();if(s)throw s;if(!t)throw new Error("Game not found");c({id:t.id,whitePlayerId:t.white_player_id,blackPlayerId:t.black_player_id,status:t.status,result:t.result,pgn:t.pgn||"",currentFen:t.current_fen,moveCount:t.move_count||0,timeControl:t.time_control,whiteTimeRemaining:t.white_time_remaining,blackTimeRemaining:t.black_time_remaining,whitePalette:t.white_palette,blackPalette:t.black_palette,challengeCode:t.challenge_code,winnerId:t.winner_id,createdAt:t.created_at,startedAt:t.started_at});const r=new i(t.current_fen);a(r);const{data:l}=await n.from("chess_moves").select("move_uci").eq("game_id",e).order("move_number",{ascending:!0});if(l){const e=new Set;l.forEach(t=>{t.move_uci&&t.move_uci.length>=4&&e.add(t.move_uci.substring(2,4))}),x(e)}}catch(t){p(t instanceof Error?t.message:"Failed to load game")}finally{m(!1)}},[]),j=t.useCallback(async(t,s,a)=>{if(!e)return l.error("Please sign in to create a game"),null;m(!0),p(null);try{const r=pt[t]||null,{data:i}=await n.rpc("generate_challenge_code"),{data:o,error:c}=await n.from("chess_games").insert({white_player_id:e.id,status:"waiting",time_control:t,white_time_remaining:r,black_time_remaining:r,white_palette:a,is_public:s,challenge_code:i}).select().single();if(c)throw c;return l.success(s?"Game created! Waiting for opponent...":`Challenge code: ${i}`),await w(o.id),o.id}catch(r){const e=r instanceof Error?r.message:"Failed to create game";return p(e),l.error(e),null}finally{m(!1)}},[e,w]),N=t.useCallback(async(t,s)=>{if(!e)return l.error("Please sign in to join a game"),!1;m(!0),p(null);try{const{data:a,error:r}=await n.from("chess_games").select("*").eq("id",t).maybeSingle();if(r)throw r;if(!a)throw new Error("Game not found");if("waiting"!==a.status)throw new Error("Game already started");if(a.white_player_id===e.id)throw new Error("Cannot join your own game");const{error:i}=await n.from("chess_games").update({black_player_id:e.id,black_palette:s,status:"active",started_at:(new Date).toISOString(),last_move_at:(new Date).toISOString()}).eq("id",t);if(i)throw i;return b("gameStart"),l.success("Joined game! You are playing as Black."),await w(t),!0}catch(a){const e=a instanceof Error?a.message:"Failed to join game";return p(e),l.error(e),!1}finally{m(!1)}},[e,w,b]),k=t.useCallback(async(t,s)=>{if(!e)return l.error("Please sign in to join a game"),!1;m(!0),p(null);try{const{data:e,error:a}=await n.from("chess_games").select("id").eq("challenge_code",t.toUpperCase()).eq("status","waiting").maybeSingle();if(a)throw a;if(!e)throw new Error("Invalid or expired challenge code");return await N(e.id,s)}catch(a){const e=a instanceof Error?a.message:"Failed to join by code";return p(e),l.error(e),!1}finally{m(!1)}},[e,N]),C=t.useCallback(async(t,r,c)=>{if(!o||!e||!y)return!1;try{const d=s.move({from:t,to:r,promotion:c});if(!d)return b("illegal"),!1;s.isCheckmate()?b("checkmate"):s.isCheck()?b("check"):d.captured?b("capture"):"O-O"===d.san||"O-O-O"===d.san?b("castle"):b("move"),a(new i(s.fen())),x(e=>new Set([...e,r]));const m=s.pgn(),u=s.fen();let p=null,h=null,g="active";return s.isGameOver()&&(g="completed",s.isCheckmate()?(p="w"===s.turn()?"black_wins":"white_wins",h="w"===s.turn()?o.blackPlayerId:o.whitePlayerId):p="draw"),await n.from("chess_moves").insert({game_id:o.id,player_id:e.id,move_number:o.moveCount+1,move_san:d.san,move_uci:t+r+(c||""),fen_after:u}),await n.from("chess_games").update({pgn:m,current_fen:u,move_count:o.moveCount+1,last_move_at:(new Date).toISOString(),status:g,result:p,winner_id:h,completed_at:"completed"===g?(new Date).toISOString():null}).eq("id",o.id),"completed"===g&&p&&(await M(o.whitePlayerId,o.blackPlayerId,p),"draw"===p?b("draw"):h===(null==e?void 0:e.id)?b("victory"):b("defeat"),"white_wins"===p?l.success("w"===v?"You won!":"White wins!"):"black_wins"===p?l.success("b"===v?"You won!":"Black wins!"):l.info(dt(s))),!0}catch(d){return!1}},[s,o,e,y,v,b]),M=t.useCallback(async(t,s,a)=>{if(t&&s&&"abandoned"!==a)try{const{data:r}=await n.from("profiles").select("user_id, elo_rating").in("user_id",[t,s]);if(!r||2!==r.length)return;const i=r.find(e=>e.user_id===t),o=r.find(e=>e.user_id===s);if(!i||!o)return;const c=i.elo_rating||1200,d=o.elo_rating||1200,m=Xe(c,d,"draw"===a?"draw":a);if(await Promise.all([n.from("profiles").update({elo_rating:m.white.newRating}).eq("user_id",t),n.from("profiles").update({elo_rating:m.black.newRating}).eq("user_id",s)]),(null==e?void 0:e.id)===t){const e=m.white.change;l.info(`Rating: ${m.white.newRating} (${e>=0?"+":""}${e})`)}else if((null==e?void 0:e.id)===s){const e=m.black.change;l.info(`Rating: ${m.black.newRating} (${e>=0?"+":""}${e})`)}}catch(r){}},[e]),S=t.useCallback(async()=>{if(!o||!e||!v)return;const t="w"===v?"black_wins":"white_wins",s="w"===v?o.blackPlayerId:o.whitePlayerId;await n.from("chess_games").update({status:"completed",result:t,winner_id:s,completed_at:(new Date).toISOString()}).eq("id",o.id),await M(o.whitePlayerId,o.blackPlayerId,t),l.info("You resigned")},[o,e,v,M]),_=t.useCallback(async()=>{l.info("Draw offer sent (opponent auto-accepts in this version)"),o&&(await n.from("chess_games").update({status:"completed",result:"draw",completed_at:(new Date).toISOString()}).eq("id",o.id),await M(o.whitePlayerId,o.blackPlayerId,"draw"))},[o,M]),P=t.useCallback(e=>s.moves({square:e,verbose:!0}).map(e=>e.to),[s]);return{game:s,gameState:o,isMyTurn:y,myColor:v,isLoading:d,error:u,makeMove:C,createGame:j,joinGame:N,joinByCode:k,resignGame:S,offerDraw:_,loadGame:w,getAvailableMoves:P,movedSquares:h}})(),Rt=()=>{lt(!1),tt(null),it(null),ee(null),ae(new Set),ce([]),le(null),ye([]),E("lobby")};((e={})=>{const{onResign:s,onOfferDraw:a,onBackToLobby:r,isGameActive:i,isMyTurn:n}=e,{toggleEnabled:o,enabled:c}=ut(),d=t.useCallback(e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target.isContentEditable)return;const t=e.key.toLowerCase();switch(t){case"m":o(),l.info(c?"Sound muted":"Sound unmuted",{duration:1500,icon:c?"ðŸ”‡":"ðŸ”Š"});break;case"r":i&&s&&(e.preventDefault(),s());break;case"d":i&&n&&a&&(e.preventDefault(),a());break;case"escape":r&&(e.preventDefault(),r());break;case"?":case"/":e.shiftKey&&"?"!==t||(e.preventDefault(),_t())}},[o,c,s,a,r,i,n]);t.useEffect(()=>(window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)),[d])})({onResign:"active"===(null==vt?void 0:vt.status)?Ot:void 0,onOfferDraw:"active"===(null==vt?void 0:vt.status)&&yt?At:void 0,onBackToLobby:"lobby"!==T?Rt:void 0,isGameActive:"active"===(null==vt?void 0:vt.status),isMyTurn:yt}),t.useEffect(()=>{const e=w.get("game");e&&It(e).then(()=>E("game"))},[w,It]),t.useEffect(()=>{if(!k)return;(async()=>{const{data:e}=await n.from("profiles").select("elo_rating").eq("user_id",k.id).single();(null==e?void 0:e.elo_rating)&&Ee(e.elo_rating)})()},[k]),t.useEffect(()=>{if("lobby"!==T)return;const e=async()=>{Se(!0);const{data:e}=await n.from("chess_games").select("id, white_player_id, time_control, created_at").eq("status","waiting").eq("is_public",!0).order("created_at",{ascending:!1}).limit(10);if(e&&e.length>0){const t=e.map(e=>e.white_player_id).filter(Boolean),{data:s}=await n.from("profiles").select("user_id, elo_rating").in("user_id",t),a={};null==s||s.forEach(e=>{a[e.user_id]=e.elo_rating||1200});const r=e.map(e=>({...e,white_elo:a[e.white_player_id]||1200}));Ce(r)}else Ce([]);Se(!1)};e();const t=n.channel("waiting-games").on("postgres_changes",{event:"*",schema:"public",table:"chess_games"},()=>e()).subscribe();return()=>{n.removeChannel(t)}},[T]),t.useEffect(()=>{"active"===(null==vt?void 0:vt.status)&&"game"!==T&&(E("game"),null===et&&tt(Te))},[null==vt?void 0:vt.status,T,Te,et]),t.useEffect(()=>{if("completed"===(null==vt?void 0:vt.status)&&null!==et&&!nt&&k){(async()=>{const{data:e}=await n.from("profiles").select("elo_rating").eq("user_id",k.id).single();void 0!==(null==e?void 0:e.elo_rating)&&(it(e.elo_rating),Ee(e.elo_rating),setTimeout(()=>lt(!0),500))})()}},[null==vt?void 0:vt.status,et,nt,k]);const Lt=async()=>{if(!k)return void A(!0);if(!C)return void q(!0);const e=Ie.find(e=>e.id===U),t=(null==e?void 0:e.white)||{};await Tt(Y,X,t)&&E("waiting")},zt=async e=>{if(!k)return void A(!0);if(!C)return void q(!0);const t=Ie.find(e=>e.id===U),s=(null==t?void 0:t.black)||{};await Et(e,s)&&E("game")},Yt=()=>ke.length?ke.filter(e=>{const t=e.white_elo||1200;return Math.abs(t-Te)<=Le}).sort((e,t)=>Math.abs((e.white_elo||1200)-Te)-Math.abs((t.white_elo||1200)-Te)):[],Vt=()=>{var e;const t=new i;ee(t),ae(new Set),ce([]),le(null),ue(U);const s=Ie.filter(e=>e.id!==U),a=s[Math.floor(Math.random()*s.length)];he(a.id),E("bot-game"),Ne("gameStart"),P.gameStart(),l.success(`Starting game vs ${null==(e=Ft.find(e=>e.id===G))?void 0:e.label} bot â€¢ Bot using ${a.name} palette`)},Ut=(e,t,s)=>{const a=e.get(t);return a?{piece:a.type,color:a.color}:null},Wt=t.useCallback(async(e,t,s)=>{if(!Z||re)return!1;try{const a=Ut(Z,e),r=Z.move({from:e,to:t,promotion:s});if(!r)return Ne("illegal"),P.error(),!1;if(a){const e={square:t,piece:a.piece,color:a.color,moveNumber:Z.history().length};ce(t=>[...t,e])}if(Z.isCheckmate()?(Ne("checkmate"),P.victory()):Z.isCheck()?(Ne("check"),P.check()):r.captured?(Ne("capture"),P.capture()):"O-O"===r.san||"O-O-O"===r.san?(Ne("castle"),P.castle()):(Ne("move"),P.move()),ee(new i(Z.fen())),ae(e=>new Set([...e,t])),Z.isGameOver())return Z.isCheckmate()?(le("win"),Ne("victory"),P.victory(),l.success("Checkmate! You won!")):(le("draw"),Ne("draw"),l.info(dt(Z))),!0;ie(!0);const n=function(e){switch(e){case"easy":return 300+500*Math.random();case"medium":return 500+1e3*Math.random();case"hard":return 800+1500*Math.random();case"stockfish":return 100;default:return 500}}(G);await new Promise(e=>setTimeout(e,n));const o=Ht(Z,G);if(o){const e=Ut(Z,o.from,o.to);if(Z.move(o),e){const t={square:o.to,piece:e.piece,color:e.color,moveNumber:Z.history().length};ce(e=>[...e,t])}Z.isCheckmate()?(Ne("checkmate"),P.error()):Z.isCheck()?(Ne("check"),P.check()):o.captured?(Ne("capture"),P.capture()):"O-O"===o.san||"O-O-O"===o.san?Ne("castle"):(Ne("move"),P.move()),ee(new i(Z.fen())),ae(e=>new Set([...e,o.to])),Z.isGameOver()&&(Z.isCheckmate()?(le("loss"),Ne("defeat"),P.error(),l.error("Checkmate! You lost.")):(le("draw"),Ne("draw"),l.info(dt(Z))))}return ie(!1),!0}catch(a){return ie(!1),P.error(),!1}},[Z,re,G,Ne,P]),Xt=t.useCallback(e=>{if(!Z)return[];return Z.moves({square:e,verbose:!0}).map(e=>e.to)},[Z]);return c.jsxs("div",{className:"min-h-screen bg-background",children:[c.jsx(Oe,{}),c.jsx("main",{className:"container mx-auto px-3 sm:px-4 py-8 sm:py-16",children:c.jsxs("div",{className:"max-w-5xl mx-auto",children:[c.jsxs("div",{className:"text-center space-y-3 sm:space-y-6 mb-6 sm:mb-12 relative",children:[c.jsx("div",{className:"absolute right-0 top-0",children:c.jsx(Ct,{})}),c.jsxs("div",{className:"inline-flex items-center gap-2 px-3 sm:px-5 py-1.5 sm:py-2.5 rounded-full bg-primary/10 border border-primary/20 text-primary text-xs sm:text-sm font-display uppercase tracking-widest",children:[c.jsx(h,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Visionary Exclusive"]}),c.jsxs("h1",{className:"text-2xl sm:text-4xl md:text-5xl font-royal font-bold uppercase tracking-wide",children:["Play ",c.jsx("span",{className:"text-gold-gradient",children:"En Pensent"})]}),c.jsxs("p",{className:"text-sm sm:text-lg text-muted-foreground font-serif leading-relaxed max-w-2xl mx-auto px-2",children:["Experience chess as art. Watch your visualization come alive ",c.jsx("span",{className:"text-primary font-medium",children:"as you play"}),"."]}),c.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground font-display",children:[c.jsx(N,{className:"h-3 w-3 text-primary"}),c.jsx("span",{children:'Toggle "En Pensent" mode during any game to see colors fill the board live'})]})]}),c.jsxs(te,{mode:"wait",children:["lobby"===T&&c.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4 sm:space-y-8",children:[c.jsxs("div",{className:"sm:hidden",children:[c.jsx("div",{className:"flex justify-center gap-1 mb-4",children:Bt.map(e=>c.jsx("button",{onClick:()=>{P.select(),z(e)},className:"px-4 py-2 rounded-full text-xs font-display uppercase tracking-wider transition-all touch-manipulation "+(R===e?"bg-primary text-primary-foreground":"bg-muted/50 text-muted-foreground"),children:"bot"===e?"Bot":"create"===e?"Create":"Join"},e))}),c.jsx("p",{className:"text-center text-[10px] text-muted-foreground mb-2",children:"Swipe left/right to navigate"})]}),c.jsx("div",{className:"p-4 sm:p-6 rounded-lg border border-green-500/30 bg-gradient-to-r from-green-500/10 via-green-500/5 to-transparent space-y-4",children:c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[c.jsx(at,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-500 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-display font-bold uppercase tracking-wider text-sm sm:text-base",children:"Practice vs Bot"}),c.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground font-serif",children:"Free for everyone! Watch your vision generate live."})]})]}),c.jsxs(D,{onClick:Vt,className:"gap-2 bg-green-600 hover:bg-green-700 active:bg-green-800 h-11 sm:h-10 text-sm touch-manipulation",children:[c.jsx(at,{className:"h-4 w-4"}),"Play Bot"]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-xs font-display uppercase tracking-wider text-muted-foreground flex items-center gap-2",children:[c.jsx(h,{className:"h-3 w-3"}),"Difficulty"]}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ft.map(e=>c.jsxs("button",{onClick:()=>B(e.id),className:"px-2 py-2.5 rounded-lg text-xs font-display transition-all touch-manipulation text-center "+(G===e.id?"bg-green-500 text-white":"bg-card/50 border border-border/50 text-muted-foreground active:bg-green-500/20"),children:[c.jsx("div",{children:e.label}),c.jsx("div",{className:"text-[10px] opacity-70",children:e.rating})]},e.id))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-xs font-display uppercase tracking-wider text-muted-foreground flex items-center gap-2",children:[c.jsx(Ae,{className:"h-3 w-3"}),"Your Palette (Bot gets random)"]}),c.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-1.5",children:Ie.slice(0,8).map(e=>c.jsxs("button",{onClick:()=>W(e.id),className:"p-1.5 rounded-lg border transition-all touch-manipulation "+(U===e.id?"border-green-500 bg-green-500/10":"border-border/50 active:bg-green-500/5"),children:[c.jsx("div",{className:"flex gap-0.5 mb-0.5 justify-center",children:Object.values(e.white).slice(0,3).map((e,t)=>c.jsx("div",{className:"w-2 h-2 rounded-sm",style:{backgroundColor:e}},t))}),c.jsx("p",{className:"text-[7px] sm:text-[8px] font-display truncate",children:e.name})]},e.id))})]})]})}),c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-amber-500/30 bg-gradient-to-r from-amber-500/10 via-amber-500/5 to-transparent",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(qe,{className:"h-5 w-5 text-amber-500"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-display font-bold uppercase tracking-wider text-sm",children:"Opening Encyclopedia"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Master famous book openings"})]})]}),c.jsx(De,{to:"/openings",children:c.jsxs(D,{variant:"outline",size:"sm",className:"gap-1 text-xs",children:["Browse All",c.jsx(Re,{className:"h-3 w-3"})]})})]}),c.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:[{name:"Queen's Gambit",icon:"ðŸ‘¸",color:"border-purple-500/40 bg-purple-500/10"},{name:"Sicilian",icon:"ðŸ›¡ï¸",color:"border-red-500/40 bg-red-500/10"},{name:"Italian",icon:"ðŸ›ï¸",color:"border-green-500/40 bg-green-500/10"},{name:"King's Gambit",icon:"âš”ï¸",color:"border-amber-500/40 bg-amber-500/10"},{name:"Ruy Lopez",icon:"ðŸ‡ªðŸ‡¸",color:"border-blue-500/40 bg-blue-500/10"},{name:"London",icon:"ðŸŽ©",color:"border-gray-500/40 bg-gray-500/10"}].map(e=>c.jsxs(De,{to:`/marketplace?opening=${encodeURIComponent(e.name.toLowerCase())}`,className:`p-2 rounded-lg border ${e.color} text-center hover:scale-105 transition-transform`,children:[c.jsx("div",{className:"text-lg mb-0.5",children:e.icon}),c.jsx("p",{className:"text-[9px] font-medium truncate",children:e.name})]},e.name))})]}),!C&&c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-primary/30 bg-gradient-to-r from-primary/10 via-primary/5 to-transparent flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[c.jsx(p,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-display font-bold uppercase tracking-wider text-sm sm:text-base",children:"Visionary Exclusive"}),c.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground font-serif",children:"Upgrade to play online with visualization"})]})]}),c.jsxs(D,{onClick:()=>q(!0),className:"gap-2 w-full sm:w-auto h-11 sm:h-10 touch-manipulation",children:[c.jsx(N,{className:"h-4 w-4"}),"Upgrade Now"]})]}),k&&C&&c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-primary/30 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 space-y-4",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("span",{className:`inline-block px-3 py-1 rounded-full bg-gradient-to-r ${Ke(Te).color} text-white font-display text-base sm:text-lg`,children:Te}),c.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mt-1 font-display uppercase",children:Ke(Te).name})]}),c.jsxs("div",{children:[c.jsxs("h3",{className:"font-display font-bold uppercase tracking-wider flex items-center gap-2 text-sm sm:text-base",children:[c.jsx(j,{className:"h-4 w-4 text-primary"}),"Your Rating"]}),c.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground font-serif",children:["Range: Â±",Le," ELO"]})]})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[c.jsx("div",{className:"grid grid-cols-3 gap-2 sm:flex sm:gap-2",children:[100,200,400].map(e=>c.jsxs("button",{onClick:()=>Ze(e),className:"px-3 py-2.5 sm:py-1 rounded-lg text-xs font-display transition-all touch-manipulation "+(Le===e?"bg-primary text-primary-foreground":"bg-card/50 border border-border/50 text-muted-foreground active:bg-primary/20"),children:["Â±",e]},e))}),c.jsxs(D,{onClick:async()=>{if(!k)return void A(!0);if(!C)return void q(!0);const e=Yt().filter(e=>e.white_player_id!==k.id);e.length>0?await zt(e[0].id):(l.info("No matching opponents found. Creating a new game..."),await Lt())},className:"gap-2 h-11 sm:h-10 touch-manipulation",disabled:jt,children:[c.jsx(g,{className:"h-4 w-4"}),"Quick Match"]})]})]}),Yt().length>0&&c.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground font-serif",children:[Yt().filter(e=>e.white_player_id!==(null==k?void 0:k.id)).length," opponent",1!==Yt().filter(e=>e.white_player_id!==(null==k?void 0:k.id)).length?"s":""," in your skill range"]})]}),c.jsxs("div",{className:"grid lg:grid-cols-2 gap-4 sm:gap-8",children:[c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-border/50 bg-card/50 space-y-4 sm:space-y-6",children:[c.jsxs("h2",{className:"text-lg sm:text-xl font-display font-bold uppercase tracking-wider flex items-center gap-2",children:[c.jsx(h,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Create Game"]}),c.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[c.jsx("label",{className:"text-xs sm:text-sm font-display uppercase tracking-wider text-muted-foreground",children:"Time Control"}),c.jsx("div",{className:"grid grid-cols-3 gap-2",children:Gt.map(e=>c.jsxs("button",{onClick:()=>V(e.id),className:"p-2.5 sm:p-3 rounded-lg border text-center transition-all touch-manipulation "+(Y===e.id?"border-primary bg-primary/10":"border-border/50 active:bg-primary/5"),children:[c.jsx(e.icon,{className:"h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1 text-primary"}),c.jsx("p",{className:"font-display text-xs sm:text-sm",children:e.label}),c.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:e.description})]},e.id))})]}),c.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[c.jsx("label",{className:"text-xs sm:text-sm font-display uppercase tracking-wider text-muted-foreground",children:"Your Palette"}),c.jsx("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2",children:Ie.slice(0,8).map(e=>c.jsxs("button",{onClick:()=>W(e.id),className:"p-1.5 sm:p-2 rounded-lg border transition-all touch-manipulation "+(U===e.id?"border-primary bg-primary/10":"border-border/50 active:bg-primary/5"),children:[c.jsx("div",{className:"flex gap-0.5 mb-1 justify-center",children:Object.values(e.white).slice(0,4).map((e,t)=>c.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-sm",style:{backgroundColor:e}},t))}),c.jsx("p",{className:"text-[8px] sm:text-[10px] font-display truncate",children:e.name})]},e.id))})]}),c.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[c.jsxs("button",{onClick:()=>K(!0),className:"flex-1 p-2.5 sm:p-3 rounded-lg border text-center transition-all touch-manipulation "+(X?"border-primary bg-primary/10":"border-border/50"),children:[c.jsx(ze,{className:"h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1"}),c.jsx("p",{className:"text-xs sm:text-sm font-display",children:"Quick Match"})]}),c.jsxs("button",{onClick:()=>K(!1),className:"flex-1 p-2.5 sm:p-3 rounded-lg border text-center transition-all touch-manipulation "+(X?"border-border/50":"border-primary bg-primary/10"),children:[c.jsx(He,{className:"h-4 w-4 sm:h-5 sm:w-5 mx-auto mb-1"}),c.jsx("p",{className:"text-xs sm:text-sm font-display",children:"Challenge"})]})]}),c.jsxs(D,{onClick:Lt,className:"w-full gap-2 h-11 sm:h-10 touch-manipulation",disabled:jt||!C,children:[!C&&c.jsx(Fe,{className:"h-4 w-4"}),"Create Game",c.jsx(Ge,{className:"h-4 w-4"})]})]}),c.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-border/50 bg-card/50 space-y-3 sm:space-y-4",children:[c.jsxs("h2",{className:"text-lg sm:text-xl font-display font-bold uppercase tracking-wider flex items-center gap-2",children:[c.jsx(He,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Join by Code"]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Be,{value:J,onChange:e=>Q(e.target.value.toUpperCase()),placeholder:"6-digit code",className:"font-mono text-base sm:text-lg tracking-widest h-11 sm:h-10",maxLength:6,inputMode:"text",autoComplete:"off",autoCorrect:"off"}),c.jsx(D,{onClick:async()=>{if(!J.trim())return void l.error("Please enter a challenge code");if(!k)return void A(!0);if(!C)return void q(!0);const e=Ie.find(e=>e.id===U),t=(null==e?void 0:e.black)||{};await $t(J.trim(),t)&&E("game")},disabled:jt||!C,className:"h-11 sm:h-10 px-4 sm:px-6 touch-manipulation",children:"Join"})]})]}),c.jsxs("div",{className:"p-4 sm:p-6 rounded-lg border border-border/50 bg-card/50 space-y-3 sm:space-y-4",children:[c.jsxs("h2",{className:"text-lg sm:text-xl font-display font-bold uppercase tracking-wider flex items-center gap-2",children:[c.jsx(ze,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"}),"Open Games"]}),Me?c.jsx("p",{className:"text-muted-foreground text-sm font-serif",children:"Loading..."}):0===ke.length?c.jsx("p",{className:"text-muted-foreground text-xs sm:text-sm font-serif italic",children:"No games waiting. Create one!"}):c.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto -mx-1 px-1",children:ke.map(e=>{var t;const s=e.white_elo||1200,a=k&&Math.abs(s-Te)<=Le,r=e.white_player_id===(null==k?void 0:k.id),i=k?Je(Te,s):null;return c.jsxs("div",{className:"flex items-center justify-between p-2.5 sm:p-3 rounded-lg border transition-all "+(a&&!r?"bg-primary/10 border-primary/30":"bg-card/50 border-border/30"),children:[c.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[c.jsxs("div",{className:"min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[c.jsx("p",{className:"font-display text-xs sm:text-sm",children:(null==(t=Gt.find(t=>t.id===e.time_control))?void 0:t.label)||"Blitz"}),a&&!r&&c.jsx("span",{className:"text-[8px] sm:text-[10px] px-1 sm:px-1.5 py-0.5 rounded bg-primary/20 text-primary font-display uppercase",children:"Match"})]}),c.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),c.jsx("span",{className:`text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded-full bg-gradient-to-r ${Ke(s).color} text-white font-display flex-shrink-0`,children:s})]}),c.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[i&&!r&&c.jsx(O,{children:c.jsxs(M,{children:[c.jsx(S,{asChild:!0,children:c.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 text-[10px] font-mono px-2 py-1 rounded bg-card border border-border/50 cursor-help",children:[c.jsxs("span",{className:"text-green-500",children:["+",i.win]}),c.jsx("span",{className:"text-muted-foreground",children:"/"}),c.jsx("span",{className:i.draw>=0?"text-blue-400":"text-orange-400",children:i.draw>=0?`+${i.draw}`:i.draw}),c.jsx("span",{className:"text-muted-foreground",children:"/"}),c.jsx("span",{className:"text-red-500",children:i.loss})]})}),c.jsxs(_,{side:"left",className:"space-y-1",children:[c.jsx("p",{className:"font-display text-xs uppercase tracking-wider mb-1",children:"ELO Change Preview"}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("span",{className:"text-green-500 font-bold",children:"Win:"}),c.jsxs("span",{children:["+",i.win," â†’ ",Te+i.win]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("span",{className:"text-blue-400 font-bold",children:"Draw:"}),c.jsxs("span",{children:[i.draw>=0?`+${i.draw}`:i.draw," â†’ ",Te+i.draw]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("span",{className:"text-red-500 font-bold",children:"Loss:"}),c.jsxs("span",{children:[i.loss," â†’ ",Te+i.loss]})]})]})]})}),c.jsx(D,{size:"sm",onClick:()=>zt(e.id),disabled:jt||!C||r,variant:a&&!r?"default":"outline",className:"h-9 sm:h-8 px-3 sm:px-4 text-xs touch-manipulation",children:"Join"})]})]},e.id)})})]})]})]})]},"lobby"),"waiting"===T&&c.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center space-y-8",children:c.jsxs("div",{className:"p-8 rounded-lg border border-primary/30 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent",children:[c.jsx(m.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 mx-auto mb-4",children:c.jsx(h,{className:"w-full h-full text-primary"})}),c.jsx("h2",{className:"text-2xl font-display font-bold uppercase tracking-wider mb-2",children:"Waiting for Opponent"}),(null==vt?void 0:vt.challengeCode)&&!X&&c.jsxs("div",{className:"mt-6 space-y-4",children:[c.jsx("p",{className:"text-muted-foreground font-serif",children:"Share this code with your friend:"}),c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("span",{className:"text-4xl font-mono tracking-[0.5em] text-primary",children:vt.challengeCode}),c.jsx(D,{variant:"outline",size:"icon",onClick:()=>{(null==vt?void 0:vt.challengeCode)&&(navigator.clipboard.writeText(vt.challengeCode),l.success("Challenge code copied!"))},children:c.jsx(Ye,{className:"h-4 w-4"})})]})]}),c.jsx(D,{variant:"outline",onClick:()=>{E("lobby")},className:"mt-6",children:"Cancel"})]})},"waiting"),"game"===T&&vt&&c.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4 sm:space-y-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[c.jsxs("div",{className:"text-center sm:text-left",children:[c.jsx("p",{className:"text-sm sm:text-base font-display uppercase tracking-wider "+(yt&&"active"===vt.status?"text-primary":"text-muted-foreground"),children:"active"===vt.status?yt?"Your Turn":"Opponent's Turn":"draw"===vt.result?"Draw":vt.winnerId===(null==k?void 0:k.id)?"You Won!":"You Lost"}),c.jsxs("p",{className:"text-xs text-muted-foreground font-serif",children:["Playing as ","w"===wt?"White":"Black"]})]}),c.jsxs("div",{className:"flex items-center gap-2 justify-center sm:justify-end flex-wrap",children:[c.jsx(Mt,{isEnabled:xe,onToggle:()=>ge(!xe),totalMoves:ve.length,showPieces:fe,onShowPiecesToggle:()=>be(!fe)}),"active"===vt.status&&c.jsxs(c.Fragment,{children:[c.jsxs(D,{variant:"outline",size:"sm",onClick:At,className:"gap-1.5 h-10 sm:h-9 px-4 touch-manipulation",children:[c.jsx(rt,{className:"h-4 w-4"}),c.jsx("span",{className:"hidden sm:inline",children:"Offer "}),"Draw"]}),c.jsxs(D,{variant:"outline",size:"sm",onClick:Ot,className:"gap-1.5 h-10 sm:h-9 px-4 text-destructive touch-manipulation",children:[c.jsx(L,{className:"h-4 w-4"}),"Resign"]})]})]})]}),c.jsxs(Ve,{children:[c.jsxs("div",{className:"grid lg:grid-cols-[1fr,280px] gap-4",children:[c.jsx(bt,{fen:vt.currentFen,onMove:Pt,getAvailableMoves:qt,isMyTurn:yt,myColor:wt,whitePalette:vt.whitePalette||Ie[0].white,blackPalette:vt.blackPalette||Ie[0].black,movedSquares:Dt,disabled:"active"!==vt.status,enPensentEnabled:xe,moveHistory:ve,showPieces:fe}),xe&&c.jsx("div",{className:"hidden lg:block",children:c.jsx(Qe,{whitePalette:vt.whitePalette||Ie[0].white,blackPalette:vt.blackPalette||Ie[0].black,moveHistory:ve,title:"Live Legend"})})]}),xe&&c.jsx("div",{className:"lg:hidden",children:c.jsx(Qe,{whitePalette:vt.whitePalette||Ie[0].white,blackPalette:vt.blackPalette||Ie[0].black,moveHistory:ve,compact:!0,title:"Legend"})})]}),c.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border border-border/50 bg-card/30",children:[c.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground font-display uppercase tracking-wider mb-1 sm:mb-2",children:["Moves: ",vt.moveCount]}),c.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground font-mono break-all line-clamp-2 sm:line-clamp-none",children:vt.pgn||"Game started..."})]}),"completed"===vt.status&&null!==et&&null!==st&&c.jsx(kt,{oldRating:et,newRating:st,isWin:vt.winnerId===(null==k?void 0:k.id),isDraw:"draw"===vt.result,show:nt}),"completed"===vt.status&&c.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center flex-wrap",children:[c.jsx(D,{onClick:Rt,className:"h-11 sm:h-10 touch-manipulation",children:"Back to Lobby"}),c.jsxs(D,{variant:"outline",onClick:()=>{const e=`${window.location.origin}/play?game=${null==vt?void 0:vt.id}`;navigator.clipboard.writeText(e),l.success("Game link copied!")},className:"gap-2 h-11 sm:h-10 touch-manipulation",children:[c.jsx(He,{className:"h-4 w-4"}),"Share Game"]}),xe&&ve.length>0&&c.jsxs(D,{variant:"outline",onClick:()=>ct(!0),className:"gap-2 h-11 sm:h-10 touch-manipulation border-primary/30 bg-primary/5 hover:bg-primary/10",children:[c.jsx(Ue,{className:"h-4 w-4"}),"Export Art"]})]})]},"game"),"bot-game"===T&&Z&&c.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4 sm:space-y-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[c.jsxs("div",{className:"text-center sm:text-left",children:[c.jsxs("p",{className:"text-sm sm:text-base font-display uppercase tracking-wider flex items-center justify-center sm:justify-start gap-2 "+(re||ne?"text-muted-foreground":"text-primary"),children:[c.jsx(at,{className:"h-4 w-4"}),ne?"win"===ne?"You Won!":"loss"===ne?"You Lost":"Draw":re?"Bot thinking...":"Your Turn"]}),c.jsxs("p",{className:"text-xs text-muted-foreground font-serif",children:["vs ",null==(e=Ft.find(e=>e.id===G))?void 0:e.label," Bot (",null==(s=Ft.find(e=>e.id===G))?void 0:s.rating,")"]})]}),c.jsxs("div",{className:"flex items-center gap-2 justify-center sm:justify-end flex-wrap",children:[c.jsx(Mt,{isEnabled:xe,onToggle:()=>ge(!xe),totalMoves:oe.length,showPieces:fe,onShowPiecesToggle:()=>be(!fe)}),!ne&&c.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{le("loss"),Ne("defeat"),P.error(),l.info("You resigned.")},className:"gap-1.5 h-10 sm:h-9 px-4 text-destructive touch-manipulation",children:[c.jsx(L,{className:"h-4 w-4"}),"Resign"]})]})]}),c.jsxs(Ve,{children:[c.jsxs("div",{className:"grid lg:grid-cols-[1fr,280px] gap-4",children:[c.jsx(bt,{fen:Z.fen(),onMove:Wt,getAvailableMoves:Xt,isMyTurn:!re&&!ne&&"w"===Z.turn(),myColor:"w",whitePalette:(null==(a=Ie.find(e=>e.id===de))?void 0:a.white)||Ie[0].white,blackPalette:(null==(o=Ie.find(e=>e.id===pe))?void 0:o.black)||Ie[0].black,movedSquares:se,disabled:re||!!ne,enPensentEnabled:xe,moveHistory:oe,showPieces:fe}),xe&&c.jsx("div",{className:"hidden lg:block",children:c.jsx(Qe,{whitePalette:(null==(d=Ie.find(e=>e.id===de))?void 0:d.white)||Ie[0].white,blackPalette:(null==(u=Ie.find(e=>e.id===pe))?void 0:u.black)||Ie[0].black,moveHistory:oe,title:"Live Legend"})})]}),xe&&c.jsx("div",{className:"lg:hidden",children:c.jsx(Qe,{whitePalette:(null==(x=Ie.find(e=>e.id===de))?void 0:x.white)||Ie[0].white,blackPalette:(null==(f=Ie.find(e=>e.id===pe))?void 0:f.black)||Ie[0].black,moveHistory:oe,compact:!0,title:"Legend"})})]}),c.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border border-border/50 bg-card/30 space-y-3",children:[c.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground font-display uppercase tracking-wider mb-1 sm:mb-2",children:["Moves: ",Z.history().length]}),c.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground font-mono break-all line-clamp-2 sm:line-clamp-none",children:Z.pgn()||"Game started..."}),ne&&xe&&oe.length>0&&c.jsx(Nt,{totalMoves:oe.length,moves:Z.history(),moveHistory:oe,currentMove:ht===1/0?oe.length:ht,onMoveChange:gt,compact:!0})]}),ne&&c.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center flex-wrap",children:[c.jsx(D,{onClick:Rt,className:"h-11 sm:h-10 touch-manipulation",children:"Back to Lobby"}),c.jsxs(D,{variant:"outline",onClick:Vt,className:"gap-2 h-11 sm:h-10 touch-manipulation",children:[c.jsx(at,{className:"h-4 w-4"}),"Play Again"]}),xe&&oe.length>0&&c.jsxs(D,{variant:"outline",onClick:()=>ct(!0),className:"gap-2 h-11 sm:h-10 touch-manipulation border-primary/30 bg-primary/5 hover:bg-primary/10",children:[c.jsx(Ue,{className:"h-4 w-4"}),"Export Art"]})]})]},"bot-game")]})]})}),c.jsx(We,{}),c.jsx(Pe,{isOpen:$,onClose:()=>A(!1)}),c.jsx(_e,{isOpen:I,onClose:()=>q(!1),trigger:"general"}),c.jsx(St,{isOpen:ot,onClose:()=>ct(!1),moveHistory:"bot-game"===T?oe:ve,whitePalette:"bot-game"===T?(null==(b=Ie.find(e=>e.id===de))?void 0:b.white)||Ie[0].white:(null==vt?void 0:vt.whitePalette)||Ie[0].white,blackPalette:"bot-game"===T?(null==(v=Ie.find(e=>e.id===pe))?void 0:v.black)||Ie[0].black:(null==vt?void 0:vt.blackPalette)||Ie[0].black,gameInfo:{white:"bot-game"===T||"w"===wt?"You":"Opponent",black:"bot-game"===T?`${null==(y=Ft.find(e=>e.id===G))?void 0:y.label} Bot`:"b"===wt?"You":"Opponent",result:"bot-game"===T?"win"===ne?"You Won!":"loss"===ne?"You Lost":"Draw":(null==vt?void 0:vt.result)||"Game Finished",totalMoves:"bot-game"===T?oe.length:ve.length}})]})};export{Yt as default};
