const n="import { supabase } from '@/integrations/supabase/client';\nimport type { Json } from '@/integrations/supabase/types';\n\nexport type SecurityEventCategory = \n  | 'authentication'\n  | 'authorization'\n  | 'data_access'\n  | 'data_modification'\n  | 'marketplace'\n  | 'subscription'\n  | 'moderation'\n  | 'admin_action'\n  | 'withdrawal'\n  | 'general';\n\nexport type SecuritySeverity = 'info' | 'warn' | 'error' | 'critical';\n\nexport interface SecurityEventOptions {\n  actionType: string;\n  actionCategory?: SecurityEventCategory;\n  userId?: string;\n  adminId?: string;\n  targetType?: string;\n  targetId?: string;\n  metadata?: Record<string, Json>;\n  severity?: SecuritySeverity;\n}\n\n// Log security event using the database function\nexport async function logSecurityEvent(options: SecurityEventOptions): Promise<string | null> {\n  try {\n    const { data, error } = await supabase.rpc('log_security_event', {\n      p_action_type: options.actionType,\n      p_action_category: options.actionCategory || 'general',\n      p_user_id: options.userId || null,\n      p_admin_id: options.adminId || null,\n      p_target_type: options.targetType || null,\n      p_target_id: options.targetId || null,\n      p_ip_address: null, // Server-side only for security\n      p_user_agent: typeof navigator !== 'undefined' ? navigator.userAgent : null,\n      p_metadata: (options.metadata || {}) as Json,\n      p_severity: options.severity || 'info',\n    });\n\n    if (error) {\n      console.error('Error logging security event:', error);\n      return null;\n    }\n\n    return data;\n  } catch (error) {\n    console.error('Error logging security event:', error);\n    return null;\n  }\n}\n\n// Convenience functions for common security events\nexport const SecurityEvents = {\n  // Authentication events\n  userSignUp: (userId: string, metadata?: Record<string, Json>) =>\n    logSecurityEvent({\n      actionType: 'user_signup',\n      actionCategory: 'authentication',\n      userId,\n      metadata,\n      severity: 'info',\n    }),\n\n  userSignIn: (userId: string, metadata?: Record<string, Json>) =>\n    logSecurityEvent({\n      actionType: 'user_signin',\n      actionCategory: 'authentication',\n      userId,\n      metadata,\n      severity: 'info',\n    }),\n\n  userSignOut: (userId: string) =>\n    logSecurityEvent({\n      actionType: 'user_signout',\n      actionCategory: 'authentication',\n      userId,\n      severity: 'info',\n    }),\n\n  signInFailed: (email: string, reason: string) =>\n    logSecurityEvent({\n      actionType: 'signin_failed',\n      actionCategory: 'authentication',\n      metadata: { email, reason },\n      severity: 'warn',\n    }),\n\n  mfaEnabled: (userId: string) =>\n    logSecurityEvent({\n      actionType: 'mfa_enabled',\n      actionCategory: 'authentication',\n      userId,\n      severity: 'info',\n    }),\n\n  mfaVerified: (userId: string) =>\n    logSecurityEvent({\n      actionType: 'mfa_verified',\n      actionCategory: 'authentication',\n      userId,\n      severity: 'info',\n    }),\n\n  // Marketplace events\n  visionListed: (userId: string, visualizationId: string, priceCents: number) =>\n    logSecurityEvent({\n      actionType: 'vision_listed',\n      actionCategory: 'marketplace',\n      userId,\n      targetType: 'visualization',\n      targetId: visualizationId,\n      metadata: { price_cents: priceCents },\n      severity: 'info',\n    }),\n\n  visionPurchased: (buyerId: string, sellerId: string, visualizationId: string, priceCents: number) =>\n    logSecurityEvent({\n      actionType: 'vision_purchased',\n      actionCategory: 'marketplace',\n      userId: buyerId,\n      targetType: 'visualization',\n      targetId: visualizationId,\n      metadata: { seller_id: sellerId, price_cents: priceCents },\n      severity: 'info',\n    }),\n\n  // Subscription events\n  subscriptionCreated: (userId: string, productId: string) =>\n    logSecurityEvent({\n      actionType: 'subscription_created',\n      actionCategory: 'subscription',\n      userId,\n      metadata: { product_id: productId },\n      severity: 'info',\n    }),\n\n  subscriptionCancelled: (userId: string) =>\n    logSecurityEvent({\n      actionType: 'subscription_cancelled',\n      actionCategory: 'subscription',\n      userId,\n      severity: 'warn',\n    }),\n\n  // Withdrawal events\n  withdrawalRequested: (userId: string, amountCents: number) =>\n    logSecurityEvent({\n      actionType: 'withdrawal_requested',\n      actionCategory: 'withdrawal',\n      userId,\n      metadata: { amount_cents: amountCents },\n      severity: 'info',\n    }),\n\n  withdrawalApproved: (adminId: string, userId: string, withdrawalId: string, amountCents: number) =>\n    logSecurityEvent({\n      actionType: 'withdrawal_approved',\n      actionCategory: 'withdrawal',\n      userId,\n      adminId,\n      targetType: 'withdrawal',\n      targetId: withdrawalId,\n      metadata: { amount_cents: amountCents },\n      severity: 'warn',\n    }),\n\n  withdrawalRejected: (adminId: string, userId: string, withdrawalId: string, reason: string) =>\n    logSecurityEvent({\n      actionType: 'withdrawal_rejected',\n      actionCategory: 'withdrawal',\n      userId,\n      adminId,\n      targetType: 'withdrawal',\n      targetId: withdrawalId,\n      metadata: { reason },\n      severity: 'warn',\n    }),\n\n  // Admin events\n  adminAction: (adminId: string, actionType: string, targetType: string, targetId: string, metadata?: Record<string, Json>) =>\n    logSecurityEvent({\n      actionType,\n      actionCategory: 'admin_action',\n      adminId,\n      targetType,\n      targetId,\n      metadata,\n      severity: 'warn',\n    }),\n\n  userBanned: (adminId: string, userId: string, reason: string) =>\n    logSecurityEvent({\n      actionType: 'user_banned',\n      actionCategory: 'moderation',\n      userId,\n      adminId,\n      metadata: { reason },\n      severity: 'critical',\n    }),\n\n  contentFlagged: (userId: string, contentId: string, reason: string) =>\n    logSecurityEvent({\n      actionType: 'content_flagged',\n      actionCategory: 'moderation',\n      userId,\n      targetType: 'content',\n      targetId: contentId,\n      metadata: { reason },\n      severity: 'warn',\n    }),\n\n  // Data access events\n  sensitiveDataAccessed: (userId: string, dataType: string, targetId?: string) =>\n    logSecurityEvent({\n      actionType: 'sensitive_data_accessed',\n      actionCategory: 'data_access',\n      userId,\n      targetType: dataType,\n      targetId,\n      severity: 'info',\n    }),\n};\n";export{n as default};
