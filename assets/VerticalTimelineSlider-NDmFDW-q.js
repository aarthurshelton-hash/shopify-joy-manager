const n='import React, { useEffect, useMemo } from \'react\';\nimport { useTimeline, GamePhase } from \'@/contexts/TimelineContext\';\nimport { Slider } from \'@/components/ui/slider\';\nimport { Button } from \'@/components/ui/button\';\nimport { Play, Pause, SkipBack, SkipForward, RotateCcw, Gauge } from \'lucide-react\';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \'@/components/ui/dropdown-menu\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport { analyzeTimeline, getMomentCounts, TimelineAnalysisResult } from \'@/lib/chess/timelineAnalysis\';\nimport { TimelineMarker, PhaseButton, momentConfig, phaseConfig } from \'./EnhancedTimelineMarker\';\nimport TrajectoryTimelineOverlay from \'./TrajectoryTimelineOverlay\';\nimport { HybridPrediction } from \'@/lib/chess/hybridPrediction\';\nimport { PatternPrediction } from \'@/lib/chess/patternLearning\';\n\ninterface VerticalTimelineSliderProps {\n  totalMoves: number;\n  moves?: string[];\n  pgn?: string;\n  hybridPrediction?: HybridPrediction | null;\n  patternPrediction?: PatternPrediction | null;\n}\n\nconst VerticalTimelineSlider: React.FC<VerticalTimelineSliderProps> = ({ \n  totalMoves, \n  moves = [], \n  pgn,\n  hybridPrediction,\n  patternPrediction,\n}) => {\n  const {\n    currentMove,\n    isPlaying,\n    playbackSpeed,\n    selectedPhase,\n    phaseRanges,\n    setCurrentMove,\n    setMaxMoves,\n    togglePlayback,\n    reset,\n    stepForward,\n    stepBackward,\n    setPlaybackSpeed,\n    setSelectedPhase,\n  } = useTimeline();\n\n  // Comprehensive timeline analysis\n  const analysis: TimelineAnalysisResult | null = useMemo(() => {\n    if (!pgn || moves.length === 0) return null;\n    try {\n      return analyzeTimeline(pgn, moves);\n    } catch {\n      return null;\n    }\n  }, [pgn, moves]);\n\n  // Update max moves when totalMoves changes\n  useEffect(() => {\n    setMaxMoves(totalMoves);\n  }, [totalMoves, setMaxMoves]);\n\n  const range = phaseRanges[selectedPhase];\n  const displayMove = currentMove === Infinity ? range.end : Math.min(currentMove, range.end);\n  const isAtEnd = displayMove >= range.end;\n  const isAtStart = currentMove <= range.start || currentMove === 0;\n\n  // Filter moments to current phase\n  const visibleMoments = useMemo(() => \n    analysis?.moments.filter(m => m.moveNumber >= range.start && m.moveNumber <= range.end) || [],\n    [analysis, range]\n  );\n\n  // Get phase info from analysis\n  const getPhaseInfo = (phase: GamePhase) => {\n    if (phase === \'all\' || !analysis) return undefined;\n    return analysis.phases.find(p => p.name === phase);\n  };\n\n  // Moment counts for summary\n  const momentCounts = useMemo(() => getMomentCounts(visibleMoments), [visibleMoments]);\n\n  // Format move display\n  const getMoveLabel = () => {\n    if (currentMove === Infinity || currentMove >= range.end) {\n      if (selectedPhase === \'all\') return \'All\';\n      return phaseConfig[selectedPhase].label;\n    }\n    if (currentMove === 0 || currentMove === range.start) {\n      return \'Start\';\n    }\n    const moveIndex = currentMove - 1;\n    if (moves[moveIndex]) {\n      const moveNum = Math.floor(moveIndex / 2) + 1;\n      const isWhite = moveIndex % 2 === 0;\n      return `${moveNum}.${isWhite ? \'\' : \'..\'} ${moves[moveIndex]}`;\n    }\n    return `${currentMove}`;\n  };\n\n  // Get current player\n  const getCurrentPlayer = () => {\n    if (currentMove === 0 || currentMove === Infinity) return null;\n    return (currentMove % 2 === 1) ? \'white\' : \'black\';\n  };\n\n  const handleSliderChange = (value: number[]) => {\n    const newValue = value[0];\n    if (newValue >= range.end) {\n      setCurrentMove(Infinity);\n    } else {\n      setCurrentMove(Math.max(newValue, range.start));\n    }\n  };\n\n  const handleMomentClick = (moveNumber: number) => {\n    setCurrentMove(moveNumber);\n  };\n\n  const speedOptions = [\n    { label: \'0.5x\', value: 1000 },\n    { label: \'1x\', value: 500 },\n    { label: \'2x\', value: 250 },\n  ];\n\n  const currentSpeedLabel = speedOptions.find(s => s.value === playbackSpeed)?.label || \'1x\';\n  const player = getCurrentPlayer();\n  const phaseMoveCount = Math.max(range.end - range.start, 1);\n\n  // Calculate position for a moment marker (vertical - from top)\n  const getMomentPosition = (moveNumber: number) => {\n    return ((moveNumber - range.start) / phaseMoveCount) * 100;\n  };\n\n  return (\n    <TooltipProvider>\n      <div className="bg-card/80 backdrop-blur-sm rounded-lg border border-border/50 p-3 h-full flex flex-col w-[120px] min-w-[120px]">\n        {/* Header */}\n        <div className="flex flex-col items-center gap-2 pb-3 border-b border-border/30">\n          <div className="flex items-center gap-2">\n            <span className="text-[10px] font-semibold uppercase tracking-widest text-muted-foreground">\n              Timeline\n            </span>\n            {player && (\n              <div className={`w-2 h-2 rounded-full ${player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n            )}\n          </div>\n          \n          {/* Current move label */}\n          <div className="text-xs font-medium text-center truncate w-full">\n            {getMoveLabel()}\n          </div>\n\n          {/* Accuracy display */}\n          {analysis && (\n            <div className="flex items-center gap-1.5 px-2 py-1 rounded bg-muted/50 border border-border/30">\n              <span className="text-[9px] text-muted-foreground">Accuracy</span>\n              <span className={`text-xs font-bold ${\n                analysis.summary.accuracy >= 90 ? \'text-green-400\' :\n                analysis.summary.accuracy >= 70 ? \'text-yellow-400\' :\n                \'text-red-400\'\n              }`}>\n                {analysis.summary.accuracy}%\n              </span>\n            </div>\n          )}\n        </div>\n\n        {/* Phase filter buttons - vertical stack with hover tooltips */}\n        <div className="flex flex-col gap-1 py-3 border-b border-border/30">\n          {([\'all\', \'opening\', \'middlegame\', \'endgame\'] as const).map((phase) => {\n            const phaseRange = phaseRanges[phase];\n            const moveCount = phaseRange.end - phaseRange.start;\n            \n            // Handle phase click: select the phase AND jump to its start\n            const handlePhaseClick = () => {\n              setSelectedPhase(phase);\n              // Jump to the appropriate position\n              if (phase === \'all\') {\n                // "All" shows the complete visualization\n                setCurrentMove(Infinity);\n              } else {\n                // Other phases jump to their start move\n                setCurrentMove(phaseRange.start);\n              }\n            };\n            \n            return (\n              <PhaseButton\n                key={phase}\n                phase={phase}\n                isActive={selectedPhase === phase}\n                moveCount={moveCount}\n                onClick={handlePhaseClick}\n                phaseInfo={getPhaseInfo(phase)}\n                compact\n              />\n            );\n          })}\n        </div>\n\n        {/* Key moments summary with rich tooltips - clickable to jump to first occurrence */}\n        {visibleMoments.length > 0 && (\n          <div className="py-2 border-b border-border/30">\n            <div className="text-[9px] text-muted-foreground mb-1.5 text-center">Key Moments</div>\n            <div className="flex flex-wrap items-center justify-center gap-1.5">\n              {/* Quality moves */}\n              {momentCounts.brilliant > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'brilliant\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.brilliant.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.brilliant.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.brilliant}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first brilliant move\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.great > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'great\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.great.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.great.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.great}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first great move\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.blunder > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'blunder\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.blunder.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.blunder.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.blunder}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first blunder\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {/* Tactical */}\n              {momentCounts.fork > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'fork\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.fork.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.fork.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.fork}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first fork\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.sacrifice > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'sacrifice\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.sacrifice.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.sacrifice.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.sacrifice}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first sacrifice\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {/* Events */}\n              {momentCounts.checkmate > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'checkmate\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.checkmate.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.checkmate.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.checkmate}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to checkmate\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.check > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'check\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.check.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.check.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.check}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first check\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.castling > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'castling\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.castling.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.castling.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.castling}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first castle\n                  </TooltipContent>\n                </Tooltip>\n              )}\n              {momentCounts.promotion > 0 && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <button \n                      onClick={() => {\n                        const first = visibleMoments.find(m => m.type === \'promotion\');\n                        if (first) setCurrentMove(first.moveNumber);\n                      }}\n                      className={`flex items-center gap-0.5 ${momentConfig.promotion.color} hover:scale-110 transition-transform cursor-pointer`}\n                    >\n                      <momentConfig.promotion.icon className="w-2.5 h-2.5" />\n                      <span className="text-[9px]">{momentCounts.promotion}</span>\n                    </button>\n                  </TooltipTrigger>\n                  <TooltipContent side="right" className="text-xs">\n                    Click to jump to first promotion\n                  </TooltipContent>\n                </Tooltip>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Vertical slider with moment markers and trajectory overlay */}\n        <div className="flex-1 flex items-center justify-center py-4 min-h-[200px]">\n          <div className="relative h-full flex items-center gap-2">\n            {/* Key moment markers on the left side with enhanced tooltips */}\n            <div className="relative h-full w-6">\n              {visibleMoments.slice(0, 25).map((moment, idx) => (\n                <TimelineMarker\n                  key={`${moment.moveNumber}-${moment.type}-${idx}`}\n                  moment={moment}\n                  position={getMomentPosition(moment.moveNumber)}\n                  orientation="vertical"\n                  onClick={() => handleMomentClick(moment.moveNumber)}\n                  size="sm"\n                />\n              ))}\n            </div>\n\n            {/* Vertical slider with trajectory overlay */}\n            <div className="relative h-full flex flex-col items-center">\n              <span className="text-[8px] text-muted-foreground mb-1">Start</span>\n              <div className="relative h-full w-4">\n                <Slider\n                  value={[displayMove]}\n                  min={range.start}\n                  max={range.end}\n                  step={1}\n                  onValueChange={handleSliderChange}\n                  orientation="vertical"\n                  className="h-full"\n                />\n                {/* Trajectory prediction overlay */}\n                {(hybridPrediction || patternPrediction) && (\n                  <TrajectoryTimelineOverlay\n                    hybridPrediction={hybridPrediction}\n                    patternPrediction={patternPrediction}\n                    totalMoves={totalMoves}\n                    currentMove={displayMove}\n                    orientation="vertical"\n                    className="left-6"\n                  />\n                )}\n              </div>\n              <span className="text-[8px] text-muted-foreground mt-1">{range.end}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Controls - compact vertical layout */}\n        <div className="pt-3 border-t border-border/30 space-y-2">\n          {/* Play/Pause row */}\n          <div className="flex items-center justify-center gap-1">\n            <Button\n              variant="ghost"\n              size="sm"\n              onClick={stepBackward}\n              disabled={isAtStart}\n              className="h-7 w-7 p-0"\n              title="Previous move"\n            >\n              <SkipBack className="h-3 w-3" />\n            </Button>\n\n            <Button\n              variant={isPlaying ? "secondary" : "default"}\n              size="sm"\n              onClick={togglePlayback}\n              className="h-8 w-8 p-0 rounded-full"\n              title={isPlaying ? "Pause" : "Play"}\n            >\n              {isPlaying ? (\n                <Pause className="h-4 w-4" />\n              ) : (\n                <Play className="h-4 w-4 ml-0.5" />\n              )}\n            </Button>\n\n            <Button\n              variant="ghost"\n              size="sm"\n              onClick={stepForward}\n              disabled={isAtEnd}\n              className="h-7 w-7 p-0"\n              title="Next move"\n            >\n              <SkipForward className="h-3 w-3" />\n            </Button>\n          </div>\n\n          {/* Reset and Speed row */}\n          <div className="flex items-center justify-center gap-1">\n            <Button\n              variant="ghost"\n              size="sm"\n              onClick={reset}\n              className="h-6 w-6 p-0"\n              title="Reset"\n            >\n              <RotateCcw className="h-3 w-3" />\n            </Button>\n\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button\n                  variant="ghost"\n                  size="sm"\n                  className="h-6 px-1.5 gap-0.5 text-[10px]"\n                  title="Playback speed"\n                >\n                  <Gauge className="h-2.5 w-2.5" />\n                  {currentSpeedLabel}\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align="center" side="top">\n                {speedOptions.map((option) => (\n                  <DropdownMenuItem\n                    key={option.value}\n                    onClick={() => setPlaybackSpeed(option.value)}\n                    className={playbackSpeed === option.value ? \'bg-accent\' : \'\'}\n                  >\n                    {option.label}\n                  </DropdownMenuItem>\n                ))}\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n\n        {/* Progress indicator */}\n        {isPlaying && (\n          <div className="h-1 bg-muted rounded-full overflow-hidden mt-2">\n            <div \n              className="h-full bg-gradient-to-r from-sky-500 via-purple-500 to-rose-500 transition-all duration-100"\n              style={{ width: `${((displayMove - range.start) / phaseMoveCount) * 100}%` }}\n            />\n          </div>\n        )}\n      </div>\n    </TooltipProvider>\n  );\n};\n\nexport default VerticalTimelineSlider;\n';export{n as default};
