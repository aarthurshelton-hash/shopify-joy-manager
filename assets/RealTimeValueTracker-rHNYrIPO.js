const e='import React, { useEffect, useState } from \'react\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { useQuery, useQueryClient } from \'@tanstack/react-query\';\nimport { \n  Activity, \n  Palette, \n  Gamepad2, \n  TrendingUp, \n  Zap,\n  Eye,\n  RefreshCw,\n  Sparkles\n} from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Progress } from \'@/components/ui/progress\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { getPaletteValuePools, getGamecardValuePools, type ValuePool } from \'@/lib/analytics/financialTrends\';\nimport { format } from \'date-fns\';\n\ninterface RecentInteraction {\n  id: string;\n  type: \'palette\' | \'gamecard\';\n  name: string;\n  timestamp: Date;\n}\n\nconst RealTimeValueTracker: React.FC = () => {\n  const queryClient = useQueryClient();\n  const [recentInteractions, setRecentInteractions] = useState<RecentInteraction[]>([]);\n  const [isLive, setIsLive] = useState(true);\n\n  // Fetch palette pools with real-time updates\n  const { data: palettePools, refetch: refetchPalettes } = useQuery({\n    queryKey: [\'admin-palette-pools-live\'],\n    queryFn: getPaletteValuePools,\n    refetchInterval: isLive ? 5000 : false, // Poll every 5 seconds when live\n  });\n\n  // Fetch gamecard pools with real-time updates\n  const { data: gamecardPools, refetch: refetchGamecards } = useQuery({\n    queryKey: [\'admin-gamecard-pools-live\'],\n    queryFn: getGamecardValuePools,\n    refetchInterval: isLive ? 5000 : false,\n  });\n\n  // Subscribe to real-time changes\n  useEffect(() => {\n    if (!isLive) return;\n\n    const paletteChannel = supabase\n      .channel(\'palette-pool-changes\')\n      .on(\n        \'postgres_changes\',\n        { event: \'*\', schema: \'public\', table: \'palette_value_pool\' },\n        (payload) => {\n          console.log(\'Palette pool update:\', payload);\n          refetchPalettes();\n          \n          if (payload.eventType === \'UPDATE\' && payload.new) {\n            const newData = payload.new as any;\n            setRecentInteractions(prev => [{\n              id: `palette-${Date.now()}`,\n              type: \'palette\' as const,\n              name: newData.palette_name || newData.palette_id,\n              timestamp: new Date(),\n            }, ...prev].slice(0, 10));\n          }\n        }\n      )\n      .subscribe();\n\n    const gamecardChannel = supabase\n      .channel(\'gamecard-pool-changes\')\n      .on(\n        \'postgres_changes\',\n        { event: \'*\', schema: \'public\', table: \'gamecard_value_pool\' },\n        (payload) => {\n          console.log(\'Gamecard pool update:\', payload);\n          refetchGamecards();\n          \n          if (payload.eventType === \'UPDATE\' && payload.new) {\n            const newData = payload.new as any;\n            setRecentInteractions(prev => [{\n              id: `gamecard-${Date.now()}`,\n              type: \'gamecard\' as const,\n              name: newData.game_title || newData.game_id,\n              timestamp: new Date(),\n            }, ...prev].slice(0, 10));\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(paletteChannel);\n      supabase.removeChannel(gamecardChannel);\n    };\n  }, [isLive, refetchPalettes, refetchGamecards]);\n\n  const formatCents = (cents: number) => \n    `$${(cents / 100).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n\n  // Calculate totals\n  const totalPaletteValue = (palettePools || []).reduce((sum, p) => sum + p.totalValueCents, 0);\n  const totalGamecardValue = (gamecardPools || []).reduce((sum, g) => sum + g.totalValueCents, 0);\n  const totalInteractions = (palettePools || []).reduce((sum, p) => sum + p.interactionCount, 0) +\n    (gamecardPools || []).reduce((sum, g) => sum + g.interactionCount, 0);\n  const totalEarnedValue = (palettePools || []).reduce((sum, p) => sum + p.earnedValueCents, 0) +\n    (gamecardPools || []).reduce((sum, g) => sum + g.earnedValueCents, 0);\n\n  // Get top performers\n  const topPalettes = (palettePools || [])\n    .filter(p => p.interactionCount > 0)\n    .slice(0, 5);\n  const topGamecards = (gamecardPools || [])\n    .filter(g => g.interactionCount > 0)\n    .slice(0, 5);\n\n  return (\n    <div className="space-y-6">\n      {/* Live Status Header */}\n      <div className="flex items-center justify-between">\n        <div className="flex items-center gap-3">\n          <div className={`p-2 rounded-full ${isLive ? \'bg-green-500/20 animate-pulse\' : \'bg-muted\'}`}>\n            <Activity className={`h-5 w-5 ${isLive ? \'text-green-500\' : \'text-muted-foreground\'}`} />\n          </div>\n          <div>\n            <h3 className="text-lg font-semibold">Real-Time Value Accrual</h3>\n            <p className="text-sm text-muted-foreground">\n              {isLive ? \'Live tracking enabled • Updates every 5 seconds\' : \'Paused\'}\n            </p>\n          </div>\n        </div>\n        <div className="flex items-center gap-2">\n          <button\n            onClick={() => setIsLive(!isLive)}\n            className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${\n              isLive \n                ? \'bg-green-500/20 text-green-500 border border-green-500/30\' \n                : \'bg-muted text-muted-foreground border border-border\'\n            }`}\n          >\n            {isLive ? \'● Live\' : \'○ Paused\'}\n          </button>\n          <button\n            onClick={() => {\n              refetchPalettes();\n              refetchGamecards();\n            }}\n            className="p-2 rounded-md bg-muted hover:bg-muted/80 transition-colors"\n          >\n            <RefreshCw className="h-4 w-4" />\n          </button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">\n        <Card className="border-purple-500/30 bg-gradient-to-br from-purple-500/5 to-purple-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Palette className="h-3 w-3" />\n              <span className="text-xs">Palette Pool</span>\n            </div>\n            <p className="text-xl font-bold text-purple-400">{formatCents(totalPaletteValue)}</p>\n            <p className="text-xs text-muted-foreground">\n              {(palettePools || []).reduce((sum, p) => sum + p.interactionCount, 0)} interactions\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-amber-500/30 bg-gradient-to-br from-amber-500/5 to-amber-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Gamepad2 className="h-3 w-3" />\n              <span className="text-xs">Gamecard Pool</span>\n            </div>\n            <p className="text-xl font-bold text-amber-400">{formatCents(totalGamecardValue)}</p>\n            <p className="text-xs text-muted-foreground">\n              {(gamecardPools || []).reduce((sum, g) => sum + g.interactionCount, 0)} interactions\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-green-500/30 bg-gradient-to-br from-green-500/5 to-green-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <TrendingUp className="h-3 w-3" />\n              <span className="text-xs">Earned Value</span>\n            </div>\n            <p className="text-xl font-bold text-green-400">{formatCents(totalEarnedValue)}</p>\n            <p className="text-xs text-muted-foreground">From orders & trades</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Eye className="h-3 w-3" />\n              <span className="text-xs">Total Interactions</span>\n            </div>\n            <p className="text-xl font-bold">{totalInteractions.toLocaleString()}</p>\n            <p className="text-xs text-muted-foreground">Across all assets</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Activity Feed */}\n      {recentInteractions.length > 0 && (\n        <Card>\n          <CardHeader className="pb-3">\n            <CardTitle className="text-sm flex items-center gap-2">\n              <Zap className="h-4 w-4 text-yellow-500" />\n              Recent Activity\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className="space-y-2">\n              <AnimatePresence mode="popLayout">\n                {recentInteractions.slice(0, 5).map((interaction) => (\n                  <motion.div\n                    key={interaction.id}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: 20 }}\n                    className="flex items-center justify-between py-2 px-3 bg-muted/50 rounded-lg"\n                  >\n                    <div className="flex items-center gap-2">\n                      {interaction.type === \'palette\' ? (\n                        <Palette className="h-4 w-4 text-purple-400" />\n                      ) : (\n                        <Gamepad2 className="h-4 w-4 text-amber-400" />\n                      )}\n                      <span className="text-sm font-medium">{interaction.name}</span>\n                      <Badge variant="outline" className="text-xs">\n                        {interaction.type}\n                      </Badge>\n                    </div>\n                    <span className="text-xs text-muted-foreground">\n                      {format(interaction.timestamp, \'HH:mm:ss\')}\n                    </span>\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Top Performers */}\n      <div className="grid lg:grid-cols-2 gap-6">\n        {/* Top Palettes */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="text-sm flex items-center gap-2">\n              <Palette className="h-4 w-4 text-purple-400" />\n              Most Used Palettes\n            </CardTitle>\n            <CardDescription>By interaction count</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {topPalettes.length > 0 ? (\n              <div className="space-y-3">\n                {topPalettes.map((palette, index) => {\n                  const maxInteractions = Math.max(...topPalettes.map(p => p.interactionCount), 1);\n                  const percentage = (palette.interactionCount / maxInteractions) * 100;\n                  \n                  return (\n                    <div key={palette.id} className="space-y-1">\n                      <div className="flex items-center justify-between text-sm">\n                        <span className="font-medium">{palette.name}</span>\n                        <div className="flex items-center gap-2">\n                          <span className="text-muted-foreground">{palette.interactionCount}</span>\n                          <span className="text-xs text-purple-400">{formatCents(palette.totalValueCents)}</span>\n                        </div>\n                      </div>\n                      <Progress value={percentage} className="h-1.5" />\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className="text-center py-6 text-muted-foreground">\n                <Sparkles className="h-8 w-8 mx-auto mb-2 opacity-40" />\n                <p className="text-sm">No palette interactions yet</p>\n                <p className="text-xs">Interactions will appear as users load games</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Top Gamecards */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="text-sm flex items-center gap-2">\n              <Gamepad2 className="h-4 w-4 text-amber-400" />\n              Most Viewed Gamecards\n            </CardTitle>\n            <CardDescription>By interaction count</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {topGamecards.length > 0 ? (\n              <div className="space-y-3">\n                {topGamecards.map((game) => {\n                  const maxInteractions = Math.max(...topGamecards.map(g => g.interactionCount), 1);\n                  const percentage = (game.interactionCount / maxInteractions) * 100;\n                  \n                  return (\n                    <div key={game.id} className="space-y-1">\n                      <div className="flex items-center justify-between text-sm">\n                        <span className="font-medium truncate max-w-[150px]">{game.name}</span>\n                        <div className="flex items-center gap-2">\n                          <Badge \n                            variant="outline" \n                            className={`text-[10px] ${\n                              game.rarityTier === \'legendary\' ? \'border-amber-500 text-amber-500\' :\n                              game.rarityTier === \'epic\' ? \'border-purple-500 text-purple-500\' :\n                              \'border-blue-500 text-blue-500\'\n                            }`}\n                          >\n                            {game.rarityTier}\n                          </Badge>\n                          <span className="text-muted-foreground">{game.interactionCount}</span>\n                        </div>\n                      </div>\n                      <Progress value={percentage} className="h-1.5" />\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className="text-center py-6 text-muted-foreground">\n                <Sparkles className="h-8 w-8 mx-auto mb-2 opacity-40" />\n                <p className="text-sm">No gamecard interactions yet</p>\n                <p className="text-xs">Interactions will appear as users load famous games</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* All Pools Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle className="text-sm">Complete Value Pool Status</CardTitle>\n          <CardDescription>All registered palettes and gamecards with their current values</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className="grid lg:grid-cols-2 gap-6">\n            {/* Palettes */}\n            <div>\n              <h4 className="font-semibold text-sm mb-3 flex items-center gap-2">\n                <Palette className="h-4 w-4 text-purple-400" />\n                Palettes ({palettePools?.length || 0})\n              </h4>\n              <div className="max-h-[300px] overflow-y-auto space-y-2">\n                {(palettePools || []).map((palette) => (\n                  <div \n                    key={palette.id}\n                    className="flex items-center justify-between py-2 px-3 bg-muted/30 rounded-lg text-sm"\n                  >\n                    <div>\n                      <span className="font-medium">{palette.name}</span>\n                      <div className="text-xs text-muted-foreground">\n                        {palette.interactionCount} views • {palette.usageCount} visions\n                      </div>\n                    </div>\n                    <div className="text-right">\n                      <div className="font-medium">{formatCents(palette.totalValueCents)}</div>\n                      {palette.earnedValueCents > 0 && (\n                        <div className="text-xs text-green-500">+{formatCents(palette.earnedValueCents)}</div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Gamecards */}\n            <div>\n              <h4 className="font-semibold text-sm mb-3 flex items-center gap-2">\n                <Gamepad2 className="h-4 w-4 text-amber-400" />\n                Gamecards ({gamecardPools?.length || 0})\n              </h4>\n              <div className="max-h-[300px] overflow-y-auto space-y-2">\n                {(gamecardPools || []).map((game) => (\n                  <div \n                    key={game.id}\n                    className="flex items-center justify-between py-2 px-3 bg-muted/30 rounded-lg text-sm"\n                  >\n                    <div>\n                      <span className="font-medium truncate block max-w-[180px]">{game.name}</span>\n                      <div className="flex items-center gap-2 text-xs text-muted-foreground">\n                        <Badge \n                          variant="outline" \n                          className={`text-[9px] px-1 py-0 ${\n                            game.rarityTier === \'legendary\' ? \'border-amber-500 text-amber-500\' :\n                            game.rarityTier === \'epic\' ? \'border-purple-500 text-purple-500\' :\n                            \'border-blue-500 text-blue-500\'\n                          }`}\n                        >\n                          {game.rarityTier}\n                        </Badge>\n                        <span>{game.interactionCount} views</span>\n                      </div>\n                    </div>\n                    <div className="text-right">\n                      <div className="font-medium">{formatCents(game.totalValueCents)}</div>\n                      {game.earnedValueCents > 0 && (\n                        <div className="text-xs text-green-500">+{formatCents(game.earnedValueCents)}</div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default RealTimeValueTracker;\n';export{e as default};
