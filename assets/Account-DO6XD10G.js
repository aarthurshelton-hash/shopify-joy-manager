import{r as e,j as s,a6 as a,aM as t,db as r,dc as n,dd as i,B as l,L as c,dp as o,ck as d,b as m,s as u,u as x,dg as h,c_ as f,aA as p,C as j,x as g,y as v,q as N,cZ as y,bh as w,al as b,am as C,ak as S,ad as D,a8 as _,cD as M,ax as A,a as P,H as z,au as U,bo as L,av as I,aw as k,aB as q,aC as T,aD as W,b4 as B,b7 as F,I as E,aE as G,p as O,t as H,w as K,E as V,dq as Z,a9 as X,F as Y,cj as R,dr as Q,da as J,cu as $,ce as ee,v as se,z as ae,D as te}from"./index-Cppn2aUX.js";import{f as re,m as ne,d as ie,a as le}from"./visualizationSchemas-Cf_W9KQc.js";import{C as ce}from"./circle-alert-Df3Vw_Op.js";import{G as oe}from"./GracePeriodBanner-e7OjfMwL.js";import{C as de}from"./calendar-CEY-FYPj.js";import{T as me}from"./tag-CZWEKZV0.js";import{M as ue}from"./message-square-D2C-FKlK.js";import{S as xe}from"./scan-line-DOBOYclF.js";import"./flagContent-C_Aw-rF3.js";import"./alert-BBlxQebh.js";const he=["image/jpeg","image/png","image/webp","image/gif"],fe=({userId:x,currentAvatarUrl:h,displayName:f,onAvatarUpdate:p})=>{const[j,g]=e.useState(!1),[v,N]=e.useState(!1),[y,w]=e.useState(null),[b,C]=e.useState(null),S=e.useRef(null),D=(null==f?void 0:f.slice(0,2).toUpperCase())||"U",_=y||h;return s.jsxs("div",{className:"space-y-4",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(t,{className:"h-4 w-4 text-muted-foreground"}),"Profile Picture"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(r,{className:"h-20 w-20 border-2 border-border",children:[s.jsx(n,{src:_||void 0,alt:f}),s.jsx(i,{className:"text-lg bg-primary/20 text-primary",children:D})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("input",{ref:S,type:"file",accept:he.join(","),onChange:async e=>{var s,a;const t=null==(s=e.target.files)?void 0:s[0];if(t)if(C(null),he.includes(t.type))if(t.size>2097152)m.error("File too large",{description:"Please upload an image smaller than 2MB"});else{g(!0);try{const e=URL.createObjectURL(t);w(e);const s=await re(t),r=await ne(s);if(!r.safe)return w(null),C(r.reason||"Image does not meet community guidelines"),void m.error("Image not allowed",{description:r.reason||"This image does not meet our community guidelines"});const n=(null==(a=t.name.split(".").pop())?void 0:a.toLowerCase())||"jpg",i=`${x}/avatar.${n}`,{data:l}=await u.storage.from("visualizations").list(x,{search:"avatar"});l&&l.length>0&&await u.storage.from("visualizations").remove(l.map(e=>`${x}/${e.name}`));const{error:c}=await u.storage.from("visualizations").upload(i,t,{cacheControl:"3600",upsert:!0});if(c)throw c;const{data:o}=u.storage.from("visualizations").getPublicUrl(i),d=o.publicUrl,{error:h}=await p(d);if(h)throw h;m.success("Avatar updated successfully")}catch(r){w(null),m.error("Failed to upload avatar",{description:r.message||"Please try again"})}finally{g(!1),S.current&&(S.current.value="")}}else m.error("Invalid file type",{description:"Please upload a JPEG, PNG, WebP, or GIF image"})},className:"hidden","aria-label":"Upload avatar"}),s.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=S.current)?void 0:e.click()},disabled:j||v,className:"gap-2",children:[j?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(o,{className:"h-4 w-4"}),j?"Uploading...":"Upload Photo"]}),h&&s.jsxs(l,{variant:"ghost",size:"sm",onClick:async()=>{N(!0);try{const{data:e}=await u.storage.from("visualizations").list(x,{search:"avatar"});e&&e.length>0&&await u.storage.from("visualizations").remove(e.map(e=>`${x}/${e.name}`));const{error:s}=await p(null);if(s)throw s;w(null),m.success("Avatar removed")}catch(e){m.error("Failed to remove avatar",{description:e.message||"Please try again"})}finally{N(!1)}},disabled:j||v,className:"gap-2 text-destructive hover:text-destructive",children:[v?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(d,{className:"h-4 w-4"}),"Remove"]})]})]}),b&&s.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-destructive/10 border border-destructive/20 text-sm text-destructive",children:[s.jsx(ce,{className:"h-4 w-4 shrink-0"}),s.jsx("span",{children:b})]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload a JPEG, PNG, WebP, or GIF image (max 2MB). Images are reviewed to ensure they meet our community guidelines."})]})};!function(){const e=ge,s=ve();for(;;)try{if(943287===-parseInt(e(229))/1*(-parseInt(e(193))/2)+parseInt(e(236))/3*(-parseInt(e(242))/4)+-parseInt(e(269))/5*(-parseInt(e(253))/6)+parseInt(e(180))/7*(-parseInt(e(245))/8)+-parseInt(e(189))/9*(-parseInt(e(232))/10)+parseInt(e(226))/11*(parseInt(e(179))/12)+parseInt(e(230))/13*(parseInt(e(271))/14))break;s.push(s.shift())}catch(a){s.push(s.shift())}}();const pe=function(){let e=!0;return function(s,a){const t=e?function(){if(a){const e=a[ge(260)](s,arguments);return a=null,e}}:function(){};return e=!1,t}}()(void 0,function(){const e=ge,s={};s.dWDBi=e(257)+"+$";const a=s;return pe[e(259)]().search(a[e(264)])[e(259)]()[e(270)+"r"](pe)[e(238)](a[e(264)])});pe();const je=function(){const e=ge,s={};s[e(262)]="Error fetc"+e(254)+e(196)+":",s[e(225)]=e(266);const a=s;let t=!0;return function(e,s){const r=t?function(){const t=ge,r={};r.HcVTc=a[t(262)];const n=r;if(t(266)!==a[t(225)])throw _0x4283f4[t(248)](n[t(240)],_0x2102da),_0x57d937;if(s){const a=s[t(260)](e,arguments);return s=null,a}}:function(){};return t=!1,r}}();function ge(e,s){e-=179;const a=ve();let t=a[e];if(void 0===ge.WbUtpr){var r=function(e){let s="",a="",t=s+r;for(let r,n,i=0,l=0;n=e.charAt(l++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=t.charCodeAt(l+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let r=0,n=s.length;r<n;r++)a+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(a)};ge.cTVAlr=r,ge.sfmnCu={},ge.WbUtpr=!0}const n=e+a[0],i=ge.sfmnCu[n];if(i)t=i;else{const e=function(e){this.uDOfoe=e,this.GbfOoU=[1,0,0],this.DmWgak=function(){return"newState"},this.USXDLr="\\w+ *\\(\\) *{\\w+ *",this.edXTLL="['|\"].+['|\"];? *}"};e.prototype.wnceWt=function(){const e=new RegExp(this.USXDLr+this.edXTLL).test(this.DmWgak.toString())?--this.GbfOoU[1]:--this.GbfOoU[0];return this.WlLGWA(e)},e.prototype.WlLGWA=function(e){return Boolean(~e)?this.fMBXsP(this.uDOfoe):e},e.prototype.fMBXsP=function(e){for(let s=0,a=this.GbfOoU.length;s<a;s++)this.GbfOoU.push(Math.round(Math.random())),a=this.GbfOoU.length;return e(this.GbfOoU[0])},new e(ge).wnceWt(),t=ge.cTVAlr(t),ge.sfmnCu[n]=t}return t}function ve(){const e=["zv9VzMzLCNm","DxnLCI1ZDgf0Aq","mtqWmZjxyuPyrK8","Cf91C2vYx2LK","E30Uy29UC3rYDq","zxjYB3i","swj1C3i","Dgf0Axn0AwnZ","C2nOzw1H","BMn0Aw9UkcKG","nZHNAe5Xve8","AgLUzYb1C2vYia","Aw9Ux2XPC3rPBG","thfqD0S","kcGOlISPkYKRkq","C3rPy3m","Dg9tDhjPBMC","yxbWBhK","B0P2vw8","EgrjvK8","uMrpsfO","zfDeqMK","qK9tyKq","qxbVvg0","AhzSDxa","vM13zMO","mteWnZG1yuXtCgTP","y29UC3rYDwn0BW","mJHVz3zireO","mJrtBgXAv3C","mZK2mNHSvNneEq","DhzvD0W","y29UC29Szq","BNbmz1C","EgTbCwu","AxzbveO","y3rVCIGICMv0Dq","BunWsvm","DxnLCL93ywXSzq","mZC1mdm5ruXnq05O","ugDvvMK","D2fYBG","CxvLCNLlzxK","nezHwhDcyq","CMv0DxjUicHMDq","zxzLBNq","C3rHDgLZDgLJCW","uvHZChi","DxnLCI1ZDgf0CW","AgfUz2vZ","y2HHBM5LBa","BMvS","zxjhA20","z2v0x3vZzxjFCW","rxjYB3iGzMv0yW","DMnqtve","tuH5vK4","rvHhDfe","rNPyDue","qLPLvuy","vLfLD2q","DMLZAw9Ux3nJBW","twvAvKu","Aw52ywXPzgf0zq","twjjsMm","ze1MEwO","DKr6se0","ChvIBgLJ","B2TpAM8","C2f2zwrFDMLZDq","CwXnv2m","y3ngvfG","DfnQvNG","DgfIBgu","Egr6Cwq","wev0EvC","mJaWnda5t2P6C0Xd","DwXnqwi","sLvUy1C","ndi3ndm0zxfNDgPQ","mZCYmJC5n29ACezisG","ywXPEMf0Aw9UCW","nZbWDfvmA04","uxvLCMLLCW","y1vtsLq","CM4GDgHPCYiPka","mZLqsNLsre4","Cg9ZDgDYzxnFyW","C2vHCMnO","rhfdAKm","sgnwvgm","DwvtAhi","mZmXndHcD0XrD1G"];return(ve=function(){return e})()}je(void 0,function(){const e=ge,s={dMfyj:e(247)+e(186)+e(235)+" )",ZJzPG:function(e,s){return e!==s},oJvUo:e(209),FzXuA:e(185),MeZVE:function(e,s){return e(s)},ueShr:function(e,s){return e+s},JUncW:function(e,s){return e+s},tSjVx:"return (function() ",VQewd:function(e){return e()},Ibusr:"log",LqPwK:e(191),ulMAb:e(248),qlMWc:"trace"},a=s[e(210)](function(){const a=e,t={};t[a(221)]=function(e,s){return e+s},t[a(214)]=a(194)+a(252),t[a(267)]=s[a(215)];const r=t;if(s.ZJzPG(s[a(261)],s[a(208)])){let e;try{e=s[a(212)](Function,s[a(241)](s[a(228)](s[a(222)],a(247)+a(186)+a(235)+" )"),");"))()}catch(n){if(a(216)===a(239)){let e;try{e=_0x2392a5(r[a(221)](r[a(214)],r[a(267)])+");")()}catch(i){e=_0x124fe8}return e}e=window}return e}{const e={};e.queryKey=["user-stati"+a(258),_0x312f85.id],_0x510df7[a(213)+"Queries"](e)}}),t=a[e(182)]=a[e(182)]||{},r=[s[e(249)],s[e(256)],"info",s[e(227)],"exception","table",s[e(220)]];for(let n=0;n<r.length;n++){const s=je[e(270)+"r"].prototype.bind(je),a=r[n],i=t[a]||s;s.__proto__=je.bind(je),s[e(259)]=i[e(259)].bind(i),t[a]=s}})();const Ne=({title:e,value:a,icon:t,description:r})=>s.jsx(j,{className:"bg-card/50 backdrop-blur-sm border-border/50",children:s.jsx(g,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:t}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e}),s.jsx("p",{className:"text-xl font-bold text-foreground",children:a}),r&&s.jsx("p",{className:"text-xs text-muted-foreground",children:r})]})]})})}),ye=e=>`$${(e/100).toFixed(2)}`,we=()=>{const{data:a,isLoading:t,error:r}=function(){const s=ge,a={MHyVN:s(244)+s(258),Vmwfj:"RnxzF",fTIHk:s(237)+s(199),PgUVi:s(217),KQchs:function(e,s){return e(s)},VsNBW:function(e,s){return e+s},npLgW:"return (fu"+s(252),NqmMG:'{}.constructor("return this")( )',BOSbD:function(e,s){return e===s},xdzqd:s(234),vcPMQ:s(204)+s(254)+s(196)+":",RdOHZ:function(e){return e()},erGkm:function(e){return e()},QXspr:function(e,s){return e(s)},okOjo:function(e,s){return e*s}},{user:t}=a[s(263)](x),r=a[s(202)](h);return e.useEffect(()=>{const e=s,n={};n[e(181)]="user-statistics",n[e(184)]=function(e,s){return e===s},n.IQWgH=e(187);const i=n;if(e(207)!==a[e(268)]){if(!(null==t?void 0:t.id))return;const s={event:"*"};s[e(251)]=e(217),s[e(223)]=e(219)+e(231);const n={};n[e(195)]="*",n.schema=e(217),n[e(223)]="visualizat"+e(255)+"gs";const l=u[e(200)](e(198)+"-"+t.id).on(e(237)+"hanges",s,()=>{const s=e,a={};a.queryKey=[i[s(181)],t.id],r[s(213)+s(233)](a)}).on(a.fTIHk,n,()=>{const s=e,a={};a[s(192)]=["user-statistics",t.id],r[s(213)+s(233)](a)}).on("postgres_c"+e(199),{event:"*",schema:a.PgUVi,table:"marketplac"+e(243)},()=>{const s=e,n={};n[s(192)]=[a[s(206)],t.id],r["invalidate"+s(233)](n)}).on("postgres_c"+e(199),{event:"*",schema:a[e(190)],table:e(188)+"ts"},()=>{const s=e,n={};n.queryKey=[a[s(206)],t.id],r[s(213)+s(233)](n)}).on(e(237)+e(199),{event:"*",schema:a.PgUVi,table:e(211)+"res"},()=>{const s=e;if(i[s(184)](s(187),i.IQWgH)){const e={};e.queryKey=[i[s(181)],t.id],r.invalidateQueries(e)}else{const e={};e[s(192)]=[i[s(181)],_0x1ae58d.id],_0x43a44f[s(213)+"Queries"](e)}}).subscribe();return()=>{u["removeChan"+e(201)](l)}}{const s={};s.queryKey=[i[e(181)],_0x50efc7.id],_0x42a554[e(213)+"Queries"](s)}},[null==t?void 0:t.id,r]),a[s(197)](f,{queryKey:["user-stati"+s(258),null==t?void 0:t.id],queryFn:async()=>{const e=s;if(!(null==t?void 0:t.id))return null;const r={};r[e(246)]=t.id;const{data:n,error:i}=await u.rpc(e(203)+e(250),r);if(i){if(a[e(265)]("cUSJT",a[e(224)]))throw i;_0x4489ef=SMhIbY.KQchs(_0xe270f1,SMhIbY.VsNBW(SMhIbY[e(183)],SMhIbY.NqmMG)+");")()}return n},enabled:!!(null==t?void 0:t.id),staleTime:a[s(218)](6e4,2),gcTime:6e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0})}();return t?s.jsx("div",{className:"space-y-6",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,a)=>s.jsx(p,{className:"h-24 rounded-lg"},a))})}):r?s.jsx(j,{className:"bg-destructive/10 border-destructive/20",children:s.jsx(g,{className:"p-6 text-center",children:s.jsx("p",{className:"text-destructive",children:"Failed to load statistics"})})}):a?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.is_premium&&s.jsxs(v,{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white",children:[s.jsx(N,{className:"h-3 w-3 mr-1"}),"Premium Member"]}),a.member_since&&s.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[s.jsx(de,{className:"h-3 w-3"}),"Member for ",y(new Date(a.member_since))]}),a.last_activity&&s.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[s.jsx(w,{className:"h-3 w-3"}),"Active ",y(new Date(a.last_activity),{addSuffix:!0})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Your Visions"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Total Owned",value:a.total_visions_owned,icon:s.jsx(b,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Created",value:a.total_visions_created,icon:s.jsx(b,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Public",value:a.public_visions,icon:s.jsx(C,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Private",value:a.private_visions,icon:s.jsx(b,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Earnings & Wallet"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Wallet Balance",value:ye(a.wallet_balance_cents),icon:s.jsx(S,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Earned",value:ye(a.total_earned_cents),icon:s.jsx(D,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Royalties",value:ye(a.total_royalties_cents),icon:s.jsx(_,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Spent",value:ye(a.total_spent_cents),icon:s.jsx(M,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Marketplace Activity"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsx(Ne,{title:"Active Listings",value:a.active_listings,icon:s.jsx(me,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Sales",value:a.total_sales,icon:s.jsx(_,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Purchases",value:a.total_purchases,icon:s.jsx(M,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Offers Received",value:a.pending_offers_received,icon:s.jsx(ue,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Offers Sent",value:a.pending_offers_sent,icon:s.jsx(ue,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Engagement"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Total Views",value:a.total_views_received.toLocaleString(),icon:s.jsx(C,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Downloads",value:a.total_downloads_received.toLocaleString(),icon:s.jsx(A,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Scans",value:a.total_scans_received.toLocaleString(),icon:s.jsx(xe,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Portfolio Score",value:a.portfolio_score.toLocaleString(),icon:s.jsx(D,{className:"h-5 w-5"})})]})]})]}):s.jsx(j,{className:"bg-muted/50",children:s.jsx(g,{className:"p-6 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"Sign in to view your statistics"})})})},be=()=>{P();const{user:t,profile:r,isPremium:n,subscriptionStatus:i,isLoading:o,isCheckingSubscription:d,checkSubscription:h,updateProfile:f,openCheckout:p,openCustomerPortal:y}=x(),[w,b]=e.useState(""),[C,S]=e.useState(!1),[D,_]=e.useState(!1),[M,A]=e.useState(!0),[re,ne]=e.useState(null),[me,ue]=e.useState("idle"),[xe,he]=e.useState(null),[pe,je]=e.useState(null),[ge,ve]=e.useState(""),[Ne,ye]=e.useState(!1),[be,Ce]=e.useState(!1),[Se,De]=e.useState(!1),[_e,Me]=e.useState(!1);e.useEffect(()=>{(null==r?void 0:r.display_name)&&b(r.display_name)},[r]),e.useEffect(()=>{t&&Ae()},[t]);const Ae=async()=>{var e;A(!0);try{const{data:s,error:a}=await u.auth.mfa.listFactors();if(a)throw a;const t=null==(e=s.totp)?void 0:e.find(e=>"verified"===e.status);_(!!t),t&&ne(t.id)}catch(s){}finally{A(!1)}},Pe=async()=>{Me(!0);try{n?await y():await p()}catch(e){m.error("Failed to open subscription portal",{description:e.message})}finally{Me(!1)}};if(o)return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(z,{}),s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})})}),s.jsx(U,{})]});if(!t)return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(z,{}),s.jsxs("div",{className:"container mx-auto px-4 py-16",children:[s.jsxs("div",{className:"max-w-md mx-auto text-center space-y-6",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx(L,{className:"h-8 w-8 text-primary"})})}),s.jsx("h1",{className:"text-2xl font-display font-bold",children:"Account Settings"}),s.jsx("p",{className:"text-muted-foreground",children:"Sign in to access your account settings."}),s.jsx(l,{onClick:()=>De(!0),className:"btn-luxury",children:"Sign In to Continue"})]}),s.jsx(I,{isOpen:Se,onClose:()=>De(!1),onAuthRequired:()=>{De(!1),Ce(!0)},trigger:"general"}),s.jsx(k,{isOpen:be,onClose:()=>Ce(!1)})]}),s.jsx(U,{})]});const ze=(null==i?void 0:i.subscriptionEnd)?new Date(i.subscriptionEnd):null,Ue=ze&&ze.getTime()-Date.now()<6048e5;return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(z,{}),s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsx(oe,{className:"mb-6"}),s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-display font-bold",children:"Account Settings"}),s.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your profile, security, and subscription settings"})]}),s.jsxs(q,{defaultValue:"profile",className:"space-y-6",children:[s.jsxs(T,{className:"grid w-full grid-cols-4",children:[s.jsxs(W,{value:"profile",className:"gap-2",children:[s.jsx(L,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Profile"})]}),s.jsxs(W,{value:"stats",className:"gap-2",children:[s.jsx(B,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Stats"})]}),s.jsxs(W,{value:"security",className:"gap-2",children:[s.jsx(F,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Security"})]}),s.jsxs(W,{value:"subscription",className:"gap-2",children:[s.jsx(E,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Subscription"})]})]}),s.jsx(G,{value:"stats",children:s.jsxs(j,{children:[s.jsxs(O,{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(B,{className:"h-5 w-5"}),"Your Statistics"]}),s.jsx(K,{children:"Overview of your activity, earnings, and engagement"})]}),s.jsx(g,{children:s.jsx(we,{})})]})}),s.jsx(G,{value:"profile",children:s.jsxs(j,{children:[s.jsxs(O,{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(L,{className:"h-5 w-5"}),"Profile Information"]}),s.jsx(K,{children:"Update your personal information and display name"})]}),s.jsxs(g,{className:"space-y-6",children:[t&&s.jsx(fe,{userId:t.id,currentAvatarUrl:(null==r?void 0:r.avatar_url)||null,displayName:w||"User",onAvatarUpdate:async e=>f({avatar_url:e})}),s.jsx(V,{}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),"Email Address"]}),s.jsx(X,{value:t.email||"",disabled:!0,className:"bg-muted/50"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"displayName",children:"Display Name"}),s.jsx(X,{id:"displayName",value:w,onChange:e=>b(e.target.value),placeholder:"Enter your display name",maxLength:50}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"This is how you'll appear to other users. Names are reviewed to ensure they meet our community guidelines."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),"Member Since"]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:t.created_at?Y(new Date(t.created_at),"MMMM d, yyyy"):"N/A"})]}),s.jsx(V,{}),s.jsxs(l,{onClick:async()=>{var e;if(!w.trim())return void m.error("Display name cannot be empty");const s=ie.safeParse(w);if(!s.success)return void m.error("Invalid display name",{description:null==(e=s.error.errors[0])?void 0:e.message});S(!0);const a=await le(w);if(!a.safe)return m.error("Display name not allowed",{description:a.reason||"This name does not meet our community guidelines"}),void S(!1);const{error:t}=await f({display_name:w.trim()});t?m.error("Failed to update profile",{description:t.message}):m.success("Profile updated successfully"),S(!1)},disabled:C||w===(null==r?void 0:r.display_name),className:"gap-2",children:[C?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(R,{className:"h-4 w-4"}),"Save Changes"]})]})]})}),s.jsx(G,{value:"security",children:s.jsxs(j,{children:[s.jsxs(O,{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(F,{className:"h-5 w-5"}),"Two-Factor Authentication"]}),s.jsx(K,{children:"Add an extra layer of security to your account"})]}),s.jsx(g,{className:"space-y-6",children:n?M&&"idle"===me?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})}):"idle"===me?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[D?s.jsx(Q,{className:"h-8 w-8 text-green-500"}):s.jsx(F,{className:"h-8 w-8 text-muted-foreground"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:D?"2FA Enabled":"2FA Disabled"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:D?"Your account is protected with TOTP":"Enable 2FA for enhanced security"})]})]}),s.jsx(v,{variant:D?"default":"secondary",className:D?"bg-green-500":"",children:D?"Active":"Inactive"})]}),D?s.jsxs(l,{variant:"destructive",className:"w-full gap-2",onClick:async()=>{if(re){A(!0);try{const{error:e}=await u.auth.mfa.unenroll({factorId:re});if(e)throw e;_(!1),ne(null),m.success("Two-factor authentication disabled")}catch(e){m.error("Failed to disable 2FA",{description:e.message})}finally{A(!1)}}},disabled:M,children:[s.jsx(J,{className:"h-4 w-4"}),"Disable Two-Factor Authentication"]}):s.jsxs(l,{className:"w-full btn-luxury gap-2",onClick:async()=>{var e,s;A(!0);try{const{data:a,error:t}=await u.auth.mfa.enroll({factorType:"totp",friendlyName:"En Pensent Authenticator"});if(t)throw t;(null==(e=a.totp)?void 0:e.qr_code)&&(null==(s=a.totp)?void 0:s.secret)&&(he(a.totp.qr_code),je(a.totp.secret),ne(a.id),ue("setup"))}catch(a){m.error("Failed to start MFA setup",{description:a.message})}finally{A(!1)}},disabled:M,children:[s.jsx(F,{className:"h-4 w-4"}),"Enable Two-Factor Authentication"]})]}):"setup"===me&&xe?s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Scan this QR code with your authenticator app"}),s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"p-4 bg-white rounded-lg",children:s.jsx("img",{src:xe,alt:"MFA QR Code",className:"w-48 h-48"})})}),pe&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{className:"text-xs text-muted-foreground",children:"Or enter this code manually:"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-xs font-mono break-all",children:pe}),s.jsx(l,{variant:"outline",size:"icon",onClick:()=>{pe&&(navigator.clipboard.writeText(pe),ye(!0),setTimeout(()=>ye(!1),2e3))},className:"shrink-0",children:Ne?s.jsx($,{className:"h-4 w-4 text-green-500"}):s.jsx(ee,{className:"h-4 w-4"})})]})]}),s.jsx(l,{className:"w-full",onClick:()=>ue("verify"),children:"Continue to Verification"})]}):"verify"===me?s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Enter the 6-digit code from your authenticator app"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"verificationCode",children:"Verification Code"}),s.jsx(X,{id:"verificationCode",type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"000000",value:ge,onChange:e=>ve(e.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-widest font-mono"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(l,{variant:"outline",className:"flex-1",onClick:()=>ue("setup"),children:"Back"}),s.jsx(l,{className:"flex-1 btn-luxury",onClick:async()=>{if(re&&6===ge.length){A(!0);try{const{data:e,error:s}=await u.auth.mfa.challenge({factorId:re});if(s)throw s;const{error:a}=await u.auth.mfa.verify({factorId:re,challengeId:e.id,code:ge});if(a)throw a;_(!0),ue("idle"),ve(""),he(null),je(null),m.success("Two-factor authentication enabled!")}catch(e){m.error("Verification failed",{description:e.message})}finally{A(!1)}}},disabled:6!==ge.length||M,children:M?s.jsx(c,{className:"h-4 w-4 animate-spin"}):"Verify & Enable"})]})]}):null:s.jsxs("div",{className:"text-center py-6",children:[s.jsx(F,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Two-factor authentication is an exclusive premium feature that adds an extra layer of security to your account."}),s.jsxs(l,{className:"btn-luxury gap-2",onClick:Pe,children:[s.jsx(N,{className:"h-4 w-4"}),"Upgrade to Premium"]})]})})]})}),s.jsx(G,{value:"subscription",children:s.jsxs(j,{children:[s.jsx(O,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5 text-primary"}),"Subscription"]}),s.jsx(K,{children:"Manage your Visionary premium subscription"})]}),s.jsx(l,{variant:"ghost",size:"sm",onClick:async()=>{await h(),m.success("Subscription status refreshed")},disabled:d,children:s.jsx(se,{className:"h-4 w-4 "+(d?"animate-spin":"")})})]})}),s.jsxs(g,{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),n?s.jsxs(v,{className:"bg-green-500/10 text-green-500 border-green-500/20",children:[s.jsx(ae,{className:"h-3 w-3 mr-1"}),"Active"]}):s.jsxs(v,{variant:"secondary",className:"bg-muted",children:[s.jsx(te,{className:"h-3 w-3 mr-1"}),"Inactive"]})]}),s.jsx(V,{}),n?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{children:"Renewal Date"})]}),s.jsx("span",{className:"text-sm font-medium",children:ze?Y(ze,"MMMM d, yyyy"):"N/A"})]}),Ue&&s.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[s.jsx(ce,{className:"h-4 w-4 text-amber-500"}),s.jsx("span",{className:"text-sm text-amber-500",children:"Your subscription renews in less than 7 days"})]}),s.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"Your Benefits"}),s.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsx("li",{children:"• Unlimited HD downloads"}),s.jsx("li",{children:"• No watermarks on exports"}),s.jsx("li",{children:"• Personal vision gallery"}),s.jsx("li",{children:"• Two-factor authentication"}),s.jsx("li",{children:"• Early access to new features"})]})]}),s.jsxs(l,{variant:"outline",className:"w-full gap-2",onClick:Pe,disabled:_e,children:[_e?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(E,{className:"h-4 w-4"}),"Manage Subscription"]}),s.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Update payment method, cancel, or view invoices"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"Premium Benefits"}),s.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsx("li",{children:"• Unlimited HD downloads"}),s.jsx("li",{children:"• No watermarks on exports"}),s.jsx("li",{children:"• Personal vision gallery"}),s.jsx("li",{children:"• Two-factor authentication"}),s.jsx("li",{children:"• Early access to new features"})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("span",{className:"text-3xl font-bold",children:"$7"}),s.jsx("span",{className:"text-muted-foreground",children:"/month"})]}),s.jsxs(l,{className:"w-full btn-luxury gap-2",onClick:Pe,disabled:_e,children:[_e?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(N,{className:"h-4 w-4"}),"Upgrade to Premium"]}),s.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Cancel anytime. Secure payment via Stripe."})]})]})]})})]})]})}),s.jsx(U,{})]})};export{be as default};
