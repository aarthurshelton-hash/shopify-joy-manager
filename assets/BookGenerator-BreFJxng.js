const e="import React, { useState, useCallback, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Slider } from '@/components/ui/slider';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { toast } from 'sonner';\nimport { \n  BookOpen, \n  Download, \n  Pause, \n  RotateCcw, \n  Image as ImageIcon,\n  FileText,\n  Sparkles,\n  CheckCircle2,\n  XCircle,\n  Loader2,\n  Lock,\n  Zap,\n  PlayCircle,\n  Save,\n  RefreshCw,\n  ImageDown,\n  FolderDown,\n  Archive,\n  ShoppingCart,\n  ExternalLink,\n  Package,\n  Crown,\n  Flame\n} from 'lucide-react';\nimport { CarlsenGame } from '@/lib/book/carlsenGames';\nimport { FischerGame } from '@/lib/book/fischerGames';\nimport { BookConfig, BookType, BOOK_CONFIGS, getBookConfig, GameType } from '@/lib/book/bookConfig';\nimport { BookSpread } from '@/components/book/BookSpread';\nimport { simulateGame } from '@/lib/chess/gameSimulator';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useAuth } from '@/hooks/useAuth';\nimport { jsPDF } from 'jspdf';\n\ninterface GeneratedSpread {\n  game: GameType;\n  haiku: string;\n  visualizationImage: string;\n  status: 'pending' | 'generating' | 'complete' | 'error';\n}\n\ninterface SavedProgress {\n  game_index: number;\n  haiku: string | null;\n  visualization_data: string | null;\n  status: string;\n}\n\nconst BookGenerator: React.FC = () => {\n  const { user, isLoading: authLoading } = useAuth();\n  const [isAuthorized, setIsAuthorized] = useState(false);\n  const [checkingAuth, setCheckingAuth] = useState(true);\n  \n  // Book selection state\n  const [selectedBook, setSelectedBook] = useState<BookType>('carlsen');\n  const bookConfig = getBookConfig(selectedBook);\n  \n  const [spreads, setSpreads] = useState<GeneratedSpread[]>([]);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [previewIndex, setPreviewIndex] = useState(0);\n  const [isExporting, setIsExporting] = useState(false);\n  const [batchSize, setBatchSize] = useState(5);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isLoadingProgress, setIsLoadingProgress] = useState(false);\n  const [generatingSingleIndex, setGeneratingSingleIndex] = useState<number | null>(null);\n  const [isExportingImages, setIsExportingImages] = useState(false);\n  const [exportingIndex, setExportingIndex] = useState<number | null>(null);\n  const [imageExportProgress, setImageExportProgress] = useState(0);\n  const pauseRef = React.useRef(false);\n\n  // Initialize spreads when book changes\n  useEffect(() => {\n    const games = bookConfig.games;\n    setSpreads(\n      games.map(game => ({\n        game,\n        haiku: '',\n        visualizationImage: '',\n        status: 'pending',\n      }))\n    );\n    setPreviewIndex(0);\n    setCurrentIndex(0);\n  }, [selectedBook, bookConfig.games]);\n\n  // Check admin authorization using has_role RPC\n  useEffect(() => {\n    const checkAuthorization = async () => {\n      if (authLoading) return;\n      \n      if (!user) {\n        setIsAuthorized(false);\n        setCheckingAuth(false);\n        return;\n      }\n\n      try {\n        const { data, error } = await supabase.rpc('has_role', {\n          _user_id: user.id,\n          _role: 'admin'\n        });\n        \n        if (error) throw error;\n        setIsAuthorized(!!data);\n      } catch (error) {\n        console.error('Authorization check failed:', error);\n        setIsAuthorized(false);\n      }\n      \n      setCheckingAuth(false);\n    };\n\n    checkAuthorization();\n  }, [user, authLoading]);\n\n  // Load saved progress on mount or book change\n  useEffect(() => {\n    if (isAuthorized && user && spreads.length > 0) {\n      loadSavedProgress();\n    }\n  }, [isAuthorized, user, selectedBook]);\n\n  const loadSavedProgress = async () => {\n    if (!user) return;\n    \n    setIsLoadingProgress(true);\n    try {\n      // Use book-specific key for game_title prefix\n      const { data, error } = await supabase\n        .from('book_generation_progress')\n        .select('game_index, haiku, visualization_data, status')\n        .eq('user_id', user.id)\n        .like('game_title', `${selectedBook}:%`);\n\n      if (error) throw error;\n\n      if (data && data.length > 0) {\n        setSpreads(prev => {\n          const updated = [...prev];\n          (data as SavedProgress[]).forEach(saved => {\n            if (saved.game_index >= 0 && saved.game_index < updated.length) {\n              updated[saved.game_index] = {\n                ...updated[saved.game_index],\n                haiku: saved.haiku || '',\n                visualizationImage: saved.visualization_data || '',\n                status: saved.status as 'pending' | 'generating' | 'complete' | 'error',\n              };\n            }\n          });\n          return updated;\n        });\n        toast.success(`Loaded ${data.length} saved spreads for ${bookConfig.title}`);\n      }\n    } catch (error) {\n      console.error('Failed to load progress:', error);\n      toast.error('Failed to load saved progress');\n    } finally {\n      setIsLoadingProgress(false);\n    }\n  };\n\n  const saveProgressToDatabase = async () => {\n    if (!user) return;\n    \n    setIsSaving(true);\n    try {\n      const completedSpreads = spreads\n        .map((spread, index) => ({ spread, index }))\n        .filter(({ spread }) => spread.status === 'complete');\n\n      if (completedSpreads.length === 0) {\n        toast.info('No completed spreads to save');\n        setIsSaving(false);\n        return;\n      }\n\n      // Upsert all completed spreads with book-specific prefix\n      const upsertData = completedSpreads.map(({ spread, index }) => ({\n        user_id: user.id,\n        game_index: index,\n        game_title: `${selectedBook}:${spread.game.title}`,\n        haiku: spread.haiku,\n        visualization_data: spread.visualizationImage,\n        status: spread.status,\n      }));\n\n      const { error } = await supabase\n        .from('book_generation_progress')\n        .upsert(upsertData, { \n          onConflict: 'user_id,game_index',\n          ignoreDuplicates: false \n        });\n\n      if (error) throw error;\n      toast.success(`Saved ${completedSpreads.length} spreads to database`);\n    } catch (error) {\n      console.error('Failed to save progress:', error);\n      toast.error('Failed to save progress');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const saveSingleSpread = async (index: number) => {\n    if (!user) return;\n    \n    const spread = spreads[index];\n    if (spread.status !== 'complete') return;\n\n    try {\n      const { error } = await supabase\n        .from('book_generation_progress')\n        .upsert({\n          user_id: user.id,\n          game_index: index,\n          game_title: `${selectedBook}:${spread.game.title}`,\n          haiku: spread.haiku,\n          visualization_data: spread.visualizationImage,\n          status: spread.status,\n        }, { \n          onConflict: 'user_id,game_index',\n          ignoreDuplicates: false \n        });\n\n      if (error) throw error;\n    } catch (error) {\n      console.error('Failed to save spread:', error);\n    }\n  };\n\n  const completedCount = spreads.filter(s => s.status === 'complete').length;\n  const errorCount = spreads.filter(s => s.status === 'error').length;\n  const generatingCount = spreads.filter(s => s.status === 'generating').length;\n  const progress = spreads.length > 0 ? (completedCount / spreads.length) * 100 : 0;\n\n  const generateHaiku = async (game: GameType): Promise<string> => {\n    try {\n      const { data, error } = await supabase.functions.invoke('generate-haiku', {\n        body: {\n          title: game.title,\n          white: game.white,\n          black: game.black,\n          event: game.event,\n          year: game.year,\n          result: game.result,\n          significance: game.significance,\n        },\n      });\n\n      if (error) throw error;\n      return data.haiku || 'Silent pieces move\\nAcross the checkered cosmos\\nVictory awaits';\n    } catch (error) {\n      console.error('Haiku generation failed:', error);\n      return 'Silent pieces move\\nAcross the checkered cosmos\\nVictory awaits';\n    }\n  };\n\n  const generateVisualization = async (game: GameType): Promise<string> => {\n    console.log(`[BookGenerator] Starting visualization generation for: ${game.title}`);\n    try {\n      const simulation = simulateGame(game.pgn);\n      \n      if (!simulation || !simulation.board || simulation.board.length === 0) {\n        console.error('[BookGenerator] Simulation failed - empty board returned');\n        toast.error('Failed to simulate game', { description: 'Invalid PGN data' });\n        return '';\n      }\n      \n      console.log(`[BookGenerator] Simulation successful, generating image...`);\n      \n      // Use the print image generator\n      const { generateCleanPrintImage } = await import('@/lib/chess/printImageGenerator');\n      const imageDataUrl = await generateCleanPrintImage(simulation, {\n        darkMode: false,\n        includeQR: false,\n      });\n      \n      if (!imageDataUrl || imageDataUrl === '') {\n        console.error('[BookGenerator] generateCleanPrintImage returned empty string');\n        toast.error('Visualization generation failed', { description: 'Image generation returned empty result' });\n        return '';\n      }\n      \n      console.log(`[BookGenerator] Visualization generated successfully for: ${game.title}`);\n      return imageDataUrl;\n    } catch (error) {\n      console.error('[BookGenerator] Visualization generation failed:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n      toast.error('Failed to generate visualization', { \n        description: errorMessage,\n        duration: 5000\n      });\n      return '';\n    }\n  };\n\n  const generateSpread = async (index: number, autoSave = false): Promise<boolean> => {\n    const currentSpread = spreads[index];\n    if (!currentSpread || currentSpread.status === 'complete') return true;\n    \n    const game = currentSpread.game;\n    \n    setSpreads(prev => prev.map((s, i) => \n      i === index ? { ...s, status: 'generating' } : s\n    ));\n\n    try {\n      const [haiku, visualizationImage] = await Promise.all([\n        generateHaiku(game),\n        generateVisualization(game),\n      ]);\n\n      setSpreads(prev => prev.map((s, i) => \n        i === index ? { ...s, haiku, visualizationImage, status: 'complete' } : s\n      ));\n      \n      if (autoSave) {\n        setTimeout(() => saveSingleSpread(index), 100);\n      }\n      \n      return true;\n    } catch (error) {\n      console.error(`Error generating spread ${index}:`, error);\n      setSpreads(prev => prev.map((s, i) => \n        i === index ? { ...s, status: 'error' } : s\n      ));\n      return false;\n    }\n  };\n\n  const generateSingleSpread = async (index: number) => {\n    setGeneratingSingleIndex(index);\n    setPreviewIndex(index);\n    toast.info(`Generating spread #${index + 1}: ${spreads[index].game.title}`);\n    \n    const success = await generateSpread(index, true);\n    \n    if (success) {\n      toast.success(`Spread #${index + 1} generated successfully!`);\n    } else {\n      toast.error(`Failed to generate spread #${index + 1}`);\n    }\n    \n    setGeneratingSingleIndex(null);\n  };\n\n  const startBatchGeneration = useCallback(async () => {\n    setIsGenerating(true);\n    pauseRef.current = false;\n    \n    const pendingIndices = spreads\n      .map((s, i) => ({ status: s.status, index: i }))\n      .filter(s => s.status === 'pending' || s.status === 'error')\n      .map(s => s.index);\n\n    toast.info(`Starting batch generation of ${pendingIndices.length} spreads (${batchSize} parallel)`);\n\n    for (let i = 0; i < pendingIndices.length; i += batchSize) {\n      if (pauseRef.current) {\n        toast.info('Generation paused - saving progress...');\n        await saveProgressToDatabase();\n        break;\n      }\n\n      const batch = pendingIndices.slice(i, i + batchSize);\n      setCurrentIndex(batch[0]);\n      \n      await Promise.all(batch.map(index => generateSpread(index, true)));\n      \n      if (i + batchSize < pendingIndices.length) {\n        await new Promise(resolve => setTimeout(resolve, 300));\n      }\n    }\n\n    setIsGenerating(false);\n    \n    if (!pauseRef.current) {\n      await saveProgressToDatabase();\n      const newCompleted = spreads.filter(s => s.status === 'complete').length;\n      toast.success(`Generation complete! ${newCompleted} spreads ready and saved.`);\n    }\n  }, [spreads, batchSize, user]);\n\n  const pauseGeneration = () => {\n    pauseRef.current = true;\n    setIsPaused(true);\n    setIsGenerating(false);\n  };\n\n  const resetGeneration = () => {\n    const games = bookConfig.games;\n    setSpreads(\n      games.map(game => ({\n        game,\n        haiku: '',\n        visualizationImage: '',\n        status: 'pending',\n      }))\n    );\n    setCurrentIndex(0);\n    setIsGenerating(false);\n    setIsPaused(false);\n  };\n\n  const generateHighResSpreadImage = async (spread: GeneratedSpread): Promise<string> => {\n    const html2canvas = (await import('html2canvas')).default;\n    \n    const container = document.createElement('div');\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n    container.style.width = '1200px';\n    document.body.appendChild(container);\n    \n    try {\n      const React = await import('react');\n      const ReactDOM = await import('react-dom/client');\n      const { BookSpread } = await import('@/components/book/BookSpread');\n      \n      const spreadElement = document.createElement('div');\n      container.appendChild(spreadElement);\n      \n      const root = ReactDOM.createRoot(spreadElement);\n      await new Promise<void>((resolve) => {\n        root.render(\n          React.createElement(BookSpread, {\n            game: spread.game as CarlsenGame,\n            haiku: spread.haiku,\n            visualizationImage: spread.visualizationImage,\n            pageNumber: spread.game.rank,\n          })\n        );\n        setTimeout(resolve, 200);\n      });\n      \n      await new Promise(resolve => setTimeout(resolve, 300));\n      \n      const canvas = await html2canvas(spreadElement, {\n        scale: 3,\n        backgroundColor: '#F5F5DC',\n        useCORS: true,\n        allowTaint: true,\n        logging: false,\n        width: 1200,\n        height: 840,\n      });\n      \n      const base64 = canvas.toDataURL('image/png', 1.0);\n      root.unmount();\n      \n      return base64;\n    } finally {\n      document.body.removeChild(container);\n    }\n  };\n\n  const exportSingleSpreadImage = async (index: number) => {\n    const spread = spreads[index];\n    if (spread.status !== 'complete') {\n      toast.error('This spread is not yet generated');\n      return;\n    }\n    \n    setExportingIndex(index);\n    toast.info(`Generating high-res image for spread #${index + 1}...`);\n    \n    try {\n      const imageData = await generateHighResSpreadImage(spread);\n      \n      const link = document.createElement('a');\n      link.href = imageData;\n      link.download = `${selectedBook}-spread-${String(spread.game.rank).padStart(3, '0')}-${spread.game.id}.png`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      toast.success(`Downloaded spread #${spread.game.rank} (300 DPI)`);\n    } catch (error) {\n      console.error('Export failed:', error);\n      toast.error('Failed to export image');\n    } finally {\n      setExportingIndex(null);\n    }\n  };\n\n  const exportAllSpreadImages = async () => {\n    const completedSpreads = spreads.filter(s => s.status === 'complete');\n    \n    if (completedSpreads.length === 0) {\n      toast.error('No completed spreads to export');\n      return;\n    }\n    \n    setIsExportingImages(true);\n    setImageExportProgress(0);\n    toast.info(`Starting export of ${completedSpreads.length} high-res images...`);\n    \n    try {\n      for (let i = 0; i < completedSpreads.length; i++) {\n        const spread = completedSpreads[i];\n        \n        try {\n          const imageData = await generateHighResSpreadImage(spread);\n          \n          const link = document.createElement('a');\n          link.href = imageData;\n          link.download = `${selectedBook}-spread-${String(spread.game.rank).padStart(3, '0')}-${spread.game.id}.png`;\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n          \n          await new Promise(resolve => setTimeout(resolve, 500));\n        } catch (error) {\n          console.error(`Failed to export spread ${spread.game.rank}:`, error);\n        }\n        \n        setImageExportProgress(((i + 1) / completedSpreads.length) * 100);\n      }\n      \n      toast.success(`Exported ${completedSpreads.length} high-res images (300 DPI)`);\n    } catch (error) {\n      console.error('Batch export failed:', error);\n      toast.error('Failed to export images');\n    } finally {\n      setIsExportingImages(false);\n      setImageExportProgress(0);\n    }\n  };\n\n  const exportAsZip = async () => {\n    const completedSpreads = spreads.filter(s => s.status === 'complete');\n    \n    if (completedSpreads.length === 0) {\n      toast.error('No completed spreads to export');\n      return;\n    }\n    \n    setIsExportingImages(true);\n    setImageExportProgress(0);\n    toast.info(`Creating ZIP archive with cover, TOC, and ${completedSpreads.length} high-res images...`);\n    \n    try {\n      const JSZip = (await import('jszip')).default;\n      const zip = new JSZip();\n      \n      const folderName = selectedBook === 'fischer' ? 'fischer-in-color' : 'carlsen-in-color';\n      const mainFolder = zip.folder(folderName);\n      const spreadsFolder = mainFolder?.folder('spreads');\n      \n      try {\n        const coverResponse = await fetch(bookConfig.cover);\n        const coverBlob = await coverResponse.blob();\n        const coverBuffer = await coverBlob.arrayBuffer();\n        mainFolder?.file('00-cover.jpg', coverBuffer);\n      } catch (coverError) {\n        console.warn('Could not add cover to ZIP:', coverError);\n      }\n      \n      const tocContent = generateTableOfContents(completedSpreads);\n      mainFolder?.file('README.md', tocContent);\n      \n      const metadata = generateMetadataJson(completedSpreads);\n      mainFolder?.file('metadata.json', JSON.stringify(metadata, null, 2));\n      \n      for (let i = 0; i < completedSpreads.length; i++) {\n        const spread = completedSpreads[i];\n        \n        try {\n          const imageData = await generateHighResSpreadImage(spread);\n          const base64Data = imageData.split(',')[1];\n          const filename = `spread-${String(spread.game.rank).padStart(3, '0')}-${spread.game.id}.png`;\n          spreadsFolder?.file(filename, base64Data, { base64: true });\n        } catch (error) {\n          console.error(`Failed to add spread ${spread.game.rank} to ZIP:`, error);\n        }\n        \n        setImageExportProgress(((i + 1) / completedSpreads.length) * 100);\n      }\n      \n      toast.info('Compressing archive...');\n      const zipBlob = await zip.generateAsync({ \n        type: 'blob',\n        compression: 'DEFLATE',\n        compressionOptions: { level: 6 }\n      });\n      \n      const url = URL.createObjectURL(zipBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `${folderName}-complete-${new Date().toISOString().split('T')[0]}.zip`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      toast.success(`Downloaded complete archive: cover, TOC, metadata, and ${completedSpreads.length} spreads`);\n    } catch (error) {\n      console.error('ZIP export failed:', error);\n      toast.error('Failed to create ZIP archive');\n    } finally {\n      setIsExportingImages(false);\n      setImageExportProgress(0);\n    }\n  };\n\n  const generateTableOfContents = (completedSpreads: GeneratedSpread[]): string => {\n    const now = new Date().toLocaleDateString('en-US', { \n      year: 'numeric', month: 'long', day: 'numeric' \n    });\n    \n    const playerName = selectedBook === 'fischer' ? 'Bobby Fischer' : 'Magnus Carlsen';\n    \n    let toc = `# ${bookConfig.title}\n## ${bookConfig.subtitle}\n\n**Generated:** ${now}\n**Format:** 300 DPI Print-Ready PNG (3600×2520px)\n**Color Palette:** ${bookConfig.paletteDisplayName}\n**Spreads Included:** ${completedSpreads.length}\n\n---\n\n## About This Collection\n\nThis archive contains high-resolution book spreads from \"${bookConfig.title},\" \na visual celebration of ${playerName}'s greatest chess games, rendered \nthrough the En Pensent visualization system with unique haiku poetry.\n\nEach spread features:\n- Left page: Original haiku inspired by the game\n- Right page: En Pensent visualization using the ${bookConfig.paletteDisplayName} palette\n\n---\n\n## Table of Contents\n\n| # | Title | Players | Event | Year | Result |\n|---|-------|---------|-------|------|--------|\n`;\n\n    completedSpreads.forEach(spread => {\n      toc += `| ${spread.game.rank} | ${spread.game.title} | ${spread.game.white} vs ${spread.game.black} | ${spread.game.event} | ${spread.game.year} | ${spread.game.result} |\\n`;\n    });\n\n    toc += `\n---\n\n## Print Specifications\n\n- **Recommended Paper:** 100lb gloss text or matte art paper\n- **Binding:** Smyth-sewn hardcover\n- **Trim Size:** 12\" × 8.4\" (spread, folded to 6\" × 8.4\" per page)\n- **Color Profile:** sRGB\n\n---\n\n## Order Physical Copies\n\nVisit [enpensent.com/shop](https://enpensent.com/shop) to order professionally \nprinted copies of \"${bookConfig.title}.\"\n\n- **Standard Edition (8.5\"×11\"):** ${bookConfig.standardPrice}\n- **Large Format (11\"×14\"):** ${bookConfig.largePrice}\n\n---\n\n© En Pensent • All Rights Reserved\n`;\n\n    return toc;\n  };\n\n  const generateMetadataJson = (completedSpreads: GeneratedSpread[]) => {\n    return {\n      title: `${bookConfig.title}: ${bookConfig.subtitle}`,\n      bookType: selectedBook,\n      version: \"1.0\",\n      generated: new Date().toISOString(),\n      palette: bookConfig.paletteDisplayName,\n      format: {\n        resolution: \"300 DPI\",\n        dimensions: \"3600×2520px\",\n        fileType: \"PNG\"\n      },\n      spreads: completedSpreads.map(spread => ({\n        rank: spread.game.rank,\n        id: spread.game.id,\n        title: spread.game.title,\n        white: spread.game.white,\n        black: spread.game.black,\n        event: spread.game.event,\n        year: spread.game.year,\n        result: spread.game.result,\n        significance: spread.game.significance,\n        haiku: spread.haiku.split('\\n').filter(l => l.trim()),\n        filename: `spreads/spread-${String(spread.game.rank).padStart(3, '0')}-${spread.game.id}.png`\n      })),\n      ordering: {\n        standardEdition: {\n          price: bookConfig.standardPrice,\n          size: \"8.5×11 inches\",\n          weight: \"2.5 lbs\"\n        },\n        largeFormat: {\n          price: bookConfig.largePrice, \n          size: \"11×14 inches\",\n          weight: \"4 lbs\"\n        },\n        url: \"https://enpensent.com/shop\"\n      }\n    };\n  };\n\n  const exportToPDF = async () => {\n    if (completedCount === 0) {\n      toast.error('No spreads generated yet');\n      return;\n    }\n\n    setIsExporting(true);\n    toast.info('Generating PDF... This may take a few minutes.');\n\n    try {\n      const pdf = new jsPDF({\n        orientation: 'landscape',\n        unit: 'mm',\n        format: 'a4',\n      });\n\n      const pageWidth = 297;\n      const pageHeight = 210;\n\n      // Add cover page\n      const coverImg = new Image();\n      coverImg.src = bookConfig.cover;\n      await new Promise(resolve => {\n        coverImg.onload = resolve;\n        coverImg.onerror = resolve;\n      });\n\n      if (coverImg.complete && coverImg.naturalWidth > 0) {\n        pdf.addImage(coverImg, 'JPEG', 0, 0, pageWidth, pageHeight);\n      } else {\n        pdf.setFillColor(245, 245, 220);\n        pdf.rect(0, 0, pageWidth, pageHeight, 'F');\n        pdf.setFont('times', 'bold');\n        pdf.setFontSize(48);\n        pdf.setTextColor(44, 44, 44);\n        pdf.text(bookConfig.title, pageWidth / 2, pageHeight / 2 - 20, { align: 'center' });\n        pdf.setFont('times', 'italic');\n        pdf.setFontSize(24);\n        pdf.text(bookConfig.subtitle, pageWidth / 2, pageHeight / 2 + 10, { align: 'center' });\n      }\n\n      // Add title page\n      pdf.addPage();\n      pdf.setFillColor(245, 245, 220);\n      pdf.rect(0, 0, pageWidth, pageHeight, 'F');\n      pdf.setFont('times', 'bold');\n      pdf.setFontSize(36);\n      pdf.setTextColor(44, 44, 44);\n      pdf.text(bookConfig.title, pageWidth / 2, 60, { align: 'center' });\n      pdf.setFont('times', 'italic');\n      pdf.setFontSize(18);\n      pdf.text(bookConfig.subtitle, pageWidth / 2, 80, { align: 'center' });\n      pdf.setFont('times', 'normal');\n      pdf.setFontSize(12);\n      pdf.text('Visualized with the En Pensent System', pageWidth / 2, 100, { align: 'center' });\n      pdf.text(`${bookConfig.paletteDisplayName} Palette`, pageWidth / 2, 115, { align: 'center' });\n\n      // Add legend page\n      pdf.addPage();\n      pdf.setFillColor(245, 245, 220);\n      pdf.rect(0, 0, pageWidth, pageHeight, 'F');\n      pdf.setFont('times', 'bold');\n      pdf.setFontSize(24);\n      pdf.text('How to Read the Visualizations', pageWidth / 2, 30, { align: 'center' });\n      \n      pdf.setFont('times', 'normal');\n      pdf.setFontSize(12);\n      \n      const legendDescription = selectedBook === 'fischer' \n        ? [\n            'Each visualization maps the journey of every piece across the 64 squares.',\n            '',\n            'White pieces are shown in Egyptian gold tones (golds, ambers, bronzes).',\n            'Black pieces are shown in mystical tones (deep blues, purples, teals).',\n            '',\n            'When multiple pieces visit the same square, their colors layer',\n            'creating a unique visual fingerprint of the game.',\n            '',\n            'The resulting abstract artwork captures the essence of each',\n            \"masterpiece from Bobby Fischer's legendary career.\",\n          ]\n        : [\n            'Each visualization maps the journey of every piece across the 64 squares.',\n            '',\n            'White pieces are shown in cool tones (blues, teals, purples).',\n            'Black pieces are shown in warm tones (reds, oranges, magentas).',\n            '',\n            'When multiple pieces visit the same square, their colors layer',\n            'creating a unique visual fingerprint of the game.',\n            '',\n            'The resulting abstract artwork captures the essence of each',\n            \"masterpiece from Magnus Carlsen's legendary career.\",\n          ];\n      \n      legendDescription.forEach((line, i) => {\n        pdf.text(line, pageWidth / 2, 60 + (i * 12), { align: 'center' });\n      });\n\n      // Add game spreads\n      const completedSpreads = spreads.filter(s => s.status === 'complete');\n      \n      for (let i = 0; i < completedSpreads.length; i++) {\n        const spread = completedSpreads[i];\n        pdf.addPage();\n        \n        pdf.setFillColor(245, 245, 220);\n        pdf.rect(0, 0, pageWidth, pageHeight, 'F');\n        \n        const halfWidth = pageWidth / 2;\n        \n        pdf.setDrawColor(200, 200, 200);\n        pdf.line(halfWidth, 20, halfWidth, pageHeight - 20);\n        \n        pdf.setFont('times', 'normal');\n        pdf.setFontSize(10);\n        pdf.setTextColor(107, 107, 107);\n        pdf.text(spread.game.title.toUpperCase(), halfWidth / 2, 50, { align: 'center' });\n        \n        pdf.setFont('times', 'italic');\n        pdf.setFontSize(18);\n        pdf.setTextColor(44, 44, 44);\n        const haikuLines = spread.haiku.split('\\n').filter(l => l.trim());\n        haikuLines.forEach((line, lineIndex) => {\n          pdf.text(line, halfWidth / 2, 85 + (lineIndex * 18), { align: 'center' });\n        });\n        \n        pdf.setFont('times', 'normal');\n        pdf.setFontSize(10);\n        pdf.setTextColor(107, 107, 107);\n        pdf.text(`${spread.game.white} vs ${spread.game.black}`, halfWidth / 2, 150, { align: 'center' });\n        pdf.text(`${spread.game.event}, ${spread.game.year}`, halfWidth / 2, 162, { align: 'center' });\n        \n        pdf.setFontSize(9);\n        pdf.text(`${(i + 1) * 2}`, 20, pageHeight - 15);\n        \n        if (spread.visualizationImage) {\n          try {\n            const imgSize = Math.min(halfWidth - 30, pageHeight - 60);\n            const imgX = halfWidth + (halfWidth - imgSize) / 2;\n            const imgY = (pageHeight - imgSize) / 2;\n            pdf.addImage(spread.visualizationImage, 'PNG', imgX, imgY, imgSize, imgSize);\n          } catch (imgError) {\n            console.error('Error adding visualization image:', imgError);\n            pdf.setFont('times', 'italic');\n            pdf.setFontSize(12);\n            pdf.setTextColor(107, 107, 107);\n            pdf.text('Visualization', halfWidth + halfWidth / 2, pageHeight / 2, { align: 'center' });\n          }\n        }\n        \n        pdf.setFont('times', 'bold');\n        pdf.setFontSize(9);\n        pdf.setTextColor(107, 107, 107);\n        pdf.text(`#${spread.game.rank}`, pageWidth - 20, 25, { align: 'right' });\n        \n        pdf.text(`${(i + 1) * 2 + 1}`, pageWidth - 20, pageHeight - 15, { align: 'right' });\n      }\n\n      // Add colophon\n      pdf.addPage();\n      pdf.setFillColor(245, 245, 220);\n      pdf.rect(0, 0, pageWidth, pageHeight, 'F');\n      pdf.setFont('times', 'italic');\n      pdf.setFontSize(12);\n      pdf.setTextColor(107, 107, 107);\n      pdf.text('Colophon', pageWidth / 2, 60, { align: 'center' });\n      pdf.setFont('times', 'normal');\n      pdf.setFontSize(10);\n      const colophonText = [\n        `${bookConfig.title}: ${bookConfig.subtitle}`,\n        '',\n        'Visualizations created with the En Pensent system',\n        `using the ${bookConfig.paletteDisplayName} color palette.`,\n        '',\n        'Haiku poetry generated with AI assistance.',\n        '',\n        `Generated on ${new Date().toLocaleDateString()}`,\n        '',\n        '© En Pensent',\n      ];\n      colophonText.forEach((line, i) => {\n        pdf.text(line, pageWidth / 2, 90 + (i * 12), { align: 'center' });\n      });\n\n      const filename = selectedBook === 'fischer' ? 'Fischer-in-Color.pdf' : 'Carlsen-in-Color.pdf';\n      pdf.save(filename);\n      toast.success('PDF exported successfully!');\n    } catch (error) {\n      console.error('PDF export failed:', error);\n      toast.error('Failed to export PDF');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const currentSpread = spreads[previewIndex];\n\n  // Authorization check\n  if (checkingAuth || authLoading) {\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-12 h-12 animate-spin mx-auto mb-4 text-[#2C2C2C]\" />\n          <p className=\"text-[#6B6B6B]\">Checking authorization...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthorized) {\n    return (\n      <div className=\"min-h-screen bg-[#F5F5DC] flex items-center justify-center\">\n        <Card className=\"max-w-md bg-white/80 border-[#D4D4C4]\">\n          <CardHeader className=\"text-center\">\n            <Lock className=\"w-16 h-16 mx-auto mb-4 text-[#6B6B6B]\" />\n            <CardTitle className=\"font-serif\">Access Restricted</CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-center space-y-4\">\n            <p className=\"text-[#6B6B6B]\">\n              The Book Generator is exclusively available to authorized personnel.\n            </p>\n            <p className=\"text-sm text-[#9B9B9B]\">\n              Please sign in with an authorized account to access this feature.\n            </p>\n            <Button \n              onClick={() => window.location.href = '/'}\n              variant=\"outline\"\n              className=\"border-[#2C2C2C]\"\n            >\n              Return to Home\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F5DC] text-[#2C2C2C]\">\n      {/* Header */}\n      <header className=\"border-b border-[#D4D4C4] px-6 py-4\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <BookOpen className=\"w-8 h-8\" />\n            <div>\n              <h1 className=\"text-2xl font-serif font-bold\">Book Generator</h1>\n              <p className=\"text-sm text-[#6B6B6B]\">CEO Access • Admin Tools</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-3\">\n            <Badge variant=\"outline\" className=\"border-amber-600 text-amber-700\">\n              <Zap className=\"w-3 h-3 mr-1\" />\n              Batch: {batchSize} parallel\n            </Badge>\n            <Badge variant=\"outline\" className=\"border-[#2C2C2C]\">\n              {completedCount}/{spreads.length} Complete\n            </Badge>\n            {generatingCount > 0 && (\n              <Badge className=\"bg-amber-600\">\n                {generatingCount} In Progress\n              </Badge>\n            )}\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-7xl mx-auto p-6\">\n        {/* Book Selector Tabs */}\n        <Tabs value={selectedBook} onValueChange={(v) => setSelectedBook(v as BookType)} className=\"mb-6\">\n          <TabsList className=\"grid w-full max-w-md grid-cols-2 bg-[#E8E8D8]\">\n            <TabsTrigger \n              value=\"carlsen\" \n              className=\"flex items-center gap-2 data-[state=active]:bg-amber-100 data-[state=active]:text-amber-900\"\n              disabled={isGenerating}\n            >\n              <Crown className=\"w-4 h-4\" />\n              Carlsen\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"fischer\" \n              className=\"flex items-center gap-2 data-[state=active]:bg-amber-100 data-[state=active]:text-amber-900\"\n              disabled={isGenerating}\n            >\n              <Flame className=\"w-4 h-4\" />\n              Fischer\n            </TabsTrigger>\n          </TabsList>\n          \n          {/* Book Info Banner */}\n          <div className={`mt-4 p-4 rounded-lg border ${\n            selectedBook === 'fischer' \n              ? 'bg-gradient-to-r from-amber-100 to-yellow-50 border-amber-300' \n              : 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200'\n          }`}>\n            <div className=\"flex items-center gap-3\">\n              {selectedBook === 'fischer' ? (\n                <Flame className=\"w-8 h-8 text-amber-700\" />\n              ) : (\n                <Crown className=\"w-8 h-8 text-amber-600\" />\n              )}\n              <div>\n                <h2 className=\"text-xl font-serif font-bold text-[#2C2C2C]\">{bookConfig.title}</h2>\n                <p className=\"text-sm text-[#6B6B6B]\">\n                  {bookConfig.subtitle} • <span className=\"font-medium\">{bookConfig.paletteDisplayName}</span> Palette\n                </p>\n              </div>\n            </div>\n            <p className=\"mt-2 text-sm text-[#6B6B6B]\">{bookConfig.description}</p>\n          </div>\n        </Tabs>\n\n        <div className=\"grid lg:grid-cols-3 gap-6\">\n          {/* Control Panel */}\n          <Card className=\"lg:col-span-1 bg-white/50 border-[#D4D4C4]\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Sparkles className=\"w-5 h-5\" />\n                Generation Controls\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Progress */}\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span>Progress</span>\n                  <span>{Math.round(progress)}%</span>\n                </div>\n                <Progress value={progress} className=\"h-2\" />\n              </div>\n\n              {/* Batch Size Control */}\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"flex items-center gap-1\">\n                    <Zap className=\"w-4 h-4\" />\n                    Parallel Batch Size\n                  </span>\n                  <span className=\"font-mono\">{batchSize}</span>\n                </div>\n                <Slider\n                  value={[batchSize]}\n                  onValueChange={(value) => setBatchSize(value[0])}\n                  min={1}\n                  max={10}\n                  step={1}\n                  disabled={isGenerating}\n                  className=\"w-full\"\n                />\n                <p className=\"text-xs text-[#6B6B6B]\">\n                  Higher values = faster but may hit rate limits\n                </p>\n              </div>\n\n              {/* Control Buttons */}\n              <div className=\"grid grid-cols-2 gap-2\">\n                {!isGenerating ? (\n                  <Button \n                    onClick={startBatchGeneration}\n                    className=\"col-span-2 bg-[#2C2C2C] hover:bg-[#1C1C1C]\"\n                    disabled={isLoadingProgress}\n                  >\n                    <Zap className=\"w-4 h-4 mr-2\" />\n                    {completedCount > 0 ? 'Resume' : 'Start'} Batch Generation\n                  </Button>\n                ) : (\n                  <Button \n                    onClick={pauseGeneration}\n                    variant=\"outline\"\n                    className=\"col-span-2 border-[#2C2C2C]\"\n                  >\n                    <Pause className=\"w-4 h-4 mr-2\" />\n                    Pause & Save\n                  </Button>\n                )}\n                \n                {currentSpread && (\n                  <Button \n                    onClick={() => generateSingleSpread(previewIndex)}\n                    variant=\"outline\"\n                    className=\"col-span-2 border-amber-600 text-amber-700 hover:bg-amber-50\"\n                    disabled={isGenerating || generatingSingleIndex !== null || currentSpread.status === 'complete'}\n                  >\n                    {generatingSingleIndex === previewIndex ? (\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    ) : (\n                      <PlayCircle className=\"w-4 h-4 mr-2\" />\n                    )}\n                    Generate Single Spread #{previewIndex + 1}\n                  </Button>\n                )}\n                \n                <Button \n                  onClick={resetGeneration}\n                  variant=\"outline\"\n                  className=\"border-[#D4D4C4]\"\n                  disabled={isGenerating}\n                >\n                  <RotateCcw className=\"w-4 h-4 mr-2\" />\n                  Reset\n                </Button>\n                \n                <Button \n                  onClick={saveProgressToDatabase}\n                  variant=\"outline\"\n                  className=\"border-green-600 text-green-700 hover:bg-green-50\"\n                  disabled={isGenerating || isSaving || completedCount === 0}\n                >\n                  {isSaving ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Save className=\"w-4 h-4 mr-2\" />\n                  )}\n                  Save Progress\n                </Button>\n                \n                <Button \n                  onClick={loadSavedProgress}\n                  variant=\"outline\"\n                  className=\"border-blue-600 text-blue-700 hover:bg-blue-50\"\n                  disabled={isGenerating || isLoadingProgress}\n                >\n                  {isLoadingProgress ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <RefreshCw className=\"w-4 h-4 mr-2\" />\n                  )}\n                  Load Saved\n                </Button>\n                \n                <Button \n                  onClick={exportToPDF}\n                  disabled={completedCount === 0 || isExporting}\n                  className=\"bg-amber-700 hover:bg-amber-800\"\n                >\n                  {isExporting ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <Download className=\"w-4 h-4 mr-2\" />\n                  )}\n                  Export PDF\n                </Button>\n              </div>\n\n              {/* High-Res Image Export Section */}\n              <div className=\"space-y-3 p-3 rounded-lg bg-purple-50 border border-purple-200\">\n                <h4 className=\"text-sm font-medium text-purple-900 flex items-center gap-2\">\n                  <ImageDown className=\"w-4 h-4\" />\n                  300 DPI High-Res Export\n                </h4>\n                <p className=\"text-xs text-purple-700\">\n                  Export individual spreads as print-ready PNG files (3600×2520px)\n                </p>\n                \n                {isExportingImages && (\n                  <div className=\"space-y-1\">\n                    <Progress value={imageExportProgress} className=\"h-2\" />\n                    <p className=\"text-xs text-purple-600 text-center\">\n                      {Math.round(imageExportProgress)}% complete\n                    </p>\n                  </div>\n                )}\n                \n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Button \n                    onClick={() => exportSingleSpreadImage(previewIndex)}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"border-purple-400 text-purple-700 hover:bg-purple-100\"\n                    disabled={isExportingImages || exportingIndex !== null || !currentSpread || currentSpread.status !== 'complete'}\n                  >\n                    {exportingIndex === previewIndex ? (\n                      <Loader2 className=\"w-3 h-3 mr-1 animate-spin\" />\n                    ) : (\n                      <ImageDown className=\"w-3 h-3 mr-1\" />\n                    )}\n                    Export #{previewIndex + 1}\n                  </Button>\n                  \n                  <Button \n                    onClick={exportAllSpreadImages}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"border-purple-400 text-purple-700 hover:bg-purple-100\"\n                    disabled={isExportingImages || completedCount === 0}\n                  >\n                    {isExportingImages ? (\n                      <Loader2 className=\"w-3 h-3 mr-1 animate-spin\" />\n                    ) : (\n                      <FolderDown className=\"w-3 h-3 mr-1\" />\n                    )}\n                    Individual\n                  </Button>\n                  \n                  <Button \n                    onClick={exportAsZip}\n                    size=\"sm\"\n                    className=\"col-span-2 bg-purple-700 hover:bg-purple-800 text-white\"\n                    disabled={isExportingImages || completedCount === 0}\n                  >\n                    {isExportingImages ? (\n                      <Loader2 className=\"w-3 h-3 mr-1 animate-spin\" />\n                    ) : (\n                      <Archive className=\"w-3 h-3 mr-1\" />\n                    )}\n                    Download ZIP ({completedCount} images)\n                  </Button>\n                </div>\n              </div>\n\n              {/* Print Order Section */}\n              <div className=\"space-y-3 p-3 rounded-lg bg-amber-50 border border-amber-200\">\n                <h4 className=\"text-sm font-medium text-amber-900 flex items-center gap-2\">\n                  <Package className=\"w-4 h-4\" />\n                  Order Physical Book\n                </h4>\n                <p className=\"text-xs text-amber-700\">\n                  Ready to print? Order your hardcover coffee table book through our print partner.\n                </p>\n                \n                <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                  <div className=\"p-2 bg-white/60 rounded\">\n                    <div className=\"font-medium text-amber-900\">Standard</div>\n                    <div className=\"text-amber-700\">8.5\" × 11\" • {bookConfig.standardPrice}</div>\n                    <div className=\"text-amber-600\">~2.5 lbs</div>\n                  </div>\n                  <div className=\"p-2 bg-white/60 rounded\">\n                    <div className=\"font-medium text-amber-900\">Large Format</div>\n                    <div className=\"text-amber-700\">11\" × 14\" • {bookConfig.largePrice}</div>\n                    <div className=\"text-amber-600\">~4 lbs</div>\n                  </div>\n                </div>\n\n                <Button \n                  onClick={() => window.open('https://printify-shop-manager-fs4kw.myshopify.com/collections/all?q=book', '_blank')}\n                  size=\"sm\"\n                  className=\"w-full bg-amber-700 hover:bg-amber-800 text-white\"\n                  disabled={completedCount < 100}\n                >\n                  <ShoppingCart className=\"w-3 h-3 mr-1\" />\n                  {completedCount < 100 ? `Complete all spreads first (${completedCount}/100)` : 'Order Print Book'}\n                  <ExternalLink className=\"w-3 h-3 ml-1\" />\n                </Button>\n                \n                {completedCount === 100 && (\n                  <p className=\"text-xs text-center text-amber-600\">\n                    ✓ All spreads ready • Book will ship in 5-7 business days\n                  </p>\n                )}\n              </div>\n\n              <Separator className=\"bg-[#D4D4C4]\" />\n\n              {/* Stats */}\n              <div className=\"grid grid-cols-3 gap-4 text-center\">\n                <div>\n                  <div className=\"text-2xl font-bold\">{completedCount}</div>\n                  <div className=\"text-xs text-[#6B6B6B]\">Complete</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold\">{spreads.filter(s => s.status === 'generating').length}</div>\n                  <div className=\"text-xs text-[#6B6B6B]\">In Progress</div>\n                </div>\n                <div>\n                  <div className=\"text-2xl font-bold\">{errorCount}</div>\n                  <div className=\"text-xs text-[#6B6B6B]\">Errors</div>\n                </div>\n              </div>\n\n              <Separator className=\"bg-[#D4D4C4]\" />\n\n              {/* Game List */}\n              <div className=\"space-y-2\">\n                <h3 className=\"font-medium text-sm\">Games</h3>\n                <ScrollArea className=\"h-[300px] rounded border border-[#D4D4C4]\">\n                  <div className=\"p-2 space-y-1\">\n                    {spreads.map((spread, index) => (\n                      <button\n                        key={spread.game.id}\n                        onClick={() => setPreviewIndex(index)}\n                        className={`w-full text-left px-3 py-2 rounded text-sm transition-colors ${\n                          previewIndex === index \n                            ? 'bg-[#2C2C2C] text-white' \n                            : 'hover:bg-[#E8E8D8]'\n                        }`}\n                      >\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"truncate flex-1\">\n                            #{spread.game.rank} {spread.game.title}\n                          </span>\n                          {spread.status === 'complete' && (\n                            <CheckCircle2 className=\"w-4 h-4 text-green-600 ml-2 flex-shrink-0\" />\n                          )}\n                          {spread.status === 'generating' && (\n                            <Loader2 className=\"w-4 h-4 text-amber-600 ml-2 flex-shrink-0 animate-spin\" />\n                          )}\n                          {spread.status === 'error' && (\n                            <XCircle className=\"w-4 h-4 text-red-600 ml-2 flex-shrink-0\" />\n                          )}\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Preview Panel */}\n          <Card className=\"lg:col-span-2 bg-white/50 border-[#D4D4C4]\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BookOpen className=\"w-5 h-5\" />\n                Spread Preview {currentSpread ? `- #${currentSpread.game.rank}` : ''}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {currentSpread ? (\n                <>\n                  {/* Book Spread Preview */}\n                  <div className=\"rounded-lg overflow-hidden shadow-xl border border-[#D4D4C4]\">\n                    <BookSpread\n                      game={currentSpread.game as CarlsenGame}\n                      haiku={currentSpread.haiku || 'Generating haiku...\\nPoetry takes time to craft\\nPatience, chess master'}\n                      visualizationImage={currentSpread.visualizationImage}\n                      pageNumber={currentSpread.game.rank}\n                    />\n                  </div>\n\n                  {/* Spread Info */}\n                  <div className=\"mt-4 grid md:grid-cols-2 gap-4\">\n                    <div className=\"p-4 rounded-lg bg-[#E8E8D8]\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <FileText className=\"w-4 h-4\" />\n                        <span className=\"font-medium\">Haiku Status</span>\n                      </div>\n                      <p className=\"text-sm text-[#6B6B6B]\">\n                        {currentSpread.haiku \n                          ? 'Generated successfully' \n                          : currentSpread.status === 'generating' \n                            ? 'Generating...'\n                            : 'Pending'}\n                      </p>\n                    </div>\n                    <div className=\"p-4 rounded-lg bg-[#E8E8D8]\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <ImageIcon className=\"w-4 h-4\" />\n                        <span className=\"font-medium\">Visualization Status</span>\n                      </div>\n                      <p className=\"text-sm text-[#6B6B6B]\">\n                        {currentSpread.visualizationImage \n                          ? 'Rendered successfully' \n                          : currentSpread.status === 'generating' \n                            ? 'Rendering...'\n                            : 'Pending'}\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Game Details */}\n                  <div className=\"mt-4 p-4 rounded-lg bg-[#E8E8D8]\">\n                    <h4 className=\"font-medium mb-2\">{currentSpread.game.title}</h4>\n                    <p className=\"text-sm text-[#6B6B6B] mb-2\">\n                      {currentSpread.game.white} vs {currentSpread.game.black}\n                    </p>\n                    <p className=\"text-sm text-[#6B6B6B] mb-2\">\n                      {currentSpread.game.event}, {currentSpread.game.year} • {currentSpread.game.result}\n                    </p>\n                    <p className=\"text-sm italic\">{currentSpread.game.significance}</p>\n                  </div>\n                </>\n              ) : (\n                <div className=\"flex items-center justify-center h-64 text-[#6B6B6B]\">\n                  <p>Loading spreads...</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BookGenerator;\n";export{e as default};
