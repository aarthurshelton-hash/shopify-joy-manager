import{dg as e,c_ as s,j as t,aA as a,C as l,p as r,t as i,aO as c,w as n,x as d,aq as o,B as m,v as x,bG as u,bh as h,y as j,ad as g,z as v,bC as f,ea as p,b as N,s as y,aY as b,eC as w,eF as _}from"./index-D4HOopRf.js";import{u as F}from"./useMutation-C8lqDMD8.js";const k={"market-collector":t.jsx(h,{className:"h-5 w-5"}),"prediction-engine":t.jsx(p,{className:"h-5 w-5"}),"resolution-engine":t.jsx(v,{className:"h-5 w-5"}),"evolution-engine":t.jsx(w,{className:"h-5 w-5"}),"correlation-engine":t.jsx(g,{className:"h-5 w-5"}),"autonomous-trader":t.jsx(b,{className:"h-5 w-5"}),"data-integrity":t.jsx(c,{className:"h-5 w-5"}),"prediction-accuracy":t.jsx(g,{className:"h-5 w-5"}),"system-fitness":t.jsx(h,{className:"h-5 w-5"})};function q(){var b,w;const _=e(),{data:q,isLoading:P,refetch:M}=s({queryKey:["system-vitals"],queryFn:async()=>{const{data:e,error:s}=await y.rpc("get_system_vitals");if(s)throw s;return e},refetchInterval:5e3}),{data:S}=s({queryKey:["evolution-state"],queryFn:async()=>{const{data:e,error:s}=await y.from("evolution_state").select("*").eq("state_type","global").single();if(s)throw s;return e},refetchInterval:1e4}),{data:$}=s({queryKey:["system-stats"],queryFn:async()=>{const[e,s,t]=await Promise.all([y.from("market_tick_history").select("id",{count:"exact",head:!0}),y.from("prediction_outcomes").select("id",{count:"exact",head:!0}),y.from("prediction_outcomes").select("direction_correct").not("resolved_at","is",null)]),a=t.data||[],l=a.filter(e=>e.direction_correct).length;return{totalTicks:e.count||0,totalPredictions:s.count||0,resolvedPredictions:a.length,correctPredictions:l,overallAccuracy:a.length>0?l/a.length:0}},refetchInterval:1e4}),C=F({mutationFn:async()=>{const{data:e,error:s}=await y.functions.invoke("system-heartbeat",{body:{action:"full_cycle"}});if(s)throw s;return e},onSuccess:e=>{var s,t;N.success("Heartbeat triggered successfully",{description:`Collected ${(null==(s=null==e?void 0:e.collect)?void 0:s.ticks)||0} ticks, ${(null==(t=null==e?void 0:e.predict)?void 0:t.predictions)||0} predictions`}),_.invalidateQueries({queryKey:["system-vitals"]}),_.invalidateQueries({queryKey:["system-stats"]})},onError:e=>{N.error("Heartbeat failed",{description:e.message})}}),K=e=>{switch(e){case"healthy":return"text-green-500";case"degraded":return"text-yellow-500";case"critical":return"text-destructive";default:return"text-muted-foreground"}},L=e=>{switch(e){case"healthy":return"default";case"degraded":return"secondary";case"critical":return"destructive";default:return"outline"}},z=(null==q?void 0:q.filter(e=>"heartbeat"===e.vital_type))||[],A=(null==q?void 0:q.filter(e=>"metric"===e.vital_type))||[],H=(null==q?void 0:q.filter(e=>e.is_healthy).length)||0,G=(null==q?void 0:q.length)||0,T=G>0?H/G*100:0;return P?t.jsxs("div",{className:"space-y-4",children:[t.jsx(a,{className:"h-32 w-full"}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[t.jsx(a,{className:"h-48"}),t.jsx(a,{className:"h-48"}),t.jsx(a,{className:"h-48"})]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[t.jsxs(l,{className:"md:col-span-2",children:[t.jsxs(r,{className:"pb-2",children:[t.jsxs(i,{className:"flex items-center gap-2",children:[t.jsx(c,{className:"h-6 w-6 "+(T>=80?"text-green-500 animate-pulse":T>=50?"text-yellow-500":"text-destructive")}),"System Vitals"]}),t.jsx(n,{children:"Living system health at a glance"})]}),t.jsx(d,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Overall Health"}),t.jsxs("span",{className:"font-bold",children:[Math.round(T),"%"]})]}),t.jsx(o,{value:T,className:"h-3"}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{children:[H," of ",G," systems healthy"]}),t.jsxs(m,{size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[C.isPending?t.jsx(x,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(u,{className:"h-4 w-4 mr-2"}),"Trigger Heartbeat"]})]})]})})]}),t.jsxs(l,{children:[t.jsx(r,{className:"pb-2",children:t.jsx(i,{className:"text-sm font-medium",children:"Evolution"})}),t.jsxs(d,{children:[t.jsxs("div",{className:"text-3xl font-bold",children:["Gen ",(null==S?void 0:S.generation)||0]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fitness: ",(100*((null==S?void 0:S.fitness_score)||0)).toFixed(1),"%"]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(null==(b=null==S?void 0:S.total_predictions)?void 0:b.toLocaleString())||0," total predictions"]})]})]}),t.jsxs(l,{children:[t.jsx(r,{className:"pb-2",children:t.jsx(i,{className:"text-sm font-medium",children:"Accuracy"})}),t.jsxs(d,{children:[t.jsxs("div",{className:"text-3xl font-bold",children:[(100*((null==$?void 0:$.overallAccuracy)||0)).toFixed(1),"%"]}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[(null==$?void 0:$.correctPredictions)||0," / ",(null==$?void 0:$.resolvedPredictions)||0," correct"]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(null==(w=null==$?void 0:$.totalTicks)?void 0:w.toLocaleString())||0," ticks collected"]})]})]})]}),t.jsxs(l,{children:[t.jsxs(r,{children:[t.jsxs(i,{className:"flex items-center gap-2",children:[t.jsx(h,{className:"h-5 w-5"}),"Subsystem Heartbeats"]}),t.jsx(n,{children:"Real-time status of all system components"})]}),t.jsx(d,{children:t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:z.map(e=>{var s,a,l;return t.jsxs("div",{className:"p-4 rounded-lg border transition-colors "+(e.is_healthy?"border-green-500/30 bg-green-500/5":"degraded"===e.status?"border-yellow-500/30 bg-yellow-500/5":"critical"===e.status?"border-destructive/30 bg-destructive/5":"border-border bg-muted/30"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:K(e.status),children:k[e.vital_name]||t.jsx(h,{className:"h-5 w-5"})}),t.jsx("span",{className:"font-medium capitalize",children:e.vital_name.replace(/-/g," ")})]}),t.jsx(j,{variant:L(e.status),children:e.status})]}),t.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:null==(s=e.metadata)?void 0:s.description}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{className:"text-muted-foreground",children:["Last pulse: ",(l=e.seconds_since_pulse,l<60?`${Math.floor(l)}s ago`:l<3600?`${Math.floor(l/60)}m ago`:l<86400?`${Math.floor(l/3600)}h ago`:`${Math.floor(l/86400)}d ago`)]}),t.jsxs("span",{className:"font-mono text-xs",children:["#",e.pulse_count.toLocaleString()]})]}),e.is_healthy?t.jsx("div",{className:"mt-2 h-1 bg-green-500/30 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-green-500 animate-pulse",style:{width:`${Math.max(10,100-e.seconds_since_pulse/(((null==(a=e.metadata)?void 0:a.interval_ms)||6e4)/1e3)*100)}%`}})}):t.jsx("div",{className:"mt-2 h-1 bg-destructive/30 rounded-full"})]},e.vital_name)})})})]}),t.jsxs(l,{children:[t.jsxs(r,{children:[t.jsxs(i,{className:"flex items-center gap-2",children:[t.jsx(g,{className:"h-5 w-5"}),"Performance Metrics"]}),t.jsx(n,{children:"Key performance indicators"})]}),t.jsx(d,{children:t.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:A.map(e=>t.jsxs("div",{className:"p-4 rounded-lg border bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"font-medium capitalize",children:e.vital_name.replace(/-/g," ")}),e.is_healthy?t.jsx(v,{className:"h-5 w-5 text-green-500"}):t.jsx(f,{className:"h-5 w-5 text-yellow-500"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-end justify-between",children:[t.jsxs("span",{className:"text-3xl font-bold",children:[(100*e.last_value).toFixed(1),"%"]}),t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Target: ",(100*e.target_value).toFixed(0),"%"]})]}),t.jsx(o,{value:100*e.last_value,className:"h-2"})]})]},e.vital_name))})})]}),(null==S?void 0:S.genes)&&t.jsxs(l,{children:[t.jsxs(r,{children:[t.jsxs(i,{className:"flex items-center gap-2",children:[t.jsx(p,{className:"h-5 w-5"}),"Evolution Genes (Generation ",S.generation,")"]}),t.jsx(n,{children:"Current genetic parameters guiding predictions"})]}),t.jsx(d,{children:t.jsx("div",{className:"grid gap-3 md:grid-cols-4",children:Object.entries(S.genes).map(([e,s])=>t.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[t.jsx("div",{className:"text-sm text-muted-foreground capitalize",children:e.replace(/([A-Z])/g," $1").trim()}),t.jsx("div",{className:"text-xl font-mono font-bold",children:"number"==typeof s?s.toFixed(3):String(s)})]},e))})})]})]})}const P=()=>t.jsx(_,{featureName:"System Vitals",children:t.jsx(q,{})});export{P as default};
