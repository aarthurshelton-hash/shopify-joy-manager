const e='import React, { useState } from \'react\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Brain, Sparkles, CheckCircle, AlertTriangle, Loader2, RefreshCw } from \'lucide-react\';\nimport { supabase } from \'@/integrations/supabase/client\';\n\ninterface ValidationResult {\n  content: string;\n  isComplete: boolean;\n}\n\nexport function AIConceptValidator() {\n  const [isValidating, setIsValidating] = useState(false);\n  const [result, setResult] = useState<ValidationResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const validateConcept = async () => {\n    setIsValidating(true);\n    setError(null);\n    setResult({ content: \'\', isComplete: false });\n\n    try {\n      const response = await fetch(\n        `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/validate-concept`,\n        {\n          method: \'POST\',\n          headers: {\n            \'Content-Type\': \'application/json\',\n            Authorization: `Bearer ${import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY}`,\n          },\n          body: JSON.stringify({ validationType: \'full\' }),\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error(`Validation failed: ${response.status}`);\n      }\n\n      if (!response.body) {\n        throw new Error(\'No response body\');\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder();\n      let textBuffer = \'\';\n      let fullContent = \'\';\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        textBuffer += decoder.decode(value, { stream: true });\n\n        let newlineIndex: number;\n        while ((newlineIndex = textBuffer.indexOf(\'\\n\')) !== -1) {\n          let line = textBuffer.slice(0, newlineIndex);\n          textBuffer = textBuffer.slice(newlineIndex + 1);\n\n          if (line.endsWith(\'\\r\')) line = line.slice(0, -1);\n          if (line.startsWith(\':\') || line.trim() === \'\') continue;\n          if (!line.startsWith(\'data: \')) continue;\n\n          const jsonStr = line.slice(6).trim();\n          if (jsonStr === \'[DONE]\') break;\n\n          try {\n            const parsed = JSON.parse(jsonStr);\n            const content = parsed.choices?.[0]?.delta?.content as string | undefined;\n            if (content) {\n              fullContent += content;\n              setResult({ content: fullContent, isComplete: false });\n            }\n          } catch {\n            textBuffer = line + \'\\n\' + textBuffer;\n            break;\n          }\n        }\n      }\n\n      setResult({ content: fullContent, isComplete: true });\n    } catch (err) {\n      console.error(\'Validation error:\', err);\n      setError(err instanceof Error ? err.message : \'Unknown error\');\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  const parseScores = (content: string) => {\n    const innovationMatch = content.match(/innovation\\s*(?:score)?[:\\s]*(\\d+)/i);\n    const marketMatch = content.match(/market\\s*(?:potential)?\\s*(?:score)?[:\\s]*(\\d+)/i);\n    const technicalMatch = content.match(/technical\\s*(?:feasibility)?\\s*(?:score)?[:\\s]*(\\d+)/i);\n    const verdictMatch = content.match(/(?:overall\\s*)?verdict[:\\s]*(strong|promising|needs work|weak)/i);\n\n    return {\n      innovation: innovationMatch ? parseInt(innovationMatch[1]) : null,\n      market: marketMatch ? parseInt(marketMatch[1]) : null,\n      technical: technicalMatch ? parseInt(technicalMatch[1]) : null,\n      verdict: verdictMatch ? verdictMatch[1].toLowerCase() : null,\n    };\n  };\n\n  const scores = result ? parseScores(result.content) : null;\n\n  const getVerdictColor = (verdict: string | null) => {\n    switch (verdict) {\n      case \'strong\': return \'bg-green-500/20 text-green-400 border-green-500/30\';\n      case \'promising\': return \'bg-blue-500/20 text-blue-400 border-blue-500/30\';\n      case \'needs work\': return \'bg-yellow-500/20 text-yellow-400 border-yellow-500/30\';\n      case \'weak\': return \'bg-red-500/20 text-red-400 border-red-500/30\';\n      default: return \'bg-muted text-muted-foreground\';\n    }\n  };\n\n  const getScoreColor = (score: number | null) => {\n    if (score === null) return \'text-muted-foreground\';\n    if (score >= 8) return \'text-green-400\';\n    if (score >= 6) return \'text-blue-400\';\n    if (score >= 4) return \'text-yellow-400\';\n    return \'text-red-400\';\n  };\n\n  return (\n    <Card className="border-primary/20 bg-card/50 backdrop-blur">\n      <CardHeader className="pb-3">\n        <CardTitle className="flex items-center gap-2 text-lg">\n          <Brain className="h-5 w-5 text-primary" />\n          AI Concept Validator\n          <Badge variant="outline" className="ml-2 text-xs">\n            Live Demo\n          </Badge>\n        </CardTitle>\n        <p className="text-sm text-muted-foreground">\n          Send En Pensent to AI for real-time validation. See if an AI understands and vouches for the concept.\n        </p>\n      </CardHeader>\n      <CardContent className="space-y-4">\n        {!result && !isValidating && (\n          <div className="text-center py-6">\n            <Sparkles className="h-12 w-12 mx-auto text-primary/50 mb-4" />\n            <p className="text-muted-foreground mb-4">\n              Click below to have an AI evaluate the En Pensent concept as if they were an investor.\n            </p>\n            <Button onClick={validateConcept} size="lg" className="gap-2">\n              <Brain className="h-4 w-4" />\n              Validate Concept with AI\n            </Button>\n          </div>\n        )}\n\n        {isValidating && !result?.content && (\n          <div className="text-center py-8">\n            <Loader2 className="h-8 w-8 animate-spin mx-auto text-primary mb-4" />\n            <p className="text-muted-foreground">Sending concept to AI for evaluation...</p>\n          </div>\n        )}\n\n        {result && (\n          <div className="space-y-4">\n            {/* Score Cards */}\n            {scores && (scores.innovation || scores.market || scores.technical || scores.verdict) && (\n              <div className="grid grid-cols-4 gap-2">\n                {scores.verdict && (\n                  <div className={`rounded-lg border p-3 text-center ${getVerdictColor(scores.verdict)}`}>\n                    <div className="text-xs uppercase opacity-70 mb-1">Verdict</div>\n                    <div className="font-bold capitalize">{scores.verdict}</div>\n                  </div>\n                )}\n                {scores.innovation && (\n                  <div className="rounded-lg border border-border/50 bg-muted/30 p-3 text-center">\n                    <div className="text-xs text-muted-foreground mb-1">Innovation</div>\n                    <div className={`text-xl font-bold ${getScoreColor(scores.innovation)}`}>\n                      {scores.innovation}/10\n                    </div>\n                  </div>\n                )}\n                {scores.market && (\n                  <div className="rounded-lg border border-border/50 bg-muted/30 p-3 text-center">\n                    <div className="text-xs text-muted-foreground mb-1">Market</div>\n                    <div className={`text-xl font-bold ${getScoreColor(scores.market)}`}>\n                      {scores.market}/10\n                    </div>\n                  </div>\n                )}\n                {scores.technical && (\n                  <div className="rounded-lg border border-border/50 bg-muted/30 p-3 text-center">\n                    <div className="text-xs text-muted-foreground mb-1">Technical</div>\n                    <div className={`text-xl font-bold ${getScoreColor(scores.technical)}`}>\n                      {scores.technical}/10\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* AI Response */}\n            <div className="rounded-lg border border-border/50 bg-muted/20 p-4 max-h-[500px] overflow-y-auto">\n              <div className="flex items-center gap-2 mb-3 pb-2 border-b border-border/30">\n                <Brain className="h-4 w-4 text-primary" />\n                <span className="text-sm font-medium">AI Assessment</span>\n                {result.isComplete ? (\n                  <CheckCircle className="h-4 w-4 text-green-500 ml-auto" />\n                ) : (\n                  <Loader2 className="h-4 w-4 animate-spin text-primary ml-auto" />\n                )}\n              </div>\n              <div className="prose prose-sm prose-invert max-w-none">\n                <pre className="whitespace-pre-wrap font-sans text-sm text-foreground/90 leading-relaxed">\n                  {result.content || \'Waiting for response...\'}\n                </pre>\n              </div>\n            </div>\n\n            {result.isComplete && (\n              <div className="flex justify-center">\n                <Button variant="outline" onClick={validateConcept} className="gap-2">\n                  <RefreshCw className="h-4 w-4" />\n                  Run Again\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n\n        {error && (\n          <div className="rounded-lg border border-destructive/50 bg-destructive/10 p-4 text-center">\n            <AlertTriangle className="h-6 w-6 text-destructive mx-auto mb-2" />\n            <p className="text-sm text-destructive">{error}</p>\n            <Button variant="outline" onClick={validateConcept} className="mt-3 gap-2">\n              <RefreshCw className="h-4 w-4" />\n              Try Again\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n';export{e as default};
