const e="import React, { useMemo, useCallback } from 'react';\nimport { GameData, formatMoves } from '@/lib/chess/gameSimulator';\nimport { useLegendHighlight, AnnotationType, HighlightedPiece, parseSanMove, HoveredMoveInfo } from '@/contexts/LegendHighlightContext';\nimport { PieceType, PieceColor } from '@/lib/chess/pieceColors';\n\ninterface InteractiveGameInfoDisplayProps {\n  gameData: GameData;\n  title?: string;\n  darkMode?: boolean;\n}\n\n// Format date from PGN format (YYYY.MM.DD) to display format\nfunction formatDate(dateStr: string): string {\n  if (!dateStr || dateStr === 'Unknown' || dateStr === '????.??.??') {\n    return 'Date Unknown';\n  }\n  \n  const parts = dateStr.split('.');\n  if (parts.length !== 3) return dateStr;\n  \n  const months = [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December'\n  ];\n  \n  const year = parts[0];\n  const monthIndex = parseInt(parts[1]) - 1;\n  const day = parseInt(parts[2]);\n  \n  if (isNaN(monthIndex) || monthIndex < 0 || monthIndex > 11) return dateStr;\n  \n  const getDaySuffix = (d: number) => {\n    if (d > 3 && d < 21) return 'th';\n    switch (d % 10) {\n      case 1: return 'st';\n      case 2: return 'nd';\n      case 3: return 'rd';\n      default: return 'th';\n    }\n  };\n  \n  return `${months[monthIndex]} ${day}${getDaySuffix(day)}, ${year}`;\n}\n\n// All white pieces\nconst WHITE_PIECES: HighlightedPiece[] = [\n  { pieceType: 'k', pieceColor: 'w' },\n  { pieceType: 'q', pieceColor: 'w' },\n  { pieceType: 'r', pieceColor: 'w' },\n  { pieceType: 'b', pieceColor: 'w' },\n  { pieceType: 'n', pieceColor: 'w' },\n  { pieceType: 'p', pieceColor: 'w' },\n];\n\n// All black pieces\nconst BLACK_PIECES: HighlightedPiece[] = [\n  { pieceType: 'k', pieceColor: 'b' },\n  { pieceType: 'q', pieceColor: 'b' },\n  { pieceType: 'r', pieceColor: 'b' },\n  { pieceType: 'b', pieceColor: 'b' },\n  { pieceType: 'n', pieceColor: 'b' },\n  { pieceType: 'p', pieceColor: 'b' },\n];\n\nconst InteractiveGameInfoDisplay: React.FC<InteractiveGameInfoDisplayProps> = ({ \n  gameData, \n  title, \n  darkMode = false \n}) => {\n  // Try to use highlight context if available\n  let highlightContext: ReturnType<typeof useLegendHighlight> | null = null;\n  try {\n    highlightContext = useLegendHighlight();\n  } catch {\n    // Context not available\n  }\n\n  const {\n    lockedPieces = [],\n    highlightedAnnotations = [],\n    hoveredAnnotation = null,\n    hoveredSquare = null,\n    hoveredMove = null,\n    setHoveredAnnotation,\n    setHoveredMove,\n    highlightedPiece,\n  } = highlightContext || {\n    lockedPieces: [],\n    highlightedAnnotations: [],\n    hoveredAnnotation: null,\n    hoveredSquare: null,\n    hoveredMove: null,\n    setHoveredAnnotation: () => {},\n    setHoveredMove: () => {},\n    highlightedPiece: null,\n  };\n\n  // Get highlighted move numbers from hovered square\n  const highlightedMoveNumbers = useMemo(() => {\n    if (hoveredSquare?.moveNumbers && hoveredSquare.moveNumbers.length > 0) {\n      return new Set(hoveredSquare.moveNumbers);\n    }\n    return null;\n  }, [hoveredSquare]);\n\n  // Determine if annotation should be highlighted\n  const isAnnotationHighlighted = (type: AnnotationType): boolean => {\n    return highlightedAnnotations.includes(type);\n  };\n\n  // Check if this annotation is currently hovered\n  const isAnnotationHovered = (type: AnnotationType): boolean => {\n    return hoveredAnnotation?.type === type;\n  };\n\n  // Check if we should dim this annotation (others are highlighted)\n  const shouldDimAnnotation = (type: AnnotationType): boolean => {\n    const hasActiveHighlight = lockedPieces.length > 0 || highlightedPiece !== null;\n    if (!hasActiveHighlight) return false;\n    \n    // If pieces are locked, check if this annotation is in the highlighted list\n    if (lockedPieces.length > 0) {\n      // White player should highlight if any white piece is locked\n      if (type === 'white-player') {\n        return !lockedPieces.some(p => p.pieceColor === 'w');\n      }\n      // Black player should highlight if any black piece is locked\n      if (type === 'black-player') {\n        return !lockedPieces.some(p => p.pieceColor === 'b');\n      }\n    }\n    \n    // If hovering a piece, check color association\n    if (highlightedPiece) {\n      if (type === 'white-player') {\n        return highlightedPiece.pieceColor !== 'w';\n      }\n      if (type === 'black-player') {\n        return highlightedPiece.pieceColor !== 'b';\n      }\n    }\n    \n    return false;\n  };\n\n  const handleAnnotationHover = (type: AnnotationType) => {\n    if (!setHoveredAnnotation) return;\n    \n    let associatedPieces: HighlightedPiece[] = [];\n    \n    if (type === 'white-player') {\n      associatedPieces = WHITE_PIECES;\n    } else if (type === 'black-player') {\n      associatedPieces = BLACK_PIECES;\n    }\n    \n    setHoveredAnnotation({ type, associatedPieces });\n  };\n\n  const handleAnnotationLeave = () => {\n    if (setHoveredAnnotation) {\n      setHoveredAnnotation(null);\n    }\n  };\n\n  // Handle move notation hover\n  const handleMoveHover = useCallback((moveIndex: number, san: string) => {\n    if (!setHoveredMove) return;\n    \n    const isWhiteMove = moveIndex % 2 === 0;\n    const parsed = parseSanMove(san, isWhiteMove);\n    \n    if (parsed) {\n      const moveInfo: HoveredMoveInfo = {\n        moveNumber: moveIndex + 1, // 1-indexed\n        san,\n        piece: {\n          pieceType: parsed.pieceType,\n          pieceColor: isWhiteMove ? 'w' : 'b',\n        },\n        targetSquare: parsed.targetSquare,\n        isCapture: parsed.isCapture,\n      };\n      setHoveredMove(moveInfo);\n    }\n  }, [setHoveredMove]);\n\n  const handleMoveLeave = useCallback(() => {\n    if (setHoveredMove) {\n      setHoveredMove(null);\n    }\n  }, [setHoveredMove]);\n  \n  // Color classes based on mode\n  const primaryText = darkMode ? 'text-stone-100' : 'text-stone-800';\n  const secondaryText = darkMode ? 'text-stone-400' : 'text-stone-500';\n  const mutedText = darkMode ? 'text-stone-500' : 'text-stone-400';\n  const vsText = darkMode ? 'text-stone-500' : 'text-stone-400';\n  const dotText = darkMode ? 'text-stone-700' : 'text-stone-300';\n\n  // Highlight styles\n  const getAnnotationStyle = (type: AnnotationType) => {\n    const isHighlighted = isAnnotationHighlighted(type);\n    const isHovered = isAnnotationHovered(type);\n    const shouldDim = shouldDimAnnotation(type);\n    \n    let style: React.CSSProperties = {\n      transition: 'all 0.2s ease-out',\n      cursor: highlightContext ? 'pointer' : 'default',\n    };\n    \n    if (isHighlighted || isHovered) {\n      const glowColor = type === 'white-player' \n        ? 'rgba(56, 189, 248, 0.4)' \n        : type === 'black-player' \n          ? 'rgba(251, 113, 133, 0.4)' \n          : 'rgba(168, 85, 247, 0.4)';\n      \n      style = {\n        ...style,\n        textShadow: `0 0 8px ${glowColor}`,\n        transform: 'scale(1.02)',\n      };\n    }\n    \n    if (shouldDim) {\n      style.opacity = 0.3;\n    }\n    \n    return style;\n  };\n\n  // Render individual moves with highlighting based on hovered square or hovered move\n  const renderMovesWithHighlighting = useMemo(() => {\n    const moves = gameData.moves;\n    if (!moves || moves.length === 0) return null;\n\n    const elements: React.ReactNode[] = [];\n    \n    for (let i = 0; i < moves.length; i++) {\n      const moveNumber = i + 1; // 1-indexed move number\n      const isWhiteMove = i % 2 === 0;\n      const displayMoveNumber = Math.floor(i / 2) + 1;\n      \n      // Check if this move should be highlighted from square hover\n      const isHighlightedFromSquare = highlightedMoveNumbers?.has(moveNumber) ?? false;\n      \n      // Check if this is the currently hovered move\n      const isCurrentlyHovered = hoveredMove?.moveNumber === moveNumber;\n      \n      const isHighlighted = isHighlightedFromSquare || isCurrentlyHovered;\n      \n      // Add move number for white moves\n      if (isWhiteMove) {\n        elements.push(\n          <span key={`num-${i}`} className=\"text-muted-foreground/60\">\n            {displayMoveNumber}.{' '}\n          </span>\n        );\n      }\n      \n      // Add the move with potential highlighting\n      const moveStyle: React.CSSProperties = isHighlighted\n        ? {\n            backgroundColor: 'rgba(251, 191, 36, 0.3)',\n            borderRadius: '2px',\n            padding: '0 2px',\n            fontWeight: 600,\n            color: darkMode ? '#fbbf24' : '#d97706',\n            boxShadow: '0 0 4px rgba(251, 191, 36, 0.4)',\n          }\n        : {};\n      \n      elements.push(\n        <span \n          key={`move-${i}`} \n          style={moveStyle}\n          className=\"cursor-pointer hover:bg-amber-500/20 rounded transition-colors\"\n          title={`Move ${moveNumber}: ${moves[i]}`}\n          onMouseEnter={() => handleMoveHover(i, moves[i])}\n          onMouseLeave={handleMoveLeave}\n        >\n          {moves[i]}\n        </span>\n      );\n      \n      // Add space after move\n      elements.push(<span key={`space-${i}`}> </span>);\n    }\n    \n    return elements;\n  }, [gameData.moves, highlightedMoveNumbers, darkMode, hoveredMove, handleMoveHover, handleMoveLeave]);\n\n  // Determine if there are highlighted moves (for summary display)\n  const hasHighlightedMoves = highlightedMoveNumbers && highlightedMoveNumbers.size > 0;\n  \n  return (\n    <div className=\"text-center max-w-md mx-auto space-y-3\">\n      {/* Player Names - Cinzel inspired, elegant serif */}\n      <h1 \n        className={`text-xl md:text-2xl font-semibold tracking-wide ${primaryText}`}\n        style={{ fontFamily: \"'Cinzel', 'Times New Roman', serif\" }}\n      >\n        <span \n          style={getAnnotationStyle('white-player')}\n          onMouseEnter={() => handleAnnotationHover('white-player')}\n          onMouseLeave={handleAnnotationLeave}\n          className={`inline-block ${isAnnotationHighlighted('white-player') ? 'ring-2 ring-sky-400/50 rounded px-1' : ''}`}\n        >\n          {gameData.white}\n        </span>\n        <span className={`mx-2 font-normal italic text-lg ${vsText}`} style={{ fontFamily: \"'Cormorant', Georgia, serif\" }}>vs</span>\n        <span \n          style={getAnnotationStyle('black-player')}\n          onMouseEnter={() => handleAnnotationHover('black-player')}\n          onMouseLeave={handleAnnotationLeave}\n          className={`inline-block ${isAnnotationHighlighted('black-player') ? 'ring-2 ring-rose-400/50 rounded px-1' : ''}`}\n        >\n          {gameData.black}\n        </span>\n      </h1>\n      \n      {/* Event Name - Elegant italic serif */}\n      {gameData.event && gameData.event !== 'Unknown' && (\n        <h2 \n          className={`text-sm md:text-base italic ${secondaryText}`}\n          style={{ fontFamily: \"'Cormorant', Georgia, serif\" }}\n        >\n          {gameData.event}\n        </h2>\n      )}\n      \n      {/* Title and Date - Clean sans-serif */}\n      <p \n        className={`text-xs uppercase tracking-[0.15em] flex items-center justify-center gap-3 ${mutedText}`}\n        style={{ fontFamily: \"'Inter', sans-serif\" }}\n      >\n        {title && <span className=\"font-medium\">{title}</span>}\n        {title && <span className={dotText}>•</span>}\n        <span>{formatDate(gameData.date)}</span>\n      </p>\n\n      {/* Square hover summary - shows which moves are highlighted */}\n      {hasHighlightedMoves && hoveredSquare && (\n        <div \n          className=\"text-xs px-3 py-1.5 rounded-full bg-amber-500/20 text-amber-600 dark:text-amber-400 inline-flex items-center gap-1\"\n          style={{ fontFamily: \"'Inter', sans-serif\" }}\n        >\n          <span className=\"font-medium\">{hoveredSquare.square.toUpperCase()}</span>\n          <span className=\"opacity-70\">•</span>\n          <span>{highlightedMoveNumbers!.size} move{highlightedMoveNumbers!.size !== 1 ? 's' : ''}</span>\n        </div>\n      )}\n      \n      {/* Move Notation - Classic Times New Roman with individual move highlighting */}\n      <div \n        className={`leading-relaxed px-2 text-[8px] ${mutedText}`}\n        style={{ \n          fontFamily: \"'Times New Roman', Times, serif\",\n          ...(!hasHighlightedMoves ? getAnnotationStyle('move-notation') : {}),\n        }}\n        onMouseEnter={() => !hasHighlightedMoves && handleAnnotationHover('move-notation')}\n        onMouseLeave={handleAnnotationLeave}\n      >\n        {renderMovesWithHighlighting}\n      </div>\n    </div>\n  );\n};\n\nexport default InteractiveGameInfoDisplay;";export{e as default};
