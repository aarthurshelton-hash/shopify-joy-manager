const e='import React, { useState } from \'react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Separator } from \'@/components/ui/separator\';\nimport { \n  Wrench, \n  Play, \n  Loader2, \n  CheckCircle, \n  XCircle, \n  Clock,\n  Trash2,\n  Database,\n  Bell,\n  MessageSquare,\n  Activity\n} from \'lucide-react\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { toast } from \'sonner\';\nimport { format } from \'date-fns\';\n\ninterface MaintenanceResult {\n  success: boolean;\n  message?: string;\n  results?: {\n    interactions_deleted: number;\n    offers_deleted: number;\n    notifications_deleted: number;\n    analytics_deleted: number;\n    funnel_events_deleted: number;\n    maintenance_completed_at: string;\n  };\n  error?: string;\n  executed_at: string;\n}\n\nexport const AdminMaintenancePanel: React.FC = () => {\n  const [isRunning, setIsRunning] = useState(false);\n  const [lastResult, setLastResult] = useState<MaintenanceResult | null>(null);\n\n  const runMaintenance = async () => {\n    setIsRunning(true);\n    try {\n      const { data, error } = await supabase.functions.invoke(\'data-maintenance\', {\n        method: \'POST\',\n      });\n\n      if (error) throw error;\n\n      setLastResult(data as MaintenanceResult);\n      \n      if (data.success) {\n        toast.success(\'Data maintenance completed successfully\', {\n          description: `Cleaned up old records from the database`,\n        });\n      } else {\n        toast.error(\'Maintenance completed with errors\', {\n          description: data.error,\n        });\n      }\n    } catch (error: any) {\n      console.error(\'Maintenance error:\', error);\n      toast.error(\'Failed to run maintenance\', {\n        description: error.message,\n      });\n      setLastResult({\n        success: false,\n        error: error.message,\n        executed_at: new Date().toISOString(),\n      });\n    } finally {\n      setIsRunning(false);\n    }\n  };\n\n  return (\n    <div className="space-y-6">\n      {/* Header Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className="flex items-center gap-2">\n            <Wrench className="h-5 w-5" />\n            Data Maintenance\n          </CardTitle>\n          <CardDescription>\n            Clean up old records, expired data, and optimize database performance\n          </CardDescription>\n        </CardHeader>\n        <CardContent className="space-y-6">\n          {/* Maintenance Info */}\n          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">\n            <div className="flex items-start gap-3 p-4 rounded-lg border bg-card">\n              <Activity className="h-5 w-5 text-muted-foreground mt-0.5" />\n              <div>\n                <p className="font-medium text-sm">Interactions</p>\n                <p className="text-xs text-muted-foreground">Deletes vision interactions older than 90 days</p>\n              </div>\n            </div>\n            <div className="flex items-start gap-3 p-4 rounded-lg border bg-card">\n              <MessageSquare className="h-5 w-5 text-muted-foreground mt-0.5" />\n              <div>\n                <p className="font-medium text-sm">Expired Offers</p>\n                <p className="text-xs text-muted-foreground">Removes marketplace offers expired 30+ days</p>\n              </div>\n            </div>\n            <div className="flex items-start gap-3 p-4 rounded-lg border bg-card">\n              <Bell className="h-5 w-5 text-muted-foreground mt-0.5" />\n              <div>\n                <p className="font-medium text-sm">Notifications</p>\n                <p className="text-xs text-muted-foreground">Clears read notifications older than 60 days</p>\n              </div>\n            </div>\n            <div className="flex items-start gap-3 p-4 rounded-lg border bg-card">\n              <Database className="h-5 w-5 text-muted-foreground mt-0.5" />\n              <div>\n                <p className="font-medium text-sm">Analytics Cache</p>\n                <p className="text-xs text-muted-foreground">Removes expired premium analytics data</p>\n              </div>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Run Button */}\n          <div className="flex items-center gap-4">\n            <Button \n              onClick={runMaintenance} \n              disabled={isRunning}\n              className="gap-2"\n            >\n              {isRunning ? (\n                <>\n                  <Loader2 className="h-4 w-4 animate-spin" />\n                  Running...\n                </>\n              ) : (\n                <>\n                  <Play className="h-4 w-4" />\n                  Run Maintenance Now\n                </>\n              )}\n            </Button>\n            <p className="text-sm text-muted-foreground">\n              This runs automatically daily at 3:00 AM UTC\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Last Result Card */}\n      {lastResult && (\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2 text-lg">\n              <Clock className="h-5 w-5" />\n              Last Maintenance Result\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className="space-y-4">\n              {/* Status */}\n              <div className="flex items-center gap-3">\n                {lastResult.success ? (\n                  <Badge className="bg-green-500/20 text-green-600 border-green-500/30 gap-1">\n                    <CheckCircle className="h-3 w-3" />\n                    Success\n                  </Badge>\n                ) : (\n                  <Badge variant="destructive" className="gap-1">\n                    <XCircle className="h-3 w-3" />\n                    Failed\n                  </Badge>\n                )}\n                <span className="text-sm text-muted-foreground">\n                  {format(new Date(lastResult.executed_at), \'PPpp\')}\n                </span>\n              </div>\n\n              {/* Results */}\n              {lastResult.success && lastResult.results && (\n                <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-5">\n                  <div className="p-3 rounded-lg border bg-muted/30">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Trash2 className="h-3 w-3" />\n                      <span className="text-xs">Interactions</span>\n                    </div>\n                    <p className="text-lg font-bold">\n                      {lastResult.results.interactions_deleted.toLocaleString()}\n                    </p>\n                  </div>\n                  <div className="p-3 rounded-lg border bg-muted/30">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Trash2 className="h-3 w-3" />\n                      <span className="text-xs">Offers</span>\n                    </div>\n                    <p className="text-lg font-bold">\n                      {lastResult.results.offers_deleted.toLocaleString()}\n                    </p>\n                  </div>\n                  <div className="p-3 rounded-lg border bg-muted/30">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Trash2 className="h-3 w-3" />\n                      <span className="text-xs">Notifications</span>\n                    </div>\n                    <p className="text-lg font-bold">\n                      {lastResult.results.notifications_deleted.toLocaleString()}\n                    </p>\n                  </div>\n                  <div className="p-3 rounded-lg border bg-muted/30">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Trash2 className="h-3 w-3" />\n                      <span className="text-xs">Analytics</span>\n                    </div>\n                    <p className="text-lg font-bold">\n                      {lastResult.results.analytics_deleted.toLocaleString()}\n                    </p>\n                  </div>\n                  <div className="p-3 rounded-lg border bg-muted/30">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Trash2 className="h-3 w-3" />\n                      <span className="text-xs">Funnel Events</span>\n                    </div>\n                    <p className="text-lg font-bold">\n                      {lastResult.results.funnel_events_deleted.toLocaleString()}\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              {/* Error */}\n              {!lastResult.success && lastResult.error && (\n                <div className="p-3 rounded-lg border border-destructive/30 bg-destructive/10 text-destructive text-sm">\n                  {lastResult.error}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n';export{e as default};
