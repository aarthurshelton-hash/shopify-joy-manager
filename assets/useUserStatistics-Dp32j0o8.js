const e="import { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useAuth } from '@/hooks/useAuth';\n\nexport interface UserStatistics {\n  user_id: string;\n  generated_at: string;\n  // Vision statistics\n  total_visions_owned: number;\n  total_visions_created: number;\n  private_visions: number;\n  public_visions: number;\n  // Earnings statistics\n  wallet_balance_cents: number;\n  total_earned_cents: number;\n  total_spent_cents: number;\n  total_royalties_cents: number;\n  // Marketplace activity\n  active_listings: number;\n  total_sales: number;\n  total_purchases: number;\n  pending_offers_received: number;\n  pending_offers_sent: number;\n  // Engagement metrics\n  total_views_received: number;\n  total_downloads_received: number;\n  total_scans_received: number;\n  portfolio_score: number;\n  // Account info\n  is_premium: boolean;\n  member_since: string | null;\n  last_activity: string | null;\n}\n\nexport function useUserStatistics() {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n\n  // Set up realtime subscriptions for statistics-related tables\n  useEffect(() => {\n    if (!user?.id) return;\n\n    const channel = supabase\n      .channel(`user-stats-${user.id}`)\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'saved_visualizations' }, () => {\n        queryClient.invalidateQueries({ queryKey: ['user-statistics', user.id] });\n      })\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'visualization_listings' }, () => {\n        queryClient.invalidateQueries({ queryKey: ['user-statistics', user.id] });\n      })\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'marketplace_offers' }, () => {\n        queryClient.invalidateQueries({ queryKey: ['user-statistics', user.id] });\n      })\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'user_wallets' }, () => {\n        queryClient.invalidateQueries({ queryKey: ['user-statistics', user.id] });\n      })\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'vision_scores' }, () => {\n        queryClient.invalidateQueries({ queryKey: ['user-statistics', user.id] });\n      })\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [user?.id, queryClient]);\n\n  return useQuery({\n    queryKey: ['user-statistics', user?.id],\n    queryFn: async (): Promise<UserStatistics | null> => {\n      if (!user?.id) return null;\n\n      const { data, error } = await supabase.rpc('get_user_statistics', {\n        p_user_id: user.id\n      });\n\n      if (error) {\n        console.error('Error fetching user statistics:', error);\n        throw error;\n      }\n\n      return data as unknown as UserStatistics;\n    },\n    enabled: !!user?.id,\n    staleTime: 1000 * 60 * 2, // 2 minutes - balance freshness with performance\n    gcTime: 1000 * 60 * 10, // 10 minutes garbage collection\n    refetchOnWindowFocus: true, // Refetch when user returns to tab\n    refetchOnReconnect: true, // Refetch when connection restored\n  });\n}\n";export{e as default};
