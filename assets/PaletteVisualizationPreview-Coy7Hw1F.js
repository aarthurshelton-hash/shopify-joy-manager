const e="import React, { useMemo } from 'react';\nimport { simulateGame, SquareData, SquareVisit } from '@/lib/chess/gameSimulator';\nimport { boardColors, colorPalettes, PaletteId } from '@/lib/chess/pieceColors';\n\ninterface PaletteVisualizationPreviewProps {\n  pgn: string;\n  paletteId: PaletteId;\n  size?: number;\n  className?: string;\n}\n\n// Get color for a piece using a specific palette\nfunction getPieceColorForPalette(\n  piece: 'p' | 'n' | 'b' | 'r' | 'q' | 'k',\n  color: 'w' | 'b',\n  paletteId: PaletteId\n): string {\n  const palette = colorPalettes.find(p => p.id === paletteId) || colorPalettes[0];\n  const colorMap = color === 'w' ? palette.white : palette.black;\n  return colorMap[piece];\n}\n\n// Render nested squares for a single board square\nconst renderNestedSquares = (\n  visits: SquareVisit[],\n  x: number,\n  y: number,\n  squareSize: number,\n  baseColor: string,\n  paletteId: PaletteId\n): React.ReactNode[] => {\n  const elements: React.ReactNode[] = [];\n  const padding = squareSize * 0.08;\n\n  // Draw base square\n  elements.push(\n    <rect\n      key={`base-${x}-${y}`}\n      x={x}\n      y={y}\n      width={squareSize}\n      height={squareSize}\n      fill={baseColor}\n    />\n  );\n\n  if (visits.length === 0) {\n    return elements;\n  }\n\n  // Get unique colors in order using the specified palette\n  const uniqueColors: string[] = [];\n  for (const visit of visits) {\n    const color = getPieceColorForPalette(visit.piece, visit.color, paletteId);\n    if (!uniqueColors.includes(color)) {\n      uniqueColors.push(color);\n    }\n  }\n\n  // Calculate sizes for nested squares\n  const maxNesting = Math.min(uniqueColors.length, 6);\n  const layers: { color: string; layerSize: number }[] = [];\n\n  let currentSize = squareSize - padding * 2;\n  const sizeReduction = (currentSize * 0.7) / maxNesting;\n\n  for (let i = 0; i < maxNesting; i++) {\n    layers.push({\n      color: uniqueColors[i],\n      layerSize: currentSize,\n    });\n    currentSize -= sizeReduction;\n    if (currentSize < squareSize * 0.1) break;\n  }\n\n  // Draw layers from outside in\n  for (let i = 0; i < layers.length; i++) {\n    const layer = layers[i];\n    const offset = (squareSize - layer.layerSize) / 2;\n\n    elements.push(\n      <rect\n        key={`layer-${x}-${y}-${i}`}\n        x={x + offset}\n        y={y + offset}\n        width={layer.layerSize}\n        height={layer.layerSize}\n        fill={layer.color}\n      />\n    );\n  }\n\n  return elements;\n};\n\nconst PaletteVisualizationPreview: React.FC<PaletteVisualizationPreviewProps> = ({\n  pgn,\n  paletteId,\n  size = 200,\n  className = '',\n}) => {\n  const { board, boardElements } = useMemo(() => {\n    const result = simulateGame(pgn);\n    const squareSize = size / 8;\n    const borderWidth = size * 0.02;\n\n    const elements = [...Array(8)].map((_, rowIndex) => {\n      const rank = 7 - rowIndex;\n      return [...Array(8)].map((_, file) => {\n        const square = result.board[rank][file];\n        const baseColor = square.isLight ? boardColors.light : boardColors.dark;\n        const x = borderWidth + file * squareSize;\n        const y = borderWidth + rowIndex * squareSize;\n\n        return renderNestedSquares(\n          square.visits,\n          x,\n          y,\n          squareSize,\n          baseColor,\n          paletteId\n        );\n      });\n    });\n\n    return { board: result.board, boardElements: elements };\n  }, [pgn, paletteId, size]);\n\n  const borderWidth = size * 0.02;\n  const totalSize = size + borderWidth * 2;\n\n  return (\n    <svg\n      width={totalSize}\n      height={totalSize}\n      viewBox={`0 0 ${totalSize} ${totalSize}`}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className={className}\n      style={{ display: 'block' }}\n    >\n      {/* Border */}\n      <rect\n        x={0}\n        y={0}\n        width={totalSize}\n        height={totalSize}\n        fill={boardColors.border}\n      />\n\n      {/* Board squares */}\n      {boardElements}\n    </svg>\n  );\n};\n\nexport default PaletteVisualizationPreview;\n";export{e as default};
