const e='import React, { useEffect, useState } from \'react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { DollarSign, TrendingUp, Loader2, Info, Building2, Sparkles, PieChart, ArrowRightLeft, Percent } from \'lucide-react\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { MEMBERSHIP_ECONOMICS } from \'@/lib/visualizations/visionScoring\';\nimport { useRandomGameArt } from \'@/hooks/useRandomGameArt\';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \'@/components/ui/tooltip\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Link } from \'react-router-dom\';\nimport { Button } from \'@/components/ui/button\';\n\ninterface PortfolioRoyaltyStats {\n  totalRoyaltyCents: number;\n  totalRoyaltyOrders: number;\n  totalPrintRevenue: number;\n  totalPrintOrders: number;\n  visionCount: number;\n}\n\nexport const PortfolioRoyaltySummary: React.FC = () => {\n  const { user } = useAuth();\n  const [stats, setStats] = useState<PortfolioRoyaltyStats | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const backgroundImages = useRandomGameArt(1);\n  const valueAppreciationPercent = MEMBERSHIP_ECONOMICS.valueAppreciationRate * 100;\n  const platformSharePercent = MEMBERSHIP_ECONOMICS.platformRetentionRate * 100;\n  const marketplaceFeePercent = MEMBERSHIP_ECONOMICS.marketplaceTransactionFee * 100;\n  const sellerKeepsPercent = MEMBERSHIP_ECONOMICS.sellerRetentionRate * 100;\n\n  useEffect(() => {\n    if (!user) return;\n    \n    const fetchStats = async () => {\n      setIsLoading(true);\n      try {\n        // Get user\'s visualizations\n        const { data: visualizations } = await supabase\n          .from(\'saved_visualizations\')\n          .select(\'id\')\n          .eq(\'user_id\', user.id);\n\n        if (!visualizations || visualizations.length === 0) {\n          setStats({\n            totalRoyaltyCents: 0,\n            totalRoyaltyOrders: 0,\n            totalPrintRevenue: 0,\n            totalPrintOrders: 0,\n            visionCount: 0,\n          });\n          setIsLoading(false);\n          return;\n        }\n\n        const vizIds = visualizations.map(v => v.id);\n\n        // Get vision scores for all user\'s visualizations\n        const { data: scores } = await supabase\n          .from(\'vision_scores\')\n          .select(\'royalty_cents_earned, royalty_orders_count, print_revenue_cents, print_order_count\')\n          .in(\'visualization_id\', vizIds);\n\n        const totals = (scores || []).reduce((acc, score) => ({\n          totalRoyaltyCents: acc.totalRoyaltyCents + (score.royalty_cents_earned || 0),\n          totalRoyaltyOrders: acc.totalRoyaltyOrders + (score.royalty_orders_count || 0),\n          totalPrintRevenue: acc.totalPrintRevenue + (score.print_revenue_cents || 0),\n          totalPrintOrders: acc.totalPrintOrders + (score.print_order_count || 0),\n        }), {\n          totalRoyaltyCents: 0,\n          totalRoyaltyOrders: 0,\n          totalPrintRevenue: 0,\n          totalPrintOrders: 0,\n        });\n\n        setStats({\n          ...totals,\n          visionCount: visualizations.length,\n        });\n      } catch (error) {\n        console.error(\'Error fetching portfolio royalty stats:\', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchStats();\n  }, [user]);\n\n  if (isLoading) {\n    return (\n      <Card className="bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">\n        <CardContent className="flex items-center justify-center py-8">\n          <Loader2 className="h-6 w-6 animate-spin text-primary" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!stats) return null;\n\n  const valueDollars = stats.totalRoyaltyCents / 100;\n  const totalRevenueDollars = stats.totalPrintRevenue / 100;\n  const platformDollars = totalRevenueDollars - valueDollars;\n\n  return (\n    <Card className="relative overflow-hidden bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">\n      {/* Subtle AI Art Background */}\n      {backgroundImages[0] && (\n        <div \n          className="absolute inset-0 opacity-[0.08] bg-cover bg-center"\n          style={{ backgroundImage: `url(${backgroundImages[0]})` }}\n        />\n      )}\n      <div className="absolute inset-0 bg-gradient-to-br from-background/80 to-background/90" />\n      \n      <CardHeader className="relative z-10 pb-2">\n        <CardTitle className="flex items-center gap-2 text-lg">\n          <TrendingUp className="h-5 w-5 text-primary" />\n          Portfolio Value\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger>\n                <Info className="h-4 w-4 text-muted-foreground" />\n              </TooltipTrigger>\n              <TooltipContent side="right" className="max-w-xs">\n                <p className="font-medium mb-2">Value Appreciation Model</p>\n                <div className="space-y-2 text-xs">\n                  <div className="flex items-center justify-between">\n                    <span className="flex items-center gap-1">\n                      <Sparkles className="h-3 w-3 text-primary" />\n                      Value Appreciation\n                    </span>\n                    <span className="font-bold text-primary">{valueAppreciationPercent}%</span>\n                  </div>\n                  <div className="flex items-center justify-between text-muted-foreground">\n                    <span className="flex items-center gap-1">\n                      <Building2 className="h-3 w-3" />\n                      Platform & Fulfillment\n                    </span>\n                    <span>{platformSharePercent}%</span>\n                  </div>\n                  <p className="text-muted-foreground pt-1 border-t border-border/50">\n                    Value accrues to your visions. Sell on the marketplace to realize gains ({sellerKeepsPercent}% to you, {marketplaceFeePercent}% platform fee).\n                  </p>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </CardTitle>\n        <CardDescription className="relative z-10">\n          Accrued value from print orders by others\n        </CardDescription>\n      </CardHeader>\n      <CardContent className="relative z-10 space-y-4">\n        {/* Main value display */}\n        <div className="flex items-baseline gap-2">\n          <span className="text-3xl font-bold text-primary">\n            +${valueDollars.toFixed(2)}\n          </span>\n          <span className="text-sm text-muted-foreground">accrued value</span>\n        </div>\n\n        {/* Value appreciation visualization */}\n        {stats.totalPrintRevenue > 0 && (\n          <div className="space-y-2">\n            <div className="flex items-center justify-between text-xs">\n              <span className="flex items-center gap-1.5">\n                <PieChart className="h-3 w-3 text-muted-foreground" />\n                Print Revenue Split\n              </span>\n              <span className="text-muted-foreground">${totalRevenueDollars.toFixed(2)} total</span>\n            </div>\n            <div className="flex h-3 rounded-full overflow-hidden bg-muted/30">\n              <div \n                className="bg-primary transition-all"\n                style={{ width: `${valueAppreciationPercent}%` }}\n              />\n              <div \n                className="bg-muted-foreground/30 transition-all"\n                style={{ width: `${platformSharePercent}%` }}\n              />\n            </div>\n            <div className="flex justify-between text-xs">\n              <span className="text-primary font-medium">Your Value: +${valueDollars.toFixed(2)}</span>\n              <span className="text-muted-foreground">Operations: ${platformDollars.toFixed(2)}</span>\n            </div>\n          </div>\n        )}\n\n        {/* Stats grid */}\n        <div className="grid grid-cols-3 gap-2">\n          <div className="p-2 rounded-lg bg-background/50 border border-border/50 text-center">\n            <p className="text-lg font-semibold">{stats.visionCount}</p>\n            <p className="text-xs text-muted-foreground">Visions</p>\n          </div>\n          <div className="p-2 rounded-lg bg-background/50 border border-border/50 text-center">\n            <p className="text-lg font-semibold">{stats.totalRoyaltyOrders}</p>\n            <p className="text-xs text-muted-foreground">Orders by Others</p>\n          </div>\n          <div className="p-2 rounded-lg bg-background/50 border border-border/50 text-center">\n            <p className="text-lg font-semibold text-green-500">{sellerKeepsPercent}%</p>\n            <p className="text-xs text-muted-foreground">On Sale</p>\n          </div>\n        </div>\n\n        {stats.totalRoyaltyOrders === 0 && (\n          <div className="p-3 rounded-lg bg-primary/5 border border-primary/20">\n            <p className="text-xs text-muted-foreground">\n              <strong className="text-foreground">How it works:</strong> When others order prints, \n              {valueAppreciationPercent}% of revenue adds to your vision\'s value. List on the marketplace to sell.\n            </p>\n          </div>\n        )}\n\n        {/* Marketplace CTA */}\n        <div className="p-3 rounded-lg bg-green-500/5 border border-green-500/20 flex items-center justify-between gap-3">\n          <div className="flex items-center gap-2 text-xs">\n            <ArrowRightLeft className="h-4 w-4 text-green-500 shrink-0" />\n            <span className="text-muted-foreground">\n              Ready to sell? <strong className="text-foreground">Only {marketplaceFeePercent}% fee</strong>\n            </span>\n          </div>\n          <Button asChild size="sm" variant="outline" className="shrink-0 h-7 text-xs">\n            <Link to="/marketplace">Marketplace</Link>\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default PortfolioRoyaltySummary;\n';export{e as default};
