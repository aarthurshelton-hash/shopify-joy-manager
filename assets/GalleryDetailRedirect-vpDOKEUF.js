const n="/**\n * GalleryDetailRedirect - Redirects gallery detail pages (/my-vision/{id}) to canonical game URLs (/g/{hash})\n * \n * This maintains backward compatibility with existing gallery links while\n * using the new unified canonical URL system.\n */\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { generateGameHash } from '@/lib/visualizations/gameCanonical';\nimport { motion } from 'framer-motion';\n\nconst GalleryDetailRedirect = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchAndRedirect = async () => {\n      if (!id) {\n        setError('Invalid visualization ID');\n        return;\n      }\n\n      try {\n        // Fetch the visualization by ID\n        const { data, error: fetchError } = await supabase\n          .from('saved_visualizations')\n          .select('pgn, game_data')\n          .eq('id', id)\n          .maybeSingle();\n\n        if (fetchError) {\n          console.error('Error fetching visualization:', fetchError);\n          setError('Failed to load visualization');\n          return;\n        }\n\n        if (!data) {\n          setError('Visualization not found');\n          return;\n        }\n\n        // Get PGN from either pgn field or game_data.pgn\n        const pgn = data.pgn || (data.game_data as { pgn?: string })?.pgn || '';\n        \n        // Generate canonical game hash\n        const gameHash = generateGameHash(pgn);\n\n        // Get palette from stored state\n        const paletteId = (data.game_data as { visualizationState?: { paletteId?: string } })?.visualizationState?.paletteId;\n        \n        // Build redirect URL with palette param\n        const params = new URLSearchParams();\n        if (paletteId) {\n          params.set('p', paletteId);\n        }\n        params.set('src', 'gallery'); // Track source for context-aware UI\n        \n        const paramString = params.toString();\n        const redirectUrl = `/g/${gameHash}${paramString ? `?${paramString}` : ''}`;\n        \n        navigate(redirectUrl, { replace: true });\n      } catch (err) {\n        console.error('Redirect error:', err);\n        setError('Failed to redirect');\n      }\n    };\n\n    fetchAndRedirect();\n  }, [id, navigate]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-xl font-royal font-bold text-foreground\">\n            {error}\n          </h1>\n          <button \n            onClick={() => navigate('/my-vision')}\n            className=\"text-primary hover:underline\"\n          >\n            Return to Gallery\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}\n        className=\"w-12 h-12 border-2 border-primary border-t-transparent rounded-full\"\n      />\n    </div>\n  );\n};\n\nexport default GalleryDetailRedirect;\n";export{n as default};
