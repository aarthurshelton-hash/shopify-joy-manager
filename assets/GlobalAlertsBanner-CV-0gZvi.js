const n='import { useEffect, useState } from \'react\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { AlertTriangle, Bell, X, XCircle, Shield } from \'lucide-react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { useAuth } from \'@/hooks/useAuth\';\n\ninterface SystemAlert {\n  id: string;\n  alert_type: string;\n  severity: \'info\' | \'warning\' | \'critical\';\n  title: string;\n  message: string;\n  created_at: string;\n}\n\nexport function GlobalAlertsBanner() {\n  const { user } = useAuth();\n  const [dismissed, setDismissed] = useState<Set<string>>(new Set());\n  const [showBanner, setShowBanner] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n\n  // Check if user is admin\n  useEffect(() => {\n    const checkAdmin = async () => {\n      if (!user) {\n        setIsAdmin(false);\n        return;\n      }\n\n      try {\n        const { data } = await supabase.rpc(\'has_role\', { \n          _user_id: user.id, \n          _role: \'admin\' \n        });\n        setIsAdmin(!!data);\n      } catch {\n        setIsAdmin(false);\n      }\n    };\n\n    checkAdmin();\n  }, [user]);\n\n  const { data: alerts } = useQuery({\n    queryKey: [\'global-system-alerts\', isAdmin],\n    queryFn: async () => {\n      if (!isAdmin) return [];\n      \n      const { data, error } = await supabase.rpc(\'get_system_alerts\', { \n        p_include_resolved: false,\n        p_limit: 5 \n      });\n      if (error) throw error;\n      return (data as unknown as SystemAlert[]) || [];\n    },\n    enabled: isAdmin,\n    refetchInterval: 60000, // Check every minute\n    staleTime: 30000,\n  });\n\n  // Filter out dismissed alerts\n  const activeAlerts = alerts?.filter(a => !dismissed.has(a.id)) || [];\n  const criticalAlerts = activeAlerts.filter(a => a.severity === \'critical\');\n  const hasAlerts = activeAlerts.length > 0;\n  const hasCritical = criticalAlerts.length > 0;\n\n  if (!isAdmin || !hasAlerts || !showBanner) {\n    return null;\n  }\n\n  const mostCritical = criticalAlerts[0] || activeAlerts[0];\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0, y: -50 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: -50 }}\n        className={`fixed top-4 right-4 z-[9999] max-w-md ${\n          hasCritical ? \'bg-destructive\' : \'bg-amber-500\'\n        } text-white rounded-lg shadow-2xl overflow-hidden border border-white/20`}\n      >\n        <div className="p-4">\n          <div className="flex items-start gap-3">\n            {hasCritical ? (\n              <XCircle className="h-5 w-5 shrink-0 mt-0.5 animate-pulse" />\n            ) : (\n              <AlertTriangle className="h-5 w-5 shrink-0 mt-0.5" />\n            )}\n            \n            <div className="flex-1 min-w-0">\n              <div className="flex items-center gap-2">\n                <p className="font-semibold text-sm">{mostCritical.title}</p>\n                <Badge \n                  variant="secondary" \n                  className="bg-white/20 text-white text-xs"\n                >\n                  {activeAlerts.length > 1 \n                    ? `+${activeAlerts.length - 1} more` \n                    : mostCritical.alert_type}\n                </Badge>\n              </div>\n              <p className="text-xs opacity-90 mt-1 line-clamp-2">\n                {mostCritical.message}\n              </p>\n            </div>\n\n            <Button\n              variant="ghost"\n              size="icon"\n              className="shrink-0 h-6 w-6 text-white hover:bg-white/20"\n              onClick={() => {\n                if (activeAlerts.length === 1) {\n                  setShowBanner(false);\n                }\n                setDismissed(prev => new Set([...prev, mostCritical.id]));\n              }}\n            >\n              <X className="h-4 w-4" />\n            </Button>\n          </div>\n\n          <div className="flex items-center gap-2 mt-3">\n            <Button\n              size="sm"\n              variant="secondary"\n              className="text-xs h-7 bg-white/20 hover:bg-white/30 text-white"\n              onClick={() => {\n                window.location.href = \'/admin/ceo-dashboard?tab=health\';\n              }}\n            >\n              <Shield className="h-3 w-3 mr-1" />\n              View Dashboard\n            </Button>\n            <Button\n              size="sm"\n              variant="ghost"\n              className="text-xs h-7 text-white hover:bg-white/20"\n              onClick={() => setShowBanner(false)}\n            >\n              Dismiss All\n            </Button>\n          </div>\n        </div>\n\n        {/* Auto-dismiss progress bar */}\n        <motion.div\n          initial={{ width: \'100%\' }}\n          animate={{ width: \'0%\' }}\n          transition={{ duration: 60, ease: \'linear\' }}\n          onAnimationComplete={() => setShowBanner(false)}\n          className="h-1 bg-white/30"\n        />\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n';export{n as default};
