const t="import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from 'sonner';\n\ninterface SystemVital {\n  vital_name: string;\n  vital_type: string;\n  status: string;\n  last_pulse_at: string;\n  seconds_since_pulse: number;\n  pulse_count: number;\n  last_value: number;\n  target_value: number;\n  is_healthy: boolean;\n  metadata: Record<string, unknown>;\n}\n\ninterface EvolutionState {\n  generation: number | null;\n  fitness_score: number | null;\n  total_predictions: number | null;\n  last_mutation_at: string | null;\n  genes: Record<string, number>;\n  adaptation_history: unknown[];\n}\n\ninterface SystemHealth {\n  isAlive: boolean;\n  healthPercentage: number;\n  healthyCount: number;\n  totalCount: number;\n  criticalSystems: string[];\n  degradedSystems: string[];\n}\n\nexport function useSystemVitals() {\n  const queryClient = useQueryClient();\n\n  // Fetch all system vitals\n  const vitalsQuery = useQuery({\n    queryKey: ['system-vitals'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc('get_system_vitals');\n      if (error) throw error;\n      return data as SystemVital[];\n    },\n    refetchInterval: 5000,\n    staleTime: 2000,\n  });\n\n  // Fetch evolution state\n  const evolutionQuery = useQuery({\n    queryKey: ['evolution-state'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('evolution_state')\n        .select('*')\n        .eq('state_type', 'global')\n        .single();\n      if (error && error.code !== 'PGRST116') throw error;\n      return data as EvolutionState | null;\n    },\n    refetchInterval: 10000,\n  });\n\n  // Calculate system health\n  const systemHealth: SystemHealth = (() => {\n    const vitals = vitalsQuery.data || [];\n    const healthyCount = vitals.filter(v => v.is_healthy).length;\n    const totalCount = vitals.length;\n    const criticalSystems = vitals.filter(v => v.status === 'critical').map(v => v.vital_name);\n    const degradedSystems = vitals.filter(v => v.status === 'degraded').map(v => v.vital_name);\n    \n    return {\n      isAlive: healthyCount > 0 && criticalSystems.length < totalCount / 2,\n      healthPercentage: totalCount > 0 ? (healthyCount / totalCount) * 100 : 0,\n      healthyCount,\n      totalCount,\n      criticalSystems,\n      degradedSystems,\n    };\n  })();\n\n  // Trigger heartbeat\n  const triggerHeartbeat = useMutation({\n    mutationFn: async (action: 'full_cycle' | 'collect' | 'predict' | 'resolve' | 'correlate' | 'evolve' = 'full_cycle') => {\n      const { data, error } = await supabase.functions.invoke('system-heartbeat', {\n        body: { action }\n      });\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['system-vitals'] });\n      queryClient.invalidateQueries({ queryKey: ['evolution-state'] });\n    },\n    onError: (error) => {\n      toast.error('Heartbeat failed', { description: error.message });\n    }\n  });\n\n  // Start automated heartbeat (for development/testing)\n  const startHeartbeat = (intervalMs = 5000) => {\n    const interval = setInterval(() => {\n      triggerHeartbeat.mutate('full_cycle');\n    }, intervalMs);\n    \n    return () => clearInterval(interval);\n  };\n\n  return {\n    vitals: vitalsQuery.data || [],\n    evolution: evolutionQuery.data,\n    systemHealth,\n    isLoading: vitalsQuery.isLoading,\n    isError: vitalsQuery.isError,\n    error: vitalsQuery.error,\n    refetch: () => {\n      vitalsQuery.refetch();\n      evolutionQuery.refetch();\n    },\n    triggerHeartbeat: triggerHeartbeat.mutate,\n    isTriggering: triggerHeartbeat.isPending,\n    startHeartbeat,\n  };\n}\n";export{t as default};
