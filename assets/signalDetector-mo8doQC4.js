const n="/**\n * Cross-Market Signal Detection Module\n */\n\nimport { MarketTick, CrossMarketSignal, AssetClass } from './types';\n\nexport function calculateTrend(history: MarketTick[]): number {\n  if (history.length < 2) return 0;\n  const changes = history.map(t => t.changePercent);\n  const avg = changes.reduce((a, b) => a + b, 0) / changes.length;\n  return Math.max(-1, Math.min(1, avg * 10));\n}\n\nexport function calculateVolatility(history: MarketTick[]): number {\n  if (history.length < 2) return 0;\n  const changes = history.map(t => Math.abs(t.changePercent));\n  return changes.reduce((a, b) => a + b, 0) / changes.length;\n}\n\nexport function detectSignals(\n  tickHistory: Map<AssetClass, MarketTick[]>,\n  existingSignals: CrossMarketSignal[]\n): CrossMarketSignal[] {\n  const signals: CrossMarketSignal[] = [];\n\n  const equityHistory = tickHistory.get('equity') || [];\n  const bondHistory = tickHistory.get('bond') || [];\n  const futureHistory = tickHistory.get('future') || [];\n  const commodityHistory = tickHistory.get('commodity') || [];\n\n  // Check for equity-bond divergences\n  if (equityHistory.length > 5 && bondHistory.length > 5) {\n    const equityTrend = calculateTrend(equityHistory.slice(-10));\n    const bondTrend = calculateTrend(bondHistory.slice(-10));\n\n    if (equityTrend > 0.3 && bondTrend > 0.3) {\n      signals.push({\n        type: 'divergence',\n        strength: Math.min(equityTrend, bondTrend),\n        sourceMarkets: ['equity', 'bond'],\n        description: 'Unusual equity-bond convergence - potential regime change',\n        predictiveValue: 0.7,\n        timestamp: Date.now()\n      });\n    }\n\n    if (equityTrend < -0.3 && bondTrend > 0.3) {\n      signals.push({\n        type: 'convergence',\n        strength: Math.abs(equityTrend - bondTrend) / 2,\n        sourceMarkets: ['equity', 'bond'],\n        description: 'Flight to safety - risk-off rotation',\n        predictiveValue: 0.8,\n        timestamp: Date.now()\n      });\n    }\n  }\n\n  // Check futures leading\n  if (futureHistory.length > 5 && equityHistory.length > 5) {\n    const futureTrend = calculateTrend(futureHistory.slice(-5));\n    const equityTrend = calculateTrend(equityHistory.slice(-5));\n\n    if (Math.abs(futureTrend) > 0.2 && Math.sign(futureTrend) !== Math.sign(equityTrend)) {\n      signals.push({\n        type: 'leading',\n        strength: Math.abs(futureTrend),\n        sourceMarkets: ['future', 'equity'],\n        description: `Futures signaling ${futureTrend > 0 ? 'bullish' : 'bearish'} move`,\n        predictiveValue: 0.75,\n        timestamp: Date.now()\n      });\n    }\n  }\n\n  // Commodity breakout detection\n  if (commodityHistory.length > 20) {\n    const recentVol = calculateVolatility(commodityHistory.slice(-10));\n    const baseVol = calculateVolatility(commodityHistory.slice(-20, -10));\n\n    if (recentVol > baseVol * 1.5) {\n      signals.push({\n        type: 'breakout',\n        strength: Math.min((recentVol / baseVol - 1), 1),\n        sourceMarkets: ['commodity'],\n        description: 'Commodity volatility spike - inflation signal',\n        predictiveValue: 0.65,\n        timestamp: Date.now()\n      });\n    }\n  }\n\n  // Keep only recent signals\n  return [...signals, ...existingSignals]\n    .filter(s => Date.now() - s.timestamp < 60000)\n    .slice(0, 10);\n}\n";export{n as default};
