const e='import React, { useState, useCallback, useMemo } from \'react\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \'@/components/ui/select\';\nimport {\n  Puzzle,\n  Trophy,\n  Flame,\n  Brain,\n  Target,\n  ChevronRight,\n  Crown,\n  Sparkles,\n  BookOpen,\n  Zap,\n  Swords,\n  RotateCcw,\n} from \'lucide-react\';\nimport { PuzzleBoard } from \'./PuzzleBoard\';\nimport {\n  ChessPuzzle,\n  PuzzleDifficulty,\n  PuzzleTheme,\n  getRandomPuzzle,\n  getPuzzleStats,\n  getPuzzlesByTheme,\n  getThemeInfo,\n  FAMOUS_GAME_PUZZLES,\n} from \'@/lib/chess/puzzleDatabase\';\nimport { cn } from \'@/lib/utils\';\n\ninterface PuzzleSession {\n  puzzlesSolved: number;\n  puzzlesFailed: number;\n  totalHintsUsed: number;\n  currentStreak: number;\n  bestStreak: number;\n  completedIds: string[];\n}\n\nconst FEATURED_THEMES: PuzzleTheme[] = [\n  \'mateIn1\',\n  \'mateIn2\',\n  \'fork\',\n  \'pin\',\n  \'sacrifice\',\n  \'discoveredAttack\',\n  \'backRankMate\',\n  \'endgame\',\n];\n\nexport const PuzzleMode: React.FC = () => {\n  const [currentPuzzle, setCurrentPuzzle] = useState<ChessPuzzle | null>(null);\n  const [selectedDifficulty, setSelectedDifficulty] = useState<PuzzleDifficulty>(\'intermediate\');\n  const [selectedTheme, setSelectedTheme] = useState<PuzzleTheme | \'any\'>(\'any\');\n  const [selectedSource, setSelectedSource] = useState<\'all\' | \'lichess\' | \'famous_game\'>(\'all\');\n  const [session, setSession] = useState<PuzzleSession>({\n    puzzlesSolved: 0,\n    puzzlesFailed: 0,\n    totalHintsUsed: 0,\n    currentStreak: 0,\n    bestStreak: 0,\n    completedIds: [],\n  });\n\n  const stats = useMemo(() => getPuzzleStats(), []);\n\n  // Start a new puzzle\n  const startPuzzle = useCallback((options?: {\n    difficulty?: PuzzleDifficulty;\n    theme?: PuzzleTheme;\n    source?: \'lichess\' | \'famous_game\';\n    specificPuzzle?: ChessPuzzle;\n  }) => {\n    if (options?.specificPuzzle) {\n      setCurrentPuzzle(options.specificPuzzle);\n      return;\n    }\n\n    const puzzle = getRandomPuzzle({\n      difficulty: options?.difficulty || selectedDifficulty,\n      theme: options?.theme || (selectedTheme !== \'any\' ? selectedTheme : undefined),\n      source: options?.source || (selectedSource !== \'all\' ? selectedSource : undefined),\n      excludeIds: session.completedIds,\n    });\n\n    if (puzzle) {\n      setCurrentPuzzle(puzzle);\n    }\n  }, [selectedDifficulty, selectedTheme, selectedSource, session.completedIds]);\n\n  // Handle puzzle completion\n  const handlePuzzleSolved = useCallback((solved: boolean, hintsUsed: number) => {\n    setSession(prev => {\n      const newStreak = solved ? prev.currentStreak + 1 : 0;\n      return {\n        ...prev,\n        puzzlesSolved: solved ? prev.puzzlesSolved + 1 : prev.puzzlesSolved,\n        puzzlesFailed: !solved ? prev.puzzlesFailed + 1 : prev.puzzlesFailed,\n        totalHintsUsed: prev.totalHintsUsed + hintsUsed,\n        currentStreak: newStreak,\n        bestStreak: Math.max(prev.bestStreak, newStreak),\n        completedIds: currentPuzzle ? [...prev.completedIds, currentPuzzle.id] : prev.completedIds,\n      };\n    });\n  }, [currentPuzzle]);\n\n  // Next puzzle\n  const handleNextPuzzle = useCallback(() => {\n    startPuzzle();\n  }, [startPuzzle]);\n\n  // Reset session\n  const resetSession = useCallback(() => {\n    setSession({\n      puzzlesSolved: 0,\n      puzzlesFailed: 0,\n      totalHintsUsed: 0,\n      currentStreak: 0,\n      bestStreak: 0,\n      completedIds: [],\n    });\n    setCurrentPuzzle(null);\n  }, []);\n\n  // Calculate accuracy\n  const accuracy = useMemo(() => {\n    const total = session.puzzlesSolved + session.puzzlesFailed;\n    if (total === 0) return 0;\n    return Math.round((session.puzzlesSolved / total) * 100);\n  }, [session]);\n\n  return (\n    <div className="space-y-6">\n      {/* Header */}\n      <div className="flex items-center justify-between flex-wrap gap-4">\n        <div className="flex items-center gap-3">\n          <div className="p-2 rounded-lg bg-primary/10">\n            <Puzzle className="h-6 w-6 text-primary" />\n          </div>\n          <div>\n            <h2 className="text-xl font-display font-bold">Puzzle Training</h2>\n            <p className="text-sm text-muted-foreground">\n              {stats.total} puzzles from Lichess & famous games\n            </p>\n          </div>\n        </div>\n\n        {/* Session Stats */}\n        <div className="flex items-center gap-4">\n          <div className="flex items-center gap-2">\n            <Trophy className="h-4 w-4 text-green-500" />\n            <span className="font-mono text-sm">{session.puzzlesSolved}</span>\n          </div>\n          {session.currentStreak > 0 && (\n            <div className="flex items-center gap-2">\n              <Flame className="h-4 w-4 text-amber-500" />\n              <span className="font-mono text-sm">{session.currentStreak} streak</span>\n            </div>\n          )}\n          {accuracy > 0 && (\n            <Badge variant="outline" className={cn(\n              accuracy >= 80 ? \'text-green-500 border-green-500/30\' :\n              accuracy >= 60 ? \'text-amber-500 border-amber-500/30\' :\n              \'text-red-500 border-red-500/30\'\n            )}>\n              {accuracy}% accuracy\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      {currentPuzzle ? (\n        /* Active Puzzle View */\n        <div className="grid lg:grid-cols-[1fr,300px] gap-6">\n          <Card>\n            <CardContent className="p-4">\n              <PuzzleBoard\n                puzzle={currentPuzzle}\n                onSolve={handlePuzzleSolved}\n                onNext={handleNextPuzzle}\n                showSolution={true}\n              />\n            </CardContent>\n          </Card>\n\n          {/* Side Panel */}\n          <div className="space-y-4">\n            {/* Quick Actions */}\n            <Card>\n              <CardHeader className="pb-2">\n                <CardTitle className="text-sm font-display uppercase tracking-wider text-muted-foreground">\n                  Quick Play\n                </CardTitle>\n              </CardHeader>\n              <CardContent className="space-y-2">\n                <Button\n                  variant="outline"\n                  size="sm"\n                  className="w-full justify-start gap-2"\n                  onClick={() => startPuzzle({ theme: \'mateIn1\' })}\n                >\n                  <Target className="h-4 w-4 text-green-500" />\n                  Mate in 1\n                </Button>\n                <Button\n                  variant="outline"\n                  size="sm"\n                  className="w-full justify-start gap-2"\n                  onClick={() => startPuzzle({ theme: \'sacrifice\' })}\n                >\n                  <Sparkles className="h-4 w-4 text-purple-500" />\n                  Sacrifices\n                </Button>\n                <Button\n                  variant="outline"\n                  size="sm"\n                  className="w-full justify-start gap-2"\n                  onClick={() => startPuzzle({ source: \'famous_game\' })}\n                >\n                  <Crown className="h-4 w-4 text-amber-500" />\n                  Master Games\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Session Stats */}\n            <Card>\n              <CardHeader className="pb-2">\n                <CardTitle className="text-sm font-display uppercase tracking-wider text-muted-foreground">\n                  This Session\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className="grid grid-cols-2 gap-3 text-center">\n                  <div className="p-2 rounded-lg bg-green-500/10">\n                    <p className="text-lg font-bold text-green-500">{session.puzzlesSolved}</p>\n                    <p className="text-xs text-muted-foreground">Solved</p>\n                  </div>\n                  <div className="p-2 rounded-lg bg-red-500/10">\n                    <p className="text-lg font-bold text-red-500">{session.puzzlesFailed}</p>\n                    <p className="text-xs text-muted-foreground">Failed</p>\n                  </div>\n                  <div className="p-2 rounded-lg bg-amber-500/10">\n                    <p className="text-lg font-bold text-amber-500">{session.bestStreak}</p>\n                    <p className="text-xs text-muted-foreground">Best Streak</p>\n                  </div>\n                  <div className="p-2 rounded-lg bg-blue-500/10">\n                    <p className="text-lg font-bold text-blue-500">{session.totalHintsUsed}</p>\n                    <p className="text-xs text-muted-foreground">Hints Used</p>\n                  </div>\n                </div>\n                <Button\n                  variant="ghost"\n                  size="sm"\n                  className="w-full mt-3 gap-2 text-muted-foreground"\n                  onClick={resetSession}\n                >\n                  <RotateCcw className="h-3 w-3" />\n                  Reset Session\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      ) : (\n        /* Puzzle Selection View */\n        <Tabs defaultValue="quick" className="w-full">\n          <TabsList className="grid w-full grid-cols-3">\n            <TabsTrigger value="quick" className="gap-2">\n              <Zap className="h-4 w-4" />\n              Quick Start\n            </TabsTrigger>\n            <TabsTrigger value="themes" className="gap-2">\n              <Target className="h-4 w-4" />\n              By Theme\n            </TabsTrigger>\n            <TabsTrigger value="famous" className="gap-2">\n              <Crown className="h-4 w-4" />\n              Famous Games\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Quick Start */}\n          <TabsContent value="quick" className="mt-6">\n            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">\n              {([\'beginner\', \'intermediate\', \'advanced\', \'master\'] as PuzzleDifficulty[]).map((diff) => {\n                const config = {\n                  beginner: { icon: BookOpen, color: \'text-green-500\', bg: \'bg-green-500/10\', border: \'border-green-500/30\' },\n                  intermediate: { icon: Brain, color: \'text-blue-500\', bg: \'bg-blue-500/10\', border: \'border-blue-500/30\' },\n                  advanced: { icon: Swords, color: \'text-purple-500\', bg: \'bg-purple-500/10\', border: \'border-purple-500/30\' },\n                  master: { icon: Crown, color: \'text-amber-500\', bg: \'bg-amber-500/10\', border: \'border-amber-500/30\' },\n                }[diff];\n                const Icon = config.icon;\n                \n                return (\n                  <Card\n                    key={diff}\n                    className={cn(\n                      \'cursor-pointer transition-all hover:ring-2 hover:ring-primary/50\',\n                      config.border,\n                      config.bg\n                    )}\n                    onClick={() => {\n                      setSelectedDifficulty(diff);\n                      startPuzzle({ difficulty: diff });\n                    }}\n                  >\n                    <CardContent className="p-6 text-center">\n                      <div className={cn(\'w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3\', config.bg)}>\n                        <Icon className={cn(\'h-6 w-6\', config.color)} />\n                      </div>\n                      <h3 className="font-display font-bold capitalize">{diff}</h3>\n                      <p className="text-xs text-muted-foreground mt-1">\n                        {diff === \'beginner\' && \'800-1200\'}\n                        {diff === \'intermediate\' && \'1200-1600\'}\n                        {diff === \'advanced\' && \'1600-2000\'}\n                        {diff === \'master\' && \'2000+\'}\n                      </p>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </TabsContent>\n\n          {/* By Theme */}\n          <TabsContent value="themes" className="mt-6">\n            <div className="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">\n              {FEATURED_THEMES.map((theme) => {\n                const info = getThemeInfo(theme);\n                const count = getPuzzlesByTheme(theme).length;\n                \n                return (\n                  <Card\n                    key={theme}\n                    className="cursor-pointer transition-all hover:ring-2 hover:ring-primary/50"\n                    onClick={() => {\n                      setSelectedTheme(theme);\n                      startPuzzle({ theme });\n                    }}\n                  >\n                    <CardContent className="p-4">\n                      <div className="flex items-center gap-3">\n                        <div className="text-2xl">{info.icon}</div>\n                        <div className="flex-1">\n                          <h3 className="font-medium text-sm">{info.name}</h3>\n                          <p className="text-xs text-muted-foreground">{count} puzzles</p>\n                        </div>\n                        <ChevronRight className="h-4 w-4 text-muted-foreground" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </TabsContent>\n\n          {/* Famous Games */}\n          <TabsContent value="famous" className="mt-6">\n            <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">\n              {FAMOUS_GAME_PUZZLES.map((puzzle) => (\n                <Card\n                  key={puzzle.id}\n                  className="cursor-pointer transition-all hover:ring-2 hover:ring-amber-500/50 border-amber-500/20 bg-amber-500/5"\n                  onClick={() => startPuzzle({ specificPuzzle: puzzle })}\n                >\n                  <CardContent className="p-4">\n                    <div className="flex items-start gap-3">\n                      <div className="p-2 rounded-lg bg-amber-500/10">\n                        <Trophy className="h-5 w-5 text-amber-500" />\n                      </div>\n                      <div className="flex-1">\n                        <h3 className="font-display font-bold text-sm">{puzzle.gameTitle}</h3>\n                        {puzzle.openingFamily && (\n                          <p className="text-xs text-muted-foreground">{puzzle.openingFamily}</p>\n                        )}\n                        <p className="text-xs text-muted-foreground mt-1 line-clamp-2">\n                          {puzzle.description}\n                        </p>\n                        <div className="flex items-center gap-2 mt-2">\n                          <Badge variant="secondary" className="text-xs font-mono">\n                            {puzzle.rating}\n                          </Badge>\n                          {puzzle.themes.slice(0, 2).map(t => (\n                            <Badge key={t} variant="outline" className="text-xs">\n                              {getThemeInfo(t).name}\n                            </Badge>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n        </Tabs>\n      )}\n    </div>\n  );\n};\n\nexport default PuzzleMode;\n';export{e as default};
