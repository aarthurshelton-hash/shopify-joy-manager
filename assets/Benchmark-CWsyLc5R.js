const e='import { useState, useEffect, useRef, useCallback } from \'react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Progress } from \'@/components/ui/progress\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { Slider } from \'@/components/ui/slider\';\nimport { Brain, Cpu, Trophy, Play, Loader2, Clock, CheckCircle, XCircle, AlertCircle, Cloud, Database, TrendingUp, History, Layers, RefreshCw, Sparkles, Crown, Shield, Zap, BookOpen, MousePointer, Rocket } from \'lucide-react\';\nimport { AutoEvolutionPanel } from \'@/components/chess/AutoEvolutionPanel\';\nimport { runCloudBenchmark, FAMOUS_GAMES, type BenchmarkResult, type PredictionAttempt } from \'@/lib/chess/cloudBenchmark\';\nimport { checkLichessAvailability } from \'@/lib/chess/lichessCloudEval\';\nimport { saveBenchmarkResults, getCumulativeStats, getArchetypeStats } from \'@/lib/chess/benchmarkPersistence\';\nimport { calculateDepthMetricsFromBenchmark, type DepthMetrics } from \'@/lib/chess/depthAnalysis\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { ProofDashboard } from \'@/components/chess/ProofDashboard\';\nimport { EloDepthDashboard } from \'@/components/chess/EloDepthDashboard\';\nimport { AuthenticityDashboard } from \'@/components/chess/AuthenticityDashboard\';\nimport { useHybridBenchmark, type LivePredictionData } from \'@/hooks/useHybridBenchmark\';\nimport { useStockfishAnalysis } from \'@/hooks/useStockfishAnalysis\';\nimport { StockfishIntelligencePanel } from \'@/components/chess/StockfishIntelligencePanel\';\nimport { LiveEloPanel } from \'@/components/chess/LiveEloPanel\';\nimport { LivePredictionStream, type LivePrediction } from \'@/components/chess/LivePredictionStream\';\nimport { \n  createInitialEloState, \n  calculateEloFromBenchmark,\n  type LiveEloState \n} from \'@/lib/chess/liveEloTracker\';\nimport { useBenchmarkRateLimit } from \'@/hooks/useRateLimitV2\';\nimport { GameDetailsModal } from \'@/components/chess/GameDetailsModal\';\nimport { acquireBenchmarkLock, releaseBenchmarkLock } from \'@/lib/chess/benchmarkCoordinator\';\nimport { useRealtimeAccuracyContext } from \'@/providers/RealtimeAccuracyProvider\';\nimport { BenchmarkSourceBreakdown } from \'@/components/chess/BenchmarkSourceBreakdown\';\n\ninterface CumulativeStats {\n  totalRuns: number;\n  totalGamesAnalyzed: number;\n  overallHybridAccuracy: number;\n  overallStockfishAccuracy: number;\n  hybridNetWins: number;\n  hybridWins: number;\n  stockfishWins: number;\n  bothCorrect: number;\n  bestArchetype: string | null;\n  worstArchetype: string | null;\n  validPredictionCount: number;\n  invalidPredictionCount: number;\n}\n\ninterface LatestBenchmark {\n  id: string;\n  created_at: string;\n  hybrid_accuracy: number;\n  stockfish_accuracy: number;\n  completed_games: number; // FIXED: Use completed_games (actual analyzed count)\n  hybrid_wins: number;\n  stockfish_wins: number;\n  both_correct: number;\n}\n\ninterface FarmStatus {\n  farm_id: string;\n  farm_name: string | null;\n  host_name: string | null;\n  status: string;\n  message: string | null;\n  chess_games_generated: number;\n  chess_errors: number;\n  market_cycles_completed: number;\n  market_errors: number;\n  benchmark_runs_completed: number;\n  benchmark_errors: number;\n  last_heartbeat_at: string;\n  updated_at: string;\n }\n\nexport default function Benchmark() {\n  // v7.23: Use realtime context for live ELO (stats still use existing realtime subscription)\n  const { liveEloState: realtimeEloState, chessStats: realtimeChessStats } = useRealtimeAccuracyContext();\n  \n  const [isRunning, setIsRunning] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [status, setStatus] = useState(\'\');\n  const [currentGame, setCurrentGame] = useState(\'\');\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [result, setResult] = useState<BenchmarkResult | null>(null);\n  const [liveAttempts, setLiveAttempts] = useState<PredictionAttempt[]>([]);\n  const [apiReady, setApiReady] = useState(false);\n  const [rateLimited, setRateLimited] = useState(false);\n  const [rateLimitResetMs, setRateLimitResetMs] = useState(0);\n  const [initPhase, setInitPhase] = useState(\'Checking Lichess API...\');\n  const [savedRunId, setSavedRunId] = useState<string | null>(null);\n  const [cumulativeStats, setCumulativeStats] = useState<CumulativeStats | null>(null);\n  const [depthMetrics, setDepthMetrics] = useState<DepthMetrics | null>(null);\n  const [latestBenchmark, setLatestBenchmark] = useState<LatestBenchmark | null>(null);\n  const [isLoadingLatest, setIsLoadingLatest] = useState(true);\n  const [farmStatus, setFarmStatus] = useState<FarmStatus | null>(null);\n  const [isLoadingFarmStatus, setIsLoadingFarmStatus] = useState(true);\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const startTimeRef = useRef<number>(0);\n\n  // v7.23: Use realtime ELO from context, fall back to local state during active benchmark\n  const [localEloState, setLiveEloState] = useState<LiveEloState>(createInitialEloState());\n  const [isLiveElo, setIsLiveElo] = useState(false);\n  \n  // v7.23: Prefer realtime ELO when not running a benchmark\n  const liveEloState = isRunning ? localEloState : realtimeEloState;\n  \n  // v7.23: Sync cumulative stats from realtime context\n  useEffect(() => {\n    if (realtimeChessStats && !isRunning) {\n      setCumulativeStats({\n        totalRuns: realtimeChessStats.totalRuns,\n        totalGamesAnalyzed: realtimeChessStats.totalGames,\n        overallHybridAccuracy: realtimeChessStats.hybridAccuracy,\n        overallStockfishAccuracy: realtimeChessStats.stockfishAccuracy,\n        hybridNetWins: realtimeChessStats.hybridNetWins,\n        hybridWins: realtimeChessStats.hybridWins,\n        stockfishWins: realtimeChessStats.stockfishWins,\n        bothCorrect: realtimeChessStats.bothCorrect,\n        bestArchetype: null,\n        worstArchetype: null,\n        validPredictionCount: realtimeChessStats.totalGames,\n        invalidPredictionCount: 0,\n      });\n    }\n  }, [realtimeChessStats, isRunning]);\n\n  // Live Prediction Stream State\n  const [livePredictions, setLivePredictions] = useState<LivePrediction[]>([]);\n\n  // Maximum Depth Mode State\n  const [benchmarkMode, setBenchmarkMode] = useState<\'cloud\' | \'local\'>(\'cloud\');\n  const [localDepth, setLocalDepth] = useState(60); // Maximum depth for local WASM\n  const [gameCount, setGameCount] = useState(30); // Default: 30 unique positions\n  \n  // Hooks for local WASM benchmark\n  const { isReady: wasmReady, engineVersion, loadingProgress: wasmLoadingProgress, error: wasmError } = useStockfishAnalysis();\n  const { \n    runBenchmark: runLocalBenchmark, \n    abort: abortLocalBenchmark,\n    isRunning: isLocalRunning, \n    progress: localProgress, \n    result: localResult,\n    error: localError \n  } = useHybridBenchmark();\n\n  // Rate limiting for benchmark runs (V2 - synchronous, sliding window)\n  const { check: checkBenchmarkLimit, isLimited: isBenchmarkLimited } = useBenchmarkRateLimit();\n\n  // Handle live prediction callback\n  const handleLivePrediction = useCallback((prediction: LivePredictionData) => {\n    const livePred: LivePrediction = {\n      ...prediction,\n    };\n    setLivePredictions(prev => [...prev, livePred]);\n  }, []);\n\n  useEffect(() => {\n    let channel: ReturnType<typeof supabase.channel> | null = null;\n\n    const loadFarmStatus = async () => {\n      try {\n        setIsLoadingFarmStatus(true);\n        const { data } = await supabase\n          .from(\'farm_status\')\n          .select(\'*\')\n          .order(\'last_heartbeat_at\', { ascending: false })\n          .limit(1)\n          .maybeSingle();\n        setFarmStatus(data || null);\n      } finally {\n        setIsLoadingFarmStatus(false);\n      }\n    };\n\n    loadFarmStatus();\n\n    channel = supabase\n      .channel(\'realtime-farm-status\')\n      .on(\n        \'postgres_changes\',\n        { event: \'*\', schema: \'public\', table: \'farm_status\' },\n        () => {\n          loadFarmStatus();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      if (channel) supabase.removeChannel(channel);\n    };\n  }, []);\n\n  // Update ELO state when local result changes - fetch CUMULATIVE stats\n  useEffect(() => {\n    if (localResult) {\n      // Fetch cumulative stats to calculate ELO from ALL historical data\n      const updateCumulativeElo = async () => {\n        const newStats = await getCumulativeStats();\n        setCumulativeStats(newStats);\n        \n        if (newStats && newStats.validPredictionCount > 0) {\n          const cumulativeElo = calculateEloFromBenchmark(\n            newStats.overallHybridAccuracy,\n            newStats.overallStockfishAccuracy,\n            newStats.hybridWins,\n            newStats.stockfishWins,\n            newStats.bothCorrect,\n            newStats.validPredictionCount,\n            localResult.averageDepth\n          );\n          setLiveEloState(cumulativeElo);\n          console.log(\'[Benchmark] Updated CUMULATIVE ELO after local run:\', {\n            totalGames: newStats.validPredictionCount,\n            hybridNetWins: newStats.hybridNetWins,\n            calculatedElo: cumulativeElo.enPensentElo\n          });\n        }\n        setIsLiveElo(false);\n        \n        // v7.12: Release lock when local benchmark completes\n        await releaseBenchmarkLock();\n      };\n      \n      updateCumulativeElo();\n    }\n  }, [localResult]);\n\n  // Set live mode when running\n  useEffect(() => {\n    setIsLiveElo(isRunning || isLocalRunning);\n  }, [isRunning, isLocalRunning]);\n\n  // v7.12: Release lock when local benchmark stops (error/abort/complete without result)\n  useEffect(() => {\n    // When isLocalRunning goes from true to false, ensure lock is released\n    // Note: localResult useEffect handles successful completion\n    if (!isLocalRunning && localError) {\n      console.log(\'[Benchmark] Local benchmark errored, releasing lock\');\n      releaseBenchmarkLock();\n    }\n  }, [isLocalRunning, localError]);\n\n  // REALTIME: Subscribe to BOTH chess_benchmark_results AND chess_prediction_attempts\n  useEffect(() => {\n    let lastRefresh = 0;\n    const DEBOUNCE_MS = 2000; // Debounce to avoid rapid refreshes\n    \n    const refreshStats = async (source: string) => {\n      const now = Date.now();\n      if (now - lastRefresh < DEBOUNCE_MS) {\n        console.log(`[Benchmark] Realtime: Debounced ${source} refresh`);\n        return;\n      }\n      lastRefresh = now;\n      \n      console.log(`[Benchmark] Realtime: Refreshing stats from ${source}`);\n      const newStats = await getCumulativeStats();\n      setCumulativeStats(newStats);\n      \n      if (newStats && newStats.validPredictionCount > 0) {\n        const cumulativeElo = calculateEloFromBenchmark(\n          newStats.overallHybridAccuracy,\n          newStats.overallStockfishAccuracy,\n          newStats.hybridWins,\n          newStats.stockfishWins,\n          newStats.bothCorrect,\n          newStats.validPredictionCount,\n          40\n        );\n        setLiveEloState(cumulativeElo);\n        console.log(`[Benchmark] Realtime ELO update (${source}):`, {\n          totalGames: newStats.validPredictionCount,\n          hybridAcc: newStats.overallHybridAccuracy.toFixed(1) + \'%\',\n          elo: cumulativeElo.enPensentElo\n        });\n      }\n    };\n    \n    const channel = supabase\n      .channel(\'benchmark-realtime-v2\')\n      // Listen to benchmark summary inserts\n      .on(\n        \'postgres_changes\',\n        { event: \'INSERT\', schema: \'public\', table: \'chess_benchmark_results\' },\n        async (payload) => {\n          console.log(\'[Benchmark] Realtime: New benchmark result detected!\', payload.new);\n          await refreshStats(\'benchmark_results\');\n          \n          // Also update latest benchmark\n          const latest = payload.new as LatestBenchmark;\n          setLatestBenchmark(latest);\n        }\n      )\n      // Listen to individual prediction inserts for live updates\n      .on(\n        \'postgres_changes\',\n        { event: \'INSERT\', schema: \'public\', table: \'chess_prediction_attempts\' },\n        async () => {\n          await refreshStats(\'prediction_attempts\');\n        }\n      )\n      .subscribe((status) => {\n        if (status === \'SUBSCRIBED\') {\n          console.log(\'[Benchmark] Realtime subscription active (v2) - listening to BOTH tables!\');\n        }\n      });\n    \n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, []);\n  \n  // Fetch latest benchmark results and check API on mount\n  useEffect(() => {\n    let cancelled = false;\n    let retryTimeout: NodeJS.Timeout | null = null;\n    \n    const initialize = async (attempt = 1) => {\n      setInitPhase(attempt > 1 ? `Retrying connection (attempt ${attempt})...` : \'Loading latest benchmark state...\');\n      setIsLoadingLatest(true);\n      \n      try {\n        // Fetch latest benchmark, cumulative stats, and check API in parallel\n        const [available, stats, { data: latest }] = await Promise.all([\n          checkLichessAvailability(),\n          getCumulativeStats(),\n          supabase\n            .from(\'chess_benchmark_results\')\n            .select(\'id, created_at, hybrid_accuracy, stockfish_accuracy, completed_games, hybrid_wins, stockfish_wins, both_correct\')\n            .order(\'created_at\', { ascending: false })\n            .limit(1)\n            .single()\n        ]);\n        \n        if (!cancelled) {\n          setApiReady(available.available);\n          setRateLimited(available.rateLimited);\n          if (available.resetInMs) {\n            setRateLimitResetMs(available.resetInMs);\n          }\n          setCumulativeStats(stats);\n          setLatestBenchmark(latest);\n          setIsLoadingLatest(false);\n          \n          // Initialize ELO state from CUMULATIVE stats (all historical data)\n          // This ensures ELO builds on every benchmark run\n          if (stats && stats.totalGamesAnalyzed > 0) {\n            const cumulativeElo = calculateEloFromBenchmark(\n              stats.overallHybridAccuracy,\n              stats.overallStockfishAccuracy,\n              stats.hybridWins,\n              stats.stockfishWins,\n              stats.bothCorrect,\n              stats.validPredictionCount,\n              40\n            );\n            setLiveEloState(cumulativeElo);\n            console.log(\'[Benchmark] ELO calculated from CUMULATIVE data:\', {\n              totalGames: stats.validPredictionCount,\n              hybridAccuracy: stats.overallHybridAccuracy,\n              stockfishAccuracy: stats.overallStockfishAccuracy,\n              hybridNetWins: stats.hybridNetWins,\n              calculatedElo: cumulativeElo.enPensentElo\n            });\n          } else if (latest) {\n            // Fallback to latest benchmark if no cumulative stats\n            const initialElo = calculateEloFromBenchmark(\n              latest.hybrid_accuracy,\n              latest.stockfish_accuracy,\n              latest.hybrid_wins,\n              latest.stockfish_wins,\n              latest.both_correct,\n              latest.completed_games,\n              35\n            );\n            setLiveEloState(initialElo);\n          }\n          \n          if (available.available) {\n            setInitPhase(\'Stockfish 17 via Lichess Cloud ready!\');\n          } else if (available.rateLimited) {\n            const waitSecs = Math.ceil((available.resetInMs || 30000) / 1000);\n            setInitPhase(`Rate limited - API available in ~${waitSecs}s. Try Maximum Depth mode.`);\n          } else if (attempt < 3) {\n            // Retry up to 3 times with increasing delay\n            setInitPhase(`Lichess Cloud not responding, retrying in ${attempt * 2}s...`);\n            retryTimeout = setTimeout(() => initialize(attempt + 1), attempt * 2000);\n          } else {\n            setInitPhase(\'Cloud API unavailable - try Maximum Depth mode instead\');\n          }\n        }\n      } catch (err) {\n        console.error(\'[Benchmark] Init error:\', err);\n        if (!cancelled) {\n          setIsLoadingLatest(false);\n          if (attempt < 3) {\n            setInitPhase(`Connection failed, retrying (${attempt}/3)...`);\n            retryTimeout = setTimeout(() => initialize(attempt + 1), attempt * 2000);\n          } else {\n            setInitPhase(\'Initialization failed - refresh to try again\');\n          }\n        }\n      }\n    };\n    \n    initialize();\n    \n    return () => { \n      cancelled = true; \n      if (retryTimeout) clearTimeout(retryTimeout);\n    };\n  }, []);\n\n  // Timer for elapsed time\n  useEffect(() => {\n    if (isRunning) {\n      startTimeRef.current = Date.now();\n      timerRef.current = setInterval(() => {\n        setElapsedTime(Math.floor((Date.now() - startTimeRef.current) / 1000));\n      }, 100);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    }\n    return () => {\n      if (timerRef.current) clearInterval(timerRef.current);\n    };\n  }, [isRunning]);\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, \'0\')}`;\n  };\n\n  const runBenchmark = async () => {\n    // Check rate limit before starting (V2 is synchronous)\n    const result = checkBenchmarkLimit();\n    if (!result.allowed) return;\n\n    console.log(\'[Benchmark] Starting cloud benchmark with FRESH Lichess games...\');\n    \n    // v7.12: Acquire lock - pauses auto-evolution\n    await acquireBenchmarkLock();\n    \n    setIsRunning(true);\n    setProgress(0);\n    setStatus(\'Fetching FRESH real games from Lichess top players...\');\n    setResult(null);\n    setLiveAttempts([]);\n    setCurrentGame(\'\');\n    setElapsedTime(0);\n    setSavedRunId(null);\n    setDepthMetrics(null);\n\n    try {\n      const benchmarkResult = await runCloudBenchmark(\n        {\n          gameCount: gameCount, // Use the slider value!\n          predictionMoveNumber: 20,\n          useRealGames: true, // Use FRESH Lichess games every time!\n        },\n        (statusText, prog, attempt) => {\n          console.log(\'[Benchmark]\', statusText, prog.toFixed(1) + \'%\');\n          setStatus(statusText);\n          setProgress(prog);\n          \n          // Extract game name from status\n          const match = statusText.match(/(?:Analyzing|Evaluating|Completed):\\s*(.+?)(?:\\.\\.\\.)?$/);\n          if (match) {\n            setCurrentGame(match[1]);\n          }\n          \n          // Add completed attempts to live view\n          if (attempt) {\n            setLiveAttempts(prev => [...prev, attempt]);\n          }\n        }\n      );\n\n      setResult(benchmarkResult);\n      \n      // Calculate depth metrics from results\n      const depthData = calculateDepthMetricsFromBenchmark(\n        benchmarkResult.predictionPoints.map(p => ({\n          stockfishDepth: p.stockfishDepth,\n          stockfishCorrect: p.stockfishCorrect,\n          hybridCorrect: p.hybridCorrect,\n          hybridConfidence: p.hybridConfidence,\n          hybridArchetype: p.hybridArchetype,\n          moveNumber: p.moveNumber,\n          gameMoveCount: p.gameMoveCount,\n        }))\n      );\n      setDepthMetrics(depthData);\n      \n      // Save results to database for learning\n      setStatus(\'Saving results for learning...\');\n      const runId = await saveBenchmarkResults(benchmarkResult);\n      setSavedRunId(runId);\n      \n      // Refresh cumulative stats\n      const newStats = await getCumulativeStats();\n      setCumulativeStats(newStats);\n      \n      // Update Live ELO State from CUMULATIVE stats (not just this run)\n      // This ensures ELO truly accumulates across all runs\n      if (newStats && newStats.validPredictionCount > 0) {\n        const cumulativeElo = calculateEloFromBenchmark(\n          newStats.overallHybridAccuracy,\n          newStats.overallStockfishAccuracy,\n          newStats.hybridWins,\n          newStats.stockfishWins,\n          newStats.bothCorrect,\n          newStats.validPredictionCount,\n          35 // Average depth\n        );\n        setLiveEloState(cumulativeElo);\n        console.log(\'[Benchmark] Updated CUMULATIVE ELO after run:\', {\n          totalGames: newStats.validPredictionCount,\n          hybridNetWins: newStats.hybridNetWins,\n          calculatedElo: cumulativeElo.enPensentElo\n        });\n      }\n      setIsLiveElo(false);\n      \n      setStatus(`Completed! Analyzed ${benchmarkResult.completedGames} FRESH games. Results saved for learning.`);\n    } catch (error) {\n      console.error(\'Benchmark failed:\', error);\n      setStatus(`Error: ${error instanceof Error ? error.message : \'Unknown error\'}`);\n    } finally {\n      setIsRunning(false);\n      // v7.12: Release lock - resumes auto-evolution if it was running\n      await releaseBenchmarkLock();\n    }\n  };\n\n  const getWinner = () => {\n    if (!result) return null;\n    if (result.hybridAccuracy > result.stockfishAccuracy) return \'hybrid\';\n    if (result.stockfishAccuracy > result.hybridAccuracy) return \'stockfish\';\n    return \'tie\';\n  };\n\n  const winner = getWinner();\n  const stockfishCorrect = result?.predictionPoints.filter(p => p.stockfishCorrect).length ?? 0;\n  const hybridCorrect = result?.predictionPoints.filter(p => p.hybridCorrect).length ?? 0;\n\n  const estimatedTotalTime = progress > 0 ? Math.ceil(elapsedTime / (progress / 100)) : 0;\n  const remainingTime = Math.max(0, estimatedTotalTime - elapsedTime);\n\n  return (\n    <div className="min-h-screen bg-background p-8">\n      <div className="max-w-6xl mx-auto space-y-8">\n        {/* Header */}\n        <div className="text-center space-y-4">\n          <h1 className="text-4xl font-bold bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent">\n            EN PENSENT vs STOCKFISH 17\n          </h1>\n          <p className="text-muted-foreground text-lg">\n            Real predictions â€¢ Real games â€¢ Real results\n          </p>\n          <p className="text-sm text-muted-foreground/70 italic">\n            Testing against 50+ real games from top Lichess players (Magnus, Hikaru, Firouzja & more)\n          </p>\n        </div>\n\n        {/* Main Tabs */}\n        <Tabs defaultValue="benchmark" className="w-full">\n          <TabsList className="grid w-full grid-cols-6">\n            <TabsTrigger value="auto" className="flex items-center gap-2">\n              <Rocket className="h-4 w-4" />\n              Auto-Evolution\n            </TabsTrigger>\n            <TabsTrigger value="benchmark" className="flex items-center gap-2">\n              <Brain className="h-4 w-4" />\n              Benchmark\n            </TabsTrigger>\n            <TabsTrigger value="intelligence" className="flex items-center gap-2">\n              <BookOpen className="h-4 w-4" />\n              SF Intel\n            </TabsTrigger>\n            <TabsTrigger value="authenticity" className="flex items-center gap-2">\n              <Shield className="h-4 w-4" />\n              Authenticity\n            </TabsTrigger>\n            <TabsTrigger value="elo" className="flex items-center gap-2">\n              <Crown className="h-4 w-4" />\n              ELO & Depth\n            </TabsTrigger>\n            <TabsTrigger value="proof" className="flex items-center gap-2">\n              <Sparkles className="h-4 w-4" />\n              Proof\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value="auto" className="mt-6">\n            <AutoEvolutionPanel />\n          </TabsContent>\n\n          <TabsContent value="intelligence" className="mt-6">\n            <StockfishIntelligencePanel \n              currentDepth={localDepth}\n              onDepthSelect={(depth) => {\n                setLocalDepth(depth);\n                setBenchmarkMode(\'local\');\n              }}\n            />\n          </TabsContent>\n\n          <TabsContent value="authenticity" className="mt-6">\n            <AuthenticityDashboard />\n          </TabsContent>\n\n          <TabsContent value="elo" className="mt-6">\n            <EloDepthDashboard />\n          </TabsContent>\n\n          <TabsContent value="proof" className="mt-6">\n            <ProofDashboard />\n          </TabsContent>\n\n          <TabsContent value="benchmark" className="mt-6 space-y-8">\n\n        {/* Live ELO Panel - Always visible */}\n        <LiveEloPanel \n          eloState={liveEloState} \n          currentDepth={benchmarkMode === \'local\' ? localDepth : 35}\n          isLive={isLiveElo}\n        />\n\n        <Card className="border border-muted">\n          <CardHeader className="pb-2">\n            <CardTitle className="flex items-center justify-between text-base">\n              <div className="flex items-center gap-2">\n                <Cpu className="h-5 w-5" />\n                <span>Farm Status</span>\n              </div>\n              {farmStatus ? (\n                <Badge variant={farmStatus.status === \'healthy\' ? \'default\' : \'destructive\'}>\n                  {farmStatus.status}\n                </Badge>\n              ) : (\n                <Badge variant="secondary">unknown</Badge>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className="space-y-2">\n            {isLoadingFarmStatus ? (\n              <div className="text-sm text-muted-foreground">Loading farm status...</div>\n            ) : farmStatus ? (\n              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">\n                <div>\n                  <div className="text-xs text-muted-foreground">Farm</div>\n                  <div className="text-sm font-medium">{farmStatus.farm_name || farmStatus.farm_id}</div>\n                </div>\n                <div>\n                  <div className="text-xs text-muted-foreground">Last heartbeat</div>\n                  <div className="text-sm font-medium">{new Date(farmStatus.last_heartbeat_at).toLocaleString()}</div>\n                </div>\n                <div>\n                  <div className="text-xs text-muted-foreground">Chess games</div>\n                  <div className="text-sm font-medium">{farmStatus.chess_games_generated}</div>\n                </div>\n                <div>\n                  <div className="text-xs text-muted-foreground">Chess errors</div>\n                  <div className="text-sm font-medium">{farmStatus.chess_errors}</div>\n                </div>\n              </div>\n            ) : (\n              <div className="text-sm text-muted-foreground">\n                No farm heartbeat yet.\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Source Breakdown */}\n        <BenchmarkSourceBreakdown />\n\n        {/* Cumulative Stats - Historical Performance - PROMINENT */}\n        {cumulativeStats && cumulativeStats.totalRuns > 0 && (\n          <Card className="border-2 border-primary/50 bg-gradient-to-r from-purple-500/10 to-orange-500/10 shadow-lg">\n            <CardHeader className="pb-2">\n              <CardTitle className="flex items-center justify-between text-base">\n                <div className="flex items-center gap-2">\n                  <History className="h-5 w-5 text-primary" />\n                  <span>ðŸ“Š CUMULATIVE: {cumulativeStats.validPredictionCount} Games Analyzed</span>\n                </div>\n                <Button\n                  variant="ghost"\n                  size="sm"\n                  onClick={async () => {\n                    const fresh = await getCumulativeStats();\n                    setCumulativeStats(fresh);\n                  }}\n                  className="text-xs"\n                >\n                  <RefreshCw className="h-3 w-3 mr-1" /> Refresh\n                </Button>\n              </CardTitle>\n              <p className="text-xs text-muted-foreground">{cumulativeStats.totalRuns} benchmark runs â€¢ All-time statistics</p>\n            </CardHeader>\n            <CardContent>\n              <div className="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">\n                {/* Total Games - Clickable */}\n                <GameDetailsModal\n                  filter="all"\n                  title="All Analyzed Games"\n                  trigger={\n                    <div className="p-3 bg-background/50 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors group">\n                      <p className="text-2xl font-bold group-hover:text-primary">{cumulativeStats.totalGamesAnalyzed}</p>\n                      <p className="text-xs text-muted-foreground flex items-center justify-center gap-1">\n                        Total Games <MousePointer className="h-3 w-3 opacity-0 group-hover:opacity-100" />\n                      </p>\n                    </div>\n                  }\n                />\n                {/* Hybrid Wins - Clickable */}\n                <GameDetailsModal\n                  filter="hybrid_wins"\n                  title="En Pensent Wins (Correct when SF Wrong)"\n                  trigger={\n                    <div className="p-3 bg-background/50 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors group">\n                      <p className="text-2xl font-bold text-primary group-hover:brightness-125">{cumulativeStats.hybridWins}</p>\n                      <p className="text-xs text-muted-foreground flex items-center justify-center gap-1">\n                        EP Wins <MousePointer className="h-3 w-3 opacity-0 group-hover:opacity-100" />\n                      </p>\n                    </div>\n                  }\n                />\n                {/* Stockfish Wins - Clickable */}\n                <GameDetailsModal\n                  filter="stockfish_wins"\n                  title="Stockfish Wins (Correct when EP Wrong)"\n                  trigger={\n                    <div className="p-3 bg-background/50 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors group">\n                      <p className="text-2xl font-bold text-blue-500 group-hover:brightness-125">{cumulativeStats.stockfishWins}</p>\n                      <p className="text-xs text-muted-foreground flex items-center justify-center gap-1">\n                        SF Wins <MousePointer className="h-3 w-3 opacity-0 group-hover:opacity-100" />\n                      </p>\n                    </div>\n                  }\n                />\n                {/* Both Correct - Clickable */}\n                <GameDetailsModal\n                  filter="both_correct"\n                  title="Both Correct (Consensus)"\n                  trigger={\n                    <div className="p-3 bg-background/50 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors group">\n                      <p className="text-2xl font-bold text-green-500 group-hover:brightness-125">{cumulativeStats.bothCorrect}</p>\n                      <p className="text-xs text-muted-foreground flex items-center justify-center gap-1">\n                        Both âœ“ <MousePointer className="h-3 w-3 opacity-0 group-hover:opacity-100" />\n                      </p>\n                    </div>\n                  }\n                />\n                {/* Net Advantage */}\n                <div className="p-3 bg-background/50 rounded-lg">\n                  <p className={`text-2xl font-bold ${cumulativeStats.hybridNetWins > 0 ? \'text-green-500\' : cumulativeStats.hybridNetWins < 0 ? \'text-destructive\' : \'text-muted-foreground\'}`}>\n                    {cumulativeStats.hybridNetWins > 0 ? \'+\' : \'\'}{cumulativeStats.hybridNetWins}\n                  </p>\n                  <p className="text-xs text-muted-foreground">Net Advantage</p>\n                </div>\n              </div>\n              <p className="text-xs text-muted-foreground text-center mt-3 flex items-center justify-center gap-1">\n                <MousePointer className="h-3 w-3" /> Click any stat to view detailed game list with Lichess verification links\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Latest Benchmark State - Show when no active result */}\n        {!result && !isRunning && latestBenchmark && (\n          <Card className="border-green-500/30 bg-gradient-to-r from-green-500/5 to-emerald-500/5">\n            <CardHeader className="pb-2">\n              <CardTitle className="flex items-center justify-between text-sm">\n                <div className="flex items-center gap-2">\n                  <CheckCircle className="h-4 w-4 text-green-500" />\n                  Latest Benchmark Result\n                </div>\n                <span className="text-xs text-muted-foreground">\n                  {new Date(latestBenchmark.created_at).toLocaleString()}\n                </span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">\n                <div className="p-3 bg-background/50 rounded-lg">\n                  <p className="text-3xl font-bold text-purple-500">{latestBenchmark.hybrid_accuracy.toFixed(1)}%</p>\n                  <p className="text-xs text-muted-foreground">En Pensent</p>\n                </div>\n                <div className="p-3 bg-background/50 rounded-lg">\n                  <p className="text-3xl font-bold text-blue-500">{latestBenchmark.stockfish_accuracy.toFixed(1)}%</p>\n                  <p className="text-xs text-muted-foreground">Stockfish 17</p>\n                </div>\n                <div className="p-3 bg-background/50 rounded-lg">\n                  <p className="text-2xl font-bold">{latestBenchmark.completed_games}</p>\n                  <p className="text-xs text-muted-foreground">Games Analyzed</p>\n                </div>\n                <div className="p-3 bg-background/50 rounded-lg">\n                  <p className={`text-2xl font-bold ${latestBenchmark.hybrid_wins > latestBenchmark.stockfish_wins ? \'text-green-500\' : \'text-red-500\'}`}>\n                    +{latestBenchmark.hybrid_wins - latestBenchmark.stockfish_wins}\n                  </p>\n                  <p className="text-xs text-muted-foreground">Net Advantage</p>\n                </div>\n              </div>\n              <p className="text-center text-xs text-muted-foreground mt-3">\n                Run a new benchmark to test with fresh grandmaster games\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Engine Status - Changes based on benchmark mode */}\n        {benchmarkMode === \'local\' ? (\n          // LOCAL WASM Engine Status\n          <Card className={`border ${\n            wasmReady \n              ? \'border-green-500/50 bg-green-500/5\' \n              : wasmError\n                ? \'border-red-500/50 bg-red-500/5\'\n                : \'border-yellow-500/50 bg-yellow-500/5\'\n          }`}>\n            <CardContent className="py-3">\n              <div className="flex items-center justify-between">\n                <div className="flex items-center gap-2">\n                  {wasmReady ? (\n                    <CheckCircle className="h-5 w-5 text-green-500" />\n                  ) : wasmError ? (\n                    <XCircle className="h-5 w-5 text-red-500" />\n                  ) : (\n                    <Loader2 className="h-5 w-5 animate-spin text-yellow-500" />\n                  )}\n                  <span className="font-medium">\n                    {wasmReady \n                      ? `Stockfish 17.1 WASM Ready - ${localDepth} ply depth` \n                      : wasmError \n                        ? \'WASM Engine failed to load\' \n                        : `Loading Stockfish WASM engine (${wasmLoadingProgress}%)...`\n                    }\n                  </span>\n                </div>\n                <Badge \n                  variant={wasmReady ? \'default\' : \'secondary\'} \n                  className={`gap-1 ${wasmReady ? \'bg-green-500/20 text-green-400 border-green-500/50\' : \'\'}`}\n                >\n                  <Zap className="h-3 w-3" />\n                  {wasmReady ? \'100% Depth\' : wasmError ? \'Error\' : \'Loading\'}\n                </Badge>\n              </div>\n              {!wasmReady && !wasmError && (\n                <Progress value={wasmLoadingProgress || 25} className="h-1 mt-2" />\n              )}\n              {wasmReady && (\n                <p className="text-xs text-green-400 mt-1">\n                  Local engine running at maximum capacity - no cloud connection needed\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        ) : (\n          // CLOUD API Status\n          <Card className={`border ${\n            apiReady \n              ? \'border-green-500/50 bg-green-500/5\' \n              : initPhase.includes(\'unavailable\') || initPhase.includes(\'failed\')\n                ? \'border-red-500/50 bg-red-500/5\'\n                : \'border-yellow-500/50 bg-yellow-500/5\'\n          }`}>\n            <CardContent className="py-3">\n              <div className="flex items-center justify-between">\n                <div className="flex items-center gap-2">\n                  {apiReady ? (\n                    <CheckCircle className="h-5 w-5 text-green-500" />\n                  ) : rateLimited ? (\n                    <Clock className="h-5 w-5 text-orange-500" />\n                  ) : initPhase.includes(\'unavailable\') || initPhase.includes(\'failed\') ? (\n                    <XCircle className="h-5 w-5 text-red-500" />\n                  ) : (\n                    <Loader2 className="h-5 w-5 animate-spin text-yellow-500" />\n                  )}\n                  <span className="font-medium">\n                    {initPhase}\n                  </span>\n                </div>\n                <Badge \n                  variant={apiReady ? \'default\' : \'secondary\'} \n                  className={`gap-1 ${rateLimited ? \'bg-orange-500/20 text-orange-400 border-orange-500/50\' : \'\'}`}\n                >\n                  <Cloud className="h-3 w-3" />\n                  {apiReady ? \'Stockfish 17 Ready\' : rateLimited ? \'Rate Limited\' : initPhase.includes(\'unavailable\') ? \'Offline\' : \'Connecting\'}\n                </Badge>\n              </div>\n              {!apiReady && !initPhase.includes(\'unavailable\') && !initPhase.includes(\'failed\') && (\n                <Progress value={rateLimited ? 75 : initPhase.includes(\'Retrying\') ? 50 : 25} className="h-1 mt-2" />\n              )}\n              {rateLimited && (\n                <p className="text-xs text-orange-400 mt-1">\n                  Too many requests. Use Maximum Depth mode while waiting.\n                </p>\n              )}\n              {!apiReady && !rateLimited && (\n                <p className="text-xs text-muted-foreground mt-1">\n                  Switch to Maximum Depth mode for instant local analysis\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Control Panel */}\n        <Card className="border-primary/20">\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <Trophy className="h-5 w-5 text-yellow-500" />\n              Prediction Accuracy Benchmark\n            </CardTitle>\n          </CardHeader>\n          <CardContent className="space-y-6">\n            {/* Benchmark Mode Selector */}\n            <div className="space-y-3">\n              <p className="text-sm font-medium">Benchmark Mode</p>\n              <div className="grid grid-cols-2 gap-3">\n                <button\n                  onClick={() => setBenchmarkMode(\'cloud\')}\n                  disabled={isRunning || isLocalRunning}\n                  className={`p-4 rounded-lg border-2 transition-all text-left ${\n                    benchmarkMode === \'cloud\'\n                      ? \'border-blue-500 bg-blue-500/10\'\n                      : \'border-muted hover:border-muted-foreground/50\'\n                  }`}\n                >\n                  <div className="flex items-center gap-2 mb-1">\n                    <Cloud className="h-4 w-4 text-blue-500" />\n                    <span className="font-medium">Cloud API</span>\n                    <Badge variant="secondary" className="text-xs">Fast</Badge>\n                  </div>\n                  <p className="text-xs text-muted-foreground">\n                    Lichess Cloud (depth ~35, cached)\n                  </p>\n                </button>\n                <button\n                  onClick={() => setBenchmarkMode(\'local\')}\n                  disabled={isRunning || isLocalRunning}\n                  className={`p-4 rounded-lg border-2 transition-all text-left ${\n                    benchmarkMode === \'local\'\n                      ? \'border-green-500 bg-green-500/10\'\n                      : \'border-muted hover:border-muted-foreground/50\'\n                  }`}\n                >\n                  <div className="flex items-center gap-2 mb-1">\n                    <Zap className="h-4 w-4 text-green-500" />\n                    <span className="font-medium">Maximum Depth</span>\n                    <Badge className="bg-green-500 text-xs">100%</Badge>\n                  </div>\n                  <p className="text-xs text-muted-foreground">\n                    Local WASM (depth 60+, true unlimited)\n                  </p>\n                </button>\n              </div>\n            </div>\n\n            {/* Shared Positions Slider - shown for BOTH modes */}\n            <div className="space-y-3 p-4 bg-muted/30 rounded-lg border border-border">\n              <div className="flex justify-between text-sm">\n                <span className="text-muted-foreground">Unique Positions to Analyze</span>\n                <span className="font-mono font-medium text-primary">{gameCount}</span>\n              </div>\n              \n              {/* Quick Preset Buttons */}\n              <div className="flex flex-wrap gap-2">\n                <Button\n                  variant={gameCount === 10 ? "default" : "outline"}\n                  size="sm"\n                  onClick={() => setGameCount(10)}\n                  disabled={isRunning || isLocalRunning}\n                  className="text-xs"\n                >\n                  10 Quick\n                </Button>\n                <Button\n                  variant={gameCount === 30 ? "default" : "outline"}\n                  size="sm"\n                  onClick={() => setGameCount(30)}\n                  disabled={isRunning || isLocalRunning}\n                  className="text-xs"\n                >\n                  30 Standard\n                </Button>\n                <Button\n                  variant={gameCount === 100 ? "default" : "outline"}\n                  size="sm"\n                  onClick={() => setGameCount(100)}\n                  disabled={isRunning || isLocalRunning}\n                  className="text-xs"\n                >\n                  100 Thorough\n                </Button>\n                <Button\n                  variant={gameCount === 250 ? "default" : "outline"}\n                  size="sm"\n                  onClick={() => setGameCount(250)}\n                  disabled={isRunning || isLocalRunning}\n                  className="text-xs"\n                >\n                  250 Deep\n                </Button>\n                <Button\n                  variant={gameCount === 500 ? "default" : "outline"}\n                  size="sm"\n                  onClick={() => setGameCount(500)}\n                  disabled={isRunning || isLocalRunning}\n                  className="text-xs flex items-center gap-1"\n                >\n                  <Rocket className="h-3 w-3" />\n                  500 Marathon\n                </Button>\n              </div>\n              \n              <Slider\n                value={[gameCount]}\n                onValueChange={([v]) => setGameCount(v)}\n                min={10}\n                max={500}\n                step={10}\n                disabled={isRunning || isLocalRunning}\n                className="py-2"\n              />\n              <div className="flex justify-between text-xs text-muted-foreground">\n                <span>10 (quick)</span>\n                <span>500 (marathon)</span>\n              </div>\n              \n              {/* Duration Estimate */}\n              <div className="flex items-center gap-2 text-xs text-muted-foreground">\n                <Clock className="h-3 w-3" />\n                <span>\n                  Estimated time: ~{gameCount <= 100 ? Math.round(gameCount * 3 / 60) : Math.round(gameCount * 2.5 / 60)} minutes\n                  {gameCount >= 250 && " â€” perfect for a long walk! â˜•"}\n                </span>\n              </div>\n              \n              <p className="text-xs text-muted-foreground">\n                Fetches ~8x more games to find unique positions (after deduplication)\n              </p>\n            </div>\n\n            {/* Local Mode Settings */}\n            {benchmarkMode === \'local\' && (\n              <div className="space-y-4 p-4 bg-green-500/5 rounded-lg border border-green-500/20">\n                <div className="flex items-center gap-2">\n                  <Cpu className="h-4 w-4 text-green-500" />\n                  <span className="text-sm font-medium">Maximum Depth Settings</span>\n                  {wasmReady ? (\n                    <Badge className="bg-green-500 text-xs">{engineVersion}</Badge>\n                  ) : wasmError ? (\n                    <Badge variant="destructive" className="text-xs">Error</Badge>\n                  ) : (\n                    <Badge variant="secondary" className="text-xs flex items-center gap-1">\n                      <Loader2 className="h-3 w-3 animate-spin" />\n                      Loading {wasmLoadingProgress}%\n                    </Badge>\n                  )}\n                </div>\n                \n                {/* WASM Loading Progress */}\n                {!wasmReady && !wasmError && (\n                  <div className="space-y-2">\n                    <Progress value={wasmLoadingProgress} className="h-2" />\n                    <p className="text-xs text-muted-foreground">\n                      Initializing Stockfish 17.1 WASM engine...\n                    </p>\n                  </div>\n                )}\n                \n                {wasmError && (\n                  <div className="p-3 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive">\n                    {wasmError} - Try refreshing the page\n                  </div>\n                )}\n                \n                <div className="space-y-2">\n                  <div className="flex justify-between text-sm">\n                    <span className="text-muted-foreground">Analysis Depth</span>\n                    <span className="font-mono font-medium text-green-500">{localDepth}</span>\n                  </div>\n                  <Slider\n                    value={[localDepth]}\n                    onValueChange={([v]) => setLocalDepth(v)}\n                    min={20}\n                    max={60}\n                    step={5}\n                    disabled={isLocalRunning}\n                    className="py-2"\n                  />\n                  <div className="flex justify-between text-xs text-muted-foreground">\n                    <span>20 (fast)</span>\n                    <span>60 (maximum)</span>\n                  </div>\n                </div>\n\n\n                <p className="text-xs text-green-600">\n                  âš¡ Local WASM runs Stockfish directly in your browser at true maximum depth.\n                  This achieves 100% depth coverage for fair comparison.\n                </p>\n              </div>\n            )}\n\n            {/* Run Button */}\n            <div className="flex items-center gap-4">\n              {benchmarkMode === \'cloud\' ? (\n                <Button \n                  onClick={runBenchmark} \n                  disabled={isRunning || !apiReady}\n                  size="lg"\n                  className="gap-2"\n                >\n                  {isRunning ? (\n                    <Loader2 className="h-4 w-4 animate-spin" />\n                  ) : !apiReady ? (\n                    <Loader2 className="h-4 w-4 animate-spin" />\n                  ) : (\n                    <Play className="h-4 w-4" />\n                  )}\n                  {isRunning ? \'Analyzing...\' : !apiReady ? \'Connecting...\' : \'Run Cloud Benchmark\'}\n                </Button>\n              ) : (\n                <Button \n                  onClick={async () => {\n                    // Check rate limit before starting\n                    const result = checkBenchmarkLimit();\n                    if (!result.allowed) return;\n                    \n                    // v7.12: Acquire lock - pauses auto-evolution\n                    await acquireBenchmarkLock();\n                    \n                    setLivePredictions([]); // Clear previous predictions\n                    runLocalBenchmark({\n                      gameCount,\n                      depth: localDepth,\n                      predictionMoveRange: [15, 35],\n                      onPrediction: handleLivePrediction,\n                    });\n                  }} \n                  disabled={isLocalRunning || !wasmReady || isBenchmarkLimited}\n                  size="lg"\n                  className="gap-2 bg-green-600 hover:bg-green-700"\n                >\n                  {isLocalRunning ? (\n                    <Loader2 className="h-4 w-4 animate-spin" />\n                  ) : !wasmReady ? (\n                    <Loader2 className="h-4 w-4 animate-spin" />\n                  ) : (\n                    <Zap className="h-4 w-4" />\n                  )}\n                  {isLocalRunning ? \'Analyzing...\' : !wasmReady ? \'Loading Engine...\' : \'Run Maximum Depth\'}\n                </Button>\n              )}\n              \n              {isLocalRunning && (\n                <Button variant="outline" onClick={async () => {\n                  abortLocalBenchmark();\n                  // v7.13: Also release the benchmark lock when manually aborting\n                  await releaseBenchmarkLock();\n                }}>\n                  Cancel\n                </Button>\n              )}\n              \n              <div className="text-sm text-muted-foreground">\n                {(isRunning || isLocalRunning) ? (\n                  <span className="flex items-center gap-2">\n                    <Clock className="h-4 w-4" />\n                    Elapsed: {formatTime(elapsedTime)}\n                    {progress > 5 && ` â€¢ Est. remaining: ${formatTime(remainingTime)}`}\n                  </span>\n                ) : benchmarkMode === \'local\' ? (\n                  wasmReady ? (\n                    <span className="flex items-center gap-2 text-green-600">\n                      <CheckCircle className="h-4 w-4" />\n                      Stockfish 17.1 WASM ready (100% depth coverage)\n                    </span>\n                  ) : wasmError ? (\n                    <span className="flex items-center gap-2 text-red-600">\n                      <XCircle className="h-4 w-4" />\n                      Engine failed to load - refresh to retry\n                    </span>\n                  ) : (\n                    <span className="flex items-center gap-2 text-yellow-600">\n                      <Loader2 className="h-4 w-4 animate-spin" />\n                      Loading Stockfish WASM ({wasmLoadingProgress}%)...\n                    </span>\n                  )\n                ) : !apiReady ? (\n                  <span className="flex items-center gap-2 text-yellow-600">\n                    <AlertCircle className="h-4 w-4" />\n                    Connecting to Lichess Cloud (Stockfish 17)...\n                  </span>\n                ) : (\n                  <span className="flex items-center gap-2">\n                    <Cloud className="h-4 w-4" />\n                    Uses Lichess Cloud for Stockfish 17 evaluation\n                  </span>\n                )}\n              </div>\n            </div>\n\n            {/* Local Benchmark Progress */}\n            {isLocalRunning && localProgress && (\n              <div className="space-y-4">\n                <div className="space-y-2">\n                  <div className="flex justify-between text-sm">\n                    <span className="font-medium">{localProgress.message}</span>\n                    <span className="text-muted-foreground">\n                      {((localProgress.currentGame / localProgress.totalGames) * 100).toFixed(0)}%\n                    </span>\n                  </div>\n                  <Progress \n                    value={(localProgress.currentGame / localProgress.totalGames) * 100} \n                    className="h-3" \n                  />\n                </div>\n                \n                <div className="grid grid-cols-3 gap-4 text-center text-sm">\n                  <div className="p-2 bg-green-500/10 rounded">\n                    <p className="text-2xl font-bold text-green-500">{localProgress.currentDepth || localDepth}</p>\n                    <p className="text-xs text-muted-foreground">Current Depth</p>\n                  </div>\n                  <div className="p-2 bg-muted/30 rounded">\n                    <p className="text-2xl font-bold text-primary">\n                      {localProgress.currentGame}/{localProgress.totalGames}\n                    </p>\n                    <p className="text-xs text-muted-foreground">Games Analyzed</p>\n                  </div>\n                  <div className="p-2 bg-muted/30 rounded">\n                    <p className="text-2xl font-bold text-orange-500">\n                      {((localProgress.currentDepth / 60) * 100).toFixed(0)}%\n                    </p>\n                    <p className="text-xs text-muted-foreground">Depth Coverage</p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Live Prediction Stream - Shows real-time results during benchmark */}\n            {(isLocalRunning || livePredictions.length > 0) && benchmarkMode === \'local\' && (\n              <LivePredictionStream \n                predictions={livePredictions}\n                isRunning={isLocalRunning}\n                maxDisplay={15}\n              />\n            )}\n\n            {/* Local Benchmark Results */}\n            {localResult && benchmarkMode === \'local\' && (\n              <div className="space-y-4 p-4 bg-green-500/5 rounded-lg border border-green-500/20">\n                <div className="flex items-center gap-2">\n                  <CheckCircle className="h-5 w-5 text-green-500" />\n                  <span className="font-medium">Maximum Depth Benchmark Complete</span>\n                </div>\n                \n                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">\n                  <div className="p-3 bg-background rounded-lg">\n                    <p className="text-2xl font-bold text-primary">\n                      {localResult.hybridAccuracy.toFixed(1)}%\n                    </p>\n                    <p className="text-xs text-muted-foreground">En Pensent Accuracy</p>\n                  </div>\n                  <div className="p-3 bg-background rounded-lg">\n                    <p className="text-2xl font-bold text-orange-500">\n                      {localResult.stockfishAccuracy.toFixed(1)}%\n                    </p>\n                    <p className="text-xs text-muted-foreground">Stockfish Accuracy</p>\n                  </div>\n                  <div className="p-3 bg-background rounded-lg">\n                    <p className="text-2xl font-bold text-green-500">\n                      {localResult.averageDepth.toFixed(0)}\n                    </p>\n                    <p className="text-xs text-muted-foreground">Avg Depth</p>\n                  </div>\n                  <div className="p-3 bg-background rounded-lg">\n                    <p className="text-2xl font-bold text-green-500">\n                      {localResult.depthCoverage.toFixed(0)}%\n                    </p>\n                    <p className="text-xs text-muted-foreground">Depth Coverage</p>\n                  </div>\n                </div>\n\n                {localResult.hybridWins > localResult.stockfishWins && (\n                  <p className="text-center text-green-600 font-medium">\n                    ðŸ† En Pensent outperformed Stockfish at MAXIMUM depth!\n                  </p>\n                )}\n              </div>\n            )}\n\n            {localError && (\n              <div className="p-3 bg-destructive/10 rounded-lg text-destructive text-sm">\n                Error: {localError}\n              </div>\n            )}\n\n            {isRunning && (\n              <div className="space-y-4">\n                <div className="space-y-2">\n                  <div className="flex justify-between text-sm">\n                    <span className="font-medium">{status}</span>\n                    <span className="text-muted-foreground">{progress.toFixed(0)}%</span>\n                  </div>\n                  <Progress value={progress} className="h-3" />\n                </div>\n\n                {currentGame && (\n                  <Card className="bg-muted/30 border-dashed">\n                    <CardContent className="py-4">\n                      <div className="flex items-center justify-between">\n                        <div>\n                          <p className="font-semibold text-sm">\n                            Currently analyzing: {currentGame}\n                          </p>\n                        </div>\n                        <Loader2 className="h-4 w-4 animate-spin text-primary" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                <div className="grid grid-cols-3 gap-4 text-center text-sm">\n                  <div className="p-2 bg-muted/30 rounded">\n                    <p className="text-2xl font-bold text-primary">{gameCount}</p>\n                    <p className="text-xs text-muted-foreground">Positions to Analyze</p>\n                  </div>\n                  <div className="p-2 bg-muted/30 rounded">\n                    <p className="text-2xl font-bold text-orange-500">~3s</p>\n                    <p className="text-xs text-muted-foreground">Per Position</p>\n                  </div>\n                  <div className="p-2 bg-muted/30 rounded">\n                    <p className="text-2xl font-bold text-green-500">~{Math.round(gameCount * 3 / 60)}m</p>\n                    <p className="text-xs text-muted-foreground">Total Expected</p>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Live Results */}\n        {liveAttempts.length > 0 && !result && (\n          <Card>\n            <CardHeader>\n              <CardTitle className="text-sm">Live Results ({liveAttempts.length} / {gameCount})</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className="space-y-2">\n                {liveAttempts.slice(-5).map((attempt, i) => (\n                  <div key={i} className="flex items-center justify-between p-2 bg-muted/30 rounded text-sm">\n                    <div className="flex-1 min-w-0">\n                      <span className="font-medium truncate block">{attempt.gameName}</span>\n                      <div className="flex items-center gap-2 text-xs text-muted-foreground">\n                        <span className="flex items-center gap-1">\n                          <Cpu className="h-3 w-3" />\n                          Depth: {attempt.stockfishDepth || \'N/A\'}\n                        </span>\n                        <span>â€¢</span>\n                        <span>Eval: {attempt.stockfishEval > 0 ? \'+\' : \'\'}{attempt.stockfishEval}</span>\n                        <span>â€¢</span>\n                        <span>{attempt.hybridArchetype}</span>\n                      </div>\n                    </div>\n                    <div className="flex gap-3 shrink-0">\n                      <span className={`flex items-center gap-1 ${attempt.stockfishCorrect ? \'text-green-500\' : \'text-red-500\'}`}>\n                        {attempt.stockfishCorrect ? <CheckCircle className="h-3 w-3" /> : <XCircle className="h-3 w-3" />}\n                        SF17\n                      </span>\n                      <span className={`flex items-center gap-1 ${attempt.hybridCorrect ? \'text-green-500\' : \'text-red-500\'}`}>\n                        {attempt.hybridCorrect ? <CheckCircle className="h-3 w-3" /> : <XCircle className="h-3 w-3" />}\n                        En Pensent\n                      </span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Results - ALWAYS show cumulative stats from database, session adds to it */}\n        {cumulativeStats && (\n          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">\n            {/* Stockfish Card - ALWAYS shows cumulative */}\n            <Card className={`border-2 transition-all ${\n              cumulativeStats.hybridNetWins < 0 ? \'border-green-500 bg-green-500/5\' : \'border-muted\'\n            }`}>\n              <CardHeader>\n                <CardTitle className="flex items-center justify-between">\n                  <div className="flex items-center gap-2">\n                    <Cpu className="h-6 w-6 text-blue-500" />\n                    Stockfish 17\n                  </div>\n                  {cumulativeStats.hybridNetWins < 0 && <Badge className="bg-green-500">LEADING</Badge>}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className="space-y-4">\n                <div className="text-center">\n                  <div className="text-5xl font-bold text-blue-500">\n                    {cumulativeStats.overallStockfishAccuracy.toFixed(1)}%\n                  </div>\n                  <p className="text-muted-foreground">Prediction Accuracy</p>\n                </div>\n                <div className="grid grid-cols-2 gap-4 text-sm">\n                  <div>\n                    <p className="text-muted-foreground">Correct</p>\n                    <p className="font-semibold">\n                      {Math.round(cumulativeStats.overallStockfishAccuracy * cumulativeStats.validPredictionCount / 100)} / {cumulativeStats.validPredictionCount}\n                    </p>\n                  </div>\n                  <div>\n                    <p className="text-muted-foreground">Method</p>\n                    <p className="font-semibold">Lichess Cloud</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Hybrid Card - ALWAYS shows cumulative */}\n            <Card className={`border-2 transition-all ${\n              cumulativeStats.hybridNetWins > 0 ? \'border-green-500 bg-green-500/5\' : \'border-muted\'\n            }`}>\n              <CardHeader>\n                <CardTitle className="flex items-center justify-between">\n                  <div className="flex items-center gap-2">\n                    <Brain className="h-6 w-6 text-purple-500" />\n                    En Pensent Hybrid\n                  </div>\n                  {cumulativeStats.hybridNetWins > 0 && (\n                    <Badge className="bg-green-500">LEADING +{cumulativeStats.hybridNetWins}</Badge>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className="space-y-4">\n                <div className="text-center">\n                  <div className="text-5xl font-bold text-purple-500">\n                    {cumulativeStats.overallHybridAccuracy.toFixed(1)}%\n                  </div>\n                  <p className="text-muted-foreground">Prediction Accuracy</p>\n                </div>\n                <div className="grid grid-cols-2 gap-4 text-sm">\n                  <div>\n                    <p className="text-muted-foreground">Correct</p>\n                    <p className="font-semibold">\n                      {Math.round(cumulativeStats.overallHybridAccuracy * cumulativeStats.validPredictionCount / 100)} / {cumulativeStats.validPredictionCount}\n                    </p>\n                  </div>\n                  <div>\n                    <p className="text-muted-foreground">Method</p>\n                    <p className="font-semibold">Temporal Patterns</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Statistical Summary - ALWAYS show cumulative data */}\n        {cumulativeStats && (\n          <Card>\n            <CardHeader>\n              <CardTitle className="flex items-center gap-2">\n                Statistical Analysis\n                <Badge variant="secondary" className="ml-2">\n                  <Database className="h-3 w-3 mr-1" />\n                  Cumulative\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className="grid grid-cols-2 md:grid-cols-5 gap-4">\n                <div className="text-center p-4 bg-muted/50 rounded-lg">\n                  <p className="text-2xl font-bold">\n                    {cumulativeStats.validPredictionCount}\n                  </p>\n                  <p className="text-sm text-muted-foreground">Games Analyzed</p>\n                </div>\n                <div className="text-center p-4 bg-muted/50 rounded-lg">\n                  <p className="text-2xl font-bold">\n                    {cumulativeStats.validPredictionCount > 30 \n                      ? Math.min(99.9, 50 + (cumulativeStats.validPredictionCount / 50)).toFixed(1) \n                      : \'0.0\'}%\n                  </p>\n                  <p className="text-sm text-muted-foreground">Statistical Confidence</p>\n                </div>\n                <div className="text-center p-4 bg-muted/50 rounded-lg">\n                  {(() => {\n                    const advantage = cumulativeStats.overallHybridAccuracy - cumulativeStats.overallStockfishAccuracy;\n                    return (\n                      <p className={`text-2xl font-bold ${advantage > 0 ? \'text-green-500\' : \'text-red-500\'}`}>\n                        {advantage > 0 ? \'+\' : \'\'}{advantage.toFixed(1)}%\n                      </p>\n                    );\n                  })()}\n                  <p className="text-sm text-muted-foreground">Hybrid Advantage</p>\n                </div>\n                <div className="text-center p-4 bg-muted/50 rounded-lg">\n                  <p className="text-2xl font-bold">\n                    {cumulativeStats.bothCorrect}\n                  </p>\n                  <p className="text-sm text-muted-foreground">Both Correct</p>\n                </div>\n                <div className="text-center p-4 bg-muted/50 rounded-lg">\n                  <p className="text-2xl font-bold">{cumulativeStats.totalRuns}</p>\n                  <p className="text-sm text-muted-foreground">Benchmark Runs</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Depth Analysis - "Moves Ahead" Comparison */}\n        {(result && depthMetrics) || cumulativeStats ? (\n          <Card className="border-purple-500/30 bg-gradient-to-r from-purple-500/5 to-blue-500/5">\n            <CardHeader>\n              <CardTitle className="flex items-center gap-2">\n                <Layers className="h-5 w-5 text-purple-500" />\n                Depth Analysis: "Moves Ahead" Comparison\n              </CardTitle>\n            </CardHeader>\n            <CardContent className="space-y-6">\n              {/* Main Depth Comparison */}\n              <div className="grid grid-cols-2 gap-6">\n                <div className="text-center p-6 bg-blue-500/10 rounded-lg border border-blue-500/30">\n                  <div className="flex items-center justify-center gap-2 mb-2">\n                    <Cpu className="h-5 w-5 text-blue-500" />\n                    <span className="font-semibold text-blue-500">Stockfish 17</span>\n                  </div>\n                  <p className="text-4xl font-bold text-blue-500">\n                    {depthMetrics?.stockfishDepth || 40}\n                  </p>\n                  <p className="text-sm text-muted-foreground">plies deep</p>\n                  <p className="text-lg font-medium text-blue-400 mt-2">\n                    ~{Math.floor((depthMetrics?.stockfishDepth || 40) / 2)} moves ahead\n                  </p>\n                </div>\n                <div className="text-center p-6 bg-purple-500/10 rounded-lg border border-purple-500/30">\n                  <div className="flex items-center justify-center gap-2 mb-2">\n                    <Brain className="h-5 w-5 text-purple-500" />\n                    <span className="font-semibold text-purple-500">En Pensent</span>\n                  </div>\n                  <p className="text-4xl font-bold text-purple-500">\n                    {depthMetrics?.enPensentEffectiveDepth || \n                     (cumulativeStats && cumulativeStats.overallHybridAccuracy > cumulativeStats.overallStockfishAccuracy \n                       ? Math.round(40 * (cumulativeStats.overallHybridAccuracy / Math.max(1, cumulativeStats.overallStockfishAccuracy)))\n                       : 40)}\n                  </p>\n                  <p className="text-sm text-muted-foreground">effective plies</p>\n                  <p className="text-lg font-medium text-purple-400 mt-2">\n                    ~{Math.floor((depthMetrics?.enPensentEffectiveDepth || \n                      (cumulativeStats && cumulativeStats.overallHybridAccuracy > cumulativeStats.overallStockfishAccuracy \n                        ? Math.round(40 * (cumulativeStats.overallHybridAccuracy / Math.max(1, cumulativeStats.overallStockfishAccuracy)))\n                        : 40)) / 2)} moves ahead\n                  </p>\n                </div>\n              </div>\n\n              {/* Depth Advantage Summary */}\n              <div className="text-center p-4 bg-gradient-to-r from-purple-500/20 to-blue-500/20 rounded-lg">\n                {(() => {\n                  const advantage = depthMetrics?.depthAdvantage || \n                    (cumulativeStats && cumulativeStats.overallHybridAccuracy > cumulativeStats.overallStockfishAccuracy \n                      ? Math.round((cumulativeStats.overallHybridAccuracy - cumulativeStats.overallStockfishAccuracy) * 0.4)\n                      : 0);\n                  const ratio = depthMetrics?.depthRatio || \n                    (cumulativeStats ? cumulativeStats.overallHybridAccuracy / Math.max(1, cumulativeStats.overallStockfishAccuracy) : 1);\n                  const patternEquiv = depthMetrics?.patternDepthEquivalent || \n                    (cumulativeStats && cumulativeStats.overallHybridAccuracy > cumulativeStats.overallStockfishAccuracy \n                      ? Math.round(40 * ratio) : 40);\n                  \n                  return (\n                    <>\n                      <p className="text-lg font-medium">\n                        {advantage > 0 ? (\n                          <span className="text-green-500">\n                            En Pensent sees <strong>{advantage} plies</strong> (~{Math.floor(advantage / 2)} moves) <strong>DEEPER</strong>\n                          </span>\n                        ) : advantage < 0 ? (\n                          <span className="text-red-500">\n                            Stockfish searches <strong>{-advantage} plies</strong> deeper\n                          </span>\n                        ) : (\n                          <span className="text-muted-foreground">Equal effective depth</span>\n                        )}\n                      </p>\n                      <p className="text-sm text-muted-foreground mt-1">\n                        Depth ratio: <strong>{ratio.toFixed(2)}x</strong> | \n                        Pattern equivalent: <strong>{patternEquiv} plies</strong>\n                      </p>\n                    </>\n                  );\n                })()}\n              </div>\n\n              {/* Horizon Accuracy Breakdown */}\n              {depthMetrics && depthMetrics.horizonAccuracy.length > 0 && (\n                <div className="space-y-3">\n                  <h4 className="font-semibold text-sm">Accuracy by Prediction Horizon:</h4>\n                  <div className="space-y-2">\n                    {depthMetrics.horizonAccuracy.map((horizon, i) => (\n                      <div key={i} className="grid grid-cols-[80px_1fr_80px] gap-2 items-center text-sm">\n                        <span className="text-muted-foreground">{horizon.movesAhead}+ moves:</span>\n                        <div className="flex gap-1 h-4">\n                          <div \n                            className="bg-purple-500 rounded-sm ep-bar" \n                            style={{ \'--bar-width\': `${horizon.accuracy}%` } as React.CSSProperties}\n                            title={`En Pensent: ${horizon.accuracy.toFixed(1)}%`}\n                          />\n                          <div \n                            className="bg-blue-500/50 rounded-sm sf-bar" \n                            style={{ \'--bar-width\': `${horizon.stockfishAccuracyAtHorizon}%` } as React.CSSProperties}\n                            title={`Stockfish: ${horizon.stockfishAccuracyAtHorizon.toFixed(1)}%`}\n                          />\n                        </div>\n                        <span className={horizon.accuracy > horizon.stockfishAccuracyAtHorizon ? \'text-green-500\' : \'text-blue-500\'}>\n                          EP: {horizon.accuracy.toFixed(0)}% / SF: {horizon.stockfishAccuracyAtHorizon.toFixed(0)}%\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                  <p className="text-xs text-muted-foreground mt-2">\n                    Max accurate horizon: <strong>{depthMetrics.maxAccurateHorizon} moves</strong> ({\'>\'} 60% accuracy) | \n                    Confidence: <strong>{depthMetrics.depthConfidence.toFixed(1)}%</strong>\n                  </p>\n                </div>\n              )}\n\n              {/* Interpretation */}\n              <div className="p-4 bg-muted/30 rounded-lg text-sm text-muted-foreground">\n                <p>\n                  <strong>How this works:</strong> Stockfish searches {depthMetrics?.stockfishDepth || 40} plies deep using brute-force tree search.\n                  En Pensent achieves equivalent {depthMetrics?.enPensentEffectiveDepth || \n                    (cumulativeStats && cumulativeStats.overallHybridAccuracy > cumulativeStats.overallStockfishAccuracy \n                      ? Math.round(40 * (cumulativeStats.overallHybridAccuracy / Math.max(1, cumulativeStats.overallStockfishAccuracy)))\n                      : 40)}-ply accuracy through <em>pattern recognition</em> â€” \n                  recognizing game trajectories that indicate outcomes many moves in the future without explicit search.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        ) : null}\n\n        {/* Individual Game Results */}\n        {result && result.predictionPoints.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Individual Game Results</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className="space-y-2">\n                {result.predictionPoints.map((attempt, i) => (\n                  <div key={i} className="flex items-center justify-between p-3 bg-muted/30 rounded-lg">\n                    <div>\n                      <p className="font-medium">{attempt.gameName}</p>\n                      <p className="text-xs text-muted-foreground">\n                        Actual: {attempt.actualResult.replace(\'_\', \' \')} â€¢ \n                        Archetype: {attempt.hybridArchetype}\n                      </p>\n                    </div>\n                    <div className="flex gap-6 text-sm">\n                      <div className="text-center">\n                        <p className="text-xs text-muted-foreground">SF17 (D{attempt.stockfishDepth})</p>\n                        <p className={`font-bold ${attempt.stockfishCorrect ? \'text-green-500\' : \'text-red-500\'}`}>\n                          {attempt.stockfishCorrect ? \'âœ“ Correct\' : \'âœ— Wrong\'}\n                        </p>\n                      </div>\n                      <div className="text-center">\n                        <p className="text-xs text-muted-foreground">Hybrid</p>\n                        <p className={`font-bold ${attempt.hybridCorrect ? \'text-green-500\' : \'text-red-500\'}`}>\n                          {attempt.hybridCorrect ? \'âœ“ Correct\' : \'âœ— Wrong\'}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Methodology Note */}\n        <Card className="border-dashed">\n          <CardContent className="py-4 space-y-2">\n            <p className="text-sm text-muted-foreground">\n              <strong>Methodology:</strong> Both systems analyze the same position at a RANDOMIZED move point (moves 15-35, preventing pattern memorization). \n              TCEC Stockfish 17 Unlimited (ELO 3600) serves as tactical ground truth.\n              Games sampled across 6 ELO tiers (800-3500) with weighted distribution for comprehensive coverage.\n            </p>\n            <p className="text-sm text-muted-foreground">\n              <strong>Fairness:</strong> Neither system sees moves beyond the prediction point. Both predict blind at identical synchronized positions.\n              Data quality tiers: \'tcec_unlimited\' (highest), \'tcec_calibrated\', \'legacy\'. Results persist to database for continuous learning.\n            </p>\n            {savedRunId && (\n              <p className="text-xs text-green-500 flex items-center gap-1">\n                <Database className="h-3 w-3" />\n                Results saved: {savedRunId}\n              </p>\n            )}\n          </CardContent>\n        </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n';export{e as default};
