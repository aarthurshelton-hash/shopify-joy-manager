const n="import React, { useState, useEffect, forwardRef } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from 'sonner';\nimport { Loader2, Shield } from 'lucide-react';\nimport { SecurityEvents } from '@/lib/security/auditLog';\n\ninterface MFAVerificationProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nconst MFAVerification = forwardRef<HTMLDivElement, MFAVerificationProps>(({ isOpen, onClose, onSuccess }, ref) => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [verificationCode, setVerificationCode] = useState('');\n  const [factorId, setFactorId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchMFAFactor();\n    }\n  }, [isOpen]);\n\n  const fetchMFAFactor = async () => {\n    try {\n      const { data, error } = await supabase.auth.mfa.listFactors();\n      if (error) throw error;\n\n      const verifiedTOTP = data.totp?.find(factor => factor.status === 'verified');\n      if (verifiedTOTP) {\n        setFactorId(verifiedTOTP.id);\n      }\n    } catch (error) {\n      console.error('Error fetching MFA factors:', error);\n    }\n  };\n\n  const handleVerify = async () => {\n    if (!factorId || verificationCode.length !== 6) return;\n\n    setIsLoading(true);\n    try {\n      const { data: challengeData, error: challengeError } = await supabase.auth.mfa.challenge({\n        factorId,\n      });\n\n      if (challengeError) throw challengeError;\n\n      const { error: verifyError } = await supabase.auth.mfa.verify({\n        factorId,\n        challengeId: challengeData.id,\n        code: verificationCode,\n      });\n\n      if (verifyError) throw verifyError;\n\n      // Log MFA verification success\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        SecurityEvents.mfaVerified(user.id);\n      }\n\n      toast.success('Verification successful!');\n      onSuccess();\n      handleClose();\n    } catch (error: any) {\n      toast.error('Verification failed', { description: 'Invalid code. Please try again.' });\n      setVerificationCode('');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setVerificationCode('');\n    onClose();\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && verificationCode.length === 6) {\n      handleVerify();\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && handleClose()}>\n      <DialogContent className=\"sm:max-w-md bg-card border-border\">\n        <DialogHeader>\n          <DialogTitle className=\"font-display text-xl flex items-center gap-2\">\n            <Shield className=\"h-5 w-5 text-primary\" />\n            Two-Factor Authentication\n          </DialogTitle>\n          <DialogDescription>\n            Enter the 6-digit code from your authenticator app\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"mfaCode\">Verification Code</Label>\n            <Input\n              id=\"mfaCode\"\n              type=\"text\"\n              inputMode=\"numeric\"\n              pattern=\"[0-9]*\"\n              maxLength={6}\n              placeholder=\"000000\"\n              value={verificationCode}\n              onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, ''))}\n              onKeyDown={handleKeyDown}\n              className=\"text-center text-2xl tracking-widest font-mono\"\n              autoFocus\n            />\n          </div>\n\n          <Button\n            className=\"w-full btn-luxury\"\n            onClick={handleVerify}\n            disabled={verificationCode.length !== 6 || isLoading}\n          >\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              'Verify'\n            )}\n          </Button>\n\n          <p className=\"text-xs text-muted-foreground text-center\">\n            Open your authenticator app and enter the current code for En Pensent\n          </p>\n        </div>\n    </DialogContent>\n    </Dialog>\n  );\n});\n\nMFAVerification.displayName = 'MFAVerification';\n\nexport default MFAVerification;\n";export{n as default};
