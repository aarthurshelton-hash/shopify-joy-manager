import{u as e,a as s,r as a,j as t,H as l,au as n,B as i,A as r,aU as c,aT as o,C as d,x as m,F as x,cb as h,bi as p,bL as u,bN as j,cl as f,bO as g,bG as v,b2 as N,bP as y,p as b,t as w,am as _,s as k,y as P}from"./index-D6g_YXgr.js";import{C}from"./calendar-B4SC_2T8.js";const B={K:"♔",Q:"♕",R:"♖",B:"♗",N:"♘",P:"♙",k:"♚",q:"♛",r:"♜",b:"♝",n:"♞",p:"♟"},q={bullet_1:"1 min",blitz_5:"5 min",rapid_15:"15 min",untimed:"Untimed"},M=({fen:e,whitePalette:s,blackPalette:l,movedSquares:n})=>{const i=a.useMemo(()=>(e=>e.split(" ")[0].split("/").map(e=>{const s=[];for(const a of e)if(/\d/.test(a))for(let e=0;e<parseInt(a);e++)s.push(null);else s.push(a);return s}))(e),[e]),r=(e,a,t)=>{const i=`${String.fromCharCode(97+t)}${8-a}`;if(!n.has(i)&&n.size>0)return"rgba(128, 128, 128, 0.15)";const r=e===e.toUpperCase(),c=e.toLowerCase();return(r?s:l)[c]||"#888888"};return t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx("div",{className:"grid grid-cols-8 border-4 border-amber-900 rounded-lg overflow-hidden shadow-xl",children:Array.from({length:64}).map((e,s)=>{var a;const l=Math.floor(s/8),c=s%8,d=null==(a=i[l])?void 0:a[c],m=(l+c)%2==0,x=`${String.fromCharCode(97+c)}${8-l}`,h=n.has(x);return t.jsx("div",{className:`\n                aspect-square relative\n                ${m?"bg-amber-100":"bg-amber-700"}\n              `,children:d&&t.jsx(o.div,{layout:!0,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:h||0===n.size?1:.15},className:"absolute inset-0 flex items-center justify-center",style:{color:r(d,l,c),filter:h||0===n.size?"none":"grayscale(100%)"},children:t.jsx("span",{className:"text-3xl md:text-4xl select-none drop-shadow-md",children:B[d]})})},s)})})})};function S(){const{user:B}=e(),S=s(),[z,D]=a.useState([]),[R,$]=a.useState(!0),[F,E]=a.useState(null),[K,Q]=a.useState([]),[U,A]=a.useState(0),[G,T]=a.useState(!1),[W,H]=a.useState(1e3);a.useEffect(()=>{if(!B)return;(async()=>{$(!0);const{data:e,error:s}=await k.from("chess_games").select("*").eq("status","completed").or(`white_player_id.eq.${B.id},black_player_id.eq.${B.id}`).order("completed_at",{ascending:!1});!s&&e&&D(e.map(e=>({...e,white_palette:e.white_palette,black_palette:e.black_palette}))),$(!1)})()},[B]),a.useEffect(()=>{if(!F)return;(async()=>{const{data:e,error:s}=await k.from("chess_moves").select("move_san, move_uci, fen_after, move_number").eq("game_id",F.id).order("move_number",{ascending:!0});!s&&e&&(Q(e),A(0),T(!1))})()},[F]),a.useEffect(()=>{if(!G||U>=K.length)return void T(!1);const e=setTimeout(()=>{A(e=>e+1)},W);return()=>clearTimeout(e)},[G,U,K.length,W]);const L=a.useMemo(()=>{var e;return 0===U||0===K.length?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1":(null==(e=K[U-1])?void 0:e.fen_after)||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},[K,U]),I=a.useMemo(()=>{var e;const s=new Set;for(let a=0;a<U;a++){const t=null==(e=K[a])?void 0:e.move_uci;t&&t.length>=4&&s.add(t.substring(2,4))}return s},[K,U]),O=e=>{if(!B)return null;const s=e.white_player_id===B.id,a=e.result;if("draw"===a)return t.jsx(P,{variant:"secondary",children:"Draw"});const l="white_wins"===a&&s||"black_wins"===a&&!s;return t.jsx(P,{variant:l?"default":"destructive",className:l?"bg-green-500":"",children:l?"Won":"Lost"})};return B?t.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[t.jsx(l,{}),t.jsxs("main",{className:"flex-1 container py-8",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[F?t.jsxs(i,{variant:"ghost",onClick:()=>E(null),children:[t.jsx(r,{className:"w-4 h-4 mr-2"}),"Return to Games"]}):t.jsxs(i,{variant:"ghost",onClick:()=>S("/play"),children:[t.jsx(r,{className:"w-4 h-4 mr-2"}),"Return to Play"]}),t.jsx("h1",{className:"text-3xl font-display font-bold",children:F?"Game Replay":"Game History"})]}),t.jsx(c,{mode:"wait",children:F?t.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[t.jsx(d,{children:t.jsx(m,{className:"pt-6",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(C,{className:"w-4 h-4"}),F.completed_at?x(new Date(F.completed_at),"MMM d, yyyy"):"Unknown"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(h,{className:"w-4 h-4"}),q[F.time_control]]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(p,{className:"w-4 h-4"}),F.move_count||0," moves"]}),O(F)]})})}),t.jsx(M,{fen:L,whitePalette:F.white_palette||{k:"#FFD700",q:"#FFA500",r:"#FF6B6B",b:"#4ECDC4",n:"#45B7D1",p:"#96CEB4"},blackPalette:F.black_palette||{k:"#8B4513",q:"#A0522D",r:"#CD853F",b:"#D2691E",n:"#B8860B",p:"#DEB887"},movedSquares:I}),t.jsx(d,{children:t.jsxs(m,{className:"pt-6 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[t.jsxs("span",{children:["Move ",U]}),t.jsxs("span",{children:["of ",K.length]})]}),t.jsx(u,{value:[U],onValueChange:([e])=>{A(e),T(!1)},max:K.length,step:1})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(i,{variant:"outline",size:"icon",onClick:()=>{A(0),T(!1)},children:t.jsx(j,{className:"w-4 h-4"})}),t.jsx(i,{variant:"outline",size:"icon",onClick:()=>A(e=>Math.max(0,e-1)),disabled:0===U,children:t.jsx(f,{className:"w-4 h-4"})}),t.jsx(i,{variant:"default",size:"icon",onClick:()=>T(!G),disabled:U>=K.length,children:G?t.jsx(g,{className:"w-4 h-4"}):t.jsx(v,{className:"w-4 h-4"})}),t.jsx(i,{variant:"outline",size:"icon",onClick:()=>A(e=>Math.min(K.length,e+1)),disabled:U>=K.length,children:t.jsx(N,{className:"w-4 h-4"})}),t.jsx(i,{variant:"outline",size:"icon",onClick:()=>{A(K.length),T(!1)},children:t.jsx(y,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Speed:"}),t.jsx("div",{className:"flex gap-2",children:[2e3,1e3,500,250].map(e=>t.jsx(i,{variant:W===e?"default":"outline",size:"sm",onClick:()=>H(e),children:2e3===e?"0.5x":1e3===e?"1x":500===e?"2x":"4x"},e))})]}),K.length>0&&t.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg p-3",children:t.jsx("div",{className:"flex flex-wrap gap-1 text-sm font-mono",children:K.map((e,s)=>t.jsxs("button",{onClick:()=>{A(s+1),T(!1)},className:`\n                              px-2 py-1 rounded transition-colors\n                              ${s+1===U?"bg-primary text-primary-foreground":"hover:bg-muted"}\n                              ${s%2==0?"ml-2":""}\n                            `,children:[s%2==0&&t.jsxs("span",{className:"text-muted-foreground mr-1",children:[Math.floor(s/2)+1,"."]}),e.move_san]},s))})})]})})]},"replay"):t.jsx(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:R?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===z.length?t.jsx(d,{children:t.jsxs(m,{className:"py-12 text-center",children:[t.jsx(p,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("p",{className:"text-lg font-medium",children:"No games yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Play your first game to see it here!"}),t.jsx(i,{onClick:()=>S("/play"),children:"Play Now"})]})}):t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:z.map(e=>t.jsx(o.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:t.jsxs(d,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>E(e),children:[t.jsx(b,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(w,{className:"text-lg flex items-center gap-2",children:[t.jsx(p,{className:"w-4 h-4"}),e.white_player_id===B.id?"White":"Black"]}),O(e)]})}),t.jsxs(m,{children:[t.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(C,{className:"w-4 h-4"}),e.completed_at?x(new Date(e.completed_at),"MMM d, yyyy h:mm a"):"Unknown"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-4 h-4"}),q[e.time_control]]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_,{className:"w-4 h-4"}),e.move_count||0," moves"]})]}),t.jsxs(i,{variant:"ghost",className:"w-full mt-4",size:"sm",children:[t.jsx(v,{className:"w-4 h-4 mr-2"}),"Watch Replay"]})]})]})},e.id))})},"list")})]}),t.jsx(n,{})]}):t.jsxs("div",{className:"min-h-screen flex flex-col",children:[t.jsx(l,{}),t.jsx("main",{className:"flex-1 flex items-center justify-center",children:t.jsx("p",{className:"text-muted-foreground",children:"Please sign in to view your game history."})}),t.jsx(n,{})]})}export{S as default};
