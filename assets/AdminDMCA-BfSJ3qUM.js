import{a as e,u as s,r as a,s as t,b as r,j as i,H as n,L as l,au as d,da as c,B as m,cS as x,b7 as o,v as h,C as j,x as u,aB as g,aC as p,aD as N,cb as f,y as v,z as w,D as b,aE as y,p as _,t as C,w as k,F as R,bo as D,dq as M,dA as S,bF as A,aF as F,aW as E,b8 as q,b9 as W,ba as I,bb as L,bc as P,e as V,de as z,f as B,g as H,h as T,i as $,k as G,l as O,m as Y}from"./index-DEc03Eh1.js";import{F as J}from"./file-warning-jpAggtyL.js";import{C as K}from"./calendar-By9lXD7j.js";const Q=()=>{const Q=e(),{user:U,isLoading:X}=s(),[Z,ee]=a.useState(!1),[se,ae]=a.useState(!0),[te,re]=a.useState([]),[ie,ne]=a.useState(!0),[le,de]=a.useState({}),[ce,me]=a.useState(new Set),[xe,oe]=a.useState("pending");a.useEffect(()=>{(async()=>{if(!U)return ee(!1),void ae(!1);try{const{data:e,error:s}=await t.rpc("has_role",{_user_id:U.id,_role:"admin"});if(s)throw s;ee(!0===e)}catch(e){ee(!1)}finally{ae(!1)}})()},[U]),a.useEffect(()=>{Z&&he()},[Z,xe]);const he=async()=>{ne(!0);try{let e=t.from("dmca_reports").select("*").order("created_at",{ascending:!1});"all"!==xe&&(e=e.eq("status",xe));const{data:s,error:a}=await e;if(a)throw a;re(s||[]);const r={};null==s||s.forEach(e=>{r[e.id]=e.admin_notes||""}),de(r)}catch(e){r.error("Failed to load DMCA reports")}finally{ne(!1)}},je=async(e,s)=>{if(U){me(s=>new Set(s).add(e));try{const{error:a}=await t.from("dmca_reports").update({status:s,admin_notes:le[e]||null,reviewed_at:(new Date).toISOString(),reviewed_by:U.id}).eq("id",e);if(a)throw a;r.success(`Report marked as ${s}`),he()}catch(a){r.error("Failed to update report")}finally{me(s=>{const a=new Set(s);return a.delete(e),a})}}},ue=e=>{switch(e){case"pending":return"bg-amber-500 text-white";case"reviewing":return"bg-blue-500 text-white";case"resolved":return"bg-green-500 text-white";case"dismissed":return"bg-muted text-muted-foreground";default:return"bg-muted"}},ge=e=>{switch(e){case"pending":return i.jsx(f,{className:"h-4 w-4"});case"reviewing":return i.jsx(J,{className:"h-4 w-4"});case"resolved":return i.jsx(w,{className:"h-4 w-4"});case"dismissed":return i.jsx(b,{className:"h-4 w-4"});default:return null}};if(X||se)return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx(l,{className:"h-8 w-8 animate-spin text-primary"})})}),i.jsx(d,{})]});if(!U||!Z)return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsx("div",{className:"container mx-auto px-4 py-16",children:i.jsxs("div",{className:"max-w-md mx-auto text-center space-y-6",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx("div",{className:"h-16 w-16 rounded-full bg-destructive/10 flex items-center justify-center",children:i.jsx(c,{className:"h-8 w-8 text-destructive"})})}),i.jsx("h1",{className:"text-2xl font-display font-bold",children:"Access Denied"}),i.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to access the DMCA administration panel."}),i.jsx(m,{onClick:()=>Q("/"),children:"Return Home"})]})}),i.jsx(d,{})]});const pe={all:te.length,pending:te.filter(e=>"pending"===e.status).length,reviewing:te.filter(e=>"reviewing"===e.status).length,resolved:te.filter(e=>"resolved"===e.status).length,dismissed:te.filter(e=>"dismissed"===e.status).length};return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsxs("div",{className:"max-w-6xl mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-8",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-3xl font-display font-bold flex items-center gap-3",children:[i.jsx(x,{className:"h-8 w-8 text-primary"}),"DMCA Report Management"]}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"Review and manage DMCA takedown requests"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(m,{variant:"outline",onClick:()=>Q("/admin/watermark-verification"),children:[i.jsx(o,{className:"h-4 w-4 mr-2"}),"Watermark Verification"]}),i.jsxs(m,{variant:"outline",onClick:he,disabled:ie,children:[i.jsx(h,{className:"h-4 w-4 mr-2 "+(ie?"animate-spin":"")}),"Refresh"]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[i.jsx(j,{children:i.jsxs(u,{className:"pt-6",children:[i.jsx("div",{className:"text-2xl font-bold text-amber-500",children:pe.pending}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})}),i.jsx(j,{children:i.jsxs(u,{className:"pt-6",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-500",children:pe.reviewing}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Reviewing"})]})}),i.jsx(j,{children:i.jsxs(u,{className:"pt-6",children:[i.jsx("div",{className:"text-2xl font-bold text-green-500",children:pe.resolved}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved"})]})}),i.jsx(j,{children:i.jsxs(u,{className:"pt-6",children:[i.jsx("div",{className:"text-2xl font-bold text-muted-foreground",children:pe.dismissed}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Dismissed"})]})})]}),i.jsxs(g,{value:xe,onValueChange:oe,className:"space-y-6",children:[i.jsxs(p,{children:[i.jsxs(N,{value:"pending",className:"gap-2",children:[i.jsx(f,{className:"h-4 w-4"}),"Pending",pe.pending>0&&i.jsx(v,{variant:"destructive",className:"ml-1",children:pe.pending})]}),i.jsxs(N,{value:"reviewing",className:"gap-2",children:[i.jsx(J,{className:"h-4 w-4"}),"Reviewing"]}),i.jsxs(N,{value:"resolved",className:"gap-2",children:[i.jsx(w,{className:"h-4 w-4"}),"Resolved"]}),i.jsxs(N,{value:"dismissed",className:"gap-2",children:[i.jsx(b,{className:"h-4 w-4"}),"Dismissed"]}),i.jsx(N,{value:"all",className:"gap-2",children:"All Reports"})]}),i.jsx(y,{value:xe,className:"space-y-4",children:ie?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(l,{className:"h-8 w-8 animate-spin text-primary"})}):0===te.length?i.jsx(j,{children:i.jsxs(u,{className:"py-12 text-center",children:[i.jsx(w,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium",children:"No Reports"}),i.jsx("p",{className:"text-muted-foreground",children:"No DMCA reports in this category"})]})}):te.map(e=>{const s=ce.has(e.id);return i.jsxs(j,{className:"overflow-hidden",children:[i.jsx(_,{className:"border-b bg-muted/30",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsxs(C,{className:"text-lg flex items-center gap-2",children:["DMCA Report #",e.id.slice(0,8),i.jsxs(v,{className:ue(e.status),children:[ge(e.status),i.jsx("span",{className:"ml-1 capitalize",children:e.status})]})]}),i.jsxs(k,{className:"flex items-center gap-2 mt-1",children:[i.jsx(K,{className:"h-3 w-3"}),"Submitted ",R(new Date(e.created_at),"MMM d, yyyy h:mm a")]})]}),e.reviewed_at&&i.jsx("div",{className:"text-right text-sm text-muted-foreground",children:i.jsxs("p",{children:["Reviewed: ",R(new Date(e.reviewed_at),"MMM d, yyyy")]})})]})}),i.jsxs(u,{className:"pt-6 space-y-6",children:[i.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[i.jsx(D,{className:"h-4 w-4"}),"Reporter Information"]}),i.jsxs("div",{className:"space-y-2 text-sm",children:[i.jsx("p",{className:"font-medium",children:e.reporter_name}),i.jsxs("p",{className:"flex items-center gap-2 text-muted-foreground",children:[i.jsx(M,{className:"h-3 w-3"}),i.jsx("a",{href:`mailto:${e.reporter_email}`,className:"hover:underline",children:e.reporter_email})]}),e.reporter_phone&&i.jsxs("p",{className:"flex items-center gap-2 text-muted-foreground",children:[i.jsx(S,{className:"h-3 w-3"}),e.reporter_phone]}),e.reporter_address&&i.jsxs("p",{className:"flex items-center gap-2 text-muted-foreground",children:[i.jsx(A,{className:"h-3 w-3"}),e.reporter_address]})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("h4",{className:"font-semibold",children:"Legal Statements"}),i.jsxs("div",{className:"space-y-2 text-sm",children:[i.jsxs("p",{className:"flex items-center gap-2",children:[e.good_faith_statement?i.jsx(w,{className:"h-4 w-4 text-green-500"}):i.jsx(b,{className:"h-4 w-4 text-destructive"}),"Good Faith Statement"]}),i.jsxs("p",{className:"flex items-center gap-2",children:[e.accuracy_statement?i.jsx(w,{className:"h-4 w-4 text-green-500"}):i.jsx(b,{className:"h-4 w-4 text-destructive"}),"Accuracy Statement"]}),i.jsxs("p",{className:"text-muted-foreground",children:[i.jsx("span",{className:"font-medium",children:"Electronic Signature:"})," ",e.electronic_signature]})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-semibold",children:"Copyrighted Work Description"}),i.jsx("p",{className:"text-sm bg-muted/50 p-3 rounded-lg",children:e.copyrighted_work_description})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-semibold",children:"Infringing Material"}),i.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg space-y-2",children:[i.jsxs("p",{className:"text-sm flex items-center gap-2",children:[i.jsx(F,{className:"h-3 w-3"}),i.jsx("a",{href:e.infringing_material_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline break-all",children:e.infringing_material_url})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:e.infringing_material_description})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"font-semibold",children:"Admin Notes"}),i.jsx(E,{placeholder:"Add notes about this report...",value:le[e.id]||"",onChange:s=>de(a=>({...a,[e.id]:s.target.value})),className:"text-sm",rows:3})]}),i.jsxs("div",{className:"flex flex-wrap gap-3 pt-4 border-t",children:[i.jsxs(q,{value:e.status,onValueChange:s=>je(e.id,s),disabled:s,children:[i.jsx(W,{className:"w-48",children:i.jsx(I,{placeholder:"Change status"})}),i.jsxs(L,{children:[i.jsx(P,{value:"pending",children:"Pending"}),i.jsx(P,{value:"reviewing",children:"Reviewing"}),i.jsx(P,{value:"resolved",children:"Resolved"}),i.jsx(P,{value:"dismissed",children:"Dismissed"})]})]}),i.jsxs(m,{variant:"outline",onClick:()=>je(e.id,"reviewing"),disabled:s||"reviewing"===e.status,children:[s?i.jsx(l,{className:"h-4 w-4 animate-spin mr-2"}):i.jsx(J,{className:"h-4 w-4 mr-2"}),"Mark Reviewing"]}),i.jsxs(V,{children:[i.jsx(z,{asChild:!0,children:i.jsxs(m,{variant:"default",disabled:s,className:"bg-green-600 hover:bg-green-700",children:[i.jsx(w,{className:"h-4 w-4 mr-2"}),"Mark Resolved"]})}),i.jsxs(B,{children:[i.jsxs(H,{children:[i.jsx(T,{children:"Resolve DMCA Report?"}),i.jsx($,{children:"This will mark the report as resolved, indicating the infringing content has been addressed. Make sure to document your actions in the admin notes."})]}),i.jsxs(G,{children:[i.jsx(O,{children:"Cancel"}),i.jsx(Y,{className:"bg-green-600 hover:bg-green-700",onClick:()=>je(e.id,"resolved"),children:"Confirm Resolution"})]})]})]}),i.jsxs(V,{children:[i.jsx(z,{asChild:!0,children:i.jsxs(m,{variant:"outline",disabled:s,children:[i.jsx(b,{className:"h-4 w-4 mr-2"}),"Dismiss"]})}),i.jsxs(B,{children:[i.jsxs(H,{children:[i.jsx(T,{children:"Dismiss DMCA Report?"}),i.jsx($,{children:"This will dismiss the report as invalid or not actionable. Make sure to document the reason in the admin notes."})]}),i.jsxs(G,{children:[i.jsx(O,{children:"Cancel"}),i.jsx(Y,{onClick:()=>je(e.id,"dismissed"),children:"Confirm Dismissal"})]})]})]})]})]})]},e.id)})})]})]})}),i.jsx(d,{})]})};export{Q as default};
