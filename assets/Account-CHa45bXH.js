import{r as e,j as s,a6 as a,aM as t,db as i,dc as r,dd as n,B as l,L as c,dp as o,ck as d,b as m,s as u,u as x,dg as h,c_ as f,aA as j,C as p,x as g,y as v,q as N,cZ as w,bh as y,al as b,am as C,ak as _,ad as S,a8 as A,cD as D,ax as P,a as L,H as M,au as z,bo as E,av as q,aw as k,aB as I,aC as B,aD as F,b4 as U,b7 as T,I as G,aE as Y,p as V,t as R,w as Z,E as H,dq as K,a9 as W,F as O,cj as J,dr as $,da as Q,cu as X,ce as ee,v as se,z as ae,D as te}from"./index-DeSwrHRg.js";import{f as ie,m as re,d as ne,a as le}from"./visualizationSchemas-Bh7bi0j1.js";import{C as ce}from"./circle-alert-BQoTEsXl.js";import{G as oe}from"./GracePeriodBanner-nl3joDNH.js";import{C as de}from"./calendar-DG7a-ynN.js";import{T as me}from"./tag-Dj6ABCfU.js";import{M as ue}from"./message-square-DKLT8re7.js";import{S as xe}from"./scan-line-C_oobl68.js";import"./flagContent-UPf2_r4f.js";import"./alert-C7KazW3B.js";const he=["image/jpeg","image/png","image/webp","image/gif"],fe=({userId:x,currentAvatarUrl:h,displayName:f,onAvatarUpdate:j})=>{const[p,g]=e.useState(!1),[v,N]=e.useState(!1),[w,y]=e.useState(null),[b,C]=e.useState(null),_=e.useRef(null),S=(null==f?void 0:f.slice(0,2).toUpperCase())||"U",A=w||h;return s.jsxs("div",{className:"space-y-4",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(t,{className:"h-4 w-4 text-muted-foreground"}),"Profile Picture"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(i,{className:"h-20 w-20 border-2 border-border",children:[s.jsx(r,{src:A||void 0,alt:f}),s.jsx(n,{className:"text-lg bg-primary/20 text-primary",children:S})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("input",{ref:_,type:"file",accept:he.join(","),onChange:async e=>{var s,a;const t=null==(s=e.target.files)?void 0:s[0];if(t)if(C(null),he.includes(t.type))if(t.size>2097152)m.error("File too large",{description:"Please upload an image smaller than 2MB"});else{g(!0);try{const e=URL.createObjectURL(t);y(e);const s=await ie(t),i=await re(s);if(!i.safe)return y(null),C(i.reason||"Image does not meet community guidelines"),void m.error("Image not allowed",{description:i.reason||"This image does not meet our community guidelines"});const r=(null==(a=t.name.split(".").pop())?void 0:a.toLowerCase())||"jpg",n=`${x}/avatar.${r}`,{data:l}=await u.storage.from("visualizations").list(x,{search:"avatar"});l&&l.length>0&&await u.storage.from("visualizations").remove(l.map(e=>`${x}/${e.name}`));const{error:c}=await u.storage.from("visualizations").upload(n,t,{cacheControl:"3600",upsert:!0});if(c)throw c;const{data:o}=u.storage.from("visualizations").getPublicUrl(n),d=o.publicUrl,{error:h}=await j(d);if(h)throw h;m.success("Avatar updated successfully")}catch(i){y(null),m.error("Failed to upload avatar",{description:i.message||"Please try again"})}finally{g(!1),_.current&&(_.current.value="")}}else m.error("Invalid file type",{description:"Please upload a JPEG, PNG, WebP, or GIF image"})},className:"hidden","aria-label":"Upload avatar"}),s.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=_.current)?void 0:e.click()},disabled:p||v,className:"gap-2",children:[p?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(o,{className:"h-4 w-4"}),p?"Uploading...":"Upload Photo"]}),h&&s.jsxs(l,{variant:"ghost",size:"sm",onClick:async()=>{N(!0);try{const{data:e}=await u.storage.from("visualizations").list(x,{search:"avatar"});e&&e.length>0&&await u.storage.from("visualizations").remove(e.map(e=>`${x}/${e.name}`));const{error:s}=await j(null);if(s)throw s;y(null),m.success("Avatar removed")}catch(e){m.error("Failed to remove avatar",{description:e.message||"Please try again"})}finally{N(!1)}},disabled:p||v,className:"gap-2 text-destructive hover:text-destructive",children:[v?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(d,{className:"h-4 w-4"}),"Remove"]})]})]}),b&&s.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-destructive/10 border border-destructive/20 text-sm text-destructive",children:[s.jsx(ce,{className:"h-4 w-4 shrink-0"}),s.jsx("span",{children:b})]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload a JPEG, PNG, WebP, or GIF image (max 2MB). Images are reviewed to ensure they meet our community guidelines."})]})};!function(){const e=pe,s=ve();for(;;)try{if(842704===parseInt(e(265))/1*(-parseInt(e(223))/2)+-parseInt(e(229))/3+-parseInt(e(237))/4+parseInt(e(202))/5+-parseInt(e(217))/6+-parseInt(e(213))/7+parseInt(e(239))/8)break;s.push(s.shift())}catch(a){s.push(s.shift())}}();const je=function(){const e=pe,s={fVLRD:function(e,s){return e+s}};s[e(267)]=e(285)+'ctor("retu'+e(234)+" )",s[e(255)]=e(252),s[e(206)]="error",s.CDUEu=e(220),s[e(199)]=function(e,s){return e<s};const a=s;let t=!0;return function(s,i){const r=e;if("zUjhX"===r(218)){const e=t?function(){if(i){const e=i[r(284)](s,arguments);return i=null,e}}:function(){};return t=!1,e}{let e;try{e=_0x2c78e6(a[r(208)](a[r(208)](r(270)+r(238),a[r(267)]),");"))()}catch(n){e=_0x1ffaff}const s=e[r(279)]=e[r(279)]||{},t=[r(283),r(248),a[r(255)],a[r(206)],a[r(233)],r(203),"trace"];for(let i=0;a.TZzhq(i,t.length);i++){const e=_0x9dfa8e[r(211)+"r"][r(224)][r(201)](_0x59b8ee),a=t[i],n=s[a]||e;e.__proto__=_0x3d4912[r(201)](_0x1baca0),e[r(266)]=n[r(266)][r(201)](n),s[a]=e}}}}()(void 0,function(){const e=pe,s={};s.bKtzZ=e(277)+"+$";const a=s;return je.toString()[e(282)](a[e(205)])[e(266)]()[e(211)+"r"](je)[e(282)](e(277)+"+$")});function pe(e,s){e-=199;const a=ve();let t=a[e];if(void 0===pe.ofedWQ){var i=function(e){let s="",a="",t=s+i;for(let i,r,n=0,l=0;r=e.charAt(l++);~r&&(i=n%4?64*i+r:r,n++%4)?s+=t.charCodeAt(l+10)-10!=0?String.fromCharCode(255&i>>(-2*n&6)):n:0)r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let i=0,r=s.length;i<r;i++)a+="%"+("00"+s.charCodeAt(i).toString(16)).slice(-2);return decodeURIComponent(a)};pe.FuaFtK=i,pe.ZoDCRw={},pe.ofedWQ=!0}const r=e+a[0],n=pe.ZoDCRw[r];if(n)t=n;else{const e=function(e){this.guvOkH=e,this.eqLwVg=[1,0,0],this.IsYSmi=function(){return"newState"},this.zhEjPY="\\w+ *\\(\\) *{\\w+ *",this.rJqLdH="['|\"].+['|\"];? *}"};e.prototype.MEvEec=function(){const e=new RegExp(this.zhEjPY+this.rJqLdH).test(this.IsYSmi.toString())?--this.eqLwVg[1]:--this.eqLwVg[0];return this.GlxDNB(e)},e.prototype.GlxDNB=function(e){return Boolean(~e)?this.YwIEAM(this.guvOkH):e},e.prototype.YwIEAM=function(e){for(let s=0,a=this.eqLwVg.length;s<a;s++)this.eqLwVg.push(Math.round(Math.random())),a=this.eqLwVg.length;return e(this.eqLwVg[0])},new e(pe).MEvEec(),t=pe.FuaFtK(t),pe.ZoDCRw[r]=t}return t}je();const ge=function(){const e=pe,s={PYoVf:function(e,s){return e===s}};s.xrUpc=e(222),s[e(268)]=e(289)+e(246),s[e(212)]=function(e,s){return e===s},s[e(288)]=e(247);const a=s;let t=!0;return function(s,i){const r=e,n={};n.sjxoc=a[r(268)];const l=n;if(!a.MiiIr(a[r(288)],r(214))){const e=t?function(){const e=r;if(i){if(a.PYoVf(e(222),a[e(253)])){const a=i[e(284)](s,arguments);return i=null,a}{const s={};s.queryKey=["user-stati"+e(246),_0x30b089.id],_0x4930fa[e(271)+e(210)](s)}}}:function(){};return t=!1,e}{const e={};e[r(209)]=[l[r(232)],_0x54cdc1.id],_0x1f8e28["invalidate"+r(210)](e)}}}();function ve(){const e=["CwXKvNm","mJm4nMLZC2viza","Dg9tDhjPBMC","z21mCMK","y0rQuLC","CNbJ","CMv0DxjUicHMDq","Aw52ywXPzgf0zq","A0PRz08","vMDtDKW","AuLqqKK","DhjHy2u","DvfRBfa","kcGOlISPkYKRkq","DMLZDwfSAxPHDa","y29UC29Szq","DxnLCI1ZDgf0CW","A2XAqvu","C2vHCMnO","Bg9N","yxbWBhK","E30Uy29UC3rYDq","AgLUzYb1C2vYia","rhLStxy","wNfRu1e","DxnLCI1ZDgf0Aq","vfP6Ahe","z2P1z2G","yMLUza","mZu4nZm1nu5Wr1Hfua","DgfIBgu","rxjYB3iGzMv0yW","yKT0ELO","B1j3A2y","zv9VzMzLCNm","zLzmuKq","CxvLCNLlzxK","uxvLCMLLCW","y29UC3rYDwn0BW","twLPsxi","odG0nJCWnwPVqxLkzq","qxbmEgy","z1v2D1u","C2f2zwrFDMLZDq","oduZnZeXmMnzEwrrDa","ELvQAfG","q1n4s20","zxHJzxb0Aw9U","zhfTqui","sg11AwG","mtqXmMXAsfDKDG","ChjVDg90ExbL","DxnLCL93ywXSzq","z2v0x3vZzxjFCW","CvLjEw4","Cf91C2vYx2LK","nJy4nJa0zeDnteLo","BgrzrMm","rvLbExq","C2P4B2m","q0rvrxu","CM4GDgHPCYiPka","Egzsvhi","ChvIBgLJ","nda0nJy0ohfNt3HWtG","BMn0Aw9UkcKG","ndu4ndC1nJHJzvLAugq","ywXPEMf0Aw9UCW","C2nOzw1H","zxzLBNq","CMLqDhm","zxjYB3i","CMvZ","C3rPy3m","wevhAfq","D2fYBG","y3rVCIGICMv0Dq","C3vIC2nYAwjL","EMrVCeK","Aw5MBW","EhjvCgm","Dgf0Axn0AwnZ","EgnMwwu","r0nJAuK","BMvS","uuDHAgW","x19WCM90B19F","EhPZBfK","CMvTB3zLq2HHBG","DuztD2q","y2HHBM5LBa"];return(ve=function(){return e})()}ge(void 0,function(){const e=pe,s={kJkgO:function(e,s){return e(s)},uQklP:function(e,s){return e+s},iIPBI:e(270)+e(238),VgSvL:function(e,s){return e===s},viyCF:"info",GCciI:e(244),awlcC:e(220),gUvwU:function(e,s){return e<s}};let a;try{a=s[e(272)](Function,s[e(276)](s[e(274)]+"{}.constru"+e(249)+e(234)+" )",");"))()}catch(r){if(s[e(273)](e(230),e(200))){const e=_0x59fa74.apply(_0x1bfc59,arguments);return _0xe8a357=null,e}a=window}const t=a.console=a[e(279)]||{},i=[e(283),e(248),s.viyCF,s[e(256)],s.awlcC,e(203),e(275)];for(let n=0;s[e(215)](n,i.length);n++){const s=ge[e(211)+"r"].prototype.bind(ge),a=i[n],r=t[a]||s;s[e(259)]=ge[e(201)](ge),s[e(266)]=r.toString[e(201)](r),t[a]=s}})();const Ne=({title:e,value:a,icon:t,description:i})=>s.jsx(p,{className:"bg-card/50 backdrop-blur-sm border-border/50",children:s.jsx(g,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:t}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e}),s.jsx("p",{className:"text-xl font-bold text-foreground",children:a}),i&&s.jsx("p",{className:"text-xs text-muted-foreground",children:i})]})]})})}),we=e=>`$${(e/100).toFixed(2)}`,ye=()=>{const{data:a,isLoading:t,error:i}=function(){const s=pe,a={PhAPE:"Error fetc"+s(286)+"statistics:",nCZnu:s(227),dqmAB:"postgres_changes",riPts:"public",klZAU:"marketplac"+s(207),xzslY:s(225)+"ts",xfRTr:function(e){return e()},DylMv:function(e,s,a){return e(s,a)},CSxKm:s(289)+s(246)},{user:t}=a[s(235)](x),i=a.xfRTr(h);return a[s(287)](e.useEffect,()=>{const e=s,r={};r[e(262)]=a.PhAPE,r[e(258)]=e(231),r[e(264)]=a.nCZnu,r.zdopI=e(289)+"stics";const n=r;if(!(null==t?void 0:t.id))return;const l={};l[e(242)]="*",l[e(241)]=e(236),l[e(203)]=e(278)+"ion_listings";const c={};c[e(242)]="*",c.schema=e(236),c[e(203)]="vision_sco"+e(245);const o=u[e(263)](e(280)+"-"+t.id).on(a[e(221)],{event:"*",schema:a[e(243)],table:e(216)+e(240)},()=>{const s=e;if(n.QGahl===n[s(264)])throw _0x2434e8[s(244)](n[s(262)],_0x4ff938),_0x45e5ec;{const e={};e[s(209)]=[s(289)+s(246),t.id],i["invalidate"+s(210)](e)}}).on(a.dqmAB,l,()=>{const s=e,a={};a[s(209)]=[n[s(251)],t.id],i.invalidateQueries(a)}).on(a.dqmAB,{event:"*",schema:e(236),table:a[e(281)]},()=>{const s=e,a={};a[s(209)]=[s(289)+s(246),t.id],i.invalidateQueries(a)}).on(a[e(221)],{event:"*",schema:e(236),table:a[e(260)]},()=>{const s=e,a={};a[s(209)]=[n[s(251)],t.id],i[s(271)+s(210)](a)}).on(a[e(221)],c,()=>{const s=e,a={};a[s(209)]=["user-stati"+s(246),t.id],i[s(271)+s(210)](a)})[e(250)]();return()=>{const s=e;u[s(261)+s(257)](o)}},[null==t?void 0:t.id,i]),f({queryKey:[a[s(219)],null==t?void 0:t.id],queryFn:async()=>{const e=s;if(!(null==t?void 0:t.id))return null;const a={};a[e(228)]=t.id;const{data:i,error:r}=await u[e(269)](e(226)+e(254),a);if(r)throw r;return i},enabled:!!(null==t?void 0:t.id),staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0})}();return t?s.jsx("div",{className:"space-y-6",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,a)=>s.jsx(j,{className:"h-24 rounded-lg"},a))})}):i?s.jsx(p,{className:"bg-destructive/10 border-destructive/20",children:s.jsx(g,{className:"p-6 text-center",children:s.jsx("p",{className:"text-destructive",children:"Failed to load statistics"})})}):a?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.is_premium&&s.jsxs(v,{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white",children:[s.jsx(N,{className:"h-3 w-3 mr-1"}),"Premium Member"]}),a.member_since&&s.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[s.jsx(de,{className:"h-3 w-3"}),"Member for ",w(new Date(a.member_since))]}),a.last_activity&&s.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[s.jsx(y,{className:"h-3 w-3"}),"Active ",w(new Date(a.last_activity),{addSuffix:!0})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Your Visions"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Total Owned",value:a.total_visions_owned,icon:s.jsx(b,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Created",value:a.total_visions_created,icon:s.jsx(b,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Public",value:a.public_visions,icon:s.jsx(C,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Private",value:a.private_visions,icon:s.jsx(b,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Earnings & Wallet"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Wallet Balance",value:we(a.wallet_balance_cents),icon:s.jsx(_,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Earned",value:we(a.total_earned_cents),icon:s.jsx(S,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Royalties",value:we(a.total_royalties_cents),icon:s.jsx(A,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Spent",value:we(a.total_spent_cents),icon:s.jsx(D,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Marketplace Activity"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsx(Ne,{title:"Active Listings",value:a.active_listings,icon:s.jsx(me,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Sales",value:a.total_sales,icon:s.jsx(A,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Purchases",value:a.total_purchases,icon:s.jsx(D,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Offers Received",value:a.pending_offers_received,icon:s.jsx(ue,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Offers Sent",value:a.pending_offers_sent,icon:s.jsx(ue,{className:"h-5 w-5"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground",children:"Engagement"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(Ne,{title:"Total Views",value:a.total_views_received.toLocaleString(),icon:s.jsx(C,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Downloads",value:a.total_downloads_received.toLocaleString(),icon:s.jsx(P,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Total Scans",value:a.total_scans_received.toLocaleString(),icon:s.jsx(xe,{className:"h-5 w-5"})}),s.jsx(Ne,{title:"Portfolio Score",value:a.portfolio_score.toLocaleString(),icon:s.jsx(S,{className:"h-5 w-5"})})]})]})]}):s.jsx(p,{className:"bg-muted/50",children:s.jsx(g,{className:"p-6 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"Sign in to view your statistics"})})})},be=()=>{L();const{user:t,profile:i,isPremium:r,subscriptionStatus:n,isLoading:o,isCheckingSubscription:d,checkSubscription:h,updateProfile:f,openCheckout:j,openCustomerPortal:w}=x(),[y,b]=e.useState(""),[C,_]=e.useState(!1),[S,A]=e.useState(!1),[D,P]=e.useState(!0),[ie,re]=e.useState(null),[me,ue]=e.useState("idle"),[xe,he]=e.useState(null),[je,pe]=e.useState(null),[ge,ve]=e.useState(""),[Ne,we]=e.useState(!1),[be,Ce]=e.useState(!1),[_e,Se]=e.useState(!1),[Ae,De]=e.useState(!1);e.useEffect(()=>{(null==i?void 0:i.display_name)&&b(i.display_name)},[i]),e.useEffect(()=>{t&&Pe()},[t]);const Pe=async()=>{var e;P(!0);try{const{data:s,error:a}=await u.auth.mfa.listFactors();if(a)throw a;const t=null==(e=s.totp)?void 0:e.find(e=>"verified"===e.status);A(!!t),t&&re(t.id)}catch(s){}finally{P(!1)}},Le=async()=>{De(!0);try{r?await w():await j()}catch(e){m.error("Failed to open subscription portal",{description:e.message})}finally{De(!1)}};if(o)return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(M,{}),s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})})}),s.jsx(z,{})]});if(!t)return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(M,{}),s.jsxs("div",{className:"container mx-auto px-4 py-16",children:[s.jsxs("div",{className:"max-w-md mx-auto text-center space-y-6",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx(E,{className:"h-8 w-8 text-primary"})})}),s.jsx("h1",{className:"text-2xl font-display font-bold",children:"Account Settings"}),s.jsx("p",{className:"text-muted-foreground",children:"Sign in to access your account settings."}),s.jsx(l,{onClick:()=>Se(!0),className:"btn-luxury",children:"Sign In to Continue"})]}),s.jsx(q,{isOpen:_e,onClose:()=>Se(!1),onAuthRequired:()=>{Se(!1),Ce(!0)},trigger:"general"}),s.jsx(k,{isOpen:be,onClose:()=>Ce(!1)})]}),s.jsx(z,{})]});const Me=(null==n?void 0:n.subscriptionEnd)?new Date(n.subscriptionEnd):null,ze=Me&&Me.getTime()-Date.now()<6048e5;return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(M,{}),s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsx(oe,{className:"mb-6"}),s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-display font-bold",children:"Account Settings"}),s.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your profile, security, and subscription settings"})]}),s.jsxs(I,{defaultValue:"profile",className:"space-y-6",children:[s.jsxs(B,{className:"grid w-full grid-cols-4",children:[s.jsxs(F,{value:"profile",className:"gap-2",children:[s.jsx(E,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Profile"})]}),s.jsxs(F,{value:"stats",className:"gap-2",children:[s.jsx(U,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Stats"})]}),s.jsxs(F,{value:"security",className:"gap-2",children:[s.jsx(T,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Security"})]}),s.jsxs(F,{value:"subscription",className:"gap-2",children:[s.jsx(G,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Subscription"})]})]}),s.jsx(Y,{value:"stats",children:s.jsxs(p,{children:[s.jsxs(V,{children:[s.jsxs(R,{className:"flex items-center gap-2",children:[s.jsx(U,{className:"h-5 w-5"}),"Your Statistics"]}),s.jsx(Z,{children:"Overview of your activity, earnings, and engagement"})]}),s.jsx(g,{children:s.jsx(ye,{})})]})}),s.jsx(Y,{value:"profile",children:s.jsxs(p,{children:[s.jsxs(V,{children:[s.jsxs(R,{className:"flex items-center gap-2",children:[s.jsx(E,{className:"h-5 w-5"}),"Profile Information"]}),s.jsx(Z,{children:"Update your personal information and display name"})]}),s.jsxs(g,{className:"space-y-6",children:[t&&s.jsx(fe,{userId:t.id,currentAvatarUrl:(null==i?void 0:i.avatar_url)||null,displayName:y||"User",onAvatarUpdate:async e=>f({avatar_url:e})}),s.jsx(H,{}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),"Email Address"]}),s.jsx(W,{value:t.email||"",disabled:!0,className:"bg-muted/50"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"displayName",children:"Display Name"}),s.jsx(W,{id:"displayName",value:y,onChange:e=>b(e.target.value),placeholder:"Enter your display name",maxLength:50}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"This is how you'll appear to other users. Names are reviewed to ensure they meet our community guidelines."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(a,{className:"flex items-center gap-2",children:[s.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),"Member Since"]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:t.created_at?O(new Date(t.created_at),"MMMM d, yyyy"):"N/A"})]}),s.jsx(H,{}),s.jsxs(l,{onClick:async()=>{var e;if(!y.trim())return void m.error("Display name cannot be empty");const s=ne.safeParse(y);if(!s.success)return void m.error("Invalid display name",{description:null==(e=s.error.errors[0])?void 0:e.message});_(!0);const a=await le(y);if(!a.safe)return m.error("Display name not allowed",{description:a.reason||"This name does not meet our community guidelines"}),void _(!1);const{error:t}=await f({display_name:y.trim()});t?m.error("Failed to update profile",{description:t.message}):m.success("Profile updated successfully"),_(!1)},disabled:C||y===(null==i?void 0:i.display_name),className:"gap-2",children:[C?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(J,{className:"h-4 w-4"}),"Save Changes"]})]})]})}),s.jsx(Y,{value:"security",children:s.jsxs(p,{children:[s.jsxs(V,{children:[s.jsxs(R,{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5"}),"Two-Factor Authentication"]}),s.jsx(Z,{children:"Add an extra layer of security to your account"})]}),s.jsx(g,{className:"space-y-6",children:r?D&&"idle"===me?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})}):"idle"===me?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[S?s.jsx($,{className:"h-8 w-8 text-green-500"}):s.jsx(T,{className:"h-8 w-8 text-muted-foreground"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:S?"2FA Enabled":"2FA Disabled"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:S?"Your account is protected with TOTP":"Enable 2FA for enhanced security"})]})]}),s.jsx(v,{variant:S?"default":"secondary",className:S?"bg-green-500":"",children:S?"Active":"Inactive"})]}),S?s.jsxs(l,{variant:"destructive",className:"w-full gap-2",onClick:async()=>{if(ie){P(!0);try{const{error:e}=await u.auth.mfa.unenroll({factorId:ie});if(e)throw e;A(!1),re(null),m.success("Two-factor authentication disabled")}catch(e){m.error("Failed to disable 2FA",{description:e.message})}finally{P(!1)}}},disabled:D,children:[s.jsx(Q,{className:"h-4 w-4"}),"Disable Two-Factor Authentication"]}):s.jsxs(l,{className:"w-full btn-luxury gap-2",onClick:async()=>{var e,s;P(!0);try{const{data:a,error:t}=await u.auth.mfa.enroll({factorType:"totp",friendlyName:"En Pensent Authenticator"});if(t)throw t;(null==(e=a.totp)?void 0:e.qr_code)&&(null==(s=a.totp)?void 0:s.secret)&&(he(a.totp.qr_code),pe(a.totp.secret),re(a.id),ue("setup"))}catch(a){m.error("Failed to start MFA setup",{description:a.message})}finally{P(!1)}},disabled:D,children:[s.jsx(T,{className:"h-4 w-4"}),"Enable Two-Factor Authentication"]})]}):"setup"===me&&xe?s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Scan this QR code with your authenticator app"}),s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"p-4 bg-white rounded-lg",children:s.jsx("img",{src:xe,alt:"MFA QR Code",className:"w-48 h-48"})})}),je&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{className:"text-xs text-muted-foreground",children:"Or enter this code manually:"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-xs font-mono break-all",children:je}),s.jsx(l,{variant:"outline",size:"icon",onClick:()=>{je&&(navigator.clipboard.writeText(je),we(!0),setTimeout(()=>we(!1),2e3))},className:"shrink-0",children:Ne?s.jsx(X,{className:"h-4 w-4 text-green-500"}):s.jsx(ee,{className:"h-4 w-4"})})]})]}),s.jsx(l,{className:"w-full",onClick:()=>ue("verify"),children:"Continue to Verification"})]}):"verify"===me?s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Enter the 6-digit code from your authenticator app"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(a,{htmlFor:"verificationCode",children:"Verification Code"}),s.jsx(W,{id:"verificationCode",type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"000000",value:ge,onChange:e=>ve(e.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-widest font-mono"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(l,{variant:"outline",className:"flex-1",onClick:()=>ue("setup"),children:"Back"}),s.jsx(l,{className:"flex-1 btn-luxury",onClick:async()=>{if(ie&&6===ge.length){P(!0);try{const{data:e,error:s}=await u.auth.mfa.challenge({factorId:ie});if(s)throw s;const{error:a}=await u.auth.mfa.verify({factorId:ie,challengeId:e.id,code:ge});if(a)throw a;A(!0),ue("idle"),ve(""),he(null),pe(null),m.success("Two-factor authentication enabled!")}catch(e){m.error("Verification failed",{description:e.message})}finally{P(!1)}}},disabled:6!==ge.length||D,children:D?s.jsx(c,{className:"h-4 w-4 animate-spin"}):"Verify & Enable"})]})]}):null:s.jsxs("div",{className:"text-center py-6",children:[s.jsx(T,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Two-factor authentication is an exclusive premium feature that adds an extra layer of security to your account."}),s.jsxs(l,{className:"btn-luxury gap-2",onClick:Le,children:[s.jsx(N,{className:"h-4 w-4"}),"Upgrade to Premium"]})]})})]})}),s.jsx(Y,{value:"subscription",children:s.jsxs(p,{children:[s.jsx(V,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs(R,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5 text-primary"}),"Subscription"]}),s.jsx(Z,{children:"Manage your Visionary premium subscription"})]}),s.jsx(l,{variant:"ghost",size:"sm",onClick:async()=>{await h(),m.success("Subscription status refreshed")},disabled:d,children:s.jsx(se,{className:"h-4 w-4 "+(d?"animate-spin":"")})})]})}),s.jsxs(g,{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),r?s.jsxs(v,{className:"bg-green-500/10 text-green-500 border-green-500/20",children:[s.jsx(ae,{className:"h-3 w-3 mr-1"}),"Active"]}):s.jsxs(v,{variant:"secondary",className:"bg-muted",children:[s.jsx(te,{className:"h-3 w-3 mr-1"}),"Inactive"]})]}),s.jsx(H,{}),r?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{children:"Renewal Date"})]}),s.jsx("span",{className:"text-sm font-medium",children:Me?O(Me,"MMMM d, yyyy"):"N/A"})]}),ze&&s.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:[s.jsx(ce,{className:"h-4 w-4 text-amber-500"}),s.jsx("span",{className:"text-sm text-amber-500",children:"Your subscription renews in less than 7 days"})]}),s.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"Your Benefits"}),s.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsx("li",{children:"• Unlimited HD downloads"}),s.jsx("li",{children:"• No watermarks on exports"}),s.jsx("li",{children:"• Personal vision gallery"}),s.jsx("li",{children:"• Two-factor authentication"}),s.jsx("li",{children:"• Early access to new features"})]})]}),s.jsxs(l,{variant:"outline",className:"w-full gap-2",onClick:Le,disabled:Ae,children:[Ae?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(G,{className:"h-4 w-4"}),"Manage Subscription"]}),s.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Update payment method, cancel, or view invoices"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/10",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"Premium Benefits"}),s.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsx("li",{children:"• Unlimited HD downloads"}),s.jsx("li",{children:"• No watermarks on exports"}),s.jsx("li",{children:"• Personal vision gallery"}),s.jsx("li",{children:"• Two-factor authentication"}),s.jsx("li",{children:"• Early access to new features"})]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("span",{className:"text-3xl font-bold",children:"$7"}),s.jsx("span",{className:"text-muted-foreground",children:"/month"})]}),s.jsxs(l,{className:"w-full btn-luxury gap-2",onClick:Le,disabled:Ae,children:[Ae?s.jsx(c,{className:"h-4 w-4 animate-spin"}):s.jsx(N,{className:"h-4 w-4"}),"Upgrade to Premium"]}),s.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Cancel anytime. Secure payment via Stripe."})]})]})]})})]})]})}),s.jsx(z,{})]})};export{be as default};
