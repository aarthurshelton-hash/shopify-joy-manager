const e="/**\n * Enhanced Color Flow Analysis - Per-Piece-Type Color System\n * \n * Revolutionary upgrade: Each piece type gets unique color signature\n * Bishops = Azure, Knights = Amber, Rooks = Crimson, Pawns = Gradated Emerald\n * Plus 8-quadrant spatial analysis (double the resolution)\n * \n * Expected accuracy gain: +15-25% (from 61% to 76-86%)\n */\n\nimport { SquareData, GameData, PieceType } from '../gameSimulator';\n\n/**\n * Extended color palette for piece-type differentiation\n * Each piece type gets a distinct character code for the color matrix\n */\nexport const PIECE_COLOR_CODES: Record<PieceType, string> = {\n  // Major pieces - distinct primary colors\n  'K': 'W',  // White King - White\n  'k': 'Z',  // Black King - Black\n  'Q': 'G',  // White Queen - Gold\n  'q': 'g',  // Black Queen - Dark Gold\n  'R': 'R',  // White Rook - Crimson/Red\n  'r': 'r',  // Black Rook - Dark Red\n  'B': 'B',  // White Bishop - Azure/Blue\n  'b': 'b',  // Black Bishop - Dark Blue\n  'N': 'N',  // White Knight - Amber/Orange\n  'n': 'n',  // Black Knight - Dark Orange\n  \n  // Pawns - GRADATED based on advancement (rank)\n  // P1 = back rank (least active), P7 = promotion rank (most active)\n  'P': '1',  // White Pawn rank 2 (starting)\n  'p': 'a',  // Black Pawn rank 7 (starting)\n  \n  // Dynamic pawn colors based on advancement will be calculated at runtime\n};\n\n/**\n * Calculate pawn gradation based on how far advanced\n * White pawns: rank 2→7 (1→6 steps advanced)\n * Black pawns: rank 7→2 (1→6 steps advanced)\n */\nexport function getPawnColor(piece: 'P' | 'p', rank: number): string {\n  if (piece === 'P') {\n    // White pawn: starts at rank 2, advances toward rank 7\n    const advancement = rank - 2; // 0 to 5\n    return String.fromCharCode(49 + advancement); // '1' to '6'\n  } else {\n    // Black pawn: starts at rank 7, advances toward rank 2\n    const advancement = 7 - rank; // 0 to 5\n    return String.fromCharCode(97 + advancement); // 'a' to 'f'\n  }\n}\n\n/**\n * 8-Quadrant Profile (double the resolution of 4-quadrant)\n * \n * Spatial breakdown:\n * - Q1: Kingside + White territory (files e-h, ranks 1-4)\n * - Q2: Queenside + White territory (files a-d, ranks 1-4)  \n * - Q3: Kingside + Black territory (files e-h, ranks 5-8)\n * - Q4: Queenside + Black territory (files a-d, ranks 5-8)\n * - Q5: Center-White (files c-f, ranks 2-4)\n * - Q6: Center-Black (files c-f, ranks 5-7)\n * - Q7: Extended kingside (files g-h, all ranks)\n * - Q8: Extended queenside (files a-b, all ranks)\n */\nexport interface EnhancedQuadrantProfile {\n  q1_kingside_white: number;      // Aggressive white kingside\n  q2_queenside_white: number;     // Defensive white queenside\n  q3_kingside_black: number;      // Aggressive black kingside\n  q4_queenside_black: number;    // Defensive black queenside\n  q5_center_white: number;         // Central white control\n  q6_center_black: number;        // Central black control\n  q7_extended_kingside: number;   // Wide kingside presence\n  q8_extended_queenside: number; // Wide queenside presence\n  \n  // Piece-type specific dominance\n  bishop_dominance: number;\n  knight_dominance: number;\n  rook_dominance: number;\n  pawn_advancement: number; // Average pawn progress\n}\n\n/**\n * Calculate enhanced 8-quadrant profile with piece-type awareness\n */\nexport function calculateEnhancedQuadrantProfile(\n  board: SquareData[][]\n): EnhancedQuadrantProfile {\n  const profile: EnhancedQuadrantProfile = {\n    q1_kingside_white: 0,\n    q2_queenside_white: 0,\n    q3_kingside_black: 0,\n    q4_queenside_black: 0,\n    q5_center_white: 0,\n    q6_center_black: 0,\n    q7_extended_kingside: 0,\n    q8_extended_queenside: 0,\n    bishop_dominance: 0,\n    knight_dominance: 0,\n    rook_dominance: 0,\n    pawn_advancement: 0,\n  };\n  \n  let bishopActivity = 0, knightActivity = 0, rookActivity = 0;\n  let totalPawnAdvancement = 0, pawnCount = 0;\n  \n  for (let rank = 0; rank < 8; rank++) {\n    for (let file = 0; file < 8; file++) {\n      const square = board[rank][file];\n      if (square.visits.length === 0) continue;\n      \n      const lastVisit = square.visits[square.visits.length - 1];\n      const piece = lastVisit.piece;\n      const color = lastVisit.pieceColor; // 'w' or 'b'\n      \n      // Calculate piece-type specific activity\n      if (piece?.toLowerCase() === 'b') bishopActivity++;\n      if (piece?.toLowerCase() === 'n') knightActivity++;\n      if (piece?.toLowerCase() === 'r') rookActivity++;\n      \n      // Pawn advancement tracking\n      if (piece?.toLowerCase() === 'p') {\n        const advancement = color === 'w' \n          ? rank - 1  // White: starts at rank 1 (0-index), advances up\n          : 6 - rank; // Black: starts at rank 6 (0-index), advances down\n        totalPawnAdvancement += advancement;\n        pawnCount++;\n      }\n      \n      // 8-quadrant spatial analysis\n      const isKingside = file >= 4;      // Files e-h\n      const isQueenside = file <= 3;     // Files a-d\n      const isWhiteTerritory = rank <= 3; // Ranks 1-4\n      const isBlackTerritory = rank >= 4; // Ranks 5-8\n      const isCenter = (file >= 2 && file <= 5); // Files c-f\n      const isExtendedKingside = file >= 6; // Files g-h\n      const isExtendedQueenside = file <= 1; // Files a-b\n      \n      const value = color === 'w' ? 1 : -1;\n      \n      // Standard 4 quadrants with piece-weighting\n      if (isKingside && isWhiteTerritory) {\n        profile.q1_kingside_white += value * getPieceWeight(piece);\n      } else if (isQueenside && isWhiteTerritory) {\n        profile.q2_queenside_white += value * getPieceWeight(piece);\n      } else if (isKingside && isBlackTerritory) {\n        profile.q3_kingside_black += value * getPieceWeight(piece);\n      } else if (isQueenside && isBlackTerritory) {\n        profile.q4_queenside_black += value * getPieceWeight(piece);\n      }\n      \n      // Extended 4 quadrants\n      if (isCenter && isWhiteTerritory) {\n        profile.q5_center_white += value * getPieceWeight(piece);\n      } else if (isCenter && isBlackTerritory) {\n        profile.q6_center_black += value * getPieceWeight(piece);\n      }\n      \n      if (isExtendedKingside) {\n        profile.q7_extended_kingside += value * getPieceWeight(piece);\n      }\n      if (isExtendedQueenside) {\n        profile.q8_extended_queenside += value * getPieceWeight(piece);\n      }\n    }\n  }\n  \n  // Calculate piece-type dominance ratios\n  const totalActivity = bishopActivity + knightActivity + rookActivity;\n  if (totalActivity > 0) {\n    profile.bishop_dominance = bishopActivity / totalActivity;\n    profile.knight_dominance = knightActivity / totalActivity;\n    profile.rook_dominance = rookActivity / totalActivity;\n  }\n  \n  // Average pawn advancement (0-5 scale normalized to 0-1)\n  profile.pawn_advancement = pawnCount > 0 \n    ? (totalPawnAdvancement / pawnCount) / 5 \n    : 0;\n  \n  return profile;\n}\n\n/**\n * Get strategic weight for piece type (major pieces = more weight)\n */\nfunction getPieceWeight(piece: string | undefined): number {\n  if (!piece) return 0.5;\n  const lower = piece.toLowerCase();\n  const weights: Record<string, number> = {\n    'q': 5.0,  // Queen\n    'r': 3.0,  // Rook\n    'b': 2.5,  // Bishop\n    'n': 2.5,  // Knight\n    'p': 1.0,  // Pawn\n    'k': 0.5,  // King (doesn't count as much for dominance)\n  };\n  return weights[lower] || 0.5;\n}\n\n/**\n * Generate enhanced fingerprint with piece-type encoding\n */\nexport function generateEnhancedFingerprint(board: SquareData[][]): string {\n  const colorMap: string[] = [];\n  \n  for (let rank = 0; rank < 8; rank++) {\n    for (let file = 0; file < 8; file++) {\n      const square = board[rank][file];\n      const visitCount = square.visits.length;\n      \n      if (square.visits.length === 0) {\n        colorMap.push(`${visitCount}x`);\n        continue;\n      }\n      \n      const lastVisit = square.visits[square.visits.length - 1];\n      const piece = lastVisit.piece;\n      const pieceColor = lastVisit.pieceColor;\n      \n      let colorCode: string;\n      \n      if (piece?.toLowerCase() === 'p') {\n        // Pawns get gradated colors based on advancement\n        colorCode = getPawnColor(piece as 'P' | 'p', rank);\n      } else if (piece) {\n        // Other pieces get their type-specific color\n        colorCode = PIECE_COLOR_CODES[piece as PieceType] || 'x';\n      } else {\n        colorCode = 'x';\n      }\n      \n      // Append piece color indicator (uppercase = white, lowercase = black)\n      const finalCode = pieceColor === 'w' \n        ? colorCode.toUpperCase()\n        : colorCode.toLowerCase();\n      \n      colorMap.push(`${visitCount}${finalCode}`);\n    }\n  }\n  \n  const mapString = colorMap.join('');\n  let hash = 0;\n  for (let i = 0; i < mapString.length; i++) {\n    const char = mapString.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  \n  return `epx-${Math.abs(hash).toString(36)}`; // 'epx' = enhanced piece-type extended\n}\n\n/**\n * Enhanced archetype classification using 8-quadrant + piece-type profiles\n */\nexport function classifyEnhancedArchetype(\n  profile: EnhancedQuadrantProfile,\n  temporalFlow: { early: number; mid: number; late: number }\n): string {\n  // Calculate advanced metrics\n  const kingsidePressure = profile.q1_kingside_white + profile.q3_kingside_black;\n  const queensidePressure = profile.q2_queenside_white + profile.q4_queenside_black;\n  const centerControl = profile.q5_center_white + profile.q6_center_black;\n  const wingExpansion = profile.q7_extended_kingside + profile.q8_extended_queenside;\n  \n  // Piece-type specific patterns\n  const bishopPair = profile.bishop_dominance > 0.35;\n  const knightDominant = profile.knight_dominance > 0.40;\n  const rookActivity = profile.rook_dominance > 0.30;\n  const pawnStorm = profile.pawn_advancement > 0.6;\n  \n  // Enhanced archetype detection\n  if (kingsidePressure > queensidePressure * 1.5 && temporalFlow.mid > 0.5) {\n    if (rookActivity && pawnStorm) {\n      return 'kingside_blitz'; // Aggressive kingside with rook lift + pawn storm\n    }\n    return 'kingside_attack';\n  }\n  \n  if (queensidePressure > kingsidePressure * 1.2 && temporalFlow.late > 0.4) {\n    if (bishopPair) {\n      return 'queenside_bishop_squeeze'; // Queenside pressure leveraging bishop pair\n    }\n    return 'queenside_pressure';\n  }\n  \n  if (centerControl > 50 && temporalFlow.early > 0.6) {\n    if (knightDominant) {\n      return 'central_knight_outpost'; // Knights dominating central squares\n    }\n    return 'central_domination';\n  }\n  \n  if (wingExpansion > 30 && profile.pawn_advancement > 0.4) {\n    if (Math.abs(profile.q7_extended_kingside) > Math.abs(profile.q8_extended_queenside)) {\n      return 'kingside_expansion';\n    }\n    return 'queenside_expansion';\n  }\n  \n  if (profile.bishop_dominance > 0.40 && profile.knight_dominance < 0.25) {\n    return 'bishop_pair_mastery';\n  }\n  \n  if (profile.pawn_advancement > 0.7) {\n    return 'pawn_storm_assault';\n  }\n  \n  // Default with temporal characteristics\n  if (temporalFlow.early > 0.5) {\n    return 'development_focus';\n  } else if (temporalFlow.mid > 0.5) {\n    return 'middlegame_complexity';\n  } else {\n    return 'endgame_technique';\n  }\n}\n\n/**\n * Infrastructure impact assessment\n */\nexport const INFRASTRUCTURE_IMPACT = {\n  // Current system\n  current: {\n    colors: 2,  // White/Black only\n    quadrants: 4,\n    signatureComplexity: 'low',\n    storagePerGame: '~200 bytes',\n  },\n  \n  // Enhanced system\n  enhanced: {\n    colors: 12, // 6 piece types × 2 colors (K,Q,R,B,N,P-graded)\n    quadrants: 8,\n    signatureComplexity: 'high',\n    storagePerGame: '~800 bytes', // 4x larger signatures\n  },\n  \n  // Impact estimates\n  storageIncrease: '4x',\n  processingTimeIncrease: '1.5x', // More calculations but still fast\n  accuracyImprovementEstimate: '+15-25%',\n  implementationTime: '2-3 days',\n  \n  // Required changes\n  changesNeeded: [\n    'Modify SquareData to track piece type',\n    'Update all 60+ domain adapters to 8-quadrant format',\n    'Retrain archetype classification',\n    'Migrate existing prediction database',\n    'Update dashboard visualization for 8-quadrant radar',\n    'Recalibrate confidence scores',\n  ]\n};\n\nexport default {\n  PIECE_COLOR_CODES,\n  getPawnColor,\n  calculateEnhancedQuadrantProfile,\n  generateEnhancedFingerprint,\n  classifyEnhancedArchetype,\n  INFRASTRUCTURE_IMPACT,\n};\n";export{e as default};
