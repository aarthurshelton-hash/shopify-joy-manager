const n='import React from \'react\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { motion } from \'framer-motion\';\nimport { MapPin, Globe, Users, TrendingUp, Clock } from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Progress } from \'@/components/ui/progress\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { formatDistanceToNow } from \'date-fns\';\n\ninterface LocationStats {\n  country: string;\n  country_code: string;\n  user_count: number;\n  percentage: number;\n}\n\ninterface CityStats {\n  city: string;\n  region: string;\n  country: string;\n  user_count: number;\n}\n\nexport const AdminLocationAnalytics: React.FC = () => {\n  // Fetch location analytics\n  const { data: locationData, isLoading } = useQuery({\n    queryKey: [\'admin-location-analytics\'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from(\'user_location_analytics\')\n        .select(\'*\');\n      \n      if (error) throw error;\n      return data || [];\n    },\n  });\n\n  // Process country stats\n  const countryStats: LocationStats[] = React.useMemo(() => {\n    if (!locationData?.length) return [];\n    \n    const countryMap = new Map<string, { count: number; code: string }>();\n    locationData.forEach(loc => {\n      if (loc.country) {\n        const existing = countryMap.get(loc.country) || { count: 0, code: loc.country_code || \'\' };\n        countryMap.set(loc.country, { count: existing.count + 1, code: existing.code });\n      }\n    });\n    \n    const total = locationData.length;\n    return Array.from(countryMap.entries())\n      .map(([country, data]) => ({\n        country,\n        country_code: data.code,\n        user_count: data.count,\n        percentage: (data.count / total) * 100\n      }))\n      .sort((a, b) => b.user_count - a.user_count);\n  }, [locationData]);\n\n  // Process city stats\n  const cityStats: CityStats[] = React.useMemo(() => {\n    if (!locationData?.length) return [];\n    \n    const cityMap = new Map<string, CityStats>();\n    locationData.forEach(loc => {\n      if (loc.city) {\n        const key = `${loc.city}-${loc.region}-${loc.country}`;\n        const existing = cityMap.get(key);\n        if (existing) {\n          existing.user_count++;\n        } else {\n          cityMap.set(key, {\n            city: loc.city,\n            region: loc.region || \'\',\n            country: loc.country || \'\',\n            user_count: 1\n          });\n        }\n      }\n    });\n    \n    return Array.from(cityMap.values())\n      .sort((a, b) => b.user_count - a.user_count)\n      .slice(0, 20);\n  }, [locationData]);\n\n  // Get recent activity\n  const recentLocations = React.useMemo(() => {\n    if (!locationData?.length) return [];\n    return [...locationData]\n      .sort((a, b) => new Date(b.last_seen_at).getTime() - new Date(a.last_seen_at).getTime())\n      .slice(0, 10);\n  }, [locationData]);\n\n  // Get timezone distribution\n  const timezoneStats = React.useMemo(() => {\n    if (!locationData?.length) return [];\n    \n    const tzMap = new Map<string, number>();\n    locationData.forEach(loc => {\n      if (loc.timezone) {\n        tzMap.set(loc.timezone, (tzMap.get(loc.timezone) || 0) + 1);\n      }\n    });\n    \n    return Array.from(tzMap.entries())\n      .map(([tz, count]) => ({ timezone: tz, count }))\n      .sort((a, b) => b.count - a.count)\n      .slice(0, 10);\n  }, [locationData]);\n\n  const getFlagEmoji = (countryCode: string) => {\n    if (!countryCode || countryCode.length !== 2) return \'ðŸŒ\';\n    const codePoints = countryCode\n      .toUpperCase()\n      .split(\'\')\n      .map(char => 127397 + char.charCodeAt(0));\n    return String.fromCodePoint(...codePoints);\n  };\n\n  if (isLoading) {\n    return (\n      <div className="flex items-center justify-center h-64">\n        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary" />\n      </div>\n    );\n  }\n\n  return (\n    <div className="space-y-6">\n      {/* Overview Stats */}\n      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">\n        <Card>\n          <CardContent className="pt-4">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Users className="h-4 w-4" />\n              <span className="text-sm">Tracked Users</span>\n            </div>\n            <p className="text-2xl font-bold">{locationData?.length || 0}</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className="pt-4">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Globe className="h-4 w-4" />\n              <span className="text-sm">Countries</span>\n            </div>\n            <p className="text-2xl font-bold">{countryStats.length}</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className="pt-4">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <MapPin className="h-4 w-4" />\n              <span className="text-sm">Cities</span>\n            </div>\n            <p className="text-2xl font-bold">{cityStats.length}</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className="pt-4">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Clock className="h-4 w-4" />\n              <span className="text-sm">Timezones</span>\n            </div>\n            <p className="text-2xl font-bold">{timezoneStats.length}</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">\n        {/* Country Distribution */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <Globe className="h-5 w-5" />\n              Users by Country\n            </CardTitle>\n            <CardDescription>Geographic distribution of your user base</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className="h-[300px]">\n              <div className="space-y-3">\n                {countryStats.length === 0 ? (\n                  <p className="text-center text-muted-foreground py-8">No location data yet</p>\n                ) : (\n                  countryStats.map((stat, index) => (\n                    <motion.div\n                      key={stat.country}\n                      initial={{ opacity: 0, x: -10 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.05 }}\n                      className="space-y-1"\n                    >\n                      <div className="flex items-center justify-between">\n                        <div className="flex items-center gap-2">\n                          <span className="text-lg">{getFlagEmoji(stat.country_code)}</span>\n                          <span className="font-medium">{stat.country}</span>\n                        </div>\n                        <div className="flex items-center gap-2">\n                          <Badge variant="outline">{stat.user_count} users</Badge>\n                          <span className="text-sm text-muted-foreground w-12 text-right">\n                            {stat.percentage.toFixed(1)}%\n                          </span>\n                        </div>\n                      </div>\n                      <Progress value={stat.percentage} className="h-1.5" />\n                    </motion.div>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n\n        {/* Top Cities */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <MapPin className="h-5 w-5" />\n              Top Cities\n            </CardTitle>\n            <CardDescription>Most active user locations</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className="h-[300px]">\n              <div className="space-y-2">\n                {cityStats.length === 0 ? (\n                  <p className="text-center text-muted-foreground py-8">No city data yet</p>\n                ) : (\n                  cityStats.map((city, index) => (\n                    <motion.div\n                      key={`${city.city}-${city.region}`}\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ delay: index * 0.03 }}\n                      className="flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors"\n                    >\n                      <div className="flex items-center gap-3">\n                        <div className="flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 text-primary text-xs font-bold">\n                          {index + 1}\n                        </div>\n                        <div>\n                          <p className="font-medium">{city.city}</p>\n                          <p className="text-xs text-muted-foreground">\n                            {city.region && `${city.region}, `}{city.country}\n                          </p>\n                        </div>\n                      </div>\n                      <Badge variant="secondary">{city.user_count}</Badge>\n                    </motion.div>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n\n        {/* Recent Activity */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <TrendingUp className="h-5 w-5" />\n              Recent Location Activity\n            </CardTitle>\n            <CardDescription>Latest user location updates</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className="h-[300px]">\n              <div className="space-y-2">\n                {recentLocations.length === 0 ? (\n                  <p className="text-center text-muted-foreground py-8">No recent activity</p>\n                ) : (\n                  recentLocations.map((loc, index) => (\n                    <motion.div\n                      key={loc.id}\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      transition={{ delay: index * 0.05 }}\n                      className="flex items-center justify-between p-2 rounded-lg border border-border/50"\n                    >\n                      <div className="flex items-center gap-2">\n                        <span>{getFlagEmoji(loc.country_code || \'\')}</span>\n                        <div>\n                          <p className="text-sm font-medium">\n                            {loc.city || \'Unknown\'}{loc.region ? `, ${loc.region}` : \'\'}\n                          </p>\n                          <p className="text-xs text-muted-foreground">{loc.country}</p>\n                        </div>\n                      </div>\n                      <span className="text-xs text-muted-foreground">\n                        {formatDistanceToNow(new Date(loc.last_seen_at), { addSuffix: true })}\n                      </span>\n                    </motion.div>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n\n        {/* Timezone Distribution */}\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <Clock className="h-5 w-5" />\n              Timezone Distribution\n            </CardTitle>\n            <CardDescription>When your users are most active</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className="h-[300px]">\n              <div className="space-y-2">\n                {timezoneStats.length === 0 ? (\n                  <p className="text-center text-muted-foreground py-8">No timezone data yet</p>\n                ) : (\n                  timezoneStats.map((tz, index) => (\n                    <motion.div\n                      key={tz.timezone}\n                      initial={{ opacity: 0, x: 10 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.05 }}\n                      className="flex items-center justify-between p-2 rounded-lg hover:bg-muted/50"\n                    >\n                      <span className="text-sm font-medium">{tz.timezone}</span>\n                      <Badge variant="outline">{tz.count} users</Badge>\n                    </motion.div>\n                  ))\n                )}\n              </div>\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n';export{n as default};
