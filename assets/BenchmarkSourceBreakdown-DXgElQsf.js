const n="import { useEffect, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Server, Monitor, Cloud, TrendingUp, Target } from 'lucide-react';\n\ninterface SourceStats {\n  data_source: string;\n  count: number;\n  hybrid_accuracy: number;\n  stockfish_accuracy: number;\n  hybrid_wins: number;\n  stockfish_wins: number;\n}\n\nexport function BenchmarkSourceBreakdown() {\n  const [stats, setStats] = useState<SourceStats[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [totalPredictions, setTotalPredictions] = useState(0);\n\n  useEffect(() => {\n    fetchSourceStats();\n    \n    // Subscribe to realtime updates\n    const channel = supabase\n      .channel('source-stats')\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'chess_prediction_attempts' },\n        () => fetchSourceStats()\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, []);\n\n  async function fetchSourceStats() {\n    try {\n      // Get total count\n      const { count: total } = await supabase\n        .from('chess_prediction_attempts')\n        .select('*', { count: 'exact', head: true });\n      \n      setTotalPredictions(total || 0);\n\n      // Fetch stats by source using a raw query approach\n      const sources = ['web_client', 'farm_terminal', 'lichess_cloud'];\n      const sourceStats: SourceStats[] = [];\n\n      for (const source of sources) {\n        const { count } = await supabase\n          .from('chess_prediction_attempts')\n          .select('*', { count: 'exact', head: true })\n          .eq('data_source', source);\n\n        const { count: hybridCorrect } = await supabase\n          .from('chess_prediction_attempts')\n          .select('*', { count: 'exact', head: true })\n          .eq('data_source', source)\n          .eq('hybrid_correct', true);\n\n        const { count: sfCorrect } = await supabase\n          .from('chess_prediction_attempts')\n          .select('*', { count: 'exact', head: true })\n          .eq('data_source', source)\n          .eq('stockfish_correct', true);\n\n        const { count: hybridWins } = await supabase\n          .from('chess_prediction_attempts')\n          .select('*', { count: 'exact', head: true })\n          .eq('data_source', source)\n          .eq('hybrid_correct', true)\n          .eq('stockfish_correct', false);\n\n        const { count: sfWins } = await supabase\n          .from('chess_prediction_attempts')\n          .select('*', { count: 'exact', head: true })\n          .eq('data_source', source)\n          .eq('stockfish_correct', true)\n          .eq('hybrid_correct', false);\n\n        const totalCount = count || 0;\n        sourceStats.push({\n          data_source: source,\n          count: totalCount,\n          hybrid_accuracy: totalCount > 0 ? ((hybridCorrect || 0) / totalCount) * 100 : 0,\n          stockfish_accuracy: totalCount > 0 ? ((sfCorrect || 0) / totalCount) * 100 : 0,\n          hybrid_wins: hybridWins || 0,\n          stockfish_wins: sfWins || 0,\n        });\n      }\n\n      setStats(sourceStats.sort((a, b) => b.count - a.count));\n    } catch (error) {\n      console.error('Error fetching source stats:', error);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const getSourceIcon = (source: string) => {\n    switch (source) {\n      case 'farm_terminal':\n        return <Server className=\"h-5 w-5 text-blue-500\" />;\n      case 'web_client':\n        return <Monitor className=\"h-5 w-5 text-green-500\" />;\n      case 'lichess_cloud':\n        return <Cloud className=\"h-5 w-5 text-purple-500\" />;\n      default:\n        return <Target className=\"h-5 w-5 text-gray-500\" />;\n    }\n  };\n\n  const getSourceLabel = (source: string) => {\n    switch (source) {\n      case 'farm_terminal':\n        return 'Compute Farm';\n      case 'web_client':\n        return 'Web Dashboard';\n      case 'lichess_cloud':\n        return 'Lichess Cloud';\n      default:\n        return source;\n    }\n  };\n\n  const getSourceColor = (source: string) => {\n    switch (source) {\n      case 'farm_terminal':\n        return 'bg-blue-500';\n      case 'web_client':\n        return 'bg-green-500';\n      case 'lichess_cloud':\n        return 'bg-purple-500';\n      default:\n        return 'bg-gray-500';\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-4 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"h-8 bg-gray-200 rounded\"></div>\n            <div className=\"h-8 bg-gray-200 rounded\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <TrendingUp className=\"h-5 w-5\" />\n          Benchmark Source Breakdown\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          {stats.map((stat) => (\n            <div key={stat.data_source} className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  {getSourceIcon(stat.data_source)}\n                  <span className=\"font-medium\">{getSourceLabel(stat.data_source)}</span>\n                </div>\n                <div className=\"text-right\">\n                  <span className=\"text-2xl font-bold\">{stat.count.toLocaleString()}</span>\n                  <span className=\"text-sm text-gray-500 ml-1\">\n                    ({((stat.count / totalPredictions) * 100).toFixed(1)}%)\n                  </span>\n                </div>\n              </div>\n              \n              <Progress \n                value={(stat.count / totalPredictions) * 100} \n                className=\"h-2\"\n              >\n                <div className={`h-full ${getSourceColor(stat.data_source)} transition-all`} \n                     style={{ width: `${(stat.count / totalPredictions) * 100}%` }} \n                />\n              </Progress>\n\n              {stat.count > 0 && (\n                <div className=\"grid grid-cols-2 gap-4 text-sm pt-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Hybrid Accuracy:</span>\n                    <span className=\"font-medium\">{stat.hybrid_accuracy.toFixed(1)}%</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Stockfish Accuracy:</span>\n                    <span className=\"font-medium\">{stat.stockfish_accuracy.toFixed(1)}%</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Hybrid Wins:</span>\n                    <span className=\"font-medium text-green-600\">{stat.hybrid_wins}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Stockfish Wins:</span>\n                    <span className=\"font-medium text-blue-600\">{stat.stockfish_wins}</span>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n\n          <div className=\"pt-4 border-t\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"font-semibold\">Total Predictions</span>\n              <span className=\"text-2xl font-bold\">{totalPredictions.toLocaleString()}</span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n";export{n as default};
