var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{ap as s,eG as a,b2 as n,b3 as c,r,bA as i,s as l,j as o,a5 as d,af as u,ag as x,L as m,aw as h,a6 as g,bH as j,B as p,aP as f,aK as w,aZ as y,ah as N,aR as b,aS as v,aT as k,aU as A,aV as I,au as P,q as T,t as C,v as S,C as R,w as _,Z as L,b$ as E,a8 as B,W as O,$,d1 as D}from"./index-1k5cZzy0.js";import{A as M,a as G,b as F}from"./alert-BVWwCtCD.js";import{T as U,a as q,b as Y,c as K,d as V,e as z}from"./table-CsUCwZyo.js";import{C as H}from"./circle-alert-D9NCoECY.js";import{W}from"./wifi-off-cvigRrv-.js";import{W as J}from"./wifi-BSy6Ig4J.js";import{B as Q}from"./briefcase-BZAygRsP.js";const X=s("Bolt",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]),Z=s("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]),ee={bridgeUrl:"http://localhost:4000",gatewayHost:"127.0.0.1",gatewayPort:4002,clientId:1};function te(){if("undefined"==typeof window)return ee;const e=localStorage.getItem("ib_gateway_bridge_url");if(e)try{return{...ee,...JSON.parse(e)}}catch{return ee}return ee}function se(){return te().bridgeUrl}const ae={TRADING:{maxRequests:10,windowMs:6e4,blockDurationMs:3e5},MARKET_DATA:{maxRequests:60,windowMs:6e4},ACCOUNT:{maxRequests:30,windowMs:6e4},ORDER_PLACE:{maxRequests:5,windowMs:6e4,blockDurationMs:6e5}};const ne=new class{constructor(){t(this,"store",new Map),t(this,"blockedClients",new Map)}isBlocked(e){const t=this.blockedClients.get(e);return t&&Date.now()<t?{blocked:!0,remainingMs:t-Date.now()}:(t&&this.blockedClients.delete(e),{blocked:!1})}recordRequest(e,t){const s=this.isBlocked(e);if(s.blocked)return{allowed:!1,remaining:0,resetTime:Date.now()+(s.remainingMs||0),blocked:!0,blockDurationMs:s.remainingMs};const a=Date.now(),n=this.store.get(e);return!n||a-n.windowStart>t.windowMs?(this.store.set(e,{count:1,windowStart:a,lastRequest:a}),{allowed:!0,remaining:t.maxRequests-1,resetTime:a+t.windowMs}):n.count>=t.maxRequests?(t.blockDurationMs&&this.blockedClients.set(e,a+t.blockDurationMs),{allowed:!1,remaining:0,resetTime:n.windowStart+t.windowMs,blocked:!0,blockDurationMs:t.blockDurationMs}):(n.count++,n.lastRequest=a,{allowed:!0,remaining:t.maxRequests-n.count,resetTime:n.windowStart+t.windowMs})}cleanup(){const e=Date.now();for(const[t,s]of this.store.entries())e-s.windowStart>36e5&&this.store.delete(t);for(const[t,s]of this.blockedClients.entries())e>s&&this.blockedClients.delete(t)}};function ce(e,t){const s=function(e,t){const s=ae[t],a=ne.recordRequest(e,s);return{limit:s.maxRequests,...a,retryAfter:a.blocked&&a.blockDurationMs?Math.ceil(a.blockDurationMs/1e3):void 0}}(e,t);if(!s.allowed){const e={"X-RateLimit-Limit":String(s.limit),"X-RateLimit-Remaining":"0","X-RateLimit-Reset":String(Math.ceil(s.resetTime/1e3))};return s.retryAfter&&(e["Retry-After"]=String(s.retryAfter)),{error:s.blocked?`Rate limit exceeded. You are temporarily blocked for ${Math.ceil((s.blockDurationMs||0)/1e3)} seconds.`:"Rate limit exceeded. Please try again later.",status:429,headers:e}}return null}setInterval(()=>ne.cleanup(),3e5);const re=n({VITE_SUPABASE_URL:c().url().min(1,"Supabase URL is required"),VITE_SUPABASE_PUBLISHABLE_KEY:c().min(1,"Supabase publishable key is required"),IB_BRIDGE_URL:c().url().optional(),IB_GATEWAY_HOST:c().default("127.0.0.1"),IB_GATEWAY_PORT:c().regex(/^\d+$/).default("4002"),ALPHA_VANTAGE_API_KEY:c().optional(),POLYGON_API_KEY:c().optional(),SLACK_WEBHOOK_URL:c().url().optional()});const ie=new class{constructor(){t(this,"connected",!1),t(this,"clientId");try{!function(){try{return re.parse({VITE_SUPABASE_URL:"https://aufycarwflhsdgszbnop.supabase.co",VITE_SUPABASE_PUBLISHABLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1ZnljYXJ3Zmxoc2Rnc3pibm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODUwOTEsImV4cCI6MjA4MzU2MTA5MX0.uNxFLqJ3BGKkAj1pj77fxnCfDGTcdKFuCIF8HMPYiXw",IB_BRIDGE_URL:void 0,IB_GATEWAY_HOST:void 0,IB_GATEWAY_PORT:void 0,ALPHA_VANTAGE_API_KEY:void 0,POLYGON_API_KEY:void 0,SLACK_WEBHOOK_URL:void 0})}catch(e){if(e instanceof a){const t=e.issues.map(e=>`  - ${e.path.join(".")}: ${e.message}`).join("\n");throw new Error(`Environment validation failed:\n${t}`)}throw e}}(),this.clientId=`${"ib-gateway-client"}:${"trading"}`}catch(e){throw e}}async checkConnection(){try{const e=te(),t=await fetch(`${se()}/api/status`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)return{connected:!1,authenticated:!1,paperTrading:!1};const s=await t.json();return this.connected=!0===s.connected,{connected:!0===s.bridgeRunning,authenticated:!0===s.connected,paperTrading:4002===e.gatewayPort}}catch(e){return{connected:!1,authenticated:!1,paperTrading:!1}}}async connect(){try{const e=te(),t=await fetch(`${se()}/api/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:e.gatewayHost,port:e.gatewayPort,clientId:e.clientId})});if(!t.ok)return!1;const s=await t.json();return this.connected=!0===s.connected,this.connected}catch(e){return!1}}async disconnect(){try{await fetch(`${se()}/api/disconnect`,{method:"POST"}),this.connected=!1}catch{}}async getAccounts(){try{const e=await fetch(`${se()}/api/accounts`);if(!e.ok)return[];return(await e.json()).accounts||[]}catch(e){return[]}}async getPositions(e){try{const t=await fetch(`${se()}/api/positions?accountId=${e}`);if(!t.ok)return[];return(await t.json()).positions||[]}catch(t){return[]}}async getOrders(){try{const e=await fetch(`${se()}/api/orders`);if(!e.ok)return[];return(await e.json()).orders||[]}catch(e){return[]}}async searchContract(e){try{const t=await fetch(`${se()}/api/search?symbol=${encodeURIComponent(e)}`);if(!t.ok)return[];return(await t.json()).contracts||[]}catch(t){return[]}}async placeOrder(e){const t=ce(this.clientId,"ORDER_PLACE");if(t)throw new Error(`Rate limit exceeded: ${t.error}`);try{const t=await fetch(`${se()}/api/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)return null;const s=await t.json();return{orderId:s.orderId||`ib-${Date.now()}`,status:s.status||"submitted"}}catch(s){return null}}async cancelOrder(e){try{return(await fetch(`${se()}/api/orders/${e}`,{method:"DELETE"})).ok}catch(t){return!1}}async getQuote(e){try{const t=await fetch(`${se()}/api/quote?conid=${e}`);if(!t.ok)return null;return await t.json()}catch{return null}}};const le=["SPY","QQQ","AAPL","MSFT","NVDA","TSLA","AMD","META"];function oe(){const{connected:e,authenticated:t,paperTrading:s,accounts:a,selectedAccount:n,positions:c,loading:D,error:Z,checkConnection:ee,connectToGateway:te,refreshData:se,selectAccount:ae}=function(){var e;const[t,s]=r.useState({connected:!1,authenticated:!1,paperTrading:!1,accounts:[],selectedAccount:null,positions:[],orders:[],loading:!0,error:null}),a=r.useRef(null),{toast:n}=i(),c=r.useCallback(async()=>{s(e=>({...e,loading:!0,error:null}));const e=setTimeout(()=>{s(e=>({...e,connected:!1,authenticated:!1,loading:!1,error:"Connection timed out. Ensure the bridge server is running."}))},8e3);try{const t=await ie.checkConnection();return clearTimeout(e),s(e=>({...e,connected:t.connected,authenticated:t.authenticated,paperTrading:t.paperTrading,loading:!1,error:t.connected?t.authenticated?null:'Bridge running but not connected to IB Gateway. Click "Connect to Gateway".':"Bridge not running. Start the local bridge server first."})),t}catch(t){return clearTimeout(e),s(e=>({...e,connected:!1,authenticated:!1,loading:!1,error:`Failed to connect: ${t.message}`})),{connected:!1,authenticated:!1,paperTrading:!1}}},[]),l=r.useCallback(async()=>{s(e=>({...e,loading:!0,error:null}));try{const e=await ie.connect();return e?(n({title:"Connected",description:"Successfully connected to IB Gateway"}),await c(),await o()):s(e=>({...e,loading:!1,error:"Failed to connect. Ensure IB Gateway is running and API is enabled."})),e}catch(e){return s(t=>({...t,loading:!1,error:`Connection failed: ${e.message}`})),!1}},[n,c]),o=r.useCallback(async()=>{const e=await ie.getAccounts(),t=e.find(e=>e.accountId.startsWith("DU")||e.accountType.toLowerCase().includes("paper"));return s(s=>({...s,accounts:e,selectedAccount:t||e[0]||null})),e},[]),d=r.useCallback(async()=>{if(!t.selectedAccount)return[];const e=await ie.getPositions(t.selectedAccount.accountId);return s(t=>({...t,positions:e})),e},[t.selectedAccount]),u=r.useCallback(async()=>{const e=await ie.getOrders();return s(t=>({...t,orders:e})),e},[]),x=r.useCallback(async()=>{t.authenticated&&await Promise.all([o(),d(),u()])},[t.authenticated,o,d,u]),m=r.useCallback(async e=>{if(!t.selectedAccount)return n({title:"No Account Selected",description:"Please select an account first.",variant:"destructive"}),null;const s=await ie.searchContract(e.symbol);if(0===s.length)return n({title:"Symbol Not Found",description:`Could not find contract for ${e.symbol}`,variant:"destructive"}),null;const a=s[0],c=await ie.placeOrder({accountId:t.selectedAccount.accountId,conid:a.conid,symbol:e.symbol,side:e.side,quantity:e.quantity,orderType:e.orderType,price:e.price});return c?(n({title:"Order Placed",description:`${e.side} ${e.quantity} ${e.symbol} - ${c.status}`}),await u()):n({title:"Order Failed",description:"Could not place order. Check gateway connection.",variant:"destructive"}),c},[t.selectedAccount,n,u]),h=r.useCallback(async e=>{const t=await ie.cancelOrder(e);return t&&(n({title:"Order Cancelled",description:`Order ${e} has been cancelled.`}),await u()),t},[n,u]),g=r.useCallback(e=>{const a=t.accounts.find(t=>t.accountId===e);a&&s(e=>({...e,selectedAccount:a}))},[t.accounts]);return r.useEffect(()=>((async()=>{(await c()).authenticated&&(await o(),await d(),await u(),a.current=setInterval(()=>{x()},1e4))})(),()=>{a.current&&clearInterval(a.current)}),[]),r.useEffect(()=>{t.selectedAccount&&t.authenticated&&d()},[null==(e=t.selectedAccount)?void 0:e.accountId]),{...t,checkConnection:c,connectToGateway:l,loadAccounts:o,loadPositions:d,loadOrders:u,refreshData:x,placeOrder:m,cancelOrder:h,selectAccount:g}}(),[ne,ce]=r.useState("overview"),[re,oe]=r.useState([]),[de,ue]=r.useState(!1),[xe,me]=r.useState([]),[he,ge]=r.useState({total:0,today:0,pnl:0}),[je,pe]=r.useState(!1),[fe,we]=r.useState({symbol:"SPY",side:"BUY",quantity:1,orderType:"MKT",price:0}),[ye,Ne]=r.useState(!1);r.useEffect(()=>{const e=async()=>{try{const{data:e}=await l.from("farm_status").select("*").eq("farm_name","high-frequency-paper-trader").single();if(e){const t=new Date(e.updated_at),s=t>new Date(Date.now()-12e4);pe("trading"===e.status||s)}const{data:t}=await l.from("autonomous_trades").select("*").order("created_at",{ascending:!1}).limit(50);if(t){me(t);const e=new Date;e.setHours(0,0,0,0);const s=t.filter(t=>new Date(t.created_at)>=e),a=t.reduce((e,t)=>e+(t.pnl||0),0);ge({total:t.length,today:s.length,pnl:a})}}catch(e){}};e();const t=l.channel("hf-trades").on("postgres_changes",{event:"INSERT",schema:"public",table:"autonomous_trades"},e=>{const t=e.new;me(e=>[t,...e].slice(0,50));const s=new Date;s.setHours(0,0,0,0);const a=new Date(t.created_at)>=s;ge(e=>({total:e.total+1,today:a?e.today+1:e.today,pnl:e.pnl+(t.pnl||0)}))}).subscribe(),s=setInterval(e,5e3);return()=>{clearInterval(s),t.unsubscribe()}},[]),r.useCallback(()=>{ee()},[ee]),r.useEffect(()=>{if(t){be();const e=setInterval(be,3e4);return()=>clearInterval(e)}},[t]);const be=async()=>{ue(!0);try{const{data:e,error:t}=await l.functions.invoke("stock-data",{body:{action:"batch",symbols:le}});!t&&(null==e?void 0:e.stocks)&&oe(e.stocks.map(e=>({symbol:e.symbol,price:e.latestPrice,change:e.change,changePercent:e.changePercent})))}catch(e){}finally{ue(!1)}},ve=e=>{we(t=>({...t,symbol:e,side:"BUY"})),ce("trade")},ke=r.useMemo(()=>{const e=c.reduce((e,t)=>e+t.marketValue,0),t=c.reduce((e,t)=>e+t.unrealizedPnl,0);return{totalValue:e,totalPnL:t,totalRealizedPnL:c.reduce((e,t)=>e+t.realizedPnl,0),pnlPercent:(null==n?void 0:n.balance)?t/n.balance*100:0}},[c,n]);return D?o.jsxs(d,{children:[o.jsxs(u,{children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs(x,{className:"flex items-center gap-2",children:[o.jsx(m,{className:"h-5 w-5 animate-spin text-primary"}),"Connecting to IB Gateway Bridge..."]})}),o.jsx(h,{children:"Checking connection to gateway"})]}),o.jsxs(g,{className:"space-y-4",children:[o.jsx(j,{value:33,className:"h-2"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Looking for the Client Portal Gateway..."}),o.jsxs(M,{children:[o.jsx(H,{className:"h-4 w-4"}),o.jsx(G,{children:"Connection taking too long?"}),o.jsxs(F,{className:"space-y-2 mt-2",children:[o.jsx("p",{children:"Your browser may be blocking the connection. Try:"}),o.jsxs("ol",{className:"list-decimal list-inside text-sm space-y-1",children:[o.jsxs("li",{children:["Click ",o.jsx("strong",{children:"Gateway Settings"})," above to configure your gateway URL"]}),o.jsx("li",{children:"If using remotely, enter your machine's IP (e.g., https://192.168.1.100:5000)"}),o.jsxs("li",{children:["Accept the ",o.jsx("strong",{children:"self-signed certificate warning"})," in your browser"]}),o.jsx("li",{children:"Login if prompted, then return here"})]})]})]}),o.jsxs(p,{variant:"outline",size:"sm",onClick:()=>window.open("https://localhost:5000","_blank"),children:[o.jsx(f,{className:"h-4 w-4 mr-2"}),"Open Gateway in New Tab"]})]})]}):e?t?o.jsxs("div",{className:"space-y-6",children:[o.jsx(d,{className:"bg-gradient-to-br from-card via-card to-primary/5 border-primary/20",children:o.jsxs(g,{className:"pt-6",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(y,{className:"h-5 w-5 text-primary"}),o.jsx("span",{className:"font-medium",children:"IBKR Connected"}),s&&o.jsx(N,{variant:"outline",className:"bg-primary/10 text-primary border-primary",children:"Paper Trading"})]}),o.jsxs(b,{value:(null==n?void 0:n.accountId)||"",onValueChange:ae,children:[o.jsx(v,{className:"w-48",children:o.jsx(k,{placeholder:"Select Account"})}),o.jsx(A,{children:a.map(e=>o.jsxs(I,{value:e.accountId,children:[e.accountId," (",e.accountType,")"]},e.accountId))})]}),o.jsx(p,{variant:"ghost",size:"icon",onClick:se,children:o.jsx(w,{className:"h-4 w-4"})})]}),n&&o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[o.jsx(P,{className:"w-3 h-3"}),"Account Balance"]}),o.jsxs("div",{className:"text-3xl font-mono font-bold",children:["$",n.balance.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Buying Power"}),o.jsxs("div",{className:"text-xl font-mono",children:["$",n.buyingPower.toLocaleString("en-US",{minimumFractionDigits:2})]})]})]})]}),c.length>0&&o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Positions Value"}),o.jsxs("div",{className:"text-xl font-bold",children:["$",ke.totalValue.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Unrealized P&L"}),o.jsxs("div",{className:"text-xl font-bold "+(ke.totalPnL>=0?"text-success":"text-destructive"),children:[ke.totalPnL>=0?"+":"","$",ke.totalPnL.toFixed(2)]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Realized P&L"}),o.jsxs("div",{className:"text-xl font-bold "+(ke.totalRealizedPnL>=0?"text-success":"text-destructive"),children:[ke.totalRealizedPnL>=0?"+":"","$",ke.totalRealizedPnL.toFixed(2)]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Open Positions"}),o.jsx("div",{className:"text-xl font-bold",children:c.length})]})]})]})}),o.jsxs(T,{value:ne,onValueChange:ce,children:[o.jsxs(C,{className:"grid w-full grid-cols-2 max-w-md",children:[o.jsxs(S,{value:"overview",className:"flex items-center gap-1",children:[o.jsx(R,{className:"w-4 h-4"})," Overview"]}),o.jsxs(S,{value:"hf-trading",className:"flex items-center gap-1",children:[o.jsx(X,{className:"w-4 h-4"})," HF Trading",je&&o.jsx("span",{className:"ml-1 w-2 h-2 bg-success rounded-full animate-pulse"})]})]}),o.jsx(_,{value:"overview",className:"mt-6",children:o.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[o.jsxs(d,{children:[o.jsxs(u,{children:[o.jsxs(x,{className:"flex items-center gap-2",children:[o.jsx(L,{className:"w-5 h-5"}),"Quick Trade"]}),o.jsx(h,{children:"Click a symbol to start a trade"})]}),o.jsxs(g,{children:[o.jsx("div",{className:"grid grid-cols-4 gap-2",children:re.length>0?re.map(e=>o.jsxs(p,{variant:"outline",className:"flex flex-col h-auto py-3 hover:border-primary",onClick:()=>ve(e.symbol),children:[o.jsx("span",{className:"font-bold",children:e.symbol}),o.jsxs("span",{className:"text-sm",children:["$",e.price.toFixed(2)]}),o.jsxs("span",{className:"text-xs "+(e.changePercent>=0?"text-success":"text-destructive"),children:[e.changePercent>=0?"+":"",e.changePercent.toFixed(2),"%"]})]},e.symbol)):le.map(e=>o.jsx(p,{variant:"outline",className:"py-6",onClick:()=>ve(e),children:e},e))}),de&&o.jsx("div",{className:"text-center text-sm text-muted-foreground mt-2",children:"Updating quotes..."})]})]}),o.jsxs(d,{children:[o.jsx(u,{children:o.jsxs(x,{className:"flex items-center gap-2",children:[o.jsx(Q,{className:"w-5 h-5"}),"Current Positions"]})}),o.jsx(g,{children:0===c.length?o.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[o.jsx(E,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"No open positions"}),o.jsx("p",{className:"text-sm",children:"Place a trade to get started"})]}):o.jsxs("div",{className:"space-y-3",children:[c.slice(0,5).map(e=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:e.symbol}),o.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.position>0?"+":"",e.position," shares @ $",e.avgCost.toFixed(2)]})]}),o.jsxs("div",{className:"text-right "+(e.unrealizedPnl>=0?"text-success":"text-destructive"),children:[o.jsxs("div",{className:"font-medium",children:[e.unrealizedPnl>=0?"+":"","$",e.unrealizedPnl.toFixed(2)]}),o.jsxs("div",{className:"text-sm",children:["$",e.marketValue.toFixed(2)]})]})]},e.conid)),c.length>5&&o.jsxs(p,{variant:"ghost",className:"w-full",onClick:()=>ce("positions"),children:["View all ",c.length," positions"]})]})})]})]})}),o.jsx(_,{value:"hf-trading",className:"mt-6",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs(d,{className:"border-2 "+(je?"border-warning bg-warning/5":"border-dashed"),children:[o.jsx(u,{children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"p-3 rounded-full "+(je?"bg-warning/20":"bg-muted"),children:o.jsx(X,{className:"w-6 h-6 "+(je?"text-warning animate-pulse":"text-muted-foreground")})}),o.jsxs("div",{children:[o.jsxs(x,{className:"flex items-center gap-2",children:["High-Frequency Paper Trading",je&&o.jsxs(N,{className:"bg-warning text-warning-foreground",children:[o.jsx(E,{className:"w-3 h-3 mr-1 animate-pulse"}),"LIVE"]})]}),o.jsx(h,{children:"Terminal-based worker generating 100+ trades/day for En Pensent training"})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("div",{className:"text-sm text-muted-foreground",children:"Worker Status"}),o.jsx("div",{className:"font-medium "+(je?"text-warning":"text-muted-foreground"),children:je?"RUNNING":"OFFLINE"})]})]})}),o.jsxs(g,{children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold font-mono",children:he.total}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Trades"})]}),o.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold font-mono",children:he.today}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Today's Trades"})]}),o.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[o.jsxs("div",{className:"text-3xl font-bold font-mono "+(he.pnl>=0?"text-success":"text-destructive"),children:[he.pnl>=0?"+":"","$",he.pnl.toFixed(2)]}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Total P&L"})]}),o.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[o.jsx("div",{className:"text-3xl font-bold font-mono text-warning",children:je?"30s":"N/A"}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Cycle Time"})]})]}),o.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-muted-foreground",children:[o.jsx(B,{className:"w-4 h-4"}),o.jsx("span",{children:"Auto-refresh every 5 seconds from Supabase"}),o.jsx("span",{className:"mx-2",children:"•"}),o.jsx("span",{children:"11 symbols: AAPL, MSFT, NVDA, TSLA, AMD, META, GOOGL, AMZN, SPY, QQQ, IWM"})]})]})]}),o.jsxs(d,{children:[o.jsxs(u,{children:[o.jsxs(x,{className:"flex items-center gap-2",children:[o.jsx(E,{className:"w-5 h-5"}),"Live Trade Feed",xe.length>0&&o.jsxs(N,{variant:"secondary",children:[xe.length," recent"]})]}),o.jsx(h,{children:"Real-time trades from high-frequency worker (updates every 5s)"})]}),o.jsx(g,{children:0===xe.length?o.jsxs("div",{className:"text-center text-muted-foreground py-12",children:[o.jsx(X,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),o.jsx("p",{className:"text-lg",children:"No trades yet"}),o.jsx("p",{className:"text-sm",children:"Start the high-frequency worker to see activity"}),o.jsx("code",{className:"block mt-4 p-2 bg-muted rounded text-xs",children:"node farm/workers/high-frequency-paper-trader.mjs"})]}):o.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:xe.map(e=>{var t;return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:["BUY"===e.direction?o.jsx(O,{className:"w-4 h-4 text-success"}):o.jsx($,{className:"w-4 h-4 text-destructive"}),o.jsxs("div",{children:[o.jsx("div",{className:"font-bold",children:e.symbol}),o.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString()})]}),o.jsx(N,{variant:"BUY"===e.direction?"default":"destructive",children:e.direction}),o.jsxs(N,{variant:"outline",className:"text-xs",children:[e.shares," shares"]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"font-mono",children:["$",null==(t=e.entry_price)?void 0:t.toFixed(2)]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:"Entry"})]}),e.predicted_confidence&&o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"font-mono",children:[(100*e.predicted_confidence).toFixed(0),"%"]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:"Conf"})]}),void 0!==e.pnl&&null!==e.pnl&&o.jsxs("div",{className:"text-right font-mono "+(e.pnl>=0?"text-success":"text-destructive"),children:[o.jsxs("div",{children:[e.pnl>=0?"+":"","$",e.pnl.toFixed(2)]}),o.jsx("div",{className:"text-xs",children:"P&L"})]}),o.jsx(N,{variant:"outline",className:"open"===e.status?"bg-success/10 text-success":"bg-muted",children:e.status})]})]},e.id)})})})]}),xe.filter(e=>"open"===e.status).length>0&&o.jsxs(d,{children:[o.jsx(u,{children:o.jsxs(x,{className:"text-lg flex items-center gap-2",children:[o.jsx(Q,{className:"w-5 h-5"}),"Open HF Positions"]})}),o.jsx(g,{children:o.jsxs(U,{children:[o.jsx(q,{children:o.jsxs(Y,{children:[o.jsx(K,{children:"Symbol"}),o.jsx(K,{children:"Side"}),o.jsx(K,{className:"text-right",children:"Shares"}),o.jsx(K,{className:"text-right",children:"Entry"}),o.jsx(K,{className:"text-right",children:"Stop Loss"}),o.jsx(K,{className:"text-right",children:"Take Profit"}),o.jsx(K,{children:"Status"})]})}),o.jsx(V,{children:xe.filter(e=>"open"===e.status).map(e=>{var t,s,a;return o.jsxs(Y,{children:[o.jsx(z,{className:"font-bold",children:e.symbol}),o.jsx(z,{children:o.jsx(N,{variant:"BUY"===e.direction?"default":"destructive",children:e.direction})}),o.jsx(z,{className:"text-right font-mono",children:e.shares}),o.jsxs(z,{className:"text-right font-mono",children:["$",null==(t=e.entry_price)?void 0:t.toFixed(2)]}),o.jsxs(z,{className:"text-right font-mono text-destructive",children:["$",(null==(s=e.stop_loss)?void 0:s.toFixed(2))||"N/A"]}),o.jsxs(z,{className:"text-right font-mono text-success",children:["$",(null==(a=e.take_profit)?void 0:a.toFixed(2))||"N/A"]}),o.jsx(z,{children:o.jsx(N,{variant:"outline",className:"bg-success/10 text-success border-success/30",children:"Open"})})]},e.id)})})]})})]})]})})]})]}):o.jsxs(d,{className:"border-warning/50",children:[o.jsx(u,{children:o.jsxs(x,{className:"flex items-center gap-2 text-warning",children:[o.jsx(J,{className:"h-5 w-5"}),"Gateway Running - Login Required"]})}),o.jsxs(g,{className:"space-y-4",children:[o.jsxs(M,{variant:"default",children:[o.jsx(H,{className:"h-4 w-4"}),o.jsx(F,{children:'Bridge is running but not connected to IB Gateway. Open IB Gateway desktop app, log in, then click "Connect to Gateway".'})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(p,{onClick:te,className:"flex-1",children:[o.jsx(J,{className:"h-4 w-4 mr-2"}),"Connect to Gateway"]}),o.jsxs(p,{variant:"outline",onClick:ee,children:[o.jsx(w,{className:"h-4 w-4 mr-2"}),"Check Status"]})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"IB Gateway must be running with API enabled (port 4002 for paper trading)."})]})]}):o.jsxs(d,{className:"border-destructive/50",children:[o.jsxs(u,{children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs(x,{className:"flex items-center gap-2 text-destructive",children:[o.jsx(W,{className:"h-5 w-5"}),"IB Gateway Bridge Not Running"]})}),o.jsx(h,{children:Z||"Start the IBKR Client Portal Gateway to begin trading."})]}),o.jsxs(g,{className:"space-y-4",children:[o.jsxs(M,{children:[o.jsx(H,{className:"h-4 w-4"}),o.jsx(G,{children:"Quick Setup"}),o.jsx(F,{className:"space-y-2",children:o.jsxs("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[o.jsxs("li",{children:["Download the ",o.jsx("a",{href:"https://www.interactivebrokers.com/en/trading/ib-api.php",target:"_blank",rel:"noopener",className:"text-primary underline font-medium",children:"IBKR Client Portal Gateway"})]}),o.jsxs("li",{children:["Run ",o.jsx("code",{className:"bg-muted px-1 rounded text-sm",children:"bin/run.sh"})," (Mac) or ",o.jsx("code",{className:"bg-muted px-1 rounded text-sm",children:"bin/run.bat"})," (Windows)"]}),o.jsxs("li",{children:["Login at ",o.jsx("strong",{children:"https://localhost:5000"})," with IBKR credentials"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Using remote access?"})," Click Gateway Settings above and enter your machine's IP"]})]})})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(p,{onClick:ee,className:"flex-1",children:[o.jsx(w,{className:"h-4 w-4 mr-2"}),"Retry Connection"]}),o.jsxs(p,{variant:"outline",onClick:()=>window.open("https://localhost:5000","_blank"),children:[o.jsx(f,{className:"h-4 w-4 mr-2"}),"Open Gateway"]})]})]})]})}const de=()=>o.jsxs("div",{className:"container mx-auto py-8 px-4",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[o.jsx(Z,{className:"w-8 h-8 text-primary"}),o.jsxs("h1",{className:"text-4xl font-bold",children:[o.jsx("span",{className:"text-primary",children:"En Pensent™"})," Trading"]})]}),o.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Paper trading powered by Interactive Brokers. Start with simulated funds, graduate to real money when ready."})]}),o.jsx(D,{componentName:"IBKRTradingDashboard",children:o.jsx(oe,{})}),o.jsx("p",{className:"text-center text-xs text-muted-foreground mt-8",children:"⚠️ Paper trading uses simulated funds. No real money is at risk. When ready, switch to a live IBKR account for real trading."})]});export{de as default};
