import{r as e,a0 as s,a1 as t,a2 as a,j as r,x as i,I as n,a3 as c,D as o,E as l,d,a4 as m}from"./index-1k5cZzy0.js";const p={k:{w:"â™š",b:"â™”"},q:{w:"â™›",b:"â™•"},r:{w:"â™œ",b:"â™–"},b:{w:"â™",b:"â™—"},n:{w:"â™ž",b:"â™˜"},p:{w:"â™Ÿ",b:"â™™"}},x={k:"King",q:"Queen",r:"Rook",b:"Bishop",n:"Knight",p:"Pawn"},h=({whitePalette:h,blackPalette:g,moveHistory:u=[],compact:y=!1,title:b="Color Legend"})=>{const[f,j]=e.useState(!1),[w,N]=e.useState(!1),{setShowTerritory:k,setLockedPieces:v}=s();e.useEffect(()=>{k(w)},[w,k]);let $=null;try{$=t()}catch{}const{hoveredSquare:C,setHighlightedPiece:q,highlightedPiece:P,lockedPieces:M=[],toggleLockedPiece:S,clearLock:B}=$||{hoveredSquare:null,setHighlightedPiece:()=>{},highlightedPiece:null,lockedPieces:[],toggleLockedPiece:()=>{},clearLock:()=>{}},L=e.useMemo(()=>{const e=new Map,s=["k","q","r","b","n","p"],t=["w","b"];for(const a of t)for(const t of s)e.set(`${a}-${t}`,0);for(const a of u){const s=`${a.color}-${a.piece}`;e.set(s,(e.get(s)||0)+1)}return e},[u]),T=e.useMemo(()=>{const e=Array(8).fill(null).map(()=>Array(8).fill(0)),s=Array(8).fill(null).map(()=>Array(8).fill(0));let t=0,a=0;for(const c of u){const r=c.square.charCodeAt(0)-97,i=parseInt(c.square[1])-1;r>=0&&r<8&&i>=0&&i<8&&("w"===c.color?(e[7-i][r]++,t=Math.max(t,e[7-i][r])):(s[7-i][r]++,a=Math.max(a,s[7-i][r])))}let r=0,i=0;for(let c=0;c<8;c++)for(let t=0;t<8;t++)r+=e[c][t],i+=s[c][t];const n=r+i||1;return{whiteControl:e,blackControl:s,maxWhite:t||1,maxBlack:a||1,whitePercent:Math.round(r/n*100),blackPercent:Math.round(i/n*100)}},[u]),W=e.useMemo(()=>{if(0===u.length)return null;const e={q1:0,q2:0,q3:0,q4:0},s=u.length;for(const n of u){const s=n.square.charCodeAt(0)-97,t=parseInt(n.square[1])-1;s>=0&&s<8&&t>=0&&t<8&&(t>=4&&s<4?e.q1++:t>=4&&s>=4?e.q2++:t<4&&s<4?e.q3++:e.q4++)}s>0&&(e.q1/=s,e.q2/=s,e.q3/=s,e.q4/=s);const t=T.whitePercent/100,a={opening:Math.min(1,10/s),middle:s>10?Math.min(1,(s-10)/30):0,ending:s>40?Math.min(1,(s-40)/20):0,trend:t>.55?"accelerating":t<.45?"declining":"stable",momentum:2*(t-.5)},r=Math.min(1,s/80),i=t>.55?"primary":t<.45?"secondary":"balanced";return{fingerprint:`live-${Date.now()}`,archetype:"unknown",dominantForce:i,flowDirection:a.momentum>0?"forward":a.momentum<0?"backward":"lateral",intensity:r,quadrantProfile:e,temporalFlow:a,criticalMoments:[]}},[u,T]);e.useMemo(()=>W?a(W):null,[W]);const A=null!==C||M.length>0||null!==P,D=(e,s)=>!!C&&C.pieces.some(t=>t.pieceType===e&&t.pieceColor===s),H=(e,s)=>(null==P?void 0:P.pieceType)===e&&(null==P?void 0:P.pieceColor)===s,E=(e,s)=>M.some(t=>t.pieceType===e&&t.pieceColor===s),I=()=>{q&&0===M.length&&q(null)},F=(e,s)=>{const t="w"===e?h:g;return r.jsxs("div",{className:"space-y-1.5",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-[10px] font-display uppercase tracking-wider "+("w"===e?"text-sky-400":"text-rose-400"),children:["w"===e?"ðŸ‘‘":"ðŸ–¤"," ",s]})}),r.jsx("div",{className:`grid ${y?"grid-cols-6":"grid-cols-3"} gap-1`,children:["k","q","r","b","n","p"].map(s=>{const a=D(s,e),n=H(s,e),c=E(s,e),l=(m=s,h=e,!(!A||(C?D(m,h):M.length>0?E(m,h):!P||H(m,h))));var m,h;const g=a||n||c,u=L.get(`${e}-${s}`)||0,b=t[s]||"#888";return r.jsxs(i.div,{className:`\n                  relative flex items-center gap-1.5 p-1.5 rounded-md transition-all cursor-pointer\n                  touch-manipulation select-none\n                  ${g?"bg-primary/20 ring-2 ring-primary shadow-lg":"hover:bg-accent/30"}\n                  ${a?"ring-2 ring-amber-400 bg-amber-400/20":""}\n                  ${c?"ring-2 ring-sky-400 bg-sky-400/20":""}\n                  ${l?"opacity-20":"opacity-100"}\n                `,onMouseEnter:()=>((e,s)=>{q&&0===M.length&&q({pieceType:e,pieceColor:s})})(s,e),onMouseLeave:I,onClick:()=>((e,s)=>{S&&S({pieceType:e,pieceColor:s})})(s,e),animate:{scale:g?1.05:1,opacity:l?.2:1},transition:{duration:.2},children:[r.jsx("div",{className:"w-4 h-4 rounded shadow-sm shrink-0 transition-transform "+(g?"scale-110 ring-1 ring-white/50":""),style:{backgroundColor:b}}),r.jsx("span",{className:"text-base shrink-0",style:{color:b},children:p[s][e]}),!y&&r.jsx("span",{className:"text-[10px] text-muted-foreground truncate",children:x[s]}),u>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-primary text-[8px] font-bold text-primary-foreground flex items-center justify-center",children:u>99?"99+":u}),c&&r.jsx("span",{className:"absolute -top-1 -left-1 w-4 h-4 rounded-full bg-sky-500 flex items-center justify-center",children:r.jsx(d,{className:"w-2 h-2 text-white"})}),r.jsx(o,{children:a&&r.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 rounded-md pointer-events-none",style:{boxShadow:`0 0 12px 2px ${b}80`}})})]},`${e}-${s}`)})})]})};return f?r.jsxs(i.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>j(!1),className:"p-2 rounded-lg bg-card/80 backdrop-blur-sm border border-border/50 flex items-center gap-2 hover:bg-accent/30 transition-colors",children:[r.jsx(n,{className:"w-4 h-4 text-primary"}),r.jsx("span",{className:"text-xs font-display uppercase tracking-wider",children:"Legend"})]}):r.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 rounded-lg bg-card/80 backdrop-blur-sm border border-border/50 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:"text-xs font-display font-semibold uppercase tracking-wider flex items-center gap-1.5",children:[r.jsx(n,{className:"w-3 h-3 text-primary"}),b]}),r.jsxs("div",{className:"flex items-center gap-2",children:[u.length>0&&r.jsxs("span",{className:"text-[10px] text-muted-foreground font-mono",children:[u.length," moves"]}),M.length>0&&r.jsx("button",{onClick:B,className:"p-1 rounded hover:bg-accent/50 transition-colors",title:"Clear selection",children:r.jsx(c,{className:"w-3 h-3 text-muted-foreground"})})]})]}),r.jsxs(o,{mode:"wait",children:[C&&r.jsxs(i.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-[10px] text-amber-400 text-center bg-amber-400/10 rounded px-2 py-1",children:[r.jsx(l,{className:"w-3 h-3 inline mr-1"}),"Pieces on ",r.jsx("span",{className:"font-mono font-bold",children:C.square})]},"square-hint"),M.length>0&&!C&&r.jsxs(i.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-[10px] text-sky-400 text-center bg-sky-400/10 rounded px-2 py-1",children:[r.jsx(d,{className:"w-3 h-3 inline mr-1"}),M.length," piece",M.length>1?"s":""," locked â€¢ tap to toggle"]},"lock-hint")]}),r.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[r.jsxs("button",{onClick:()=>N(!1),className:"flex-1 flex items-center justify-center gap-1 py-1.5 rounded text-[10px] font-medium transition-colors "+(w?"text-muted-foreground hover:bg-accent/30":"bg-primary/20 text-primary"),children:[r.jsx(l,{className:"w-3 h-3"}),"Show Pieces"]}),r.jsxs("button",{onClick:()=>N(!0),className:"flex-1 flex items-center justify-center gap-1 py-1.5 rounded text-[10px] font-medium transition-colors "+(w?"bg-primary/20 text-primary":"text-muted-foreground hover:bg-accent/30"),children:[r.jsx(m,{className:"w-3 h-3"}),"Territory"]})]}),r.jsx(o,{mode:"wait",children:w?r.jsxs(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"space-y-3",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-[10px]",children:[r.jsxs("span",{className:"text-sky-400 font-semibold",children:["ðŸ‘‘ White ",T.whitePercent,"%"]}),r.jsxs("span",{className:"text-rose-400 font-semibold",children:["ðŸ–¤ Black ",T.blackPercent,"%"]})]}),r.jsxs("div",{className:"h-2 rounded-full overflow-hidden bg-muted/50 flex",children:[r.jsx(i.div,{className:"h-full bg-gradient-to-r from-sky-500 to-sky-400",initial:{width:0},animate:{width:`${T.whitePercent}%`},transition:{duration:.5,ease:"easeOut"}}),r.jsx(i.div,{className:"h-full bg-gradient-to-r from-rose-400 to-rose-500",initial:{width:0},animate:{width:`${T.blackPercent}%`},transition:{duration:.5,ease:"easeOut"}})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-[9px] text-sky-400 font-display uppercase tracking-wider",children:"White Control"}),r.jsx("div",{className:"aspect-square grid grid-cols-8 gap-px bg-border/30 rounded overflow-hidden",children:T.whiteControl.map((e,s)=>e.map((e,t)=>{const a=e/T.maxWhite;return r.jsx("div",{className:"aspect-square transition-colors",style:{backgroundColor:a>0?`rgba(56, 189, 248, ${.2+.8*a})`:(s+t)%2==0?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.1)"},title:`${String.fromCharCode(97+t)}${8-s}: ${e} visits`},`w-${s}-${t}`)}))})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-[9px] text-rose-400 font-display uppercase tracking-wider",children:"Black Control"}),r.jsx("div",{className:"aspect-square grid grid-cols-8 gap-px bg-border/30 rounded overflow-hidden",children:T.blackControl.map((e,s)=>e.map((e,t)=>{const a=e/T.maxBlack;return r.jsx("div",{className:"aspect-square transition-colors",style:{backgroundColor:a>0?`rgba(251, 113, 133, ${.2+.8*a})`:(s+t)%2==0?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.1)"},title:`${String.fromCharCode(97+t)}${8-s}: ${e} visits`},`b-${s}-${t}`)}))})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-[9px] text-muted-foreground font-display uppercase tracking-wider",children:"Combined Dominance"}),r.jsx("div",{className:"aspect-[2/1] grid grid-cols-8 gap-px bg-border/30 rounded overflow-hidden",children:T.whiteControl.map((e,s)=>e.map((e,t)=>{const a=T.blackControl[s][t],i=e+a;if(0===i)return r.jsx("div",{className:"aspect-square",style:{backgroundColor:(s+t)%2==0?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.1)"}},`c-${s}-${t}`);const n=e/i;let c;return c=Math.min(e,a)/Math.max(e,a,1)>.5?`rgba(168, 85, 247, ${.4+i/(T.maxWhite+T.maxBlack)*.6})`:n>.5?`rgba(56, 189, 248, ${.3+.7*n})`:`rgba(251, 113, 133, ${.3+.7*(1-n)})`,r.jsx("div",{className:"aspect-square transition-colors",style:{backgroundColor:c},title:`${String.fromCharCode(97+t)}${8-s}: W:${e} B:${a}`},`c-${s}-${t}`)}))}),r.jsxs("div",{className:"flex justify-center gap-3 text-[8px] text-muted-foreground",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-2 h-2 rounded-sm bg-sky-400"})," White"]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-2 h-2 rounded-sm bg-purple-500"})," Contested"]}),r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"w-2 h-2 rounded-sm bg-rose-400"})," Black"]})]})]})]},"heatmap"):r.jsxs(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"space-y-3",children:[F("w","White"),F("b","Black"),r.jsx("p",{className:"text-[9px] text-muted-foreground text-center italic",children:y?"Tap to lock":"Hover squares or tap pieces to highlight"})]},"pieces")})]})};export{h as L};
