const n="import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Share2, Copy, Check, ExternalLink } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/hooks/useAuth';\nimport { supabase } from '@/integrations/supabase/client';\nimport type { CodeAnalysisResult } from '@/hooks/useCodeAnalysis';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\n\ninterface ShareReportButtonProps {\n  result: CodeAnalysisResult;\n}\n\nexport function ShareReportButton({ result }: ShareReportButtonProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [shareUrl, setShareUrl] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n  const { toast } = useToast();\n  const { user } = useAuth();\n\n  const generateShareableReport = async () => {\n    setSaving(true);\n    try {\n      // Check if this repo already has a saved pattern\n      const { data: existing } = await supabase\n        .from('code_repository_patterns')\n        .select('id')\n        .eq('fingerprint', result.fingerprint)\n        .single();\n\n      let reportId: string;\n\n      if (existing) {\n        reportId = existing.id;\n      } else {\n        // Save the analysis\n        const { data: pattern, error } = await supabase\n          .from('code_repository_patterns')\n          .insert({\n            repository_url: result.repository_url,\n            repository_name: result.repository_name,\n            owner: result.owner,\n            fingerprint: result.fingerprint,\n            archetype: result.archetype,\n            dominant_force: result.dominant_force,\n            flow_direction: result.flow_direction,\n            intensity: result.intensity,\n            quadrant_profile: result.quadrant_profile,\n            temporal_flow: result.temporal_flow,\n            critical_moments: result.critical_moments,\n            code_metrics: result.code_metrics,\n            total_commits: result.total_commits,\n            total_contributors: result.total_contributors,\n            analysis_period_start: result.analysis_period_start,\n            analysis_period_end: result.analysis_period_end,\n            predicted_outcome: result.predicted_outcome,\n            outcome_confidence: result.outcome_confidence,\n            recommendations: result.recommendations,\n            analyzed_by: user?.id || null,\n          })\n          .select('id')\n          .single();\n\n        if (error) throw error;\n        reportId = pattern.id;\n      }\n\n      const url = `${window.location.origin}/analysis/${reportId}`;\n      setShareUrl(url);\n      \n      toast({\n        title: 'Report Ready to Share!',\n        description: 'Copy the link below to share your analysis.',\n      });\n    } catch (err) {\n      toast({\n        title: 'Error',\n        description: err instanceof Error ? err.message : 'Failed to generate shareable link',\n        variant: 'destructive',\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const copyLink = () => {\n    if (shareUrl) {\n      navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      toast({ title: 'Copied!', description: 'Link copied to clipboard' });\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  const openInNewTab = () => {\n    if (shareUrl) {\n      window.open(shareUrl, '_blank');\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Share2 className=\"h-4 w-4\" />\n          Share Report\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Share Analysis Report</DialogTitle>\n          <DialogDescription>\n            Generate a permanent, shareable link to this analysis that anyone can view.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 pt-4\">\n          {!shareUrl ? (\n            <Button \n              onClick={generateShareableReport} \n              disabled={saving}\n              className=\"w-full\"\n            >\n              {saving ? 'Generating...' : 'Generate Shareable Link'}\n            </Button>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg\">\n                <input\n                  type=\"text\"\n                  value={shareUrl}\n                  readOnly\n                  className=\"flex-1 bg-transparent text-sm outline-none\"\n                />\n                <Button variant=\"ghost\" size=\"sm\" onClick={copyLink}>\n                  {copied ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n              \n              <div className=\"flex gap-2\">\n                <Button onClick={copyLink} variant=\"outline\" className=\"flex-1 gap-2\">\n                  {copied ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                  Copy Link\n                </Button>\n                <Button onClick={openInNewTab} className=\"flex-1 gap-2\">\n                  <ExternalLink className=\"h-4 w-4\" />\n                  Open Report\n                </Button>\n              </div>\n\n              <p className=\"text-xs text-muted-foreground text-center\">\n                This link is permanent and can be shared with investors, team members, or anyone interested in the analysis.\n              </p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n";export{n as default};
