const n="/**\n * Medical Domain Adapter\n * \n * Temporal pattern recognition for diagnostic data\n * Patient monitoring, disease progression, treatment response\n * \n * Applications:\n * - Patient monitoring: Vital signs, ECG, EEG patterns\n * - Disease progression: Cancer markers, chronic conditions\n * - Treatment response: Medication efficacy, side effects\n * - Epidemiology: Disease spread patterns, outbreak detection\n * - Imaging: MRI/CT temporal sequences, tumor growth\n * \n * Patent-Pending: En Pensentâ„¢ Medical Temporal Analysis\n */\n\nimport type { DomainSignature } from '../types';\n\n// Medical telemetry point\nexport interface MedicalPoint {\n  timestamp: number;\n  \n  // Vital signs\n  heartRate: number;           // BPM (normalized 0-1)\n  bloodPressureSystolic: number; // mmHg (normalized)\n  bloodPressureDiastolic: number;\n  temperature: number;         // Celsius (normalized)\n  respiratoryRate: number;     // Breaths per minute (normalized)\n  oxygenSaturation: number;    // SpO2 % (normalized)\n  \n  // Lab values\n  whiteBloodCellCount: number; // WBC (normalized)\n  glucoseLevel: number;        // mg/dL (normalized)\n  creatinine: number;          // Kidney function (normalized)\n  \n  // Disease markers\n  tumorMarker: number;         // PSA, CA-125, etc. (normalized)\n  viralLoad: number;           // For infectious diseases (normalized)\n  inflammationIndex: number;   // CRP, ESR composite (normalized)\n  \n  // Treatment metrics\n  medicationDose: number;      // Current dose level (normalized)\n  treatmentPhase: 'induction' | 'maintenance' | 'tapering' | 'observation';\n  sideEffectSeverity: number;  // 0-1 scale\n  \n  // Patient location/status\n  ward: string;\n  bedNumber: number;\n  mobilityScore: number;       // 0-1 (bedridden to fully mobile)\n  consciousnessLevel: number;  // GCS normalized (0-1)\n}\n\n// Organ system status\nexport interface OrganSystem {\n  name: 'cardiac' | 'respiratory' | 'renal' | 'hepatic' | 'neurological' | 'immune';\n  functionScore: number;       // 0-1 (normal to failure)\n  trend: 'improving' | 'stable' | 'declining' | 'critical';\n  lastUpdate: number;\n}\n\n// Medical case data\nexport interface MedicalData {\n  patientId: string;\n  diagnosis: string;\n  diseaseStage: 'early' | 'localized' | 'advanced' | 'terminal' | 'remission';\n  treatmentProtocol: string;\n  \n  points: MedicalPoint[];\n  organSystems: OrganSystem[];\n  \n  timeRange: {\n    start: number;\n    end: number;\n  };\n  \n  metadata?: {\n    hospital?: string;\n    attendingPhysician?: string;\n    age?: number;\n    sex?: 'male' | 'female' | 'other';\n    comorbidities?: string[];\n  };\n}\n\n// Medical archetypes (patient trajectories)\nexport type MedicalArchetype =\n  | 'stable_recovery'          // Normal healing trajectory\n  | 'acute_deterioration'      // Sudden decline requiring intervention\n  | 'chronic_management'       // Long-term stable condition\n  | 'treatment_response'       // Positive reaction to therapy\n  | 'treatment_resistance'     // No response to standard care\n  | 'inflammatory_cascade'     // Cytokine storm, sepsis pattern\n  | 'organ_failure_progression' // Multi-organ decline\n  | 'immune_reconstitution'    // Post-chemo recovery\n  | 'viral_clearance'          // Infectious disease recovery\n  | 'viral_replication_burst'  // Rapid viral proliferation\n  | 'medication_toxicity'      // Adverse drug reaction\n  | 'surgical_recovery'        // Post-operative healing\n  | 'palliative_decline'      // End-of-life trajectory\n  | 'spontaneous_remission'    // Unexpected recovery\n  | 'diagnostic_odyssey';      // Long uncertain diagnosis process\n\n// Archetype definitions with clinical significance\nexport const MEDICAL_ARCHETYPES: Record<MedicalArchetype, {\n  description: string;\n  color: string;\n  urgencyLevel: 'routine' | 'urgent' | 'emergent' | 'critical';\n  typicalDuration: number; // hours\n  interventionRequired: boolean;\n}> = {\n  stable_recovery: {\n    description: 'Normal healing trajectory with improving vitals',\n    color: '#22C55E', // Green\n    urgencyLevel: 'routine',\n    typicalDuration: 72,\n    interventionRequired: false\n  },\n  acute_deterioration: {\n    description: 'Sudden decline requiring immediate intervention',\n    color: '#DC2626', // Red\n    urgencyLevel: 'critical',\n    typicalDuration: 2,\n    interventionRequired: true\n  },\n  chronic_management: {\n    description: 'Long-term stable condition with baseline vitals',\n    color: '#3B82F6', // Blue\n    urgencyLevel: 'routine',\n    typicalDuration: 8760, // 1 year\n    interventionRequired: false\n  },\n  treatment_response: {\n    description: 'Positive reaction to therapy, markers improving',\n    color: '#10B981', // Emerald\n    urgencyLevel: 'routine',\n    typicalDuration: 168, // 1 week\n    interventionRequired: false\n  },\n  treatment_resistance: {\n    description: 'No response to standard care, consider alternatives',\n    color: '#F59E0B', // Amber\n    urgencyLevel: 'urgent',\n    typicalDuration: 336, // 2 weeks\n    interventionRequired: true\n  },\n  inflammatory_cascade: {\n    description: 'Cytokine storm, sepsis pattern - aggressive care needed',\n    color: '#7F1D1D', // Dark red\n    urgencyLevel: 'critical',\n    typicalDuration: 6,\n    interventionRequired: true\n  },\n  organ_failure_progression: {\n    description: 'Multi-organ decline, ICU care required',\n    color: '#991B1B', // Very dark red\n    urgencyLevel: 'critical',\n    typicalDuration: 24,\n    interventionRequired: true\n  },\n  immune_reconstitution: {\n    description: 'Post-chemotherapy immune system recovery',\n    color: '#8B5CF6', // Purple\n    urgencyLevel: 'urgent',\n    typicalDuration: 720, // 30 days\n    interventionRequired: true\n  },\n  viral_clearance: {\n    description: 'Infectious disease recovery, viral load decreasing',\n    color: '#06B6D4', // Cyan\n    urgencyLevel: 'routine',\n    typicalDuration: 336, // 2 weeks\n    interventionRequired: false\n  },\n  viral_replication_burst: {\n    description: 'Rapid viral proliferation, antiviral intervention needed',\n    color: '#EF4444', // Red\n    urgencyLevel: 'emergent',\n    typicalDuration: 48,\n    interventionRequired: true\n  },\n  medication_toxicity: {\n    description: 'Adverse drug reaction, dose adjustment needed',\n    color: '#F97316', // Orange\n    urgencyLevel: 'urgent',\n    typicalDuration: 12,\n    interventionRequired: true\n  },\n  surgical_recovery: {\n    description: 'Post-operative healing with expected trajectory',\n    color: '#84CC16', // Lime\n    urgencyLevel: 'routine',\n    typicalDuration: 168, // 1 week\n    interventionRequired: false\n  },\n  palliative_decline: {\n    description: 'End-of-life trajectory, comfort care focus',\n    color: '#78716C', // Gray\n    urgencyLevel: 'urgent',\n    typicalDuration: 168, // 1 week\n    interventionRequired: false\n  },\n  spontaneous_remission: {\n    description: 'Unexpected recovery, document for research',\n    color: '#A855F7', // Violet\n    urgencyLevel: 'routine',\n    typicalDuration: 720, // 30 days\n    interventionRequired: false\n  },\n  diagnostic_odyssey: {\n    description: 'Long uncertain diagnosis process, multiple specialties',\n    color: '#6366F1', // Indigo\n    urgencyLevel: 'urgent',\n    typicalDuration: 2160, // 90 days\n    interventionRequired: true\n  }\n};\n\n/**\n * Build organ system status map\n */\nfunction buildOrganMap(data: MedicalData): Map<string, OrganSystem> {\n  const organMap = new Map<string, OrganSystem>();\n  \n  data.organSystems.forEach(organ => {\n    organMap.set(organ.name, organ);\n  });\n  \n  return organMap;\n}\n\n/**\n * Generate medical fingerprint\n */\nfunction generateMedicalFingerprint(points: MedicalPoint[]): string {\n  const recent = points.slice(-10); // Last 10 readings\n  const avgHR = recent.reduce((sum, p) => sum + p.heartRate, 0) / recent.length;\n  const avgTemp = recent.reduce((sum, p) => sum + p.temperature, 0) / recent.length;\n  const avgWBC = recent.reduce((sum, p) => sum + p.whiteBloodCellCount, 0) / recent.length;\n  \n  const signature = `${Math.round(avgHR * 100)}-${Math.round(avgTemp * 100)}-${Math.round(avgWBC * 100)}`;\n  \n  let hash = 0;\n  for (let i = 0; i < signature.length; i++) {\n    const char = signature.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  \n  return `med-${Math.abs(hash).toString(36).substring(0, 8)}`;\n}\n\n/**\n * Calculate medical quadrant profile\n */\nfunction calculateMedicalQuadrantProfile(data: MedicalData): {\n  aggressive: number;    // Acute severity\n  defensive: number;     // Protective response\n  tactical: number;      // Immediate interventions\n  strategic: number;     // Long-term prognosis\n} {\n  const recentPoints = data.points.slice(-20);\n  \n  // Acute severity (aggressive)\n  const abnormalVitals = recentPoints.filter(p => \n    p.heartRate > 0.8 || \n    p.temperature > 0.75 || \n    p.oxygenSaturation < 0.9\n  ).length;\n  const aggressive = abnormalVitals / recentPoints.length;\n  \n  // Protective response (defensive)\n  const immuneActive = recentPoints.filter(p => \n    p.whiteBloodCellCount > 0.6 || \n    p.inflammationIndex > 0.5\n  ).length;\n  const defensive = immuneActive / recentPoints.length;\n  \n  // Immediate interventions (tactical)\n  const interventions = recentPoints.filter(p => \n    p.medicationDose > 0.7 || \n    p.sideEffectSeverity > 0.5\n  ).length;\n  const tactical = interventions / recentPoints.length;\n  \n  // Long-term prognosis (strategic)\n  const trendPoints = data.points;\n  const earlyAvg = trendPoints.slice(0, Math.floor(trendPoints.length * 0.2))\n    .reduce((sum, p) => sum + p.consciousnessLevel, 0) / (trendPoints.length * 0.2);\n  const lateAvg = trendPoints.slice(-Math.floor(trendPoints.length * 0.2))\n    .reduce((sum, p) => sum + p.consciousnessLevel, 0) / (trendPoints.length * 0.2);\n  const strategic = lateAvg > earlyAvg ? 0.7 : 0.3;\n  \n  return {\n    aggressive: Math.min(1, aggressive),\n    defensive: Math.min(1, defensive),\n    tactical: Math.min(1, tactical),\n    strategic\n  };\n}\n\n/**\n * Calculate temporal flow for treatment phases\n */\nfunction calculateMedicalTemporalFlow(data: MedicalData): {\n  early: number;   // Diagnosis/Induction\n  mid: number;     // Active treatment\n  late: number;    // Recovery/Maintenance\n} {\n  const duration = data.timeRange.end - data.timeRange.start;\n  \n  const inductionCount = data.points.filter(p => \n    p.treatmentPhase === 'induction'\n  ).length;\n  const maintenanceCount = data.points.filter(p => \n    p.treatmentPhase === 'maintenance'\n  ).length;\n  const observationCount = data.points.filter(p => \n    p.treatmentPhase === 'observation'\n  ).length;\n  \n  const total = data.points.length || 1;\n  \n  return {\n    early: inductionCount / total,\n    mid: maintenanceCount / total,\n    late: observationCount / total\n  };\n}\n\n/**\n * Find critical medical moments\n */\nfunction findMedicalCriticalMoments(data: MedicalData): Array<{\n  timestamp: number;\n  severity: number;\n  type: string;\n  description: string;\n}> {\n  const moments: Array<{\n    timestamp: number;\n    severity: number;\n    type: string;\n    description: string;\n  }> = [];\n  \n  const sortedPoints = [...data.points].sort((a, b) => a.timestamp - b.timestamp);\n  \n  for (let i = 1; i < sortedPoints.length; i++) {\n    const prev = sortedPoints[i - 1];\n    const curr = sortedPoints[i];\n    \n    // Detect code events\n    if (curr.heartRate > 0.9 || curr.oxygenSaturation < 0.85) {\n      moments.push({\n        timestamp: curr.timestamp,\n        severity: 1.0,\n        type: 'code_blue',\n        description: 'Cardiac/respiratory emergency'\n      });\n    }\n    \n    // Detect rapid decline\n    const consciousnessDrop = prev.consciousnessLevel - curr.consciousnessLevel;\n    if (consciousnessDrop > 0.3) {\n      moments.push({\n        timestamp: curr.timestamp,\n        severity: 0.8,\n        type: 'neurological_decline',\n        description: 'Acute consciousness deterioration'\n      });\n    }\n    \n    // Detect sepsis indicators\n    if (curr.temperature > 0.8 && curr.whiteBloodCellCount > 0.8 && curr.heartRate > 0.8) {\n      moments.push({\n        timestamp: curr.timestamp,\n        severity: 0.9,\n        type: 'sepsis_alert',\n        description: 'Systemic inflammatory response'\n      });\n    }\n    \n    // Detect treatment toxicity\n    if (curr.sideEffectSeverity > 0.7) {\n      moments.push({\n        timestamp: curr.timestamp,\n        severity: 0.6,\n        type: 'toxicity_event',\n        description: 'Severe adverse drug reaction'\n      });\n    }\n  }\n  \n  return moments.slice(0, 10); // Top 10 critical events\n}\n\n/**\n * Classify medical archetype\n */\nfunction classifyMedicalArchetype(\n  data: MedicalData,\n  quadrant: { aggressive: number; defensive: number; tactical: number; strategic: number },\n  moments: ReturnType<typeof findMedicalCriticalMoments>\n): MedicalArchetype {\n  // Check for emergencies first\n  const codeEvents = moments.filter(m => m.type === 'code_blue');\n  if (codeEvents.length > 0) return 'acute_deterioration';\n  \n  const sepsisEvents = moments.filter(m => m.type === 'sepsis_alert');\n  if (sepsisEvents.length > 0) return 'inflammatory_cascade';\n  \n  // Check organ failure\n  const failingOrgans = data.organSystems.filter(o => o.functionScore < 0.3).length;\n  if (failingOrgans > 2) return 'organ_failure_progression';\n  \n  // Check treatment response\n  const treatmentResistant = data.points.filter(p => \n    p.treatmentPhase === 'maintenance' && p.tumorMarker > 0.8\n  ).length;\n  if (treatmentResistant > 5) return 'treatment_resistance';\n  \n  const treatmentResponsive = data.points.filter(p => \n    p.treatmentPhase === 'maintenance' && p.tumorMarker < 0.3\n  ).length;\n  if (treatmentResponsive > 5) return 'treatment_response';\n  \n  // Check viral patterns\n  const viralClearing = data.points.filter(p => \n    p.viralLoad < 0.2 && p.immuneReconstitution > 0.5\n  ).length;\n  if (viralClearing > 3) return 'viral_clearance';\n  \n  const viralBurst = data.points.filter(p => p.viralLoad > 0.8).length;\n  if (viralBurst > 3) return 'viral_replication_burst';\n  \n  // Check chronic vs acute\n  if (quadrant.aggressive < 0.2 && quadrant.strategic > 0.7) {\n    return 'chronic_management';\n  }\n  \n  // Check recovery\n  if (quadrant.strategic > 0.6 && moments.length === 0) {\n    return 'stable_recovery';\n  }\n  \n  // Default to diagnostic odyssey if unclear\n  return 'diagnostic_odyssey';\n}\n\n/**\n * Extract complete medical signature\n */\nexport function extractMedicalSignature(data: MedicalData): DomainSignature & {\n  fingerprint: string;\n  archetype: MedicalArchetype;\n  criticalMoments: Array<{\n    timestamp: number;\n    severity: number;\n    type: string;\n    description: string;\n  }>;\n  organMap: Map<string, OrganSystem>;\n  prognosisScore: number;\n} {\n  const organMap = buildOrganMap(data);\n  const quadrantProfile = calculateMedicalQuadrantProfile(data);\n  const temporalFlow = calculateMedicalTemporalFlow(data);\n  const criticalMoments = findMedicalCriticalMoments(data);\n  const archetype = classifyMedicalArchetype(data, quadrantProfile, criticalMoments);\n  const fingerprint = generateMedicalFingerprint(data.points);\n  \n  // Calculate intensity (overall severity)\n  const avgSeverity = data.points.reduce((sum, p) => \n    sum + (p.heartRate + p.temperature + (1 - p.oxygenSaturation)) / 3, 0\n  ) / data.points.length;\n  const intensity = Math.min(1, avgSeverity);\n  \n  // Prognosis score\n  const prognosisScore = (quadrantProfile.strategic * 0.5 + \n                         (1 - intensity) * 0.3 + \n                         (criticalMoments.length < 3 ? 0.2 : 0));\n  \n  return {\n    domain: 'chess', // Using closest available\n    quadrantProfile: {\n      aggressive: quadrantProfile.aggressive,\n      defensive: quadrantProfile.defensive,\n      tactical: quadrantProfile.tactical,\n      strategic: quadrantProfile.strategic\n    },\n    temporalFlow,\n    intensity,\n    momentum: intensity > 0.7 ? -0.5 : 0.5, // Negative momentum = declining\n    volatility: criticalMoments.length / 5,\n    dominantFrequency: data.points.length / ((data.timeRange.end - data.timeRange.start) / 3600000), // Points per hour\n    harmonicResonance: 1 - Math.abs(quadrantProfile.aggressive - quadrantProfile.defensive),\n    phaseAlignment: prognosisScore,\n    extractedAt: Date.now(),\n    fingerprint,\n    archetype,\n    criticalMoments,\n    organMap,\n    prognosisScore\n  };\n}\n\n/**\n * Predict medical outcome\n */\nexport function predictMedicalOutcome(\n  signature: ReturnType<typeof extractMedicalSignature>\n): {\n  predictedOutcome: 'recovery' | 'stable_chronic' | 'deterioration' | 'critical_event' | 'remission';\n  confidence: number;\n  timeToEvent: number; // hours\n  recommendations: string[];\n  alertLevel: 'green' | 'yellow' | 'orange' | 'red' | 'purple';\n} {\n  const archetype = MEDICAL_ARCHETYPES[signature.archetype];\n  const urgencyLevel = archetype.urgencyLevel;\n  \n  let predictedOutcome: 'recovery' | 'stable_chronic' | 'deterioration' | 'critical_event' | 'remission';\n  let recommendations: string[] = [];\n  let alertLevel: 'green' | 'yellow' | 'orange' | 'red' | 'purple';\n  \n  switch (signature.archetype) {\n    case 'acute_deterioration':\n    case 'inflammatory_cascade':\n    case 'organ_failure_progression':\n      predictedOutcome = 'critical_event';\n      recommendations = [\n        'ACTIVATE RAPID RESPONSE TEAM',\n        'Prepare for ICU transfer',\n        'Initiate advanced life support protocols',\n        'Notify family and attending physician'\n      ];\n      alertLevel = 'purple';\n      break;\n      \n    case 'treatment_resistance':\n      predictedOutcome = 'deterioration';\n      recommendations = [\n        'Oncology consultation for second-line therapy',\n        'Consider clinical trial enrollment',\n        'Palliative care consultation',\n        'Reassess treatment goals with patient'\n      ];\n      alertLevel = 'orange';\n      break;\n      \n    case 'treatment_response':\n    case 'viral_clearance':\n    case 'stable_recovery':\n      predictedOutcome = 'recovery';\n      recommendations = [\n        'Continue current treatment protocol',\n        `Prognosis: ${Math.round(signature.prognosisScore * 100)}% favorable`,\n        'Schedule follow-up in 2-4 weeks',\n        'Maintain current monitoring frequency'\n      ];\n      alertLevel = 'green';\n      break;\n      \n    case 'chronic_management':\n      predictedOutcome = 'stable_chronic';\n      recommendations = [\n        'Continue maintenance medications',\n        'Routine follow-up schedule',\n        'Patient education on warning signs',\n        'Quality of life optimization'\n      ];\n      alertLevel = 'yellow';\n      break;\n      \n    case 'spontaneous_remission':\n      predictedOutcome = 'remission';\n      recommendations = [\n        'Document case for research publication',\n        'Continue surveillance imaging',\n        'Monitor for late recurrence',\n        'Consider tapering therapy'\n      ];\n      alertLevel = 'green';\n      break;\n      \n    default:\n      predictedOutcome = 'stable_chronic';\n      recommendations = [\n        'Continue current management',\n        'Reassess in 24-48 hours',\n        'Monitor for trend changes',\n        'Consider specialist consultation'\n      ];\n      alertLevel = 'yellow';\n  }\n  \n  // Confidence calculation\n  const dataQuality = Math.min(1, signature.criticalMoments.length / 3);\n  const patternClarity = 1 - signature.volatility;\n  const confidence = (dataQuality * 0.3 + patternClarity * 0.4 + signature.prognosisScore * 0.3);\n  \n  // Time to event\n  const timeToEvent = alertLevel === 'purple' ? 2 :\n                      alertLevel === 'red' ? 6 :\n                      alertLevel === 'orange' ? 24 :\n                      alertLevel === 'yellow' ? 72 : 168;\n  \n  return {\n    predictedOutcome,\n    confidence,\n    timeToEvent,\n    recommendations,\n    alertLevel\n  };\n}\n\n// Type exports\nexport type { MedicalData, MedicalPoint, OrganSystem, MedicalArchetype };\n";export{n as default};
