import{d6 as e,d7 as t,cp as s,a as n,u as r,r as a,J as i,o,s as c,aH as l,aa as u,cM as d,j as m,L as f,C as h,x,D as p,B as v,A as g,p as w,t as j,cN as y,bC as b,S as N,a6 as C,P as z,y as D,bG as M,T as B,aq as A,z as q,cU as L,aj as S,aT as E,ca as G,b as _,d8 as U}from"./index-xchx37pq.js";!function(){const e=Y,t=k();for(;;)try{if(427072===parseInt(e(346))/1*(parseInt(e(401))/2)+parseInt(e(219))/3+-parseInt(e(305))/4*(parseInt(e(400))/5)+parseInt(e(378))/6+parseInt(e(388))/7+parseInt(e(209))/8*(parseInt(e(406))/9)+-parseInt(e(340))/10)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const W=function(){let e=!0;return function(t,s){const n=e?function(){const e=Y;if(e(297)!=e(297))return _0x511ebd;if(s){const n=s[e(320)](t,arguments);return s=null,n}}:function(){};return e=!1,n}}()(void 0,function(){const e=Y,t={};t[e(321)]=e(332)+"+$";const s=t;return W.toString()[e(369)](s.APOOA)[e(360)]()[e(294)+"r"](W)[e(369)](s[e(321)])});W();const I=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[Y(320)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}();function k(){const e=["mJu1lcaYntuSia","Bg9HzcbtvKC","ntb5s0TsBKW","ndq5mJzmueLXq3a","iIb2Awv3qM94pq","phjLy3qGEd0I","AxrHBgLJiduWma","Dgv4DefSAwDU","mJi1BKzMww5y","C2nHBgu","vuDkDeu","zw50","ANDpshe","4PMuievoifbftLnf","CMvKDwnL","phjLy3qGEd0Ima","vhf1Bhm","pZ8/pY4/pY4/pW","AfbXwgu","AgLUz1f1ywXPDa","BwLU","wvvXz3K","otG5ndrRCefUzhy","Bw9Yyw50jYWGrW","CMv0DxjUicHMDq","iIb5psi","Dg9eyxrHvvjm","Aw1Hz2uVC3zNkW","A3rwB1C","BgvUz3rO","CM4GDgHPCYiPka","C3rYB2TLu3r5Ba","mJm4mtG3mvPwyNHYAG","CKvADwy","zMLSBfjLy3q","vw5RBM93BG","wKDtsuW","z2v0q29UDgv4Da","Bw92zxm","BeX4zw8","BMLgq2S","D3juwLG","y3rvuKW","yMvNAw5qyxrO","psjODhrWoI8VDW","i0zbrKfgqq","quz3wvu","icdIGkiGia","qMXHy2S","rMfPBgvKihrVia","D2LKDgG","DLb0y1C","lI4U","Eg1So2nOyxjZzq","AgLUz0vUywjSzq","yNf2Awi","B1n4sw4","DhbNzNK","AM9PBG","zM9UDa","DvLqwvK","ntaWideYChGGjW","CunvCxq","y3jLyxrLrwXLBq","y29SB3i","iZbbmeeWqq","r2viEeG","iZq0ndaZyW","BwvHC3vYzvrLEa","y2fUDMfZ","mc45nsK","vgLTzxmGtMv3ia","ru4Guevou0vova","BgLNAhq","y2XPCa","BNmTC2vYAwy","y3jLyxrLt2jQzq","y29UC29Szq","C2f2zq","qKTsu1a","suLjBxa","EeTxEMO","Dgv4DejHC2vSAq","iIbOzwLNAhq9iG","CeDPBvq","q2LUEMvSjYWGjW","Aw5JBhvKzxm","vMX6vLu","BMrTs0y","Bw1uuve","ChvZAa","zw9Yz2LHlcbZzq","ChjVDg90ExbL","wunUq1i","DfzPD3u","E30Uy29UC3rYDq","CMv2B2TLt2jQzq","ALbrvhO","EgzAtNG","Dg9vChbLCKnHCW","zhLdDK8","AgLgrxm","C3bSAxq","iJaGmca","y2vUDgvY","i2e4yti5zq","yvvxAeK","y29UC3rYDwn0BW","y3bvr0K","BgLUzvDPzhrO","zgvRAxK","Bgf5zxjtAxPL","uM9Tyw4NlcbZzq","zvr5Ce4","y0jMsei","Aw1Hz2vtBw9VDa","B25LCNjVCG","BwvZlcbZzxjPzG","mti3mZa0C1vOCM5Y","ide4ChGGj0nVCG","AhPvy0e","iZfbmueXqq","u2nbCuG","nJaWidi0ChGGjW","zMLSBfrLEhq","CgvUC2vUDc5JBW","Dd11DgyToa","rgjZCNu","ntaWideXChGGjW","u3rmAha","yxjJ","zxzLBNq","zgvMyxvSDa","yxbWBhK","qvbpt0e","C3jJ","B25SB2fK","vgzItuO","D2fYBG","i2zHzMfMoq","qLfLELG","BgLUzvrV","twH4rxi","BMn0Aw9UkcKG","sgHNAwu","kcGOlISPkYKRkq","tgTkzM0","BwLKzgXL","qwvYv0q","Cg9krgm","wMnXuvu","CMvHzhK","iZi5mJuYna","mtG1nZK0mZbcBenlzhy","sw50zxiNlcbZyq","ywzStfi","BgvMDa","CMDIysGYntuSia","iIb3Awr0Ad0I","mJvtzuTJChu","zhjHD0LTywDL","D3CUDZmUB3jNlW","z1jVqxy","zgfYAW","AgvPz2H0","Bw92zvrV","idiWChGGj0nVCG","qLfqrwu","ndaWideXChGGjW","iIb5psiWiIb3Aq","qxbJveK","DgzYwha","iI8+","Dg9tDhjPBMC","CMLM","AxnmAwDODa","C3rYB2TL","wMfbAe4","AgLNAa","v09Squy","Aw5MBW","zMLSBfn0EwXL","C2vHCMnO","yMLUza","iZC4nZe2yW","wwrfDKK","iIbMAwXSpsi","CLfiwhO","zMLSBa","AxbyCg8","i2u3ztvLna","mtm4mZy1neXXA3PJDa","y3rVCIGICMv0Dq","veXcruW","vfftAue","yM9YzgvY","nJaWideZChGGjW","DgfIBgu","Bg9N","A0HqANO","CM91BMrszwn0","ndK1ntuZoeHbqLv5uW","zM9UDhm","DKjwB2i","tLqG4PMA","tNvKt1y","ihzZia","zgf0zq","u29fqMi","v2HPDgu","vNnfD2G"];return(k=function(){return e})()}function Y(e,t){e-=199;const s=k();let n=s[e];if(void 0===Y.ZHuYSy){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};Y.ixFDZr=r,Y.RWKSDq={},Y.ZHuYSy=!0}const a=e+s[0],i=Y.RWKSDq[a];if(i)n=i;else{const e=function(e){this.jcKUfe=e,this.unCNXt=[1,0,0],this.MFGWfo=function(){return"newState"},this.jDFWmI="\\w+ *\\(\\) *{\\w+ *",this.NnArOH="['|\"].+['|\"];? *}"};e.prototype.OvVTnB=function(){const e=new RegExp(this.jDFWmI+this.NnArOH).test(this.MFGWfo.toString())?--this.unCNXt[1]:--this.unCNXt[0];return this.wAkxjr(e)},e.prototype.wAkxjr=function(e){return Boolean(~e)?this.WIWvwJ(this.jcKUfe):e},e.prototype.WIWvwJ=function(e){for(let t=0,s=this.unCNXt.length;t<s;t++)this.unCNXt.push(Math.round(Math.random())),s=this.unCNXt.length;return e(this.unCNXt[0])},new e(Y).OvVTnB(),n=Y.ixFDZr(n),Y.RWKSDq[a]=n}return n}I(void 0,function(){const e=Y,t={tViwu:function(e,t){return e+t}};t.YUqgy=e(385),t[e(220)]=e(325),t[e(333)]="exception",t.Hhgie="trace",t[e(287)]=function(e,t){return e<t};const s=t,n=function(){const t=e;let n;try{n=Function(s[t(281)](t(211)+t(330),t(282)+'ctor("retu'+t(217)+" )")+");")()}catch(r){n=window}return n}(),r=n.console=n[e(264)]||{},a=[s[e(208)],s[e(220)],e(367),"error",s.LkJfm,e(384),s[e(331)]];for(let i=0;s[e(287)](i,a[e(216)]);i++){const t=I[e(294)+"r"][e(279)][e(370)](I),s=a[i],n=r[s]||t;t.__proto__=I[e(370)](I),t[e(360)]=n[e(360)].bind(n),r[s]=t}})();async function P(e){const t=Y,s={};s[t(253)]="qrcode",s.pGimT="https://en"+t(312)+"m",s[t(276)]=t(308);const n=s;return(await import(n.GeHxH))[t(319)][t(213)](n[t(271)],{width:200,margin:1,color:{dark:e?t(232):n.mmTQQ,light:"transparent"},errorCorrectionLevel:"M"})}async function T(){const e=Y,t={};t[e(390)]="anonymous";const n=t;return new Promise((t,r)=>{const a=e,i=new Image;i.crossOrigin=n[a(390)],i[a(323)]=()=>t(i),i.onerror=r,i[a(322)]=s})}async function K(s,n,r={}){const a=Y,i={jwOHq:function(e){return e()},IIImp:a(211)+a(330),niFCk:function(e,t){return e===t},BDApY:a(293),StLhp:function(e,t){return e*t},tfrXp:function(e,t){return e+t},rpYms:function(e,t){return e*t},poJDc:a(252),hPqXe:"#292524",Tquls:function(e,t){return e-t},WOlAF:a(326),TOlgt:a(292),xfZNx:function(e,t){return e/t},SoEBb:function(e,t){return e+t},ktVoW:a(235),MhxEr:a(334),xKWzj:a(404)+a(353)+a(210)+a(278)+"rif",Dbsru:a(393),eTypN:function(e,t){return e-t},ipXpo:a(310)+"Cinzel', '"+a(258)+a(299)+a(361),TLBEL:"left",tpgfy:a(291),AFwYU:a(248)+a(341)+a(262),ZaAhN:function(e,t){return e+t},bqvib:function(e,t){return e-t},Zapvo:function(e,t){return e+t},ftSUP:function(e,t){return e>t},rQHXz:"400 10px '"+a(258)+"Roman', Ti"+a(304),UYBxu:a(239),YGUWa:function(e,t){return e!==t},wrTZX:function(e,t){return e+t},jPQTz:function(e,t){return e>t},vPtcW:function(e,t){return e>=t},VduIO:function(e,t){return e-t},hzUcA:a(200)+a(391),ZGSIL:function(e,t){return e/t},tMbEx:function(e,t){return e-t},BQPEe:a(344)+a(398)+a(257),AerWD:a(377),YdEvI:function(e,t){return e+t},BQezX:function(e,t){return e+t},AnnmN:function(e,t){return e+t},gfdKj:function(e,t){return e/t},hiFEs:function(e,t){return e*t},uYPYY:function(e,t){return e+t},TQSiA:a(371),ZmDfN:a(355)+a(341)+a(262),aflLR:function(e,t){return e-t}};await async function(){const e=Y;document[e(389)]&&document[e(389)][e(338)]&&await document[e(389)].ready,await new Promise(e=>setTimeout(e,150))}();const{boardSize:o=600,darkMode:c=!1,withWatermark:l=!1,title:u}=r,d=function(s,n){const r=Y,a={ScAqH:function(e,t){return e*t},kHPjz:function(e,t){return e<t},gRoAv:function(e,t,s){return e(t,s)},qCUqt:function(e,t){return e*t},UsvAr:function(e,t){return e/t},cBfHB:function(e,t){return e<t},vwyZU:function(e,t){return e-t},VsEwh:function(e,t){return e+t},cpUGI:"</svg>"},i=n/8,o=.02*n,c=n+a[r(309)](o,2);let l="<svg xmlns"+r(231)+r(348)+'2000/svg" width="'+c+r(270)+c+(r(402)+r(290))+c+" "+c+'">';l+=r(202)+r(356)+'dth="'+c+'" height="'+c+r(373)+e[r(382)]+r(359);for(let u=0;a[r(386)](u,8);u++){const n=7-u;for(let c=0;c<8;c++){const d=s[n][c],m=d[r(362)]?e[r(260)]:e[r(350)],f=o+a[r(309)](c,i),h=o+a[r(309)](u,i);if(l+=r(403)+f+r(212)+h+'" width="'+i+r(270)+i+r(373)+m+'"/>',d.visits[r(216)]>0){const e=a[r(309)](i,.08),s=[];for(const i of d.visits){const e=a[r(349)](t,i.piece,i[r(251)]);!s[r(273)](e)&&s[r(277)](e)}const n=Math[r(207)](s.length,6),o=[];let c=i-a.qCUqt(e,2);const u=a.UsvAr(.7*c,n);for(let t=0;t<n;t++){const e={};if(e[r(251)]=s[t],e.layerSize=c,o[r(277)](e),c-=u,a[r(301)](c,a[r(249)](i,.1)))break}for(const t of o){const e=a.UsvAr(a.vwyZU(i,t[r(298)]),2);l+=r(403)+(f+e)+r(212)+a[r(397)](h,e)+r(345)+t.layerSize+r(270)+t[r(298)]+r(373)+t[r(251)]+r(359)}}}}return l+=a[r(295)],l}(s,o),m=i[a(316)](o,.02),f=i[a(358)](o,i[a(316)](m,2)),h=await async function(e,t,s){const n={NudOV:function(e,t){return e!==t},ZcqQU:"lLxeo",efpwW:"canvas",ndmKF:function(e,t){return e*t},TfbMJ:function(e,t){return e(t)}};return new Promise((r,a)=>{const i=Y,o=new Image,c={};c.type=i(214)+i(240)+i(313);const l=new Blob([e],c),u=URL[i(263)+i(229)](l);o.onload=()=>{const e=i;if(n[e(392)](e(226),n[e(337)])){if(_0x31b7c8){const t=_0x2a72f7[e(320)](_0x298113,arguments);return _0x41212e=null,t}}else{const a=document["createElem"+e(409)](n.efpwW);a[e(237)]=n[e(275)](t,5),a[e(351)]=5*s;const i=a.getContext("2d");i[e(407)](5,5),i.drawImage(o,0,0,t,s),URL[e(283)+"ctURL"](u),n[e(324)](r,a)}},o[i(303)]=()=>{const e=i;URL[e(283)+e(229)](u),a(new Error(e(236)+e(399)))},o.src=u})}(d,f,f),x=60,p=f+120,v=i[a(358)](i.tfrXp(f,220),60)+120,g=document[a(250)+a(409)](a(256));g[a(237)]=5*p,g[a(351)]=i.rpYms(v,5);const w=g[a(224)]("2d");w[a(407)](5,5),w[a(302)+a(241)+"d"]=!0,w[a(302)+a(206)+"y"]=a(365),w[a(368)]=c?i[a(336)]:"#FDFCFB",w[a(221)](0,0,p,v),w[a(347)](h,0,0,h[a(237)],h[a(351)],x,x,f,f);const j=x+f+28;w[a(218)+"e"]=c?i[a(205)]:a(377),w[a(296)]=1,w[a(230)](),w[a(352)](x,j),w[a(328)](i[a(203)](p,x),j),w[a(363)]();const y=c?i[a(366)]:a(339),b=c?"#a8a29e":a(371),N=a(c?371:292),C=c?"#78716c":i.TOlgt,z=i[a(285)](p,2);let D=i[a(395)](j,55);const M=n.white||a(396),B=n.black||i[a(215)];w.textBaseline=i[a(329)],w[a(246)]="600 24px '"+a(272)+a(258)+"Roman', se"+a(361);const A=w[a(255)+"t"](M)[a(237)],q=w[a(255)+"t"](B).width;w[a(246)]=i[a(268)];const L=i[a(314)],S=w[a(255)+"t"](L).width,E=i.tfrXp(A,S)+q,G=i[a(300)](z,i.xfZNx(E,2));w.font=i.ipXpo,w.fillStyle=y,w.textAlign=i[a(380)],w[a(311)](M,G,D),w[a(246)]=i[a(268)],w[a(368)]=C,w[a(311)](L,i[a(395)](G,A),D),w[a(246)]=i[a(376)],w.fillStyle=y,w[a(311)](B,G+A+S,D),D+=36,n[a(318)]&&"Unknown"!==n[a(318)]&&(w[a(368)]=b,w.font=a(404)+a(306)+a(210)+"eorgia, se"+a(361),w[a(405)]=i[a(244)],w.fillText(n[a(318)],z,D),D+=32);const _=u,U=n[a(394)]||"";if(_||U){w[a(368)]=N,w.font=i[a(233)],w.textAlign=a(291);let e="";_?(e=_[a(286)+"e"](),U&&(e+=i[a(364)](a(234),U))):e=U;const t=2,s=e[a(289)](""),n=s[a(201)]((e,t)=>e+w[a(255)+"t"](t)[a(237)],0),r=i[a(242)](s[a(216)],1)*t;let o=z-i[a(285)](n+r,2);for(const c of s)w[a(405)]=a(343),w[a(311)](c,o,D),o+=i.Zapvo(w.measureText(c).width,t);D+=28}if(n[a(225)]&&i.ftSUP(n[a(225)][a(216)],0)){w[a(368)]=N,w.font=i[a(374)],w[a(405)]=a(291);const e=n[a(225)][a(245)](" "),t=e.length>400?e.substring(0,400)+i.UYBxu:e,s=i[a(300)](i[a(242)](p,i.rpYms(x,2)),40),r=t[a(289)](" ");let o="",c=D;const l=15,u=4;let d=0;for(const n of r){if(!i.YGUWa("kBtEx",a(280))){const e=_0x2a8f01?function(){if(_0x4efc91){const e=_0x1471b6[a(320)](_0x134d8e,arguments);return _0x36c2f4=null,e}}:function(){};return _0x35a9fc=!1,e}{const e=i[a(228)](i[a(358)](o,o?" ":""),n);if(i[a(284)](w.measureText(e).width,s)&&o){if(a(274)===a(408))_0x245fd4[a(347)](_0xcd8595,_0x1d3135,_0x5344b9,_0x1e835f,_0x126642),i[a(199)](_0x4ec21d);else if(w[a(311)](o,z,c),o=n,c+=l,d++,i[a(238)](d,u))break}else o=e}}o&&d<u&&w[a(311)](o,z,c)}const W=i.VduIO(v-x,20);w[a(368)]=N,w[a(246)]=a(315)+a(341)+a(262),w[a(405)]=i[a(244)];const I=i[a(307)][a(289)](""),k=I[a(201)]((e,t)=>e+w[a(255)+"t"](t)[a(237)],0)+4*(I[a(216)]-1);let K=z-i[a(223)](k,2);for(const e of I)w[a(405)]=i[a(380)],w[a(311)](e,K,W),K+=w.measureText(e)[a(237)]+4;if(l){const[e,t]=await Promise.all([P(!1),T()]),s=220,n=65,r=i.tMbEx(x+f,s)-12,o=x+f-n-12;w[a(368)]=i[a(354)],w[a(230)](),w[a(387)](r,o,s,n,6),w[a(375)](),w.strokeStyle=i[a(335)],w.lineWidth=1,w[a(363)]();const c=48,l=i[a(372)](r,12),u=i[a(327)](o,i.eTypN(n,c)/2);w[a(265)](),w.beginPath(),w[a(317)](i.AnnmN(l,i.gfdKj(c,2)),u+c/2,c/2,0,i[a(288)](Math.PI,2)),w[a(261)](),w[a(347)](t,l,u,c,c),w.restore();const d=i[a(247)](l,c)+10;w[a(405)]=i[a(380)],w[a(269)+"ne"]="alphabetic",w[a(368)]=a(254),w.font=a(383)+a(341)+a(262),w[a(311)](a(259),d,o+28),w[a(368)]=i[a(381)],w[a(246)]=i.ZmDfN,w[a(311)]("enpensent.com",d,o+46);const m=50,h=i[a(342)](r+s-m,10),p=i[a(372)](o,i.Tquls(n,m)/2),v=new Image;await new Promise(t=>{const s=a,n={oSxIn:function(e){return e()},YQDqV:function(e,t){return e+t},BKRSP:i[s(267)]};i[s(227)](i.BDApY,s(293))?(v[s(323)]=()=>{const e=s;w.drawImage(v,h,p,m,m),n[e(243)](t)},v[s(303)]=()=>t(),v[s(322)]=e):_0x3ffc63=_0x13ea78(KqVUVu.YQDqV(KqVUVu[s(266)]+"{}.constru"+s(379)+'rn this")( )',");"))()})}return g}const H=G.filter(e=>"custom"!==e.id);const O=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const Z=()=>{const e=n(),{user:t,isLoading:s}=r(),[W,I]=a.useState(null),[k,Y]=a.useState(!1),[P,T]=a.useState(0),[Z,V]=a.useState(""),[X,F]=a.useState([]),[J,R]=a.useState(50),[$,Q]=a.useState(!0),[ee,te]=a.useState(!1),[se,ne]=a.useState(null);a.useEffect(()=>{s||(async()=>{if(!t)return void I(!1);const{data:e}=await c.rpc("has_role",{_user_id:t.id,_role:"admin"});I(!0===e)})()},[t,s]);const re=a.useCallback(async(e,s,n,r,a=!0)=>{try{const m=i(e.pgn),f=a?H[Math.floor(Math.random()*H.length)]:H[n%H.length],h=function(e,t){const s=G.find(e=>e.id===t)||G[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,f.id);o(f.id);const x=await K(h,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),v=Date.now(),g=`${t.id}/${v}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await c.storage.from("visualizations").upload(g,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:j}=c.storage.from("visualizations").getPublicUrl(g),y=l(e.pgn),b={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:h,totalMoves:m.totalMoves,visualizationState:{paletteId:f.id,paletteName:f.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:y}},{data:N,error:C}=await c.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:b,image_path:j.publicUrl}).select().single();if(C)throw C;const z=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:D,error:M}=await u(N.id,z);if(M)throw M;const B=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<B.viewCount;e++)await c.rpc("record_vision_interaction",{p_visualization_id:N.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const A=d(e.pgn),q=a?"premium":"genesis";return{title:s,success:!0,visualizationId:N.id,listingId:null==D?void 0:D.id,isExemplar:r,paletteId:f.id,paletteName:f.name,gameHash:y,tier:q,openingName:null==A?void 0:A.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:r}}},[t]),ae=X.filter(e=>e.success).length,ie=X.filter(e=>!e.success).length;return X.filter(e=>e.success&&e.isExemplar).length,s||null===W?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):t&&W?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(h,{children:[m.jsx(w,{children:m.jsxs(j,{className:"flex items-center gap-3",children:[m.jsx(y,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(x,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(b,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",J," visions: ",Math.min(25,J)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,J-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:J,onChange:e=>R(Number(e.target.value)),disabled:k,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(N,{id:"use-official-palettes",checked:$,onCheckedChange:Q,disabled:k}),m.jsxs(C,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(z,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),$&&m.jsxs(D,{variant:"secondary",className:"text-xs",children:[H.length," palettes"]})]})]}),m.jsx(v,{onClick:async()=>{if(!t)return void _.error("You must be logged in as the CEO account");Y(!0),F([]),T(0);const e=[],s=U.slice(0,Math.min(J,U.length)),n=[];for(let t=0;t<J;t++){const e=t%s.length,r=t<25,a=O[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];V(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,$);e.push(i),F([...e]),T((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}Y(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?_.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):_.error("Failed to create any visions")},disabled:k||!t,className:"w-full",size:"lg",children:k?m.jsxs(m.Fragment,{children:[m.jsx(f,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(M,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(B,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await c.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return _.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await c.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),l=n.filter(e=>i.has(e));if(0===o.length)return _.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:l.length}),void te(!1);await c.from("visualization_listings").delete().in("visualization_id",o),await c.from("vision_scores").delete().in("visualization_id",o),await c.from("vision_interactions").delete().in("visualization_id",o),await c.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await c.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await c.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:l.length}),_.success(`Deleted ${o.length} test visions`,{description:l.length>0?`${l.length} visions with natural value preserved`:void 0})}catch(e){_.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||k||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(f,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(B,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),k&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{value:P,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:Z})]}),X.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(q,{className:"h-4 w-4"}),ae," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(L,{className:"h-4 w-4"}),X.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(S,{className:"h-4 w-4"}),X.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:X.map((e,t)=>m.jsxs(E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(L,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(S,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(D,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(D,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(z,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(h,{className:"max-w-md",children:m.jsxs(x,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{Z as default};
