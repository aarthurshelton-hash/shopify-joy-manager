import{s as e,u as s,a as t,r as n,j as r,L as a,b7 as i,ca as c,C as o,x as l,y as d,aP as u,p as x,t as m,P as h,w as f,B as p,bM as j,cj as v,a9 as w,am as g,a1 as y,a2 as b,a3 as N,a4 as z,bC as C,a5 as B,cu as k,b as A}from"./index-CN5tH3TC.js";!function(){const e=D,s=P();for(;;)try{if(232747===-parseInt(e(238))/1*(-parseInt(e(236))/2)+-parseInt(e(179))/3+-parseInt(e(182))/4+parseInt(e(215))/5*(parseInt(e(220))/6)+-parseInt(e(211))/7+-parseInt(e(217))/8*(parseInt(e(231))/9)+parseInt(e(275))/10*(parseInt(e(240))/11))break;s.push(s.shift())}catch(t){s.push(s.shift())}}();const S=function(){const e=D,s={};s[e(191)]=e(212);const t=s;let n=!0;return function(s,r){const a=e,i={};i[a(207)]=function(e,s){return e!==s},i[a(245)]=t[a(191)];const c=i,o=n?function(){const e=a;if(!c[e(207)](c[e(245)],e(227))){const e=_0x465942?function(){if(_0x56b8d6){const e=_0x57cd86.apply(_0x26fb5b,arguments);return _0x36d825=null,e}}:function(){};return _0x35fed2=!1,e}if(r){const e=r.apply(s,arguments);return r=null,e}}:function(){};return n=!1,o}}()(void 0,function(){return S[D(239)]().search("(((.+)+)+)+$").toString().constructor(S).search("(((.+)+)+)+$")});S();const q=function(){let e=!0;return function(s,t){const n=e?function(){if(t){const e=t[D(178)](s,arguments);return t=null,e}}:function(){};return e=!1,n}}();async function M(s,t,n,r){const a=D,i={};i[a(265)]=function(e,s){return e===s},i[a(210)]=a(226)+"+$",i.AZqBG=function(e,s){return e!==s},i[a(216)]="DKFaS",i[a(255)]=function(e,s){return e+s},i[a(206)]=a(204),i[a(224)]=a(273);const c=i;try{const{data:i}=await async function(s){const t=D,n={};n[t(260)]=t(200)+"errides",n[t(266)]=function(e,s){return e!==s};const r=n;try{const{data:n,error:a}=await e[t(237)](r[t(260)])[t(201)]("*").eq(t(204),s)[t(186)]();if(a&&r[t(266)](a.code,t(192)))throw a;const i={};return i[t(194)]=n,i[t(264)]=null,i}catch(a){const e={};return e[t(194)]=null,e[t(264)]=a,e}}(s);if(!i){if(c[a(265)](a(273),c[a(224)])){const i={};i[a(204)]=s,i[a(232)+"rs"]=t,i[a(188)+"rs"]=n,i[a(198)+"y"]=r,i[a(219)]=1;const{error:c}=await e[a(237)]("palette_ov"+a(197))[a(214)](i);if(c)throw c;const o={error:null};return o[a(219)]=1,o}return _0x3ee8a3[a(239)]()[a(205)](cTRRGs[a(210)])[a(239)]()[a(268)+"r"](_0x4a2fe7)[a(205)](cTRRGs[a(210)])}if(!c[a(181)](c[a(216)],a(259))){const{error:o}=await e.from("palette_ov"+a(197)).update({white_colors:t,black_colors:n,modified_by:r,version:c.VkeTM(i[a(219)],1)}).eq(c[a(206)],s);if(o)throw o;return{error:null,version:c[a(255)](i[a(219)],1)}}{const e=_0x23427d[a(196)][a(249)+a(180)];(c[a(265)](null==e?void 0:e[a(250)],_0x3bebc0)||c[a(265)](null==e?void 0:e[a(274)+a(272)],_0x141949))&&_0x18a32f++}}catch(o){const e={};return e[a(264)]=o,e[a(219)]=0,e}}function D(e,s){e-=178;const t=P();let n=t[e];if(void 0===D.jpBNHX){var r=function(e){let s="",t="",n=s+r;for(let r,a,i=0,c=0;a=e.charAt(c++);~a&&(r=i%4?64*r+a:a,i++%4)?s+=n.charCodeAt(c+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=s.length;r<a;r++)t+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)};D.bzLzeF=r,D.wAWbqt={},D.jpBNHX=!0}const a=e+t[0],i=D.wAWbqt[a];if(i)n=i;else{const e=function(e){this.vbATPf=e,this.MOZlJe=[1,0,0],this.kZcvVs=function(){return"newState"},this.NTUpju="\\w+ *\\(\\) *{\\w+ *",this.QVOLiy="['|\"].+['|\"];? *}"};e.prototype.KySRew=function(){const e=new RegExp(this.NTUpju+this.QVOLiy).test(this.kZcvVs.toString())?--this.MOZlJe[1]:--this.MOZlJe[0];return this.cuhqhj(e)},e.prototype.cuhqhj=function(e){return Boolean(~e)?this.boKKSZ(this.vbATPf):e},e.prototype.boKKSZ=function(e){for(let s=0,t=this.MOZlJe.length;s<t;s++)this.MOZlJe.push(Math.round(Math.random())),t=this.MOZlJe.length;return e(this.MOZlJe[0])},new e(D).KySRew(),n=D.bzLzeF(n),D.wAWbqt[a]=n}return n}function P(){const e=["yxbWBhK","nduYotmXyxDAufLX","Aw9Uu3rHDgu","qvPXqKC","ody1otCYDhHXsMDQ","Bg9N","A2LUzYbHzg1PBG","rKTPCgm","C2LUz2XL","AwqSigDHBwvFza","yMXHy2TFy29SBW","AgfZx3jVBgu","BMn0Aw9UkcKG","zMfjDK8","ueDsu1qXmty","yKXPq0y","zgf0yq","B3jKzxi","z2fTzv9KyxrH","zxjYAwrLCW","Bw9KAwzPzwrFyG","ufHPt0y","CgfSzxr0zv9VDG","C2vSzwn0","yxrPB25ZoG","zxHJzxb0Aw9U","CgfSzxr0zv9Pza","C2vHCMnO","AeTbzgK","r1LNDxm","vefKALO","CMv0DxjUicHMDq","thPequG","mtu2nZC0ofjkz05vva","weLOuhi","z29jqK4","Aw5Zzxj0","nxrouKH6yq","wwXOtNC","mtu3nZeYzej0v0nK","uNDWs28","DMvYC2LVBG","mtGYmJiZnNrRBvzWBq","CM4GDgHPCYiPka","Aw5MBW","D2HPDgu","DgzbEgi","Avz2vKq","kcGOlISPkYKRkq","EhDgz0G","BwXuyuy","ruHZDMm","shvkB1a","nJnds09lqw8","D2HPDgvFy29SBW","qvb0zeS","x3vZzxjFAwq","DgfIBgu","mLrhtMjKzG","zNjVBq","mtK4mZyYA1rMuuHe","Dg9tDhjPBMC","nta2mtiYmwXxuuzRrq","y3joB1u","D2fYBG","BgvUz3rO","y29UC29Szq","rfrlCLm","zcb2Axn1ywXPEG","x3jVBgu","zgvSzxrL","DMLZDwfSAxPHDa","CgfSzxr0zuLK","txj0tgS","rxjYB3iGy2HLyW","DgLUzYbSAw5Rzq","rxjYB3iGy291BG","vMTLve0","whbIz1O","yxrH","zfrOEeW","reTgyvm","Bw9qA0y","ywXPEMf0Aw9UCW","ihjVBgu6","ve1UzMm","zxjYB3i","z3Lpr2C","reXoBNm","yMLUza","y29UC3rYDwn0BW","zg1PBIbJAgvJAW","yMXHy2S","sungt08","DhrLswq","vwzWBhe","BgLUA2vKugfSzq","mtbNvwjlwwC","tNbAsu8"];return(P=function(){return e})()}async function _(s){const t=D,n={PXiOF:function(e,s){return e!==s}};n[t(251)]=t(228),n[t(276)]="saved_visu"+t(261),n[t(233)]=function(e,s){return e===s},n[t(258)]=t(254)+t(253)+t(246)+t(202);const r=n;try{if(r[t(199)](r[t(251)],t(218))){const{data:n,error:a}=await e.from(r[t(276)])[t(201)](t(187)+t(257));if(a)throw a;let i=0;for(const e of n||[]){const n=e[t(196)].visualizationState;(r[t(233)](null==n?void 0:n[t(250)],s)||(null==n?void 0:n[t(274)+t(272)])===s)&&i++}return i}return _0x4a5bbc[t(264)](t(252)+t(184)+t(262),_0x55c79e),!1}catch(a){return 0}}q(void 0,function(){const e=D,s={TMnfc:function(e,s){return e+s},bLiCF:e(209)+e(190),EHsvc:'{}.constructor("retu'+e(221)+" )",OaLus:function(e){return e()},JXoBj:e(242),crNoU:e(222),XpbgZ:"error",jkCwH:e(203),TAdjZ:"trace"};let t;try{const n=Function(s[e(263)](s[e(193)]+s[e(229)],");"));t=s.OaLus(n)}catch(a){t=window}const n=t[e(244)]=t[e(244)]||{},r=[e(183),s.JXoBj,s[e(241)],s[e(256)],s.jkCwH,e(235),s[e(208)]];for(let i=0;i<r[e(243)];i++){const s=q[e(268)+"r"].prototype[e(267)](q),t=r[i],a=n[t]||s;s.__proto__=q[e(267)](q),s[e(239)]=a[e(239)][e(267)](a),n[t]=s}})();const K=["k","q","r","b","n","p"],L={k:"King",q:"Queen",r:"Rook",b:"Bishop",n:"Knight",p:"Pawn"},H=()=>{var S,q,P,H;const{user:Z}=s(),O=t(),[X,G]=n.useState(!1),[U,T]=n.useState(!0),[W,Y]=n.useState([]),[I,J]=n.useState(null),[R,F]=n.useState(null),[V,E]=n.useState({}),[$,Q]=n.useState(!1),[ee,se]=n.useState(!1);n.useEffect(()=>{(async()=>{if(!Z)return void O("/");if(!(await async function(s){const t=D,n={};n[t(230)]=t(189),n[t(213)]=t(271);const r=n;try{const n={};n[t(234)]=s,n[t(247)]="admin";const{data:a,error:i}=await e.rpc(r.HuJoP,n);if(i){if("BZrxQ"===r[t(213)]){const e=_0x37b117[t(178)](_0x1370a6,arguments);return _0x146d03=null,e}return!1}return!0===a}catch(a){return!1}}(Z.id)))return A.error("Access denied",{description:"Admin privileges required"}),void O("/");G(!0),await te(),T(!1)})()},[Z,O]);const te=async()=>{const{data:s}=await async function(){const s=D,t={};t.iVvVD="palette_ov"+s(197),t[s(185)]=s(204);const n=t;try{const{data:t,error:r}=await e[s(237)](n[s(225)])[s(201)]("*")[s(195)](n[s(185)]);if(r)throw r;const a={};return a[s(194)]=t||[],a[s(264)]=null,a}catch(r){const e={data:[]};return e[s(264)]=r,e}}();Y(s);const t={};for(const e of c.filter(e=>"custom"!==e.id))t[e.id]=await _(e.id);E(t)},ne=e=>{const s=c.find(s=>s.id===e);if(!s)return;const t=W.find(s=>s.palette_id===e);J(e),F({white:(null==t?void 0:t.white_colors)||{...s.white},black:(null==t?void 0:t.black_colors)||{...s.black}})},re=(e,s,t)=>{R&&F({...R,[e]:{...R[e],[s]:t}})},ae=async()=>{if(!I||!R||!Z)return;Q(!0),se(!1);const{error:e,version:s}=await M(I,R.white,R.black,Z.id);e?A.error("Failed to save",{description:e.message}):(A.success("Palette updated!",{description:`Version ${s} saved. ${V[I]||0} visualizations will use the new colors.`}),await te()),Q(!1)},ie=e=>c.find(s=>s.id===e),ce=e=>W.some(s=>s.palette_id===e);return U?r.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:r.jsx(a,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):X?r.jsxs("div",{className:"min-h-screen bg-background",children:[r.jsxs("div",{className:"container max-w-6xl py-8",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[r.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:r.jsx(i,{className:"h-6 w-6 text-primary"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Palette Administration"}),r.jsx("p",{className:"text-muted-foreground text-sm",children:"Modify featured palette colors. Changes propagate to all linked visualizations."})]})]}),r.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("h2",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Featured Palettes"}),c.filter(e=>"custom"!==e.id).map(e=>r.jsx(o,{className:"cursor-pointer transition-all hover:border-primary/50 "+(I===e.id?"border-primary ring-1 ring-primary/20":""),onClick:()=>ne(e.id),children:r.jsxs(l,{className:"p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"font-medium text-sm",children:e.name}),r.jsxs("div",{className:"flex items-center gap-1.5",children:[ce(e.id)&&r.jsx(d,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:"Modified"}),V[e.id]>0&&r.jsxs(d,{variant:"outline",className:"text-[10px] px-1.5 py-0 gap-1",children:[r.jsx(u,{className:"h-2.5 w-2.5"}),V[e.id]]})]})]}),r.jsxs("div",{className:"flex gap-0.5",children:[K.map(s=>r.jsx("div",{className:"w-4 h-4 rounded-sm",style:{backgroundColor:e.white[s]}},`w-${s}`)),K.map(s=>r.jsx("div",{className:"w-4 h-4 rounded-sm",style:{backgroundColor:e.black[s]}},`b-${s}`))]})]})},e.id))]}),r.jsx("div",{className:"md:col-span-2",children:I&&R?r.jsxs(o,{children:[r.jsx(x,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs(m,{className:"flex items-center gap-2",children:[r.jsx(h,{className:"h-5 w-5"}),null==(S=ie(I))?void 0:S.name]}),r.jsx(f,{children:null==(q=ie(I))?void 0:q.description})]}),r.jsxs("div",{className:"flex gap-2",children:[ce(I)&&r.jsxs(p,{variant:"outline",size:"sm",onClick:async()=>{if(!I)return;Q(!0);const{error:s}=await async function(s){const t=D;try{const{error:n}=await e[t(237)]("palette_ov"+t(197))[t(248)]().eq(t(204),s);if(n)throw n;const r={};return r[t(264)]=null,r}catch(n){const e={};return e[t(264)]=n,e}}(I);s?A.error("Failed to revert",{description:s.message}):(A.success("Reverted to defaults"),ne(I),await te()),Q(!1)},disabled:$,children:[r.jsx(j,{className:"h-4 w-4 mr-1"}),"Revert"]}),r.jsxs(p,{size:"sm",onClick:async()=>{if(!I||!R||!Z)return;(V[I]||0)>0?se(!0):await ae()},disabled:$,children:[$?r.jsx(a,{className:"h-4 w-4 mr-1 animate-spin"}):r.jsx(v,{className:"h-4 w-4 mr-1"}),"Save Changes"]})]})]})}),r.jsxs(l,{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("h3",{className:"font-medium mb-3 text-sm",children:[null==(P=ie(I))?void 0:P.legendTheme.whiteEmoji," White Pieces"]}),r.jsx("div",{className:"grid grid-cols-3 gap-3",children:K.map(e=>r.jsxs("div",{className:"space-y-1.5",children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:L[e]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(w,{type:"color",value:R.white[e],onChange:s=>re("white",e,s.target.value),className:"w-10 h-8 p-0.5 cursor-pointer"}),r.jsx(w,{type:"text",value:R.white[e],onChange:s=>re("white",e,s.target.value),className:"h-8 text-xs font-mono"})]})]},`w-${e}`))})]}),r.jsxs("div",{children:[r.jsxs("h3",{className:"font-medium mb-3 text-sm",children:[null==(H=ie(I))?void 0:H.legendTheme.blackEmoji," Black Pieces"]}),r.jsx("div",{className:"grid grid-cols-3 gap-3",children:K.map(e=>r.jsxs("div",{className:"space-y-1.5",children:[r.jsx("label",{className:"text-xs text-muted-foreground",children:L[e]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(w,{type:"color",value:R.black[e],onChange:s=>re("black",e,s.target.value),className:"w-10 h-8 p-0.5 cursor-pointer"}),r.jsx(w,{type:"text",value:R.black[e],onChange:s=>re("black",e,s.target.value),className:"h-8 text-xs font-mono"})]})]},`b-${e}`))})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsxs("h3",{className:"font-medium mb-3 text-sm flex items-center gap-2",children:[r.jsx(g,{className:"h-4 w-4"}),"Color Preview"]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:"White"}),r.jsx("div",{className:"flex gap-1",children:K.map(e=>r.jsx("div",{className:"w-8 h-8 rounded-md shadow-sm",style:{backgroundColor:R.white[e]},title:L[e]},`preview-w-${e}`))})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:"Black"}),r.jsx("div",{className:"flex gap-1",children:K.map(e=>r.jsx("div",{className:"w-8 h-8 rounded-md shadow-sm",style:{backgroundColor:R.black[e]},title:L[e]},`preview-b-${e}`))})]})]})]})]})]}):r.jsx(o,{className:"h-full flex items-center justify-center",children:r.jsxs(l,{className:"text-center py-12",children:[r.jsx(h,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Select a palette to edit its colors"})]})})})]})]}),r.jsx(y,{open:ee,onOpenChange:se,children:r.jsxs(b,{children:[r.jsxs(N,{children:[r.jsxs(z,{className:"flex items-center gap-2",children:[r.jsx(C,{className:"h-5 w-5 text-amber-500"}),"Confirm Palette Update"]}),r.jsxs(B,{children:["This palette is linked to ",r.jsx("strong",{children:V[I||""]||0})," visualizations. Saving these changes will affect how all linked visualizations render."]})]}),r.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[r.jsx(p,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),r.jsxs(p,{onClick:ae,disabled:$,children:[$?r.jsx(a,{className:"h-4 w-4 mr-1 animate-spin"}):r.jsx(k,{className:"h-4 w-4 mr-1"}),"Confirm Update"]})]})]})})]}):null};export{H as default};
