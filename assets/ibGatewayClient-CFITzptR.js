const n="/**\n * IB Gateway Client\n * \n * Connects to IB Gateway through a local Node.js bridge.\n * The bridge translates HTTP requests to TWS API socket protocol.\n */\n\nimport { getBridgeUrl, getBridgeConfig } from './ibGatewayBridge';\n\nexport interface IBAccount {\n  accountId: string;\n  accountType: string;\n  balance: number;\n  buyingPower: number;\n  currency: string;\n}\n\nexport interface IBPosition {\n  conid: number;\n  symbol: string;\n  position: number;\n  marketValue: number;\n  avgCost: number;\n  unrealizedPnl: number;\n  realizedPnl: number;\n}\n\nexport interface IBOrder {\n  orderId: string;\n  conid: number;\n  symbol: string;\n  side: 'BUY' | 'SELL';\n  orderType: 'MKT' | 'LMT' | 'STP';\n  quantity: number;\n  filledQuantity: number;\n  price?: number;\n  status: string;\n}\n\nclass IBGatewayClient {\n  private connected = false;\n\n  /**\n   * Check if bridge and IB Gateway are connected\n   */\n  async checkConnection(): Promise<{ connected: boolean; authenticated: boolean; paperTrading: boolean }> {\n    try {\n      const config = getBridgeConfig();\n      const response = await fetch(`${getBridgeUrl()}/api/status`, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      if (!response.ok) {\n        return { connected: false, authenticated: false, paperTrading: false };\n      }\n\n      const data = await response.json();\n      this.connected = data.connected === true;\n      \n      return {\n        connected: data.bridgeRunning === true,\n        authenticated: data.connected === true,\n        paperTrading: config.gatewayPort === 4002, // 4002 = paper, 4001 = live\n      };\n    } catch (err) {\n      console.log('[IB Gateway] Bridge not available:', (err as Error).message);\n      return { connected: false, authenticated: false, paperTrading: false };\n    }\n  }\n\n  /**\n   * Connect the bridge to IB Gateway\n   */\n  async connect(): Promise<boolean> {\n    try {\n      const config = getBridgeConfig();\n      const response = await fetch(`${getBridgeUrl()}/api/connect`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          host: config.gatewayHost,\n          port: config.gatewayPort,\n          clientId: config.clientId,\n        }),\n      });\n      \n      if (!response.ok) return false;\n      \n      const data = await response.json();\n      this.connected = data.connected === true;\n      return this.connected;\n    } catch (err) {\n      console.error('[IB Gateway] Connect error:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Disconnect from IB Gateway\n   */\n  async disconnect(): Promise<void> {\n    try {\n      await fetch(`${getBridgeUrl()}/api/disconnect`, { method: 'POST' });\n      this.connected = false;\n    } catch {\n      // Ignore disconnect errors\n    }\n  }\n\n  /**\n   * Get accounts\n   */\n  async getAccounts(): Promise<IBAccount[]> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/accounts`);\n      if (!response.ok) return [];\n      \n      const data = await response.json();\n      return data.accounts || [];\n    } catch (err) {\n      console.error('[IB Gateway] Get accounts error:', err);\n      return [];\n    }\n  }\n\n  /**\n   * Get positions for an account\n   */\n  async getPositions(accountId: string): Promise<IBPosition[]> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/positions?accountId=${accountId}`);\n      if (!response.ok) return [];\n      \n      const data = await response.json();\n      return data.positions || [];\n    } catch (err) {\n      console.error('[IB Gateway] Get positions error:', err);\n      return [];\n    }\n  }\n\n  /**\n   * Get open orders\n   */\n  async getOrders(): Promise<IBOrder[]> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/orders`);\n      if (!response.ok) return [];\n      \n      const data = await response.json();\n      return data.orders || [];\n    } catch (err) {\n      console.error('[IB Gateway] Get orders error:', err);\n      return [];\n    }\n  }\n\n  /**\n   * Search for a contract\n   */\n  async searchContract(symbol: string): Promise<{ conid: number; symbol: string; description: string }[]> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/search?symbol=${encodeURIComponent(symbol)}`);\n      if (!response.ok) return [];\n      \n      const data = await response.json();\n      return data.contracts || [];\n    } catch (err) {\n      console.error('[IB Gateway] Search contract error:', err);\n      return [];\n    }\n  }\n\n  /**\n   * Place an order\n   */\n  async placeOrder(params: {\n    accountId: string;\n    conid: number;\n    symbol: string;\n    side: 'BUY' | 'SELL';\n    quantity: number;\n    orderType: 'MKT' | 'LMT';\n    price?: number;\n  }): Promise<{ orderId: string; status: string } | null> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/orders`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(params),\n      });\n      \n      if (!response.ok) {\n        console.error('[IB Gateway] Order failed');\n        return null;\n      }\n      \n      const data = await response.json();\n      return {\n        orderId: data.orderId || `ib-${Date.now()}`,\n        status: data.status || 'submitted',\n      };\n    } catch (err) {\n      console.error('[IB Gateway] Place order error:', err);\n      return null;\n    }\n  }\n\n  /**\n   * Cancel an order\n   */\n  async cancelOrder(orderId: string): Promise<boolean> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/orders/${orderId}`, {\n        method: 'DELETE',\n      });\n      return response.ok;\n    } catch (err) {\n      console.error('[IB Gateway] Cancel order error:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Get market data for a symbol\n   */\n  async getQuote(conid: number): Promise<{ lastPrice: number; bid: number; ask: number } | null> {\n    try {\n      const response = await fetch(`${getBridgeUrl()}/api/quote?conid=${conid}`);\n      if (!response.ok) return null;\n      \n      const data = await response.json();\n      return data;\n    } catch {\n      return null;\n    }\n  }\n}\n\nexport const ibGatewayClient = new IBGatewayClient();\n";export{n as default};
