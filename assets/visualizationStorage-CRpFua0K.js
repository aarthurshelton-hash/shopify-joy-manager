import{s as t,ca as n,dG as r,dH as e}from"./index-CESOpT9D.js";import{v as o,a as i,b as a}from"./visualizationSchemas-B9IvAbxR.js";import"./flagContent-a0U34DXL.js";!function(){const t=c,n=w();for(;;)try{if(568616===-parseInt(t(445))/1+parseInt(t(443))/2+parseInt(t(495))/3*(-parseInt(t(490))/4)+-parseInt(t(347))/5+parseInt(t(436))/6+-parseInt(t(499))/7+parseInt(t(518))/8*(parseInt(t(393))/9))break;n.push(n.shift())}catch(r){n.push(n.shift())}}();const s=function(){let t=!0;return function(n,r){const e=t?function(){if(r){const t=r[c(422)](n,arguments);return r=null,t}}:function(){};return t=!1,e}}()(void 0,function(){const t=c,n={};n.iwpsT=t(344)+"+$";const r=n;return s[t(412)]().search(r[t(410)]).toString()[t(486)+"r"](s)[t(507)](r.iwpsT)});s();const u=function(){let t=!0;return function(n,r){const e=t?function(){if(r){const t=r[c(422)](n,arguments);return r=null,t}}:function(){};return t=!1,e}}();function c(t,n){t-=343;const r=w();let e=r[t];if(void 0===c.xAupuk){var o=function(t){let n="",r="",e=n+o;for(let o,i,a=0,s=0;i=t.charAt(s++);~i&&(o=a%4?64*o+i:i,a++%4)?n+=e.charCodeAt(s+10)-10!=0?String.fromCharCode(255&o>>(-2*a&6)):a:0)i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(i);for(let o=0,i=n.length;o<i;o++)r+="%"+("00"+n.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(r)};c.LlRdxf=o,c.qUGJPf={},c.xAupuk=!0}const i=t+r[0],a=c.qUGJPf[i];if(a)e=a;else{const t=function(t){this.rlCEDO=t,this.YyRRDg=[1,0,0],this.TZxWOB=function(){return"newState"},this.wBWrBC="\\w+ *\\(\\) *{\\w+ *",this.ZAMIXj="['|\"].+['|\"];? *}"};t.prototype.ihqnGY=function(){const t=new RegExp(this.wBWrBC+this.ZAMIXj).test(this.TZxWOB.toString())?--this.YyRRDg[1]:--this.YyRRDg[0];return this.OJfZxx(t)},t.prototype.OJfZxx=function(t){return Boolean(~t)?this.CxjYfa(this.rlCEDO):t},t.prototype.CxjYfa=function(t){for(let n=0,r=this.YyRRDg.length;n<r;n++)this.YyRRDg.push(Math.round(Math.random())),r=this.YyRRDg.length;return t(this.YyRRDg[0])},new t(c).ihqnGY(),e=c.LlRdxf(e),c.qUGJPf[i]=e}return e}function f(t,n,r){const e=c,o={};o[e(380)]=e(417);const i=o;return(t||n[e(378)]||"")[e(416)]()[e(451)](/\s+/g," ")+"::"+(r?JSON.stringify({palette:r[e(390)]||i.ZvoaC,darkMode:r[e(456)]||!1,currentMove:r[e(525)+"e"]===1/0?e(487):r.currentMove,lockedPieces:(r[e(448)+"es"]||[]).sort((t,n)=>(t[e(460)]+"-"+t.pieceType).localeCompare(n.pieceColor+"-"+n[e(429)]))}):"{}")}async function l(o,i,a,s){const u=c,l={Awenn:function(t,n,r,e){return t(n,r,e)},ptTid:"saved_visu"+u(479),IAkib:"id, user_id, pgn, ga"+u(395),QRGEu:function(t,n){return t===n},zczzp:function(t,n){return t===n},NwSXb:"Exact dupl"+u(430)+"ts",MvExb:u(417),QMntB:function(t,n){return t===n},NnVqU:function(t,n){return t===n},MokPP:u(488),GNoMr:function(t,n,r,e,o,i){return t(n,r,e,o,i)},ptfcL:function(t,n){return t(n)}};try{const c=l[u(431)](f,i,a,s),{data:w,error:C}=await t[u(404)](l[u(362)])[u(388)](l.IAkib);if(C){const t={};return t[u(531)+"e"]=!1,t[u(407)+"ar"]=!1,t}for(const n of w||[]){const r=n[u(370)],e=l[u(431)](f,n[u(378)]||void 0,r,r[u(359)+u(348)]);if(l.QRGEu(c,e)){const r=l[u(391)](n[u(351)],o);let e;if(!r){const{data:r}=await t[u(404)](u(398)).select(u(506)+"me").eq(u(351),n[u(351)])[u(452)]();e=(null==r?void 0:r[u(506)+"me"])||u(403)+"llector"}const i={};return i[u(531)+"e"]=!0,i[u(407)+"ar"]=!0,i.existingId=n.id,i[u(427)+"rentUser"]=r,i["ownerDispl"+u(345)]=e,i[u(521)+"arity"]=100,i[u(376)]=l[u(527)],i}}const g=(null==s?void 0:s.paletteId)||l[u(483)];let y;if(null==s?void 0:s.customColors)y=s.customColors;else if(l[u(382)](g,u(522))){if(l[u(497)](u(444),l[u(464)])){_0x2615f9[u(363)]("Error in d"+u(386)+u(528),_0x2e64c4);const t={};return t[u(531)+"e"]=!1,t.isTooSimilar=!1,t}{const t=n[u(434)](t=>t.id===u(522));if(t){const n={};n.white=t[u(366)],n[u(374)]=t[u(374)],y=n}}}const x=await l[u(408)](r,o,i,a,g,y);if(x[u(407)+"ar"]){const t={isDuplicate:!1};return t[u(407)+"ar"]=!0,t[u(513)]=x["existingVisualizatio"+u(364)],t[u(427)+"rentUser"]=x[u(427)+u(475)],t[u(512)+u(345)]=x[u(512)+u(345)],t[u(521)+u(498)]=x[u(521)+u(498)],t[u(376)]=x[u(376)],t["existingCo"+u(399)]=x["existingCo"+u(399)],t[u(442)+u(343)]=x[u(442)+u(343)],t[u(442)+u(494)]=x[u(442)+"cGame"],t[u(508)+"eCard"]=x[u(508)+"eCard"],t[u(426)+u(437)]=x[u(426)+u(437)],t[u(426)+"etteSimila"+u(365)]=x[u(426)+u(454)+u(365)],t}let D;y&&(D=l[u(453)](e,y)||void 0);const z={isDuplicate:!1};return z[u(407)+"ar"]=!1,z["linkedPale"+u(394)]=D,z[u(521)+u(498)]=x[u(521)+u(498)],z[u(442)+u(343)]=x[u(442)+u(343)],z[u(442)+u(494)]=x[u(442)+"cGame"],z[u(508)+"eCard"]=x[u(508)+"eCard"],z[u(426)+u(437)]=x[u(426)+u(437)],z[u(426)+u(454)+"rity"]=x["matchedPal"+u(454)+u(365)],z}catch(w){const t={isDuplicate:!1};return t[u(407)+"ar"]=!1,t}}function w(){const t=["vwDHELq","y29SB3jtAw1PBa","y3vZDg9T","Bw92zxm","BgL6yxrPB246ia","y3vYCMvUDe1VDG","ywXPEMf0Aw9UoG","tNDtwgi","AgvJAZO","zMv0y2GGDMLZDq","C2f2zwrFDMLZDq","AxneDxbSAwnHDa","DxbSB2fK","Bg9JywXLq29TCa","y1bHBgv0Dgu","kcGOlISPkYKRkq","yxLoyw1L","CuzSBMi","mZaXmJC5nxD2se9hDq","Aw9Uu3rHDgu","EgztCwe","Aw4GEw91CIbNyq","DxnLCL9Pza","z01rALK","BM93","BIbIEsa","Dca4ignVBg9YCW","igzVCIb1BMLXDq","Dg9mB3DLCKnHCW","sw52ywXPzcbqrW","DMLZDwfSAxPHDa","lNbUzW","C3rVCMfNzq","ChruAwq","zxjYB3i","BKLK","CML0Eq","D2HPDgu","v25Pv2S","DgXL","CfDrzNq","z2fTzv9KyxrH","Dg8Gysb2AxnPBW","rMfPBgvKihrVia","AhvMqwG","yMXHy2S","vgHPCYb2Axn1yq","CMvHC29U","CYbVD25LzcbIEq","CgDU","z1ruC1q","wNzVyum","zgvSzxrLihzPCW","uu1UDei","rfHdBhm","DNfOEvi","yw5VDgHLCIbJBW","DxbSAwnHDguGyW","vMLZDwfSAxPHDa","C2vSzwn0","wgrnzeC","CgfSzxr0zuLK","EMn6ENa","Aw9UCW","oti3nZy1uffkEvvH","DhrLswq","BwvFzgf0yq","swDutNm","zgf0zq","ChjVzMLSzxm","Bg9YCW","ChjVDg90ExbL","C2f2zsb2Axn1yq","CMvZDwX0","qw5VDgHLCIbJBW","zNjVBq","Dw5K","ww91igHHDMuGyq","AxnuB29tAw1PBa","r05Vtxi","z2u6ia","AxDWC1q","A2LUzYbKDxbSAq","Dg9tDhjPBMC","B250zw50","jsbZAw1PBgfYia","C3vJy2vZCW","DhjPBq","Bw9KzxjU","y3rVCIGICMv0Dq","ueDsu1qXmty","z2fTzurHDge","ruf1tLq","yxbWBhK","tIbKyxrH","vgHPCYbPCYa","sw52ywXPzcb0Aq","Bwf0y2HLzfbHBa","B3DUzwrcEun1CG","DxbZzxj0","CgLLy2vuExbL","AwnHDguGzxHPCW","qxDLBM4","zw5LC3m","BwvZC2fNzq","zMLUza","CMv0DxjUicHMDq","ntm3mdq5mKLqEKzswG","zxr0zuLK","Aw1Hz2uVCg5N","BgLUA2vKugfSzq","y29UC29Szq","zxnvwKi","AxnjBNrYAw5ZAq","mJa4mdK1nK1ttezmqq","B3fqC0O","odGXnJq3vg5uy1jc","sKzqqwm","Dhj5ignOyw5NAq","Bg9JA2vKugLLyW","rxjYB3iGAw4Gza","DhjHy2u","CMvWBgfJzq","C2LUz2XL","ChrMy0W","zxr0zvnPBwLSyq","y29UDgvUDfr5Ca","zgfYA01Vzgu","BgXLy3rVCG","BMCGyxqGBgvHCW","yMLUza","CgLLy2vdB2XVCG","A3D2zMu","zxzLBNq","C29YDa","tw9Rufa","zgf0yq","DxbSB2fKigLTyq","ihzLCNKGC2LTAq","C2fMzq","CM4GDgHPCYiPka","u1fkzKC","y3jLyxrLzf9HDa","CYbHBhjLywr5ia","DwfSAxPHDgLVBG","ruXwt1y","CMvUDfvZzxi","ALDuuxG","yM9HCMq","vujVu2y","ywXPEMf0Aw9UCW","txPTvKq","v3LoqMK","Dg90ywXnB3zLCW","txzfEgi","Aw9Uig5VDcbMBW","yKTesxm","y29UC3rYDwn0BW","ywXS","quHgEuW","D2fYBG","mtG1otz5vhLmt0O","zxHJzxb0Aw9U","Cgf0Ag5HBwu","ywLUCYbPBMfWCa","y0DHBwu","mJCZDxjLs1D6","BePOCxK","tM5wCvu","yxjPDhK","mJCXmJeWohfqD3DhAG","uufAtxq","y2f0zxm6","CM91BMq","yxnJzw5KAw5N","yxjL","y3vZDg9Tq29SBW","zgLZCgXHEv9Uyq","C2vHCMnO","Bwf0y2HLzeDHBq","rxjYB3iGy2HLyW","CMvTB3zL","A2fMvM0","B3DUzxjeAxnWBa","zxHPC3rPBMDjza","ALDOEgq","BgL6yxrPB24GAq","wfbyq1a","ww5OCe0","nZjACwrqBwy","tNPHtxi"];return(w=function(){return t})()}async function C(n,r,e,s,u,f){const w=c,C={SQJfG:"modern",XPXCP:function(t,n){return t===n},MzmVD:w(487),qFlnb:function(t,n){return t(n)},XdMdG:w(425)+w(368),pWQft:function(t,n){return t(n)},WyNBi:w(517),kafVm:"Title cont"+w(493)+"ropriate c"+w(413),nCPmu:w(519),gMQjY:"This visualization i"+w(472)+w(350)+"llery",jWTQx:"qHrcM",hufAh:w(385)+w(457),jWhxd:w(438),ftNWL:w(530)+w(479),JFPAc:function(t,n){return t||n}};try{const c=C[w(346)](o,r);if(!c[w(415)])return{data:null,error:new Error(c[w(363)]||C[w(389)])};const g=await C[w(369)](i,r);if(!g[w(468)]){if(C[w(481)]===w(517))return{data:null,error:new Error(g[w(376)]||C[w(511)])};throw new _0x2022c9("Failed to "+w(466)+w(409)+_0x37b3e3[w(433)])}const y=C.pWQft(a,u);if(!y[w(415)])return{data:null,error:new Error(y[w(363)]||w(358)+w(423))};const x=await l(n,u,e[w(420)],f);if(x[w(531)+"e"]){if(C.nCPmu==C.nCPmu){const t=x[w(427)+w(475)]?C[w(352)]:w(375)+w(515)+w(377)+" "+(x.ownerDisplayName||w(385)+"llector");return{data:null,error:new Error(t),isDuplicate:!0,ownedByCurrentUser:x[w(427)+w(475)],ownerDisplayName:x[w(512)+w(345)],colorSimilarity:100}}{const t=(_0xe562b8||_0x48c407.pgn||"")[w(416)]()[w(451)](/\s+/g," ");return t+"::"+(_0x5d6327?_0xd46e81.stringify({palette:_0xd722ca.paletteId||C[w(470)],darkMode:_0x37f164[w(456)]||!1,currentMove:C[w(516)](_0x2babaf[w(525)+"e"],_0x2c33a3)?C[w(480)]:_0x11396c[w(525)+"e"],lockedPieces:(_0x22f086.lockedPieces||[])[w(463)]((t,n)=>(t[w(460)]+"-"+t[w(429)])[w(533)+w(504)](n.pieceColor+"-"+n.pieceType))}):"{}")}}if(x[w(407)+"ar"]){if("PESrJ"!==C[w(476)]){const t=x[w(427)+"rentUser"]?w(406)+w(467)+"lar visualization - "+w(447)+w(458)+w(355)+w(356)+w(432):w(424)+Math[w(502)](x[w(521)+w(498)]||30)+(w(414)+w(371)+w(354))+(x[w(512)+w(345)]||C[w(373)]);return{data:null,error:new Error(t),isTooSimilar:!0,ownedByCurrentUser:x[w(427)+w(475)],ownerDisplayName:x[w(512)+w(345)],colorSimilarity:x[w(521)+"arity"],reason:x.reason}}_0x3780b1=_0x1af8db}const D={...f};D.linkedPaletteId=x[w(439)+w(394)];const z=D,d=n+"/"+Date[w(353)]()+"-"+r[w(451)](/[^a-z0-9]/gi,"-")[w(357)+"e"]()+w(360),B={};B[w(455)+"e"]=C[w(514)],B[w(428)]=!1;const{error:q}=await t[w(361)][w(404)](w(359)+w(392))[w(532)](d,s,B);if(q)throw new Error("Failed to upload image: "+q[w(433)]);const{data:h}=t.storage[w(404)](w(359)+"ions").getPublicUrl(d),v={};v[w(366)]=e[w(420)].white,v[w(374)]=e[w(420)][w(374)],v.event=e[w(420)][w(462)],v[w(397)]=e[w(420)][w(397)],v[w(402)]=e[w(420)].result,v.pgn=e[w(420)].pgn,v[w(523)]=e[w(420)][w(523)],v[w(477)]=e[w(477)],v.totalMoves=e[w(482)],v.visualizationState=z;const L=v,{data:M,error:p}=await t.from(C.ftNWL).insert({user_id:n,title:r,pgn:C[w(446)](u,null),game_data:L,image_path:h.publicUrl})[w(388)]().single();if(p)throw await t[w(361)][w(404)](w(359)+"ions")[w(510)]([d]),new Error(w(372)+w(401)+w(524)+p.message);const A={};return A[w(465)]=M,A[w(363)]=null,A}catch(g){const t={};return t[w(465)]=null,t[w(363)]=g,t}}async function g(n){const r=c,e={};e[r(349)]=function(t,n){return t!==n},e[r(367)]="cbvyN";const o=e;try{if(!o[r(349)]("cbvyN",o.WniWk)){const e={};e[r(503)]=!1;const{data:o,error:i}=await t[r(404)](r(530)+r(479))[r(388)]("*").eq("user_id",n).order(r(471),e);if(i)throw new Error(r(372)+r(529)+r(479)+": "+i.message);const a={};return a[r(465)]=o||[],a.error=null,a}_0x49aeb0=_0x4d0765[r(505)+"rs"]}catch(i){const t={};return t[r(465)]=[],t[r(363)]=i,t}}async function y(n,r){const e=c,o={};o[e(441)]="UBoSf";const i=o;try{const o=new URL(r)[e(492)].split("/"),a=o.findIndex(t=>t===e(359)+e(392)),s=o.slice(a+1).join("/");s&&await t[e(361)][e(404)](e(359)+e(392)).remove([s]);const{error:u}=await t[e(404)](e(530)+e(479)).delete().eq("id",n);if(u){if(e(478)===i.esUZB)throw new Error(e(372)+e(381)+e(473)+": "+u.message);{const t=_0x25e6c3[e(422)](_0x2d254a,arguments);return _0x5992a6=null,t}}const c={error:null};return c}catch(a){const t={};return t.error=a,t}}u(void 0,function(){const t=c,n={lJhqy:function(t,n){return t(n)},bKDIs:function(t,n){return t+n},vqhyR:function(t){return t()},UgazT:"error",EAuNT:t(491),DXCls:"table",gTTsT:t(450),ELVOV:function(t,n){return t<n}};let r;try{const e=n[t(496)](Function,n[t(485)](t(435)+"nction() {}.constru"+t(418)+t(469)+" )",");"));r=n[t(384)](e)}catch(i){r=window}const e=r[t(440)]=r.console||{},o=["log",t(489),"info",n[t(520)],n[t(421)],n[t(383)],n[t(379)]];for(let a=0;n[t(474)](a,o.length);a++){const n=u.constructor[t(400)].bind(u),r=o[a],i=e[r]||n;n.__proto__=u.bind(u),n[t(412)]=i.toString[t(459)](i),e[r]=n}})();export{l as checkDuplicateVisualization,y as deleteVisualization,g as getUserVisualizations,C as saveVisualization};
