const e='/**\n * PaletteOwnershipCard\n * \n * Displays palette ownership and credit score information for a game/palette combination.\n * Shows who owns different colorways of the current game and their market value.\n */\n\nimport React, { useState, useEffect, useMemo } from \'react\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport { Crown, User, TrendingUp, Palette, Lock, Sparkles, Eye } from \'lucide-react\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Button } from \'@/components/ui/button\';\nimport { Skeleton } from \'@/components/ui/skeleton\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { colorPalettes, PaletteId } from \'@/lib/chess/pieceColors\';\nimport { getGamePaletteAvailability, GamePaletteAvailability, PaletteAvailabilityInfo } from \'@/lib/visualizations/paletteAvailability\';\nimport { useAuth } from \'@/hooks/useAuth\';\n\ninterface PaletteOwnershipCardProps {\n  pgn: string;\n  currentPaletteId?: PaletteId;\n  onPaletteSelect?: (info: PaletteAvailabilityInfo) => void;\n  compact?: boolean;\n}\n\ninterface VisionCreditScore {\n  visualizationId: string;\n  totalScore: number;\n  viewCount: number;\n  royaltyCentsEarned: number;\n}\n\nconst PaletteOwnershipCard: React.FC<PaletteOwnershipCardProps> = ({\n  pgn,\n  currentPaletteId,\n  onPaletteSelect,\n  compact = false,\n}) => {\n  const { user } = useAuth();\n  const [availability, setAvailability] = useState<GamePaletteAvailability | null>(null);\n  const [creditScores, setCreditScores] = useState<Map<string, VisionCreditScore>>(new Map());\n  const [isLoading, setIsLoading] = useState(true);\n  const [showAll, setShowAll] = useState(false);\n\n  // Fetch palette availability for this game\n  useEffect(() => {\n    if (!pgn) return;\n    \n    setIsLoading(true);\n    getGamePaletteAvailability(pgn, user?.id)\n      .then(result => {\n        setAvailability(result);\n        \n        // Fetch credit scores for taken palettes\n        const vizIds = result.takenPalettes.map(p => p.visualizationId).filter(Boolean) as string[];\n        if (vizIds.length > 0) {\n          fetchCreditScores(vizIds);\n        }\n      })\n      .finally(() => setIsLoading(false));\n  }, [pgn, user?.id]);\n\n  const fetchCreditScores = async (vizIds: string[]) => {\n    const { data: scores } = await supabase\n      .from(\'vision_scores\')\n      .select(\'visualization_id, total_score, view_count, royalty_cents_earned\')\n      .in(\'visualization_id\', vizIds);\n    \n    if (scores) {\n      const scoreMap = new Map<string, VisionCreditScore>();\n      scores.forEach(s => {\n        scoreMap.set(s.visualization_id, {\n          visualizationId: s.visualization_id,\n          totalScore: s.total_score,\n          viewCount: s.view_count,\n          royaltyCentsEarned: s.royalty_cents_earned,\n        });\n      });\n      setCreditScores(scoreMap);\n    }\n  };\n\n  // Memoized palette display list\n  const displayPalettes = useMemo(() => {\n    if (!availability) return [];\n    \n    const allPalettes = [...availability.takenPalettes, ...availability.availablePalettes];\n    \n    // Sort: current palette first, then taken (by score), then available\n    return allPalettes.sort((a, b) => {\n      // Current palette always first\n      if (a.paletteId === currentPaletteId) return -1;\n      if (b.paletteId === currentPaletteId) return 1;\n      \n      // Taken before available\n      if (a.isTaken && !b.isTaken) return -1;\n      if (!a.isTaken && b.isTaken) return 1;\n      \n      // Sort taken by credit score\n      if (a.isTaken && b.isTaken) {\n        const scoreA = a.visualizationId ? creditScores.get(a.visualizationId)?.totalScore || 0 : 0;\n        const scoreB = b.visualizationId ? creditScores.get(b.visualizationId)?.totalScore || 0 : 0;\n        return scoreB - scoreA;\n      }\n      \n      return 0;\n    });\n  }, [availability, currentPaletteId, creditScores]);\n\n  const visiblePalettes = showAll ? displayPalettes : displayPalettes.slice(0, compact ? 4 : 8);\n\n  if (isLoading) {\n    return (\n      <div className="p-3 rounded-lg border border-border/50 bg-card/50">\n        <div className="flex items-center gap-2 mb-3">\n          <Skeleton className="h-4 w-4" />\n          <Skeleton className="h-4 w-32" />\n        </div>\n        <div className="grid grid-cols-4 gap-2">\n          {[1, 2, 3, 4].map(i => (\n            <Skeleton key={i} className="h-12 w-full rounded" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!availability) return null;\n\n  const currentPaletteInfo = displayPalettes.find(p => p.paletteId === currentPaletteId);\n  const currentScore = currentPaletteInfo?.visualizationId \n    ? creditScores.get(currentPaletteInfo.visualizationId) \n    : null;\n\n  return (\n    <div className="p-3 rounded-lg border border-border/50 bg-card/50 space-y-3">\n      {/* Header */}\n      <div className="flex items-center justify-between">\n        <div className="flex items-center gap-2">\n          <Palette className="h-4 w-4 text-primary" />\n          <span className="text-xs font-medium uppercase tracking-wider text-muted-foreground">\n            Colorway Ownership\n          </span>\n        </div>\n        <div className="flex items-center gap-2">\n          <Badge variant="outline" className="text-[10px]">\n            {availability.totalTaken} / {availability.totalTaken + availability.totalAvailable} claimed\n          </Badge>\n        </div>\n      </div>\n\n      {/* Current Palette Credit Score */}\n      {currentPaletteInfo?.isTaken && currentScore && (\n        <div className="p-2 rounded bg-primary/5 border border-primary/20">\n          <div className="flex items-center justify-between">\n            <div className="flex items-center gap-2">\n              <Crown className="h-3 w-3 text-primary" />\n              <span className="text-xs text-muted-foreground">\n                {currentPaletteInfo.isOwnedByCurrentUser ? \'Your\' : `${currentPaletteInfo.ownerDisplayName}\'s`} {currentPaletteInfo.paletteName}\n              </span>\n            </div>\n            <div className="flex items-center gap-3 text-xs">\n              <span className="flex items-center gap-1">\n                <Eye className="h-3 w-3" />\n                {currentScore.viewCount}\n              </span>\n              <span className="flex items-center gap-1 text-primary font-medium">\n                <Sparkles className="h-3 w-3" />\n                {currentScore.totalScore.toFixed(1)} pts\n              </span>\n              {currentScore.royaltyCentsEarned > 0 && (\n                <span className="flex items-center gap-1 text-green-500">\n                  <TrendingUp className="h-3 w-3" />\n                  ${(currentScore.royaltyCentsEarned / 100).toFixed(2)}\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Palette Grid */}\n      <div className={`grid ${compact ? \'grid-cols-4\' : \'grid-cols-4 sm:grid-cols-6 lg:grid-cols-8\'} gap-1.5`}>\n        <AnimatePresence mode="popLayout">\n          {visiblePalettes.map(palette => {\n            const paletteData = colorPalettes.find(p => p.id === palette.paletteId);\n            const score = palette.visualizationId ? creditScores.get(palette.visualizationId) : null;\n            const isActive = palette.paletteId === currentPaletteId;\n            \n            return (\n              <TooltipProvider key={palette.paletteId}>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <motion.button\n                      layout\n                      initial={{ opacity: 0, scale: 0.8 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                      exit={{ opacity: 0, scale: 0.8 }}\n                      onClick={() => onPaletteSelect?.(palette)}\n                      className={`\n                        relative p-1.5 rounded border transition-all\n                        ${isActive \n                          ? \'border-primary ring-1 ring-primary/50\' \n                          : palette.isTaken \n                            ? \'border-amber-500/30 bg-amber-500/5\' \n                            : \'border-border/50 hover:border-primary/50\'\n                        }\n                      `}\n                    >\n                      {/* Color preview dots */}\n                      <div className="flex justify-center gap-0.5 mb-1">\n                        {paletteData && [\'k\', \'q\', \'r\'].map(piece => (\n                          <div\n                            key={piece}\n                            className="w-2 h-2 rounded-full"\n                            style={{ backgroundColor: paletteData.white[piece as keyof typeof paletteData.white] }}\n                          />\n                        ))}\n                      </div>\n                      \n                      {/* Palette name */}\n                      <p className="text-[8px] text-center truncate text-muted-foreground">\n                        {palette.paletteName.split(\' \')[0]}\n                      </p>\n                      \n                      {/* Ownership indicator */}\n                      {palette.isTaken && (\n                        <div className="absolute -top-1 -right-1">\n                          {palette.isOwnedByCurrentUser ? (\n                            <Crown className="h-3 w-3 text-primary" />\n                          ) : (\n                            <Lock className="h-2.5 w-2.5 text-amber-500" />\n                          )}\n                        </div>\n                      )}\n                      \n                      {/* Score badge */}\n                      {score && score.totalScore > 0 && (\n                        <div className="absolute -bottom-1 left-1/2 -translate-x-1/2">\n                          <Badge variant="secondary" className="text-[7px] px-1 py-0 h-3">\n                            {score.totalScore.toFixed(0)}\n                          </Badge>\n                        </div>\n                      )}\n                    </motion.button>\n                  </TooltipTrigger>\n                  <TooltipContent side="top" className="text-xs">\n                    <div className="space-y-1">\n                      <p className="font-medium">{palette.paletteName}</p>\n                      {palette.isTaken ? (\n                        <>\n                          <p className="text-muted-foreground">\n                            Owned by {palette.isOwnedByCurrentUser ? \'you\' : palette.ownerDisplayName}\n                          </p>\n                          {score && (\n                            <p className="text-primary">Score: {score.totalScore.toFixed(1)} pts</p>\n                          )}\n                          {palette.isListedForSale && palette.listingPriceCents && (\n                            <p className="text-green-500">\n                              For sale: ${(palette.listingPriceCents / 100).toFixed(2)}\n                            </p>\n                          )}\n                        </>\n                      ) : (\n                        <p className="text-green-500">Available to claim</p>\n                      )}\n                    </div>\n                  </TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            );\n          })}\n        </AnimatePresence>\n      </div>\n\n      {/* Show more button */}\n      {displayPalettes.length > (compact ? 4 : 8) && (\n        <Button\n          variant="ghost"\n          size="sm"\n          className="w-full text-xs"\n          onClick={() => setShowAll(!showAll)}\n        >\n          {showAll ? \'Show less\' : `Show all ${displayPalettes.length} colorways`}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default PaletteOwnershipCard;\n';export{e as default};
