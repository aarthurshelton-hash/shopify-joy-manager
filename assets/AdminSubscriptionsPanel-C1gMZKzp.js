const e='import React, { useState } from \'react\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { \n  Crown,\n  Calendar,\n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  Users,\n  AlertTriangle,\n  CheckCircle2,\n  XCircle,\n  Clock,\n  ChevronRight,\n} from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \'@/components/ui/select\';\nimport { Avatar, AvatarImage, AvatarFallback } from \'@/components/ui/avatar\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { format, formatDistanceToNow, addDays } from \'date-fns\';\n\nexport const AdminSubscriptionsPanel: React.FC = () => {\n  const [statusFilter, setStatusFilter] = useState<string>(\'all\');\n\n  // Fetch subscriptions with user info\n  const { data: subscriptions, isLoading } = useQuery({\n    queryKey: [\'admin-subscriptions\', statusFilter],\n    queryFn: async () => {\n      let query = supabase\n        .from(\'user_subscriptions\')\n        .select(\'*\')\n        .order(\'created_at\', { ascending: false });\n\n      if (statusFilter !== \'all\') {\n        query = query.eq(\'subscription_status\', statusFilter);\n      }\n\n      const { data, error } = await query;\n      if (error) throw error;\n\n      // Get profiles for all subscription users\n      const userIds = data?.map(s => s.user_id) || [];\n      const { data: profiles } = await supabase\n        .from(\'profiles\')\n        .select(\'user_id, display_name, avatar_url\')\n        .in(\'user_id\', userIds.length > 0 ? userIds : [\'none\']);\n\n      return data?.map(sub => ({\n        ...sub,\n        profile: profiles?.find(p => p.user_id === sub.user_id),\n      })) || [];\n    },\n    staleTime: 30000,\n  });\n\n  // Calculate stats\n  const stats = {\n    active: subscriptions?.filter(s => s.subscription_status === \'active\').length || 0,\n    canceled: subscriptions?.filter(s => s.subscription_status === \'canceled\').length || 0,\n    pastDue: subscriptions?.filter(s => s.subscription_status === \'past_due\').length || 0,\n    trialing: subscriptions?.filter(s => s.subscription_status === \'trialing\').length || 0,\n    mrr: (subscriptions?.filter(s => s.subscription_status === \'active\').length || 0) * 700, // $7/month\n    expiringThisWeek: subscriptions?.filter(s => {\n      if (!s.current_period_end || s.subscription_status !== \'active\') return false;\n      const endDate = new Date(s.current_period_end);\n      const weekFromNow = addDays(new Date(), 7);\n      return endDate <= weekFromNow && endDate > new Date();\n    }).length || 0,\n  };\n\n  const formatCents = (cents: number) => `$${(cents / 100).toFixed(2)}`;\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \'active\':\n        return <Badge className="bg-green-500/10 text-green-600 border-green-500/30"><CheckCircle2 className="h-3 w-3 mr-1" />Active</Badge>;\n      case \'canceled\':\n        return <Badge className="bg-red-500/10 text-red-600 border-red-500/30"><XCircle className="h-3 w-3 mr-1" />Canceled</Badge>;\n      case \'past_due\':\n        return <Badge className="bg-yellow-500/10 text-yellow-600 border-yellow-500/30"><AlertTriangle className="h-3 w-3 mr-1" />Past Due</Badge>;\n      case \'trialing\':\n        return <Badge className="bg-blue-500/10 text-blue-600 border-blue-500/30"><Clock className="h-3 w-3 mr-1" />Trialing</Badge>;\n      default:\n        return <Badge variant="outline">{status || \'Unknown\'}</Badge>;\n    }\n  };\n\n  return (\n    <div className="space-y-6">\n      {/* Stats Row */}\n      <div className="grid grid-cols-2 md:grid-cols-6 gap-4">\n        <Card className="border-green-500/30 bg-gradient-to-br from-green-500/5 to-green-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <CheckCircle2 className="h-3 w-3" />\n              <span className="text-xs">Active</span>\n            </div>\n            <p className="text-xl font-bold text-green-500">{stats.active}</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <XCircle className="h-3 w-3" />\n              <span className="text-xs">Canceled</span>\n            </div>\n            <p className="text-xl font-bold">{stats.canceled}</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-yellow-500/30 bg-gradient-to-br from-yellow-500/5 to-yellow-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <AlertTriangle className="h-3 w-3" />\n              <span className="text-xs">Past Due</span>\n            </div>\n            <p className="text-xl font-bold text-yellow-600">{stats.pastDue}</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Clock className="h-3 w-3" />\n              <span className="text-xs">Trialing</span>\n            </div>\n            <p className="text-xl font-bold">{stats.trialing}</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <DollarSign className="h-3 w-3" />\n              <span className="text-xs">MRR</span>\n            </div>\n            <p className="text-xl font-bold text-primary">{formatCents(stats.mrr)}</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-orange-500/30 bg-gradient-to-br from-orange-500/5 to-orange-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <TrendingDown className="h-3 w-3" />\n              <span className="text-xs">Expiring Soon</span>\n            </div>\n            <p className="text-xl font-bold text-orange-500">{stats.expiringThisWeek}</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filter */}\n      <Select value={statusFilter} onValueChange={setStatusFilter}>\n        <SelectTrigger className="w-48">\n          <SelectValue placeholder="Filter by Status" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value="all">All Subscriptions</SelectItem>\n          <SelectItem value="active">Active</SelectItem>\n          <SelectItem value="canceled">Canceled</SelectItem>\n          <SelectItem value="past_due">Past Due</SelectItem>\n          <SelectItem value="trialing">Trialing</SelectItem>\n        </SelectContent>\n      </Select>\n\n      {/* Subscriptions List */}\n      <Card>\n        <CardHeader>\n          <CardTitle className="flex items-center gap-2">\n            <Crown className="h-5 w-5" />\n            Subscription Database\n          </CardTitle>\n          <CardDescription>\n            All premium subscriptions with renewal tracking\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className="flex items-center justify-center py-12">\n              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary" />\n            </div>\n          ) : (\n            <ScrollArea className="h-[500px]">\n              <div className="space-y-2">\n                {subscriptions?.map((sub) => (\n                  <div\n                    key={sub.id}\n                    className="flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-muted/30 transition-colors"\n                  >\n                    <div className="flex items-center gap-4">\n                      <Avatar className="h-10 w-10">\n                        <AvatarImage src={sub.profile?.avatar_url || undefined} />\n                        <AvatarFallback className="bg-primary/10 text-primary">\n                          {sub.profile?.display_name?.charAt(0).toUpperCase() || \'U\'}\n                        </AvatarFallback>\n                      </Avatar>\n\n                      <div>\n                        <p className="font-medium">{sub.profile?.display_name || \'Unknown User\'}</p>\n                        <p className="text-sm text-muted-foreground flex items-center gap-1">\n                          <Calendar className="h-3 w-3" />\n                          Started {formatDistanceToNow(new Date(sub.created_at), { addSuffix: true })}\n                        </p>\n                      </div>\n                    </div>\n\n                    <div className="flex items-center gap-6">\n                      {getStatusBadge(sub.subscription_status)}\n\n                      <div className="text-right">\n                        <p className="text-xs text-muted-foreground">Period End</p>\n                        <p className="font-medium">\n                          {sub.current_period_end \n                            ? format(new Date(sub.current_period_end), \'MMM d, yyyy\')\n                            : \'N/A\'}\n                        </p>\n                      </div>\n\n                      {sub.cancel_at_period_end && (\n                        <Badge variant="outline" className="bg-orange-500/10 text-orange-600 border-orange-500/30">\n                          <AlertTriangle className="h-3 w-3 mr-1" />\n                          Canceling\n                        </Badge>\n                      )}\n\n                      {sub.grace_period_end && (\n                        <div className="text-right">\n                          <p className="text-xs text-muted-foreground">Grace Period</p>\n                          <p className="font-medium text-orange-500">\n                            {format(new Date(sub.grace_period_end), \'MMM d\')}\n                          </p>\n                        </div>\n                      )}\n\n                      <ChevronRight className="h-5 w-5 text-muted-foreground" />\n                    </div>\n                  </div>\n                ))}\n\n                {subscriptions?.length === 0 && (\n                  <div className="text-center py-12 text-muted-foreground">\n                    <Crown className="h-12 w-12 mx-auto mb-4 opacity-50" />\n                    <p>No subscriptions found</p>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n';export{e as default};
