const n="import { supabase } from '@/integrations/supabase/client';\nimport { getIPGeolocationSecure, hashIP } from './geolocation';\n\n// Track user location on auth events (anonymized - no precise coordinates)\nexport async function trackUserLocation(userId: string): Promise<boolean> {\n  try {\n    const geo = await getIPGeolocationSecure();\n    \n    if (!geo) {\n      console.warn('Could not get geolocation data');\n      return false;\n    }\n\n    const ipHash = geo.ip ? hashIP(geo.ip) : null;\n\n    // Upsert location data - ANONYMIZED: no latitude/longitude stored\n    const { error } = await supabase\n      .from('user_location_analytics')\n      .upsert(\n        {\n          user_id: userId,\n          ip_hash: ipHash,\n          country: geo.country,\n          country_code: geo.countryCode,\n          region: geo.region,\n          city: geo.city,\n          // Precise coordinates removed for privacy - only country/region/city retained\n          latitude: null,\n          longitude: null,\n          timezone: geo.timezone,\n          last_seen_at: new Date().toISOString(),\n        },\n        {\n          onConflict: 'user_id',\n        }\n      );\n\n    if (error) {\n      console.error('Error tracking user location:', error);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error('Error in trackUserLocation:', error);\n    return false;\n  }\n}\n\n// Update last seen timestamp without full geo lookup\nexport async function updateLastSeen(userId: string): Promise<void> {\n  try {\n    await supabase\n      .from('user_location_analytics')\n      .update({ last_seen_at: new Date().toISOString() })\n      .eq('user_id', userId);\n  } catch (error) {\n    console.warn('Error updating last seen:', error);\n  }\n}\n";export{n as default};
