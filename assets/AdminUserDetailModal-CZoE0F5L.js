const e='import React from \'react\';\nimport { useQuery } from \'@tanstack/react-query\';\nimport { \n  Crown,\n  Calendar,\n  Eye,\n  Image,\n  Wallet,\n  Mail,\n  Phone,\n  X,\n  TrendingUp,\n  ShoppingBag,\n  DollarSign,\n  ArrowRightLeft,\n  Printer,\n  Download,\n  MapPin,\n  Clock,\n  User,\n  Activity,\n  Star,\n  BarChart3,\n} from \'lucide-react\';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \'@/components/ui/dialog\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Button } from \'@/components/ui/button\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Avatar, AvatarImage, AvatarFallback } from \'@/components/ui/avatar\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { Separator } from \'@/components/ui/separator\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { format, formatDistanceToNow } from \'date-fns\';\n\ninterface AdminUserDetailModalProps {\n  userId: string | null;\n  open: boolean;\n  onClose: () => void;\n}\n\nexport const AdminUserDetailModal: React.FC<AdminUserDetailModalProps> = ({\n  userId,\n  open,\n  onClose,\n}) => {\n  // Fetch complete user details\n  const { data: userDetails, isLoading } = useQuery({\n    queryKey: [\'admin-user-detail\', userId],\n    queryFn: async () => {\n      if (!userId) return null;\n      \n      // Get profile\n      const { data: profile } = await supabase\n        .from(\'profiles\')\n        .select(\'*\')\n        .eq(\'user_id\', userId)\n        .single();\n\n      // Get subscription\n      const { data: subscription } = await supabase\n        .from(\'user_subscriptions\')\n        .select(\'*\')\n        .eq(\'user_id\', userId)\n        .single();\n\n      // Get wallet\n      const { data: wallet } = await supabase\n        .from(\'user_wallets\')\n        .select(\'*\')\n        .eq(\'user_id\', userId)\n        .single();\n\n      // Get visions with scores\n      const { data: visions } = await supabase\n        .from(\'saved_visualizations\')\n        .select(`\n          id,\n          title,\n          created_at,\n          image_path,\n          game_data\n        `)\n        .eq(\'user_id\', userId)\n        .order(\'created_at\', { ascending: false });\n\n      // Get vision scores for this user\'s visions\n      const visionIds = visions?.map(v => v.id) || [];\n      const { data: scores } = await supabase\n        .from(\'vision_scores\')\n        .select(\'*\')\n        .in(\'visualization_id\', visionIds.length > 0 ? visionIds : [\'none\']);\n\n      // Get orders for this user\n      const { data: orders } = await supabase\n        .from(\'order_financials\')\n        .select(\'*\')\n        .eq(\'user_id\', userId)\n        .order(\'created_at\', { ascending: false });\n\n      // Get wallet transactions\n      const { data: transactions } = await supabase\n        .from(\'wallet_transactions\')\n        .select(\'*\')\n        .eq(\'user_id\', userId)\n        .order(\'created_at\', { ascending: false })\n        .limit(20);\n\n      // Get marketplace listings\n      const { data: listings } = await supabase\n        .from(\'visualization_listings\')\n        .select(\'*\')\n        .eq(\'seller_id\', userId)\n        .order(\'created_at\', { ascending: false });\n\n      // Get interactions summary\n      const { data: interactions } = await supabase\n        .from(\'vision_interactions\')\n        .select(\'interaction_type, value_cents, created_at\')\n        .eq(\'user_id\', userId);\n\n      // Calculate portfolio value\n      const portfolioValue = scores?.reduce((sum, s) => {\n        return sum + (s.total_score || 0) * 10 + (s.royalty_cents_earned || 0);\n      }, 0) || 0;\n\n      // Calculate projected growth (simple 5% monthly projection)\n      const projectedGrowth = portfolioValue * 0.05;\n\n      return {\n        profile,\n        subscription,\n        wallet,\n        visions: visions?.map(v => {\n          const score = scores?.find(s => s.visualization_id === v.id);\n          return {\n            ...v,\n            score: score?.total_score || 0,\n            views: score?.view_count || 0,\n            downloads: (score?.download_hd_count || 0) + (score?.download_gif_count || 0),\n            trades: score?.trade_count || 0,\n            printOrders: score?.print_order_count || 0,\n            royaltyEarned: score?.royalty_cents_earned || 0,\n            estimatedValue: (score?.total_score || 0) * 10 + (score?.royalty_cents_earned || 0),\n          };\n        }),\n        orders,\n        transactions,\n        listings,\n        interactions,\n        portfolioValue,\n        projectedGrowth,\n        totalOrderValue: orders?.reduce((sum, o) => sum + (o.gross_revenue_cents || 0), 0) || 0,\n        totalRoyalties: scores?.reduce((sum, s) => sum + (s.royalty_cents_earned || 0), 0) || 0,\n      };\n    },\n    enabled: !!userId,\n  });\n\n  const formatCents = (cents: number) => `$${(cents / 100).toFixed(2)}`;\n\n  const isPremium = userDetails?.subscription?.subscription_status === \'active\';\n\n  return (\n    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>\n      <DialogContent className="max-w-5xl max-h-[90vh] overflow-hidden">\n        <DialogHeader>\n          <DialogTitle className="flex items-center gap-4">\n            <Avatar className="h-14 w-14">\n              <AvatarImage src={userDetails?.profile?.avatar_url || undefined} />\n              <AvatarFallback className="bg-primary/10 text-primary text-xl">\n                {userDetails?.profile?.display_name?.charAt(0).toUpperCase() || \'U\'}\n              </AvatarFallback>\n            </Avatar>\n            <div>\n              <div className="flex items-center gap-2">\n                <span>{userDetails?.profile?.display_name || \'Anonymous User\'}</span>\n                {isPremium ? (\n                  <Badge className="bg-primary/20 text-primary border-primary/30">\n                    <Crown className="h-3 w-3 mr-1" />\n                    Premium\n                  </Badge>\n                ) : (\n                  <Badge variant="outline">Free Account</Badge>\n                )}\n              </div>\n              <p className="text-sm text-muted-foreground font-normal">\n                User ID: {userId}\n              </p>\n            </div>\n          </DialogTitle>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className="flex items-center justify-center py-12">\n            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary" />\n          </div>\n        ) : (\n          <ScrollArea className="h-[calc(90vh-120px)]">\n            <div className="space-y-6 pr-4">\n              {/* Quick Stats */}\n              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">\n                <Card>\n                  <CardContent className="pt-4 pb-3">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <Wallet className="h-3 w-3" />\n                      <span className="text-xs">Wallet Balance</span>\n                    </div>\n                    <p className="text-xl font-bold text-green-500">\n                      {formatCents(userDetails?.wallet?.balance_cents || 0)}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className="pt-4 pb-3">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <BarChart3 className="h-3 w-3" />\n                      <span className="text-xs">Portfolio Value</span>\n                    </div>\n                    <p className="text-xl font-bold text-primary">\n                      {formatCents(userDetails?.portfolioValue || 0)}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className="pt-4 pb-3">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <TrendingUp className="h-3 w-3" />\n                      <span className="text-xs">Projected Growth</span>\n                    </div>\n                    <p className="text-xl font-bold text-green-500">\n                      +{formatCents(userDetails?.projectedGrowth || 0)}/mo\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardContent className="pt-4 pb-3">\n                    <div className="flex items-center gap-2 text-muted-foreground mb-1">\n                      <DollarSign className="h-3 w-3" />\n                      <span className="text-xs">Total Royalties</span>\n                    </div>\n                    <p className="text-xl font-bold">\n                      {formatCents(userDetails?.totalRoyalties || 0)}\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Account Details */}\n              <Card>\n                <CardHeader className="pb-3">\n                  <CardTitle className="text-lg flex items-center gap-2">\n                    <User className="h-5 w-5" />\n                    Account Details\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">\n                    <div>\n                      <p className="text-muted-foreground">Joined</p>\n                      <p className="font-medium">\n                        {userDetails?.profile?.created_at \n                          ? format(new Date(userDetails.profile.created_at), \'MMM d, yyyy\')\n                          : \'Unknown\'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className="text-muted-foreground">Subscription</p>\n                      <p className="font-medium">\n                        {userDetails?.subscription?.subscription_status || \'None\'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className="text-muted-foreground">Period End</p>\n                      <p className="font-medium">\n                        {userDetails?.subscription?.current_period_end \n                          ? format(new Date(userDetails.subscription.current_period_end), \'MMM d, yyyy\')\n                          : \'N/A\'}\n                      </p>\n                    </div>\n                    <div>\n                      <p className="text-muted-foreground">Total Spent</p>\n                      <p className="font-medium text-primary">\n                        {formatCents(userDetails?.wallet?.total_spent_cents || 0)}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Visions Gallery */}\n              <Card>\n                <CardHeader className="pb-3">\n                  <CardTitle className="text-lg flex items-center gap-2">\n                    <Image className="h-5 w-5" />\n                    Vision Holdings ({userDetails?.visions?.length || 0})\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {userDetails?.visions && userDetails.visions.length > 0 ? (\n                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">\n                      {userDetails.visions.map((vision) => (\n                        <div \n                          key={vision.id}\n                          className="flex gap-4 p-3 rounded-lg border bg-muted/30"\n                        >\n                          <div className="w-20 h-20 rounded-lg overflow-hidden bg-muted flex-shrink-0">\n                            <img \n                              src={vision.image_path} \n                              alt={vision.title}\n                              className="w-full h-full object-cover"\n                            />\n                          </div>\n                          <div className="flex-1 min-w-0">\n                            <p className="font-medium truncate">{vision.title}</p>\n                            <p className="text-xs text-muted-foreground mb-2">\n                              Created {formatDistanceToNow(new Date(vision.created_at), { addSuffix: true })}\n                            </p>\n                            <div className="flex flex-wrap gap-2 text-xs">\n                              <Badge variant="outline" className="gap-1">\n                                <Eye className="h-3 w-3" />\n                                {vision.views}\n                              </Badge>\n                              <Badge variant="outline" className="gap-1">\n                                <Download className="h-3 w-3" />\n                                {vision.downloads}\n                              </Badge>\n                              <Badge variant="outline" className="gap-1">\n                                <ArrowRightLeft className="h-3 w-3" />\n                                {vision.trades}\n                              </Badge>\n                              <Badge variant="outline" className="gap-1">\n                                <Printer className="h-3 w-3" />\n                                {vision.printOrders}\n                              </Badge>\n                            </div>\n                            <div className="flex items-center justify-between mt-2">\n                              <span className="text-xs text-muted-foreground">Est. Value</span>\n                              <span className="font-medium text-green-500">\n                                {formatCents(vision.estimatedValue)}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className="text-center py-8 text-muted-foreground">\n                      <Image className="h-12 w-12 mx-auto mb-2 opacity-50" />\n                      <p>No visions in portfolio</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Order History */}\n              <Card>\n                <CardHeader className="pb-3">\n                  <CardTitle className="text-lg flex items-center gap-2">\n                    <ShoppingBag className="h-5 w-5" />\n                    Order History ({userDetails?.orders?.length || 0})\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {userDetails?.orders && userDetails.orders.length > 0 ? (\n                    <div className="space-y-2">\n                      {userDetails.orders.slice(0, 10).map((order) => (\n                        <div \n                          key={order.id}\n                          className="flex items-center justify-between p-3 rounded-lg border"\n                        >\n                          <div>\n                            <p className="font-medium capitalize">{order.order_type} Order</p>\n                            <p className="text-xs text-muted-foreground">\n                              {format(new Date(order.created_at), \'MMM d, yyyy h:mm a\')}\n                            </p>\n                          </div>\n                          <div className="text-right">\n                            <p className="font-medium text-green-500">\n                              {formatCents(order.gross_revenue_cents)}\n                            </p>\n                            <p className="text-xs text-muted-foreground">\n                              Ref: {order.order_reference || \'N/A\'}\n                            </p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className="text-center py-8 text-muted-foreground">\n                      <ShoppingBag className="h-12 w-12 mx-auto mb-2 opacity-50" />\n                      <p>No orders yet</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Wallet Transactions */}\n              <Card>\n                <CardHeader className="pb-3">\n                  <CardTitle className="text-lg flex items-center gap-2">\n                    <Activity className="h-5 w-5" />\n                    Recent Transactions\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {userDetails?.transactions && userDetails.transactions.length > 0 ? (\n                    <div className="space-y-2">\n                      {userDetails.transactions.map((tx) => (\n                        <div \n                          key={tx.id}\n                          className="flex items-center justify-between p-3 rounded-lg border"\n                        >\n                          <div>\n                            <p className="font-medium capitalize">{tx.transaction_type.replace(\'_\', \' \')}</p>\n                            <p className="text-xs text-muted-foreground">\n                              {tx.description || format(new Date(tx.created_at), \'MMM d, yyyy h:mm a\')}\n                            </p>\n                          </div>\n                          <div className="text-right">\n                            <p className={`font-medium ${tx.amount_cents >= 0 ? \'text-green-500\' : \'text-red-500\'}`}>\n                              {tx.amount_cents >= 0 ? \'+\' : \'\'}{formatCents(tx.amount_cents)}\n                            </p>\n                            <p className="text-xs text-muted-foreground">\n                              Balance: {formatCents(tx.balance_after_cents)}\n                            </p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className="text-center py-8 text-muted-foreground">\n                      <Activity className="h-12 w-12 mx-auto mb-2 opacity-50" />\n                      <p>No transactions yet</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </ScrollArea>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n';export{e as default};
