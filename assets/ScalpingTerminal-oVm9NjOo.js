const e='/**\n * Scalping Terminal\n * Full trading dashboard with real-time predictions and cross-market analysis\n * Integrated with Universal Heartbeat - CEO Alec Arthur Shelton exclusive\n */\n\nimport React, { useState, useCallback, useMemo, useEffect } from \'react\';\nimport { motion } from \'framer-motion\';\nimport { \n  Play, Pause, RotateCcw, Settings, Zap, Activity,\n  TrendingUp, TrendingDown, Radio, Clock, Globe, Sparkles, DollarSign, Target, AlertCircle\n} from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Switch } from \'@/components/ui/switch\';\nimport { Slider } from \'@/components/ui/slider\';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \'@/components/ui/select\';\nimport { Separator } from \'@/components/ui/separator\';\nimport { Tabs, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { cn } from \'@/lib/utils\';\nimport { useScalpingPredictor } from \'@/hooks/useScalpingPredictor\';\nimport { useMultiMarketStream } from \'@/hooks/useMultiMarketStream\';\nimport { useSimulatedPositions } from \'@/hooks/useSimulatedPositions\';\nimport { useTradingSessionStore } from \'@/stores/tradingSessionStore\';\nimport { PredictionHUD } from \'./PredictionHUD\';\nimport { LearningStatePanel } from \'./LearningStatePanel\';\nimport { PredictionStream } from \'./PredictionStream\';\nimport { TickChart } from \'./TickChart\';\nimport { MarketTicker } from \'./MarketTicker\';\nimport { BigPicturePanel } from \'./BigPicturePanel\';\nimport { PositionTracker } from \'./PositionTracker\';\nimport { GlobalAccuracyPanel } from \'./GlobalAccuracyPanel\';\nimport { SessionControl } from \'./SessionControl\';\nimport { HeartbeatIndicator } from \'@/components/pensent-code/HeartbeatIndicator\';\nimport { MarketLearningDashboard } from \'./MarketLearningDashboard\';\n\nconst SYMBOLS = [\'SPY\', \'QQQ\', \'AAPL\', \'NVDA\', \'TSLA\', \'MSFT\', \'AMD\', \'GOOGL\', \'BTC\', \'ETH\', \'GLD\', \'TLT\', \'UUP\', \'ES\'];\n\n// Safe loading component\nconst LoadingTerminal = ({ status }: { status: string }) => (\n  <div className="flex flex-col items-center justify-center p-8 gap-4 min-h-[400px]">\n    <motion.div\n      animate={{ rotate: 360 }}\n      transition={{ duration: 2, repeat: Infinity, ease: "linear" }}\n    >\n      <Activity className="w-8 h-8 text-primary" />\n    </motion.div>\n    <div className="text-muted-foreground">Initializing Trading Engine...</div>\n    <div className="text-xs text-muted-foreground">{status}</div>\n    <div className="text-xs text-muted-foreground/60">Demo mode activating automatically</div>\n  </div>\n);\n\nconst ScalpingTerminal: React.FC = () => {\n  // State declarations - all at top level, unconditionally\n  const [symbol, setSymbol] = useState(\'SPY\');\n  const [autoPredict, setAutoPredict] = useState(true);\n  const [predictionInterval, setPredictionInterval] = useState(3000);\n  const [showSettings, setShowSettings] = useState(false);\n  const [activeView, setActiveView] = useState<\'focus\' | \'bigpicture\' | \'positions\' | \'evolution\' | \'learning\'>(\'bigpicture\');\n  const [isReady, setIsReady] = useState(false);\n  const [initStatus, setInitStatus] = useState(\'Initializing...\');\n  const mountedRef = React.useRef(true);\n  \n  // All hooks called unconditionally at top level\n  const multiMarket = useMultiMarketStream();\n  const positionsTracker = useSimulatedPositions();\n  const tradingStore = useTradingSessionStore();\n  \n  // Stable config that only changes when needed\n  const predictorConfig = useMemo(() => ({\n    symbol: symbol || \'SPY\',\n    mode: \'real\' as const, // v7.51: REAL data only\n    predictionIntervalMs: predictionInterval,\n    autoPredict,\n    pollInterval: 1500 // v7.51: Poll for real data every 1.5s\n  }), [symbol, predictionInterval, autoPredict]);\n  \n  const predictor = useScalpingPredictor(predictorConfig);\n  \n  // Safe destructuring with defaults\n  const { \n    recordPrediction = () => {},\n    updateLiveMetrics = () => {},\n    evolutionState = { \n      metrics: { \n        generationNumber: 1, \n        learningVelocity: 0, \n        currentFitness: 0.5, \n        peakFitness: 0.5,\n        totalPredictions: 0,\n        successfulEvolutions: 0,\n        startedAt: Date.now(),\n        adaptationRate: 0.1\n      }, \n      patternLibrary: [],\n      genes: [],\n      correlationMemory: [],\n      adaptiveThresholds: { confidenceBoost: 0, horizonAdjust: 0, volatilityScale: 1 },\n      recentMutations: []\n    }\n  } = tradingStore || {};\n  \n  // Safe accessors with null checks - using useMemo for stability\n  const activeSignals = useMemo(() => \n    multiMarket?.bigPicture?.activeSignals ?? [], \n    [multiMarket?.bigPicture?.activeSignals]\n  );\n  \n  const predictionBoost = useMemo(() => \n    multiMarket?.bigPicture?.predictionBoost ?? 1.0, \n    [multiMarket?.bigPicture?.predictionBoost]\n  );\n  \n  const recentPredictions = useMemo(() => \n    predictor?.recentPredictions ?? [], \n    [predictor?.recentPredictions]\n  );\n  \n  const predictorStats = useMemo(() => \n    predictor?.stats ?? { \n      totalPredictions: 0,\n      accuracy: 0, \n      recentAccuracy: 0, \n      currentStreak: 0,\n      bestStreak: 0,\n      upPredictions: { total: 0, correct: 0, accuracy: 0 },\n      downPredictions: { total: 0, correct: 0, accuracy: 0 },\n      flatPredictions: { total: 0, correct: 0, accuracy: 0 }\n    }, \n    [predictor?.stats]\n  );\n  \n  const safeLearningState = useMemo(() => \n    predictor?.learningState ?? null, \n    [predictor?.learningState]\n  );\n\n  // Build correlated prices map from multi-market snapshot\n  const correlatedPrices = useMemo(() => {\n    const map = new Map<string, number>();\n    if (!multiMarket?.snapshot) return map;\n    \n    try {\n      Object.entries(multiMarket.snapshot).forEach(([, data]) => {\n        if (data?.symbol && data?.price) {\n          map.set(data.symbol, data.price);\n        }\n      });\n    } catch (error) {\n      console.error(\'[ScalpingTerminal] Error building correlated prices:\', error);\n    }\n    return map;\n  }, [multiMarket?.snapshot]);\n\n  // Track mount state\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n\n  // Mark as ready with AGGRESSIVE initialization - demo mode MUST work\n  useEffect(() => {\n    // Immediate activation in 500ms - don\'t wait for connections in demo mode\n    const immediateTimer = setTimeout(() => {\n      if (mountedRef.current && !isReady) {\n        console.log(\'[ScalpingTerminal] Quick activation - demo mode ready\');\n        setInitStatus(\'Demo mode active\');\n        setIsReady(true);\n      }\n    }, 500);\n    \n    return () => clearTimeout(immediateTimer);\n  }, [isReady]);\n  \n  // Update status messages based on connection state\n  useEffect(() => {\n    if (isReady) return; // Don\'t update status once ready\n    \n    const predictorConnected = predictor?.connected ?? false;\n    const multiMarketConnected = multiMarket?.connected ?? false;\n    \n    if (predictorConnected && multiMarketConnected) {\n      setInitStatus(\'All systems ready\');\n    } else if (predictorConnected) {\n      setInitStatus(\'Predictor ready...\');\n    } else if (multiMarketConnected) {\n      setInitStatus(\'Markets connected...\');\n    } else {\n      setInitStatus(\'Starting demo mode...\');\n    }\n  }, [predictor?.connected, multiMarket?.connected, isReady]);\n\n  // Sync prediction outcomes to global store\n  useEffect(() => {\n    if (!predictor || recentPredictions.length === 0) return;\n    \n    try {\n      const latest = recentPredictions[0];\n      if (!latest || latest.wasCorrect === undefined) return;\n      \n      const directionCorrect = latest.wasCorrect ?? false;\n      \n      recordPrediction({\n        predicted: latest.predictedDirection as \'up\' | \'down\' | \'neutral\',\n        actual: (latest.actualDirection || latest.predictedDirection) as \'up\' | \'down\' | \'neutral\',\n        confidence: latest.confidence ?? 0.5,\n        directionCorrect,\n        magnitudeAccuracy: (predictorStats.accuracy ?? 0) / 100,\n        timingAccuracy: (predictorStats.recentAccuracy ?? 0) / 100,\n        marketConditions: {\n          correlationStrength: predictionBoost ?? 1,\n          volatility: 0.5,\n          momentum: (predictorStats.currentStreak ?? 0) / 10,\n          leadingSignals: (activeSignals?.length ?? 0) / 10\n        }\n      });\n    } catch (error) {\n      console.error(\'[ScalpingTerminal] Error recording prediction:\', error);\n    }\n  }, [recentPredictions, recordPrediction, predictionBoost, activeSignals, predictorStats, predictor]);\n  \n  // Update live metrics\n  useEffect(() => {\n    if (!predictor) return;\n    \n    try {\n      updateLiveMetrics({\n        ticksProcessed: predictor.tickCount ?? 0,\n        currentSymbol: symbol,\n        isStreaming: (predictor.connected ?? false) && autoPredict\n      });\n    } catch (error) {\n      console.error(\'[ScalpingTerminal] Error updating live metrics:\', error);\n    }\n  }, [predictor, predictor?.tickCount, symbol, predictor?.connected, autoPredict, updateLiveMetrics]);\n  \n  // Handlers with safe checks\n  const handleSymbolChange = useCallback((newSymbol: string) => {\n    setSymbol(newSymbol);\n    if (predictor) {\n      try {\n        predictor.reset();\n        predictor.reconnect();\n      } catch (error) {\n        console.error(\'[ScalpingTerminal] Error changing symbol:\', error);\n      }\n    }\n  }, [predictor]);\n  \n  const toggleAutoPredict = useCallback(() => {\n    try {\n      if (predictor) {\n        if (autoPredict) {\n          predictor.stopHeartbeat();\n        } else {\n          predictor.startHeartbeat();\n        }\n      }\n      setAutoPredict(!autoPredict);\n    } catch (error) {\n      console.error(\'[ScalpingTerminal] Error toggling auto predict:\', error);\n    }\n  }, [autoPredict, predictor]);\n  \n  // Boost indicator from cross-market analysis\n  const boostColor = predictionBoost >= 1.2 ? \'text-green-400\' : \n                     predictionBoost <= 0.8 ? \'text-red-400\' : \'text-primary\';\n  \n  // Show loading state if systems aren\'t ready\n  if (!predictor || !multiMarket || !isReady) {\n    return <LoadingTerminal status={initStatus} />;\n  }\n\n  return (\n    <div className="space-y-4">\n      {/* Global Accuracy Bar - Always Visible */}\n      <GlobalAccuracyPanel compact showStreak />\n      \n      {/* Session Control - Compact */}\n      <SessionControl compact />\n      \n      {/* Live Market Ticker - All Asset Classes */}\n      <Card className="bg-card/30 border-primary/20">\n        <CardContent className="py-3">\n          <div className="flex items-center gap-3 mb-2">\n            <Globe className="w-4 h-4 text-primary" />\n            <span className="text-sm font-medium">Cross-Market Feed</span>\n            <Badge variant="outline" className="text-xs">\n              {multiMarket.ticksPerSecond ?? 0} tps\n            </Badge>\n            {activeSignals.length > 0 && (\n              <Badge className="bg-yellow-500/20 text-yellow-400 border-yellow-500/30">\n                <Zap className="w-3 h-3 mr-1" />\n                {activeSignals.length} signals\n              </Badge>\n            )}\n            <div className={cn("flex items-center gap-1 ml-auto", boostColor)}>\n              <Sparkles className="w-3 h-3" />\n            <span className="text-xs font-mono font-bold">{predictionBoost.toFixed(2)}x boost</span>\n          </div>\n        </div>\n        <MarketTicker \n          snapshot={multiMarket.snapshot} \n          onSymbolClick={handleSymbolChange}\n          focusedSymbol={symbol}\n        />\n        </CardContent>\n      </Card>\n\n      {/* Header with controls */}\n      <div className="flex items-center justify-between flex-wrap gap-2">\n        <div className="flex items-center gap-4 flex-wrap">\n          <Tabs value={activeView} onValueChange={(v) => setActiveView(v as typeof activeView)}>\n            <TabsList>\n              <TabsTrigger value="focus">Focus</TabsTrigger>\n              <TabsTrigger value="bigpicture">Big Picture</TabsTrigger>\n              <TabsTrigger value="positions" className="flex items-center gap-1">\n                <DollarSign className="w-3 h-3" />\n                Session\n              </TabsTrigger>\n              <TabsTrigger value="evolution" className="flex items-center gap-1">\n                <Target className="w-3 h-3" />\n                Evolution\n              </TabsTrigger>\n              <TabsTrigger value="learning" className="flex items-center gap-1">\n                <Activity className="w-3 h-3" />\n                24/7 Learning\n              </TabsTrigger>\n            </TabsList>\n          </Tabs>\n          \n          <Select value={symbol} onValueChange={handleSymbolChange}>\n            <SelectTrigger className="w-32">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {SYMBOLS.map(s => (\n                <SelectItem key={s} value={s}>{s}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          \n          <div className="flex items-center gap-2">\n            <Radio className={cn(\n              "w-4 h-4",\n              predictor.connected ? "text-green-500" : "text-red-500"\n            )} />\n            <span className="text-sm text-muted-foreground">\n              {predictor.connected ? \'Connected\' : \'Disconnected\'}\n            </span>\n            <Badge variant="outline" className="text-xs">\n              {predictor.ticksPerSecond ?? 0} tps\n            </Badge>\n          </div>\n        </div>\n        \n        <div className="flex items-center gap-2">\n          <HeartbeatIndicator \n            isAlive={predictor.heartbeatAlive ?? false}\n            isProcessing={predictor.isProcessing ?? false}\n            lastPulse={predictor.lastPulse ?? null}\n            pulseCount={predictor.pulseCount ?? 0}\n            nextPulseIn={predictor.nextPulseIn ?? 0}\n            showControls={false}\n            compact\n          />\n          \n          <Button \n            variant="outline" \n            size="sm"\n            onClick={() => setShowSettings(!showSettings)}\n          >\n            <Settings className="w-4 h-4" />\n          </Button>\n          \n          <Button \n            variant="outline" \n            size="sm"\n            onClick={() => predictor.reset()}\n          >\n            <RotateCcw className="w-4 h-4" />\n          </Button>\n          \n          <Button\n            variant={autoPredict ? "default" : "outline"}\n            size="sm"\n            onClick={toggleAutoPredict}\n          >\n            {autoPredict ? <Pause className="w-4 h-4 mr-1" /> : <Play className="w-4 h-4 mr-1" />}\n            {autoPredict ? \'Pause\' : \'Start\'}\n          </Button>\n        </div>\n      </div>\n      \n      {/* Settings panel */}\n      {showSettings && (\n        <Card className="bg-muted/30">\n          <CardContent className="pt-4">\n            <div className="grid grid-cols-2 gap-4">\n              <div>\n                <label className="text-sm font-medium mb-2 block">\n                  Prediction Interval: {predictionInterval / 1000}s\n                </label>\n                <Slider\n                  value={[predictionInterval]}\n                  onValueChange={([v]) => setPredictionInterval(v)}\n                  min={1000}\n                  max={10000}\n                  step={500}\n                />\n              </div>\n              <div className="flex items-center justify-between">\n                <label className="text-sm font-medium">Auto Predict</label>\n                <Switch checked={autoPredict} onCheckedChange={setAutoPredict} />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n      \n      {/* Main dashboard - changes based on view */}\n      {activeView === \'focus\' ? (\n        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">\n          {/* Left column - Chart and HUD */}\n          <div className="lg:col-span-2 space-y-4">\n            {/* Price display */}\n            <Card className="bg-card/50 backdrop-blur">\n              <CardHeader className="pb-2">\n                <div className="flex items-center justify-between">\n                  <CardTitle className="flex items-center gap-2">\n                    <Activity className="w-5 h-5" />\n                    {symbol}\n                  </CardTitle>\n                  <div className="text-right">\n                    <div className="text-3xl font-mono font-bold">\n                      ${predictor.latestPrice?.toFixed(2) || \'---\'}\n                    </div>\n                    <div className={cn(\n                      "text-sm",\n                      (predictor.priceChangePercent ?? 0) >= 0 ? "text-green-500" : "text-red-500"\n                    )}>\n                      {(predictor.priceChangePercent ?? 0) >= 0 ? \'+\' : \'\'}\n                      {(predictor.priceChangePercent ?? 0).toFixed(3)}%\n                    </div>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <TickChart \n                  ticks={predictor.connected ? Array.from({ length: Math.min(predictor.tickCount ?? 0, 100) }).map((_, i) => ({\n                    price: predictor.latestPrice || 100,\n                    volume: 1000,\n                    timestamp: Date.now() - ((predictor.tickCount ?? 0) - i) * 100\n                  })) : []}\n                  currentPrediction={predictor.currentPrediction ? {\n                    direction: predictor.currentPrediction.predictedDirection,\n                    priceAtPrediction: predictor.currentPrediction.priceAtPrediction,\n                    targetPrice: predictor.currentPrediction.targetPrice\n                  } : null}\n                  height={180}\n                />\n              </CardContent>\n            </Card>\n            \n            {/* Current prediction */}\n            <PredictionHUD \n              prediction={predictor.currentPrediction ?? null}\n              latestPrice={predictor.latestPrice ?? null}\n              symbol={symbol}\n              simulatedBalance={tradingStore?.currentSession?.currentBalance ?? 1000}\n              targetBalance={10000}\n            />\n            \n            {/* Prediction stream */}\n            <Card className="bg-card/50 backdrop-blur">\n              <CardHeader className="pb-2">\n                <CardTitle className="flex items-center gap-2 text-lg">\n                  <Clock className="w-5 h-5" />\n                  Prediction Stream\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <PredictionStream \n                  pending={predictor.pendingPredictions ?? []}\n                  resolved={predictor.recentPredictions ?? []}\n                  maxHeight="300px"\n                />\n              </CardContent>\n            </Card>\n          </div>\n          \n          {/* Right column - Learning state */}\n          <div className="space-y-4">\n            {safeLearningState && (\n              <LearningStatePanel \n                state={safeLearningState}\n                stats={predictorStats}\n              />\n            )}\n            \n            {/* Quick stats */}\n            <Card className="bg-card/50 backdrop-blur">\n              <CardHeader className="pb-2">\n                <CardTitle className="text-lg">Session Stats</CardTitle>\n              </CardHeader>\n              <CardContent className="space-y-3">\n                <div className="flex justify-between">\n                  <span className="text-muted-foreground">Ticks Processed</span>\n                  <span className="font-mono">{predictor.tickCount ?? 0}</span>\n                </div>\n                <Separator />\n                <div className="flex justify-between">\n                  <span className="text-muted-foreground">Predictions Made</span>\n                  <span className="font-mono">{predictorStats.totalPredictions ?? 0}</span>\n                </div>\n                <div className="flex justify-between">\n                  <span className="text-muted-foreground">Correct</span>\n                  <span className="font-mono text-green-500">\n                    {safeLearningState?.correctPredictions ?? 0}\n                  </span>\n                </div>\n                <div className="flex justify-between">\n                  <span className="text-muted-foreground">Win Rate</span>\n                  <span className={cn(\n                    "font-mono font-bold",\n                    (predictorStats.accuracy ?? 0) >= 55 ? "text-green-500" : \n                    (predictorStats.accuracy ?? 0) >= 45 ? "text-yellow-500" : "text-red-500"\n                  )}>\n                    {(predictorStats.accuracy ?? 0).toFixed(1)}%\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n            \n            {/* Manual prediction button */}\n            <Button \n              className="w-full"\n              onClick={() => predictor.generatePrediction()}\n              disabled={!predictor.connected}\n            >\n              <Zap className="w-4 h-4 mr-2" />\n              Generate Prediction Now\n            </Button>\n          </div>\n        </div>\n      ) : activeView === \'bigpicture\' ? (\n        <BigPicturePanel state={multiMarket?.bigPicture ?? null} />\n      ) : activeView === \'positions\' ? (\n        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">\n          <SessionControl />\n          <PositionTracker\n            openPositions={positionsTracker.openPositions}\n            closedPositions={positionsTracker.closedPositions}\n            stats={positionsTracker.stats}\n            currentSymbol={symbol}\n            currentPrice={predictor.latestPrice ?? 100}\n            correlatedPrices={correlatedPrices}\n            onOpenPosition={(sym, dir, price, corrPrices) => {\n              positionsTracker.openPosition(sym, dir, price, corrPrices);\n            }}\n            onClosePosition={(posId, closePrice) => {\n              positionsTracker.closePosition(posId, closePrice);\n            }}\n            onUpdatePosition={(posId, price, corrPrices) => {\n              positionsTracker.updatePosition(posId, price, corrPrices);\n            }}\n          />\n        </div>\n      ) : activeView === \'evolution\' ? (\n        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">\n          <GlobalAccuracyPanel showStreak />\n          <Card className="bg-card/50 backdrop-blur">\n            <CardHeader>\n              <CardTitle className="flex items-center gap-2">\n                <Target className="w-5 h-5" />\n                Evolution Engine\n              </CardTitle>\n            </CardHeader>\n            <CardContent className="space-y-4">\n              <div className="grid grid-cols-2 gap-4 text-center">\n                <div className="p-3 bg-muted/30 rounded-lg">\n                  <div className="text-2xl font-mono font-bold text-primary">\n                    {evolutionState?.metrics?.generationNumber ?? 1}\n                  </div>\n                  <div className="text-xs text-muted-foreground">Generation</div>\n                </div>\n                <div className="p-3 bg-muted/30 rounded-lg">\n                  <div className={cn(\n                    "text-2xl font-mono font-bold",\n                    (evolutionState?.metrics?.learningVelocity ?? 0) > 0 ? "text-green-400" : "text-red-400"\n                  )}>\n                    {((evolutionState?.metrics?.learningVelocity ?? 0) * 100).toFixed(1)}%\n                  </div>\n                  <div className="text-xs text-muted-foreground">Learning Velocity</div>\n                </div>\n                <div className="p-3 bg-muted/30 rounded-lg">\n                  <div className="text-2xl font-mono font-bold">\n                    {((evolutionState?.metrics?.currentFitness ?? 0.5) * 100).toFixed(0)}%\n                  </div>\n                  <div className="text-xs text-muted-foreground">Current Fitness</div>\n                </div>\n                <div className="p-3 bg-muted/30 rounded-lg">\n                  <div className="text-2xl font-mono font-bold text-yellow-400">\n                    {evolutionState?.patternLibrary?.length ?? 0}\n                  </div>\n                  <div className="text-xs text-muted-foreground">Learned Patterns</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      ) : activeView === \'learning\' ? (\n        <MarketLearningDashboard />\n      ) : null}\n    </div>\n  );\n};\n\nexport { ScalpingTerminal };\n';export{e as default};
