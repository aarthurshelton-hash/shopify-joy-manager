const e='import React, { useEffect } from \'react\';\nimport { useQuery, useQueryClient } from \'@tanstack/react-query\';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Crown, Users, Star, Sparkles, Shield, TrendingUp, Building, Palette, Gamepad2, BookOpen, DollarSign, Wallet, Wifi, RefreshCw } from \'lucide-react\';\nimport { supabase } from \'@/integrations/supabase/client\';\n\n// Visionary emails with permanent premium - synced with edge functions\nconst VISIONARY_EMAILS = [\n  { email: \'a.arthur.shelton@gmail.com\', name: \'Alec Arthur Shelton\', role: \'CEO & Founder\' },\n  { email: \'info@mawuli.xyz\', name: \'Mawuli\', role: \'Marketplace Tester\' },\n  { email: \'opecoreug@gmail.com\', name: \'Product Specialist\', role: \'Overseas Analyst\' },\n];\n\nconst formatCents = (cents: number) => `$${(cents / 100).toFixed(2)}`;\n\nexport const AdminEconomicsPanel: React.FC = () => {\n  const queryClient = useQueryClient();\n  // Fetch user breakdown\n  const { data: userStats } = useQuery({\n    queryKey: [\'admin-economics-users\'],\n    queryFn: async () => {\n      const [totalResult, premiumResult, visionsResult] = await Promise.all([\n        supabase.from(\'profiles\').select(\'id\', { count: \'exact\', head: true }),\n        supabase.from(\'user_subscriptions\').select(\'id\', { count: \'exact\', head: true }).eq(\'subscription_status\', \'active\'),\n        supabase.from(\'saved_visualizations\').select(\'id\', { count: \'exact\', head: true }),\n      ]);\n\n      const total = totalResult.count || 0;\n      const paidPremium = premiumResult.count || 0;\n      const visionaryCount = VISIONARY_EMAILS.length;\n      const totalPremium = paidPremium + visionaryCount;\n      const freeUsers = Math.max(0, total - paidPremium);\n\n      return {\n        total,\n        paidPremium,\n        visionaryCount,\n        totalPremium,\n        freeUsers,\n        totalVisions: visionsResult.count || 0,\n        conversionRate: total > 0 ? ((paidPremium / total) * 100).toFixed(1) : \'0\',\n      };\n    },\n  });\n\n  // Fetch LIVE profit pool data\n  const { data: profitPools } = useQuery({\n    queryKey: [\'admin-live-profit-pools\'],\n    queryFn: async () => {\n      const [companyProfit, revenueStreams, gamecardPool, palettePool, openingPool, walletStats] = await Promise.all([\n        supabase.from(\'company_profit_pool\').select(\'*\'),\n        supabase.from(\'revenue_stream_summary\').select(\'*\'),\n        supabase.from(\'gamecard_value_pool\').select(\'earned_value_cents, total_interactions\'),\n        supabase.from(\'palette_value_pool\').select(\'earned_value_cents, total_interactions\'),\n        supabase.from(\'opening_value_pool\').select(\'earned_value_cents, total_interactions, total_marketplace_trades\'),\n        supabase.from(\'user_wallets\').select(\'balance_cents, total_earned_cents, total_spent_cents\'),\n      ]);\n\n      const cpData = companyProfit.data || [];\n      const totalExtractable = cpData.reduce((sum, r) => sum + (r.extractable_profit_cents || 0), 0);\n      const totalReinvested = cpData.reduce((sum, r) => sum + (r.reinvested_cents || 0), 0);\n      const totalGross = cpData.reduce((sum, r) => sum + (r.gross_revenue_cents || 0), 0);\n      const totalStripeFees = cpData.reduce((sum, r) => sum + (r.stripe_fees_cents || 0), 0);\n\n      const gcData = gamecardPool.data || [];\n      const ppData = palettePool.data || [];\n      const opData = openingPool.data || [];\n      const wData = walletStats.data || [];\n\n      return {\n        totalExtractable,\n        totalReinvested,\n        totalGross,\n        totalStripeFees,\n        gamecardPoolTotal: gcData.reduce((sum, r) => sum + (r.earned_value_cents || 0), 0),\n        palettePoolTotal: ppData.reduce((sum, r) => sum + (r.earned_value_cents || 0), 0),\n        openingPoolTotal: opData.reduce((sum, r) => sum + (r.earned_value_cents || 0), 0),\n        activeGamecards: gcData.filter(r => r.earned_value_cents > 0).length,\n        activePalettes: ppData.filter(r => r.earned_value_cents > 0).length,\n        activeOpenings: opData.filter(r => r.earned_value_cents > 0).length,\n        totalWalletBalance: wData.reduce((sum, r) => sum + (r.balance_cents || 0), 0),\n        totalUserEarnings: wData.reduce((sum, r) => sum + (r.total_earned_cents || 0), 0),\n        revenueStreams: revenueStreams.data || [],\n      };\n    },\n    refetchInterval: 10000, // Refresh every 10 seconds for live data\n    staleTime: 5000,\n  });\n\n  // Set up realtime subscriptions for instant updates\n  useEffect(() => {\n    const channels: ReturnType<typeof supabase.channel>[] = [];\n\n    const economicsChannel = supabase\n      .channel(\'economics-realtime\')\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'company_profit_pool\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-live-profit-pools\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'palette_value_pool\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-live-profit-pools\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'gamecard_value_pool\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-live-profit-pools\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'opening_value_pool\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-live-profit-pools\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'user_wallets\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-live-profit-pools\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'profiles\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-economics-users\'] });\n      })\n      .on(\'postgres_changes\', { event: \'*\', schema: \'public\', table: \'user_subscriptions\' }, () => {\n        queryClient.invalidateQueries({ queryKey: [\'admin-economics-users\'] });\n      })\n      .subscribe();\n\n    channels.push(economicsChannel);\n\n    return () => {\n      channels.forEach(channel => supabase.removeChannel(channel));\n    };\n  }, [queryClient]);\n\n  return (\n    <div className="space-y-6">\n      {/* User Breakdown Cards */}\n      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">\n        <Card>\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Users className="h-3 w-3" />\n              <span className="text-xs">Total Users</span>\n            </div>\n            <p className="text-2xl font-bold">{userStats?.total || 0}</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-amber-500/30 bg-gradient-to-br from-amber-500/5 to-amber-500/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Star className="h-3 w-3 text-amber-500" />\n              <span className="text-xs">Visionaries</span>\n            </div>\n            <p className="text-2xl font-bold text-amber-500">{userStats?.visionaryCount || 0}</p>\n            <p className="text-[10px] text-muted-foreground">Permanent Premium</p>\n          </CardContent>\n        </Card>\n\n        <Card className="border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10">\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Crown className="h-3 w-3 text-primary" />\n              <span className="text-xs">Paid Premium</span>\n            </div>\n            <p className="text-2xl font-bold text-primary">{userStats?.paidPremium || 0}</p>\n            <p className="text-[10px] text-muted-foreground">Stripe Subscribers</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className="pt-4 pb-3">\n            <div className="flex items-center gap-2 text-muted-foreground mb-1">\n              <Users className="h-3 w-3" />\n              <span className="text-xs">Free Users</span>\n            </div>\n            <p className="text-2xl font-bold">{userStats?.freeUsers || 0}</p>\n            <p className="text-[10px] text-muted-foreground flex items-center gap-1">\n              <TrendingUp className="h-3 w-3" />\n              {userStats?.conversionRate}% conversion\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Company Profit Pool - LIVE */}\n      <Card className="border-green-500/30 bg-gradient-to-br from-green-500/10 via-emerald-500/5 to-green-500/10">\n        <CardHeader>\n          <CardTitle className="flex items-center gap-2 text-xl">\n            <Building className="h-6 w-6 text-green-500" />\n            Company Profit Pool\n            <Badge className="ml-auto bg-green-500/20 text-green-600 border-green-500/30">LIVE</Badge>\n          </CardTitle>\n          <CardDescription>Real money reserves from marketplace fees + net profits</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">\n            <div className="p-4 rounded-xl bg-green-500/10 border border-green-500/20">\n              <p className="text-xs text-muted-foreground">Extractable Cash</p>\n              <p className="text-2xl font-bold text-green-500">{formatCents(profitPools?.totalExtractable || 0)}</p>\n            </div>\n            <div className="p-4 rounded-xl bg-blue-500/10 border border-blue-500/20">\n              <p className="text-xs text-muted-foreground">Reinvested</p>\n              <p className="text-2xl font-bold text-blue-500">{formatCents(profitPools?.totalReinvested || 0)}</p>\n            </div>\n            <div className="p-4 rounded-xl bg-muted/50">\n              <p className="text-xs text-muted-foreground">Gross Revenue</p>\n              <p className="text-2xl font-bold">{formatCents(profitPools?.totalGross || 0)}</p>\n            </div>\n            <div className="p-4 rounded-xl bg-muted/50">\n              <p className="text-xs text-muted-foreground">Stripe Fees</p>\n              <p className="text-2xl font-bold text-orange-500">{formatCents(profitPools?.totalStripeFees || 0)}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Value Attribution Pools - LIVE */}\n      <Card>\n        <CardHeader>\n          <CardTitle className="text-lg flex items-center gap-2">\n            <Sparkles className="h-5 w-5" />\n            Value Attribution Pools\n            <Badge variant="outline" className="ml-auto">LIVE</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className="grid grid-cols-3 gap-4">\n            <div className="p-4 rounded-xl bg-purple-500/10 border border-purple-500/20">\n              <div className="flex items-center gap-2 mb-2">\n                <Gamepad2 className="h-4 w-4 text-purple-500" />\n                <span className="text-sm font-medium">Gamecard Pool</span>\n              </div>\n              <p className="text-2xl font-bold text-purple-500">{formatCents(profitPools?.gamecardPoolTotal || 0)}</p>\n              <p className="text-xs text-muted-foreground">{profitPools?.activeGamecards || 0} active games</p>\n            </div>\n            <div className="p-4 rounded-xl bg-pink-500/10 border border-pink-500/20">\n              <div className="flex items-center gap-2 mb-2">\n                <Palette className="h-4 w-4 text-pink-500" />\n                <span className="text-sm font-medium">Palette Pool</span>\n              </div>\n              <p className="text-2xl font-bold text-pink-500">{formatCents(profitPools?.palettePoolTotal || 0)}</p>\n              <p className="text-xs text-muted-foreground">{profitPools?.activePalettes || 0} active palettes</p>\n            </div>\n            <div className="p-4 rounded-xl bg-amber-500/10 border border-amber-500/20">\n              <div className="flex items-center gap-2 mb-2">\n                <BookOpen className="h-4 w-4 text-amber-500" />\n                <span className="text-sm font-medium">Opening Pool</span>\n              </div>\n              <p className="text-2xl font-bold text-amber-500">{formatCents(profitPools?.openingPoolTotal || 0)}</p>\n              <p className="text-xs text-muted-foreground">{profitPools?.activeOpenings || 0} active openings</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* User Wallet Economy */}\n      <Card>\n        <CardHeader>\n          <CardTitle className="text-lg flex items-center gap-2">\n            <Wallet className="h-5 w-5" />\n            Wallet Economy\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className="grid grid-cols-2 gap-4">\n            <div className="p-4 rounded-xl bg-muted/50">\n              <p className="text-xs text-muted-foreground">Total Wallet Balances</p>\n              <p className="text-2xl font-bold">{formatCents(profitPools?.totalWalletBalance || 0)}</p>\n            </div>\n            <div className="p-4 rounded-xl bg-muted/50">\n              <p className="text-xs text-muted-foreground">Total User Earnings</p>\n              <p className="text-2xl font-bold text-green-500">{formatCents(profitPools?.totalUserEarnings || 0)}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Visionary Members */}\n      <Card className="border-amber-500/30">\n        <CardHeader>\n          <CardTitle className="flex items-center gap-2 text-lg">\n            <Star className="h-5 w-5 text-amber-500" />\n            Visionary Members\n          </CardTitle>\n          <CardDescription>Permanent premium access holders</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className="h-[150px]">\n            <div className="space-y-2">\n              {VISIONARY_EMAILS.map((visionary, index) => (\n                <div key={index} className="flex items-center justify-between p-2 rounded-lg bg-amber-500/5 border border-amber-500/20">\n                  <div className="flex items-center gap-2">\n                    {visionary.role === \'CEO & Founder\' ? <Crown className="h-4 w-4 text-amber-500" /> : <Shield className="h-4 w-4 text-amber-500" />}\n                    <span className="text-sm font-medium">{visionary.name}</span>\n                  </div>\n                  <Badge variant="outline" className="text-[10px]">{visionary.role}</Badge>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n';export{e as default};
