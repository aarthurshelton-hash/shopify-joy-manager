const e="import React, { useRef, useMemo } from 'react';\nimport { motion } from 'framer-motion';\nimport html2canvas from 'html2canvas';\nimport { \n  Download, \n  Crown, \n  Shield, \n  Target, \n  Crosshair,\n  Clock,\n  Zap,\n  Trophy,\n  MapPin,\n  Swords,\n  ChevronRight,\n  Lock,\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { toast } from 'sonner';\nimport { PieceType, PieceColor, getActivePalette } from '@/lib/chess/pieceColors';\nimport { SquareData } from '@/lib/chess/gameSimulator';\nimport { MoveHistoryEntry } from './EnPensentOverlay';\nimport enPensentLogo from '@/assets/en-pensent-logo-new.png';\n\ninterface VisionInfoCardProps {\n  board: SquareData[][];\n  gameData: {\n    white?: string;\n    black?: string;\n    event?: string;\n    date?: string;\n    result?: string;\n  };\n  moveHistory?: MoveHistoryEntry[];\n  totalMoves: number;\n  whitePalette: Record<string, string>;\n  blackPalette: Record<string, string>;\n  darkMode?: boolean;\n  isPremium: boolean;\n  onDownload?: () => void;\n  onPurchaseAddOn?: () => void;\n}\n\nconst PIECE_SYMBOLS: Record<PieceType, { w: string; b: string }> = {\n  k: { w: '‚ôö', b: '‚ôî' },\n  q: { w: '‚ôõ', b: '‚ôï' },\n  r: { w: '‚ôú', b: '‚ôñ' },\n  b: { w: '‚ôù', b: '‚ôó' },\n  n: { w: '‚ôû', b: '‚ôò' },\n  p: { w: '‚ôü', b: '‚ôô' },\n};\n\nconst PIECE_NAMES: Record<PieceType, string> = {\n  k: 'King', q: 'Queen', r: 'Rook', b: 'Bishop', n: 'Knight', p: 'Pawn'\n};\n\nconst PIECE_ICONS: Record<PieceType, typeof Crown> = {\n  k: Crown, q: Trophy, r: Shield, b: Crosshair, n: Target, p: MapPin\n};\n\nexport const VisionInfoCard: React.FC<VisionInfoCardProps> = ({\n  board,\n  gameData,\n  moveHistory = [],\n  totalMoves,\n  whitePalette,\n  blackPalette,\n  darkMode = false,\n  isPremium,\n  onDownload,\n  onPurchaseAddOn,\n}) => {\n  const cardRef = useRef<HTMLDivElement>(null);\n  const palette = getActivePalette();\n  const theme = palette.legendTheme;\n\n  // Calculate piece activity statistics\n  const pieceStats = useMemo(() => {\n    const stats = new Map<string, { \n      moves: number; \n      squares: Set<string>; \n      captures: number;\n      checks: number;\n    }>();\n    \n    const pieceTypes: PieceType[] = ['k', 'q', 'r', 'b', 'n', 'p'];\n    const colors: PieceColor[] = ['w', 'b'];\n    \n    for (const color of colors) {\n      for (const piece of pieceTypes) {\n        stats.set(`${color}-${piece}`, { \n          moves: 0, \n          squares: new Set(), \n          captures: 0,\n          checks: 0,\n        });\n      }\n    }\n    \n    for (const move of moveHistory) {\n      const key = `${move.color}-${move.piece}`;\n      const stat = stats.get(key);\n      if (stat) {\n        stat.moves++;\n        stat.squares.add(move.square);\n      }\n    }\n    \n    return stats;\n  }, [moveHistory]);\n\n  // Find MVP piece\n  const mvpPiece = useMemo(() => {\n    let maxActivity = 0;\n    let mvp: { piece: PieceType; color: PieceColor; moves: number } | null = null;\n    \n    pieceStats.forEach((stat, key) => {\n      if (stat.moves > maxActivity) {\n        maxActivity = stat.moves;\n        const [color, piece] = key.split('-') as [PieceColor, PieceType];\n        mvp = { piece, color, moves: stat.moves };\n      }\n    });\n    \n    return mvp;\n  }, [pieceStats]);\n\n  // Calculate territory control\n  const territoryStats = useMemo(() => {\n    let whiteSquares = 0;\n    let blackSquares = 0;\n    \n    for (const rank of board) {\n      for (const square of rank) {\n        const whiteVisits = square.visits.filter((v: any) => v.piece?.color === 'w' || v.color === 'w').length;\n        const blackVisits = square.visits.filter((v: any) => v.piece?.color === 'b' || v.color === 'b').length;\n        \n        if (whiteVisits > blackVisits) whiteSquares++;\n        else if (blackVisits > whiteVisits) blackSquares++;\n      }\n    }\n    \n    return {\n      white: whiteSquares,\n      black: blackSquares,\n      whitePercent: Math.round((whiteSquares / 64) * 100),\n      blackPercent: Math.round((blackSquares / 64) * 100),\n    };\n  }, [board]);\n\n  // Game phase analysis\n  const phaseAnalysis = useMemo(() => {\n    const opening = Math.min(10, totalMoves);\n    const middlegame = totalMoves > 10 ? Math.min(30, totalMoves) - 10 : 0;\n    const endgame = totalMoves > 40 ? totalMoves - 40 : 0;\n    \n    return { opening, middlegame, endgame, total: totalMoves };\n  }, [totalMoves]);\n\n  const handleDownload = async () => {\n    if (!isPremium) {\n      onPurchaseAddOn?.();\n      return;\n    }\n    \n    if (!cardRef.current) return;\n    \n    try {\n      const canvas = await html2canvas(cardRef.current, {\n        scale: 3,\n        backgroundColor: darkMode ? '#0A0A0A' : '#FDFCFB',\n        useCORS: true,\n      });\n      \n      const dataUrl = canvas.toDataURL('image/png', 1.0);\n      const link = document.createElement('a');\n      link.href = dataUrl;\n      link.download = `EnPensent-InfoCard-${gameData.white || 'White'}-vs-${gameData.black || 'Black'}.png`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      toast.success('Info Card downloaded!');\n      onDownload?.();\n    } catch (error) {\n      console.error('Failed to download info card:', error);\n      toast.error('Download failed. Please try again.');\n    }\n  };\n\n  const renderPieceRow = (color: PieceColor) => {\n    const pal = color === 'w' ? whitePalette : blackPalette;\n    const pieceTypes: PieceType[] = ['k', 'q', 'r', 'b', 'n', 'p'];\n    \n    return (\n      <div className=\"grid grid-cols-6 gap-1\">\n        {pieceTypes.map(piece => {\n          const key = `${color}-${piece}`;\n          const stat = pieceStats.get(key);\n          const isMvp = mvpPiece?.piece === piece && mvpPiece?.color === color;\n          const Icon = PIECE_ICONS[piece];\n          const hexColor = pal[piece] || '#888';\n          \n          return (\n            <TooltipProvider key={key}>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <div \n                    className={`relative flex flex-col items-center p-1.5 rounded-md transition-all ${\n                      isMvp ? 'ring-2 ring-amber-400 bg-amber-400/10' : 'hover:bg-accent/30'\n                    }`}\n                  >\n                    <div\n                      className=\"w-5 h-5 rounded shadow-sm mb-0.5\"\n                      style={{ backgroundColor: hexColor }}\n                    />\n                    <span className=\"text-xs\" style={{ color: hexColor }}>\n                      {PIECE_SYMBOLS[piece][color]}\n                    </span>\n                    <span className=\"text-[8px] font-mono text-muted-foreground\">\n                      {stat?.moves || 0}\n                    </span>\n                    \n                    {isMvp && (\n                      <span className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center\">\n                        <Crown className=\"w-2 h-2 text-white\" />\n                      </span>\n                    )}\n                  </div>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <div className=\"text-xs space-y-1\">\n                    <p className=\"font-semibold\">{PIECE_NAMES[piece]}</p>\n                    <p>{stat?.moves || 0} moves ‚Ä¢ {stat?.squares.size || 0} unique squares</p>\n                    {(stat?.captures || 0) > 0 && <p>‚öîÔ∏è {stat?.captures} captures</p>}\n                    {(stat?.checks || 0) > 0 && <p>‚úì {stat?.checks} checks</p>}\n                    {isMvp && <p className=\"text-amber-400 font-bold\">‚òÖ MVP</p>}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          );\n        })}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-3\">\n      {/* The actual card for download */}\n      <div \n        ref={cardRef}\n        className={`rounded-xl overflow-hidden shadow-xl ${\n          darkMode ? 'bg-stone-900 text-stone-100' : 'bg-stone-50 text-stone-900'\n        }`}\n        style={{ width: 320 }}\n      >\n        {/* Header */}\n        <div className={`p-4 ${darkMode ? 'bg-stone-800' : 'bg-stone-100'}`}>\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <img src={enPensentLogo} alt=\"En Pensent\" className=\"w-6 h-6 rounded-full\" />\n              <span className=\"text-xs font-display uppercase tracking-wider opacity-70\">Vision Data Card</span>\n            </div>\n            <span className=\"text-[10px] font-mono opacity-50\">#{totalMoves} moves</span>\n          </div>\n          \n          <div className=\"text-center\">\n            <h3 className=\"font-display font-bold text-sm\">\n              {gameData.white || 'White'} vs {gameData.black || 'Black'}\n            </h3>\n            <div className=\"flex items-center justify-center gap-2 text-[10px] opacity-70\">\n              {gameData.event && <span>{gameData.event}</span>}\n              {gameData.date && <span>‚Ä¢ {gameData.date}</span>}\n            </div>\n            {gameData.result && (\n              <span className={`inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold ${\n                darkMode ? 'bg-primary/30 text-primary-foreground' : 'bg-primary/20 text-primary'\n              }`}>\n                {gameData.result}\n              </span>\n            )}\n          </div>\n        </div>\n        \n        {/* Color Legend Section */}\n        <div className=\"p-4 space-y-3\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Zap className=\"w-3 h-3 text-primary\" />\n            <span className=\"text-[10px] font-display uppercase tracking-wider\">Piece Activity</span>\n          </div>\n          \n          {/* White pieces */}\n          <div className=\"space-y-1\">\n            <span className=\"text-[10px] text-sky-400 font-medium\">\n              {theme?.whiteEmoji || '‚ùÑÔ∏è'} {theme?.whiteName || 'White'}\n            </span>\n            {renderPieceRow('w')}\n          </div>\n          \n          {/* Black pieces */}\n          <div className=\"space-y-1\">\n            <span className=\"text-[10px] text-rose-400 font-medium\">\n              {theme?.blackEmoji || 'üî•'} {theme?.blackName || 'Black'}\n            </span>\n            {renderPieceRow('b')}\n          </div>\n        </div>\n        \n        {/* Territory Analysis */}\n        <div className={`p-4 ${darkMode ? 'bg-stone-800/50' : 'bg-stone-100/50'}`}>\n          <div className=\"flex items-center gap-2 mb-2\">\n            <MapPin className=\"w-3 h-3 text-primary\" />\n            <span className=\"text-[10px] font-display uppercase tracking-wider\">Territory Control</span>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex-1 h-2 rounded-full bg-gradient-to-r from-sky-400 to-sky-600\" \n              style={{ width: `${territoryStats.whitePercent}%` }} \n            />\n            <span className=\"text-[10px] font-mono w-8 text-center\">{territoryStats.whitePercent}%</span>\n            <span className=\"text-[10px] opacity-50\">vs</span>\n            <span className=\"text-[10px] font-mono w-8 text-center\">{territoryStats.blackPercent}%</span>\n            <div className=\"flex-1 h-2 rounded-full bg-gradient-to-r from-rose-400 to-rose-600\" \n              style={{ width: `${territoryStats.blackPercent}%` }} \n            />\n          </div>\n        </div>\n        \n        {/* Game Phases Timeline */}\n        <div className=\"p-4\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Clock className=\"w-3 h-3 text-primary\" />\n            <span className=\"text-[10px] font-display uppercase tracking-wider\">Game Phases</span>\n          </div>\n          \n          <div className=\"flex items-center gap-1\">\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div \n                  className=\"h-4 rounded-l bg-emerald-500/80 flex items-center justify-center\"\n                  style={{ flex: phaseAnalysis.opening }}\n                >\n                  {phaseAnalysis.opening > 3 && (\n                    <span className=\"text-[8px] text-white font-bold\">Opening</span>\n                  )}\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"text-xs\">Opening: {phaseAnalysis.opening} moves</p>\n                <p className=\"text-[10px] text-muted-foreground\">Development & center control</p>\n              </TooltipContent>\n            </Tooltip>\n            \n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div \n                  className=\"h-4 bg-amber-500/80 flex items-center justify-center\"\n                  style={{ flex: phaseAnalysis.middlegame || 1 }}\n                >\n                  {phaseAnalysis.middlegame > 5 && (\n                    <span className=\"text-[8px] text-white font-bold\">Middlegame</span>\n                  )}\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"text-xs\">Middlegame: {phaseAnalysis.middlegame} moves</p>\n                <p className=\"text-[10px] text-muted-foreground\">Tactical battles & strategic plans</p>\n              </TooltipContent>\n            </Tooltip>\n            \n            <Tooltip>\n              <TooltipTrigger asChild>\n                <div \n                  className=\"h-4 rounded-r bg-violet-500/80 flex items-center justify-center\"\n                  style={{ flex: phaseAnalysis.endgame || 1 }}\n                >\n                  {phaseAnalysis.endgame > 5 && (\n                    <span className=\"text-[8px] text-white font-bold\">Endgame</span>\n                  )}\n                </div>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"text-xs\">Endgame: {phaseAnalysis.endgame} moves</p>\n                <p className=\"text-[10px] text-muted-foreground\">King activation & pawn promotion</p>\n              </TooltipContent>\n            </Tooltip>\n          </div>\n        </div>\n        \n        {/* MVP Highlight */}\n        {mvpPiece && (\n          <div className={`mx-4 mb-4 p-3 rounded-lg border ${\n            darkMode \n              ? 'bg-gradient-to-r from-amber-900/30 to-orange-900/30 border-amber-500/30' \n              : 'bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200'\n          }`}>\n            <div className=\"flex items-center gap-3\">\n              <div \n                className=\"w-10 h-10 rounded-lg flex items-center justify-center text-xl shadow-lg\"\n                style={{ \n                  backgroundColor: (mvpPiece.color === 'w' ? whitePalette : blackPalette)[mvpPiece.piece],\n                }}\n              >\n                {PIECE_SYMBOLS[mvpPiece.piece][mvpPiece.color]}\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-1\">\n                  <Trophy className=\"w-3 h-3 text-amber-500\" />\n                  <span className=\"text-[10px] font-bold text-amber-500 uppercase tracking-wider\">MVP</span>\n                </div>\n                <p className=\"text-xs font-medium\">\n                  {mvpPiece.color === 'w' ? 'White' : 'Black'} {PIECE_NAMES[mvpPiece.piece]}\n                </p>\n                <p className=\"text-[10px] opacity-70\">{mvpPiece.moves} moves this game</p>\n              </div>\n            </div>\n          </div>\n        )}\n        \n        {/* Footer */}\n        <div className={`px-4 py-2 text-center ${darkMode ? 'bg-stone-800' : 'bg-stone-100'}`}>\n          <span className=\"text-[8px] tracking-[0.2em] uppercase opacity-50\">\n            ‚ôî en pensent ‚Ä¢ enpensent.com ‚ôö\n          </span>\n        </div>\n      </div>\n      \n      {/* Download Button */}\n      <motion.div\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.3 }}\n      >\n        <Button\n          onClick={handleDownload}\n          className={`w-full gap-2 ${\n            isPremium \n              ? 'btn-luxury' \n              : 'bg-muted hover:bg-muted/80 text-muted-foreground'\n          }`}\n          size=\"sm\"\n        >\n          {isPremium ? (\n            <>\n              <Download className=\"w-4 h-4\" />\n              Download Info Card\n            </>\n          ) : (\n            <>\n              <Lock className=\"w-4 h-4\" />\n              Visionary Exclusive\n              <ChevronRight className=\"w-3 h-3\" />\n            </>\n          )}\n        </Button>\n      </motion.div>\n    </div>\n  );\n};\n\nexport default VisionInfoCard;\n";export{e as default};
