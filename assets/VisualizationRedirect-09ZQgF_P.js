const n="/**\n * VisualizationRedirect - Redirects old share links (/v/{shareId}) to canonical game URLs (/g/{hash})\n * \n * This maintains backward compatibility with existing share links while\n * using the new unified canonical URL system.\n */\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { generateGameHash } from '@/lib/visualizations/gameCanonical';\nimport { motion } from 'framer-motion';\n\nconst VisualizationRedirect = () => {\n  const { shareId } = useParams<{ shareId: string }>();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchAndRedirect = async () => {\n      if (!shareId) {\n        setError('Invalid share link');\n        return;\n      }\n\n      try {\n        // Fetch the visualization by public_share_id\n        const { data, error: fetchError } = await supabase\n          .from('saved_visualizations')\n          .select('pgn, game_data')\n          .eq('public_share_id', shareId)\n          .maybeSingle();\n\n        if (fetchError) {\n          console.error('Error fetching visualization:', fetchError);\n          setError('Failed to load visualization');\n          return;\n        }\n\n        if (!data) {\n          setError('Visualization not found');\n          return;\n        }\n\n        // Get PGN from either pgn field or game_data.pgn\n        const pgn = data.pgn || (data.game_data as { pgn?: string })?.pgn || '';\n        \n        // Generate canonical game hash\n        const gameHash = generateGameHash(pgn);\n\n        // Preserve any existing URL params and add palette if stored\n        const paletteId = (data.game_data as { visualizationState?: { paletteId?: string } })?.visualizationState?.paletteId;\n        const newParams = new URLSearchParams(searchParams);\n        \n        if (paletteId && !newParams.has('p')) {\n          newParams.set('p', paletteId);\n        }\n\n        // Redirect to canonical URL\n        const paramString = newParams.toString();\n        const redirectUrl = `/g/${gameHash}${paramString ? `?${paramString}` : ''}`;\n        \n        navigate(redirectUrl, { replace: true });\n      } catch (err) {\n        console.error('Redirect error:', err);\n        setError('Failed to redirect');\n      }\n    };\n\n    fetchAndRedirect();\n  }, [shareId, searchParams, navigate]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-xl font-royal font-bold text-foreground\">\n            {error}\n          </h1>\n          <button \n            onClick={() => navigate('/')}\n            className=\"text-primary hover:underline\"\n          >\n            Go to Homepage\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}\n        className=\"w-12 h-12 border-2 border-primary border-t-transparent rounded-full\"\n      />\n    </div>\n  );\n};\n\nexport default VisualizationRedirect;\n";export{n as default};
