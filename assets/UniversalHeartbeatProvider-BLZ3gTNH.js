const e="/**\n * Universal Heartbeat Provider\n * Synchronizes audio, evolution, and all En Pensent systems\n * The pulse that unifies Code (Blood) and Market (Nervous System)\n */\n\nimport React, { createContext, useContext, useCallback, useEffect, useState, useRef, ReactNode } from 'react';\nimport { useHeartbeatMusic } from '@/hooks/useHeartbeatMusic';\nimport { useLiveHeartbeat } from '@/hooks/useLiveHeartbeat';\nimport { useUnifiedEvolution, subscribeToEvolution, EvolutionEvent } from '@/hooks/useUnifiedEvolution';\n\ninterface UniversalHeartbeatContextType {\n  isAlive: boolean;\n  pulseCount: number;\n  lastPulse: Date | null;\n  intensity: number;\n  soundEnabled: boolean;\n  setSoundEnabled: (enabled: boolean) => void;\n  volume: number;\n  setVolume: (volume: number) => void;\n  triggerPulse: () => void;\n  codeHealth: number;\n  marketSync: number;\n  patternAlignment: number;\n}\n\nconst UniversalHeartbeatContext = createContext<UniversalHeartbeatContextType | null>(null);\n\nexport function useUniversalHeartbeat() {\n  const context = useContext(UniversalHeartbeatContext);\n  if (!context) {\n    throw new Error('useUniversalHeartbeat must be used within UniversalHeartbeatProvider');\n  }\n  return context;\n}\n\ninterface Props {\n  children: ReactNode;\n  autoStart?: boolean;\n  interval?: number;\n}\n\nexport function UniversalHeartbeatProvider({ children, autoStart = true, interval = 30000 }: Props) {\n  const [soundEnabled, setSoundEnabled] = useState(false); // Off by default, user opt-in\n  const [volume, setVolume] = useState(0.3);\n  const [intensity, setIntensity] = useState(0.5);\n  \n  const evolution = useUnifiedEvolution();\n  const stateRef = useRef(evolution.getUnifiedState());\n  \n  const music = useHeartbeatMusic({\n    enabled: soundEnabled,\n    volume,\n    intensity\n  });\n  \n  // Update intensity based on unified state\n  useEffect(() => {\n    const state = evolution.getUnifiedState();\n    stateRef.current = state;\n    // Intensity is average of all health metrics\n    const avgHealth = (state.codeHealth + state.marketSync + state.patternAlignment) / 300;\n    setIntensity(avgHealth);\n  }, [evolution]);\n  \n  // Subscribe to evolution events for audio feedback\n  useEffect(() => {\n    const unsubscribe = subscribeToEvolution((event: EvolutionEvent) => {\n      if (!soundEnabled) return;\n      \n      switch (event.type) {\n        case 'code_analysis':\n        case 'code_fix':\n          music.playEvolutionSound('mutate');\n          break;\n        case 'pattern_discovered':\n          music.playEvolutionSound('evolve');\n          break;\n        case 'market_sync':\n          music.playEvolutionSound('sync');\n          break;\n      }\n    });\n    \n    return unsubscribe;\n  }, [soundEnabled, music]);\n  \n  // Main heartbeat callback\n  const onPulse = useCallback(() => {\n    // Play heartbeat sound\n    if (soundEnabled) {\n      music.playHeartbeatPulse(intensity);\n    }\n    \n    // Update state reference\n    stateRef.current = evolution.getUnifiedState();\n  }, [soundEnabled, music, intensity, evolution]);\n  \n  const heartbeat = useLiveHeartbeat({\n    interval,\n    autoStart,\n    onPulse,\n    enabled: true\n  });\n  \n  const triggerPulse = useCallback(() => {\n    heartbeat.pulse();\n  }, [heartbeat]);\n  \n  const value: UniversalHeartbeatContextType = {\n    isAlive: heartbeat.isAlive,\n    pulseCount: heartbeat.pulseCount,\n    lastPulse: heartbeat.lastPulse,\n    intensity,\n    soundEnabled,\n    setSoundEnabled,\n    volume,\n    setVolume,\n    triggerPulse,\n    codeHealth: stateRef.current.codeHealth,\n    marketSync: stateRef.current.marketSync,\n    patternAlignment: stateRef.current.patternAlignment\n  };\n  \n  return (\n    <UniversalHeartbeatContext.Provider value={value}>\n      {children}\n    </UniversalHeartbeatContext.Provider>\n  );\n}\n";export{e as default};
