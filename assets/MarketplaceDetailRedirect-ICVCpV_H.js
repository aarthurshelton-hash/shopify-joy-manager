const n="/**\n * MarketplaceDetailRedirect - Redirects marketplace detail pages (/marketplace/{id}) to canonical game URLs (/g/{hash})\n * \n * This maintains backward compatibility with existing marketplace links while\n * using the new unified canonical URL system.\n */\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { generateGameHash } from '@/lib/visualizations/gameCanonical';\nimport { motion } from 'framer-motion';\n\nconst MarketplaceDetailRedirect = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchAndRedirect = async () => {\n      if (!id) {\n        setError('Invalid listing ID');\n        return;\n      }\n\n      try {\n        // Fetch the listing and its visualization\n        const { data: listing, error: fetchError } = await supabase\n          .from('visualization_listings')\n          .select(`\n            visualization_id,\n            saved_visualizations (\n              pgn,\n              game_data\n            )\n          `)\n          .eq('id', id)\n          .maybeSingle();\n\n        if (fetchError) {\n          console.error('Error fetching listing:', fetchError);\n          setError('Failed to load listing');\n          return;\n        }\n\n        if (!listing || !listing.saved_visualizations) {\n          setError('Listing not found');\n          return;\n        }\n\n        const viz = listing.saved_visualizations as { pgn?: string; game_data?: { pgn?: string; visualizationState?: { paletteId?: string } } };\n        \n        // Get PGN from either pgn field or game_data.pgn\n        const pgn = viz.pgn || viz.game_data?.pgn || '';\n        \n        // Generate canonical game hash\n        const gameHash = generateGameHash(pgn);\n\n        // Get palette from stored state\n        const paletteId = viz.game_data?.visualizationState?.paletteId;\n        \n        // Build redirect URL with palette and source params\n        const params = new URLSearchParams();\n        if (paletteId) {\n          params.set('p', paletteId);\n        }\n        params.set('src', 'marketplace'); // Track source for context-aware UI\n        params.set('listing', id); // Pass listing ID for purchase functionality\n        \n        const paramString = params.toString();\n        const redirectUrl = `/g/${gameHash}${paramString ? `?${paramString}` : ''}`;\n        \n        navigate(redirectUrl, { replace: true });\n      } catch (err) {\n        console.error('Redirect error:', err);\n        setError('Failed to redirect');\n      }\n    };\n\n    fetchAndRedirect();\n  }, [id, navigate]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-xl font-royal font-bold text-foreground\">\n            {error}\n          </h1>\n          <button \n            onClick={() => navigate('/marketplace')}\n            className=\"text-primary hover:underline\"\n          >\n            Return to Marketplace\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}\n        className=\"w-12 h-12 border-2 border-primary border-t-transparent rounded-full\"\n      />\n    </div>\n  );\n};\n\nexport default MarketplaceDetailRedirect;\n";export{n as default};
