const n="import { useEffect, useState, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport type { VisionNFT, VisionValueHistory } from '@/lib/nfts/visionNftApi';\nimport { getVisionNFT, getVisionNFTByVisualization, getVisionValueHistory } from '@/lib/nfts/visionNftApi';\n\ninterface UseVisionNFTOptions {\n  visualizationId?: string;\n  visionNftId?: string;\n  enabled?: boolean;\n}\n\ninterface UseVisionNFTReturn {\n  visionNFT: VisionNFT | null;\n  history: VisionValueHistory[];\n  isLoading: boolean;\n  error: Error | null;\n  refetch: () => void;\n}\n\nexport function useVisionNFT({\n  visualizationId,\n  visionNftId,\n  enabled = true,\n}: UseVisionNFTOptions): UseVisionNFTReturn {\n  const [visionNFT, setVisionNFT] = useState<VisionNFT | null>(null);\n  const [history, setHistory] = useState<VisionValueHistory[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const fetchData = useCallback(async () => {\n    if (!enabled) return;\n    if (!visualizationId && !visionNftId) {\n      setIsLoading(false);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      let nft: VisionNFT | null = null;\n\n      if (visionNftId) {\n        const { data, error } = await getVisionNFT(visionNftId);\n        if (error) throw error;\n        nft = data;\n      } else if (visualizationId) {\n        const { data, error } = await getVisionNFTByVisualization(visualizationId);\n        if (error) throw error;\n        nft = data;\n      }\n\n      setVisionNFT(nft);\n\n      if (nft) {\n        const { data: historyData, error: historyError } = await getVisionValueHistory(nft.id, 90);\n        if (historyError) throw historyError;\n        setHistory(historyData || []);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error(String(err)));\n    } finally {\n      setIsLoading(false);\n    }\n  }, [visualizationId, visionNftId, enabled]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  // Set up realtime subscription for value updates\n  useEffect(() => {\n    if (!enabled || !visionNFT?.id) return;\n\n    const channel = supabase\n      .channel(`vision-nft-${visionNFT.id}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'UPDATE',\n          schema: 'public',\n          table: 'vision_nfts',\n          filter: `id=eq.${visionNFT.id}`,\n        },\n        (payload) => {\n          setVisionNFT(payload.new as VisionNFT);\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [visionNFT?.id, enabled]);\n\n  return {\n    visionNFT,\n    history,\n    isLoading,\n    error,\n    refetch: fetchData,\n  };\n}\n\n// Hook for portfolio tracking\nexport function usePortfolioValue(userId?: string) {\n  const [totalValue, setTotalValue] = useState(0);\n  const [totalGain, setTotalGain] = useState(0);\n  const [gainPercentage, setGainPercentage] = useState(0);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    if (!userId) {\n      setIsLoading(false);\n      return;\n    }\n\n    const fetchPortfolio = async () => {\n      const { calculatePortfolioValue } = await import('@/lib/nfts/visionNftApi');\n      const result = await calculatePortfolioValue(userId);\n      \n      if (!result.error) {\n        setTotalValue(result.totalValueCents);\n        setTotalGain(result.totalGainCents);\n        setGainPercentage(result.gainPercentage);\n      }\n      setIsLoading(false);\n    };\n\n    fetchPortfolio();\n\n    // Subscribe to updates\n    const channel = supabase\n      .channel(`portfolio-${userId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'vision_nfts',\n          filter: `current_owner_id=eq.${userId}`,\n        },\n        () => {\n          fetchPortfolio();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [userId]);\n\n  return { totalValue, totalGain, gainPercentage, isLoading };\n}\n";export{n as default};
