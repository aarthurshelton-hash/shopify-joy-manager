import{d6 as e,d7 as t,d8 as s,cp as n,a as r,u as a,r as i,J as o,o as l,s as c,aH as u,aa as d,cM as m,j as h,L as f,C as x,x as p,D as g,B as v,A as w,p as y,t as j,cN as N,bC as b,S as z,a6 as C,P as M,y as D,bG as E,T as B,aq as q,z as L,cU as A,aj as P,aT as S,ca as G,b as _,d9 as k}from"./index-BsQTe2MU.js";!function(){const e=Z,t=Y();for(;;)try{if(371095===-parseInt(e(300))/1+parseInt(e(385))/2*(-parseInt(e(440))/3)+-parseInt(e(450))/4*(-parseInt(e(281))/5)+parseInt(e(308))/6*(-parseInt(e(384))/7)+-parseInt(e(402))/8+-parseInt(e(311))/9*(-parseInt(e(486))/10)+parseInt(e(429))/11)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const I=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[Z(362)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}()(void 0,function(){const e=Z,t={wyJxM:"(((.+)+)+)+$"},s=t;return I[e(324)]()[e(403)](s.wyJxM)[e(324)]()[e(383)+"r"](I)[e(403)](e(339)+"+$")});I();const T=function(){const e=Z,t={};t[e(448)]=e(400),t.dVsQy=e(366),t[e(423)]=function(e,t){return e===t},t[e(345)]="dFXSn";const s=t;let n=!0;return function(e,t){const r=n?function(){const n=Z,r={};r[n(478)]=s[n(448)],r[n(427)]=s[n(296)];const a=r;if(t){if(s[n(423)]("sNDAo",s.dtyyA))return _0x5127ef&&_0x50c24c!==a[n(478)]&&_0x28c78f!==a[n(427)]?_0x2317be:_0x2570e0;{const s=t[n(362)](e,arguments);return t=null,s}}}:function(){};return n=!1,r}}();function Y(){const e=["DgfIBgu","mJaWmc9ZDMCIia","uM9Tyw4NlcbZzq","B3DPD3K","phjLy3qGEd0I","y3jLyxrLrwXLBq","BgLUzvrV","BwLKzgXL","D2LKDgG","BwfYz2LU","kcGOlISPkYKRkq","zxzLBNq","y29SB3i","C3bSAxq","CNfxteO","AxnmAwDODa","zhr5Eue","vgLTzxmGtMv3ia","D3H2rgK","y2XPCa","y3rVCIGICMv0Dq","AgvPz2H0","qMXHy2S","ntaWideYChGGjW","DhrUBfq","Dd11DgyToa","zw50","z1rbwgK","i2u3ztvLna","wLnbwuO","C1LurNK","iIb2Awv3qM94pq","y29UC29Szq","yxbWBhK","v2HPDgu","D1HOseu","zhjHD0LTywDL","pZ8/pY4/pY4/pW","y3rvuKW","sxj3Exy","tLLnqwS","zgvMyxvSDa","pc9ZDMC+","ndaWideWChGGjW","DhjHBNnWyxjLBG","quvoEe8","rMfPBgvKihrVia","C3vIC3rYAw5N","zhrOpsi","CMvHzhK","yw5VBNLTB3vZ","shzjt1u","CMzUuhe","Bg9N","y29UC3rYDwn0BW","n0DltvLnvq","ngr3Cvnkrq","zw9Yz2LHlcbZzq","i0zbrKfgqq","y3rPB25mzxzLBa","mhW0Fdj8m3WX","rvbODNK","mc45nsK","q2LUEMvSjYWGjW","EePZz3a","iZC4nZe2yW","zxjYB3jdB3jYzq","Bgf5zxjtAxPL","C2f2zq","i2zHzMfMoq","suTxyM8","vw5RBM93BG","BgvMDa","mZK0otqWmefzv2vRDq","C2vHCMnO","zMLSBfn0EwXL","wxDxBLC","C1ztB2G","vfrws20","C3DXv24","BgvUz3rO","twf2wuu","C3rYB2TL","BMn0Aw9UkcKG","B25SB2fK","q01Zz0C","whH0v00","phn2zYb4BwXUCW","yMXHy2S","mJu1lcaYntuSia","DhjHy2u","BNmTC2vYAwy","iIb5psi","CMv0DxjUicHMDq","sM9tzM4","B25LCNjVCG","iIb3Awr0Ad0I","iZi5mJuYna","Ewj4EgK","ExHZCLq","mty5mdi3mZjYBgDovfO","vKTbENm","Aw1Hz2uVC3zNkW","y3jLyxrLt2jQzq","CMv2B2TLt2jQzq","zgfYAW","D0fAq2u","zxjYB3i","vg5Rwxm","wePgyNO","Dg9vChbLCKnHCW","nJa3odG3rvbKCMn0","y2vUDgvY","vMvbwNO","y1Phq0G","idiWChGGj0nVCG","iIbMAwXSpsi","zgf0zq","CM4GDgHPCYiPka","wgzAuNm","Bw9Yyw50jYWGrW","nZzNr3f5Ehq","Eg1So2nOyxjZzq","C3jJ","uhzyrvC","sw50zxiNlcbZyq","qwrdCwS","Axnuwxq","ExvguMq","Ahr0Chm6lY9LBG","BwLU","yMvNAw5qyxrO","tLqG4PMA","ywXWAgfIzxrPyW","vgz6yM0","sNfXtNe","BwvZlcbZzxjPzG","ugXnwwu","zM9UDhm","ywXS","Dgv4DefSAwDU","uwzYtMm","s3fwqMy","ndaWideXChGGjW","zw5Wzw5Zzw50lG","BgLNAhq","yM9YzgvY","sKvlB3i","tLbxB3u","tvzJyK8","Aw5JBhvKzxm","C3rYB2TLu3r5Ba","Bw92zxm","uwDrqwq","ide4ChGGj0nVCG","D2HPDgu","wejnDxa","nJbfELf2zMy","uevxyMe","iIb5psiWiIb3Aq","iZq0ndaZyW","ChvZAa","zMLSBfrLEhq","z2v0q29UDgv4Da","CMLM","phjLy3qGEd0Ima","vNrJrNm","ruXtvg4","lI4U","yMLUza","ntm4odvjrNDvBfu","Dgv4DejHC2vSAq","wu1Wz0q","sMHcqxy","iI8+","C3jhu1y","wLbmDem","C2nusKq","CMvKDwnL","BgLUzvDPzhrO","wNP4t24","CfreyMq","BwvHC3vYzvrLEa","tKn2qNa","E30Uy29UC3rYDq","zfzZuxK","D2LKDgG9iG","y3jVC3npCMLNAq","iIbOzwLNAhq9iG","mtaXmti0wvjtuuXX","Bw92zvrV","DhLWzq","q0vgBLG","AxrHBgLJiduWma","vKz6EKC","ihzZia","zM9UDa","mZK2nJeXnhLNven3uq","Bg9HzcbtvKC","uM9Tyw4NlcbuAq","ndm2mtK0CvrZDg1Q","CgLLy2u","v0fhv3G","BfjWsMS","Dg9eyxrHvvjm","x19WCM90B19F","i2e4yti5zq","weniz1q","C1z1D1K","D2fYBG","Aw5MBW","tLfNBKK","4PMuievoifbftLnf","Dg9tDhjPBMC","AgLNAa","y2fUDMfZ","twf3tMe","DMLZAxrZ"];return(Y=function(){return e})()}T(void 0,function(){const e=Z,t={qeqPp:function(e,t){return e(t)},yxsrT:function(e,t){return e+t},pTDbd:e(422)+e(412),xJsgp:e(382),BZPts:e(321),gTAXi:e(436),wAZCe:"exception",sVuwY:e(329)};let s;try{s=t.qeqPp(Function,t[e(428)](t[e(292)],e(295)+e(349)+e(447)+" )")+");")()}catch(a){s=window}const n=s[e(361)]=s[e(361)]||{},r=[t[e(393)],e(320),t.BZPts,t[e(356)],t[e(435)],t[e(319)],e(419)];for(let i=0;i<r[e(409)];i++){const t=T[e(383)+"r"].prototype[e(280)](T),s=r[i],a=n[s]||t;t[e(316)]=T[e(280)](T),t.toString=a[e(324)][e(280)](a),n[s]=t}})();async function W(){const e=Z;document[e(467)]&&document.fonts[e(378)]&&await document[e(467)][e(378)],await new Promise(e=>setTimeout(e,150))}async function K(e,t,s){const n=Z,r={VeAZz:n(326),gyVkE:function(e,t){return e*t},VRHit:function(e,t){return e(t)}};return new Promise((a,i)=>{const o=n,l=new Image,c={};c[o(302)]=o(431)+o(451)+o(354);const u=new Blob([e],c),d=URL[o(432)+o(367)](u);l[o(413)]=()=>{const e=o,n=document[e(334)+e(355)](r[e(442)]);n[e(337)]=r.gyVkE(t,5),n[e(350)]=5*s;const i=n[e(492)]("2d");i.scale(5,5),i[e(365)](l,0,0,t,s),URL[e(433)+e(367)](d),r.VRHit(a,n)},l[o(424)]=()=>{const e=o;URL[e(433)+"ctURL"](d),i(new Error(e(375)+"load SVG"))},l[o(452)]=d})}async function H(e){const t=Z,n={};n[t(399)]=t(387),n.XJFbz="#1A1A1A";const r=n,a=(await s(()=>import("./browser-D7bYB7HG.js").then(e=>e.b),[]))[t(370)],i={};i.dark=e?r[t(399)]:r[t(438)],i.light=t(373)+"t";const o={};return o[t(337)]=200,o[t(338)]=1,o[t(341)]=i,o[t(395)+t(388)]="M",a[t(315)](t(458)+"pensent.com",o)}async function U(){const e=Z,t={};t[e(470)]=e(379);const s=t;return new Promise((t,r)=>{const a=e,i=new Image;i[a(298)+"n"]=s.QfrNc,i[a(413)]=()=>t(i),i[a(424)]=r,i[a(452)]=n})}function Z(e,t){e-=279;const s=Y();let n=s[e];if(void 0===Z.BJbUAA){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};Z.TYoOpu=r,Z.JnMVYo={},Z.BJbUAA=!0}const a=e+s[0],i=Z.JnMVYo[a];if(i)n=i;else{const e=function(e){this.ldQiCs=e,this.cFoPEP=[1,0,0],this.MgnxSR=function(){return"newState"},this.ZpbcGe="\\w+ *\\(\\) *{\\w+ *",this.fTqMhb="['|\"].+['|\"];? *}"};e.prototype.JHrGNA=function(){const e=new RegExp(this.ZpbcGe+this.fTqMhb).test(this.MgnxSR.toString())?--this.cFoPEP[1]:--this.cFoPEP[0];return this.phlXIm(e)},e.prototype.phlXIm=function(e){return Boolean(~e)?this.SxFLWC(this.ldQiCs):e},e.prototype.SxFLWC=function(e){for(let t=0,s=this.cFoPEP.length;t<s;t++)this.cFoPEP.push(Math.round(Math.random())),s=this.cFoPEP.length;return e(this.cFoPEP[0])},new e(Z).JHrGNA(),n=Z.TYoOpu(n),Z.JnMVYo[a]=n}return n}async function O(s,n,r={}){const a=Z,i={NCvBp:function(e){return e()},lRpJk:function(e,t){return e*t},PlMYe:function(e,t,s,n){return e(t,s,n)},TTVKm:function(e,t){return e+t},cZGCH:a(325),scTJD:"#FDFCFB",rfnPq:function(e,t){return e+t},XBMup:a(357),VKAzs:function(e,t){return e-t},suXNy:a(398),Irwyv:a(426),wXhHE:"#78716c",sVSoh:a(317),Tfzbm:function(e,t){return e/t},sYTFy:a(363),EPhvy:a(351),QgQAd:a(336),VFzzG:"600 24px '"+a(392)+a(346)+a(331)+"rif",rqWLJ:a(304)+a(444)+"morant', G"+a(386)+a(493),lGxgX:a(306),KqVBf:function(e,t){return e+t},TnkYs:function(e,t){return e-t},yuFRd:a(389),duyma:function(e,t){return e===t},JhBAv:a(405),AdCqk:function(e,t){return e+t},PiBjB:"  â€¢  ",cjrdU:a(374),ZPLtC:function(e,t){return e-t},NYMAk:function(e,t){return e/t},KXOOa:function(e,t){return e+t},owiwy:function(e,t){return e+t},srGSV:a(372)+"Times New "+a(310)+a(465),BkfQz:a(441),PEWba:function(e,t){return e>t},HvIOU:function(e,t){return e+t},JEKor:function(e,t){return e>=t},MavYE:a(323)+a(461),ZzxOn:function(e,t){return e-t},MawNa:function(e,t){return e(t)},grUkg:function(e,t){return e+t},ttnlT:function(e,t){return e+t},NPWou:function(e,t){return e+t},EGiyC:a(401),JqqNq:"600 13px '"+a(454)+"ns-serif",PvXEW:a(472)+"Inter', sa"+a(420),ZSAYJ:a(473)+"com",NQgnI:function(e,t){return e+t},KkNMA:function(e,t){return e/t}};await i[a(294)](W);const{boardSize:o=600,darkMode:l=!1,withWatermark:c=!1,title:u}=r,d=function(s,n){const r=Z,a={};a[r(347)]=function(e,t){return e/t},a.YMpgD=function(e,t){return e*t},a[r(456)]=function(e,t){return e<t},a.swqWn=function(e,t){return e!==t},a[r(318)]=r(414),a.ELSTn=function(e,t){return e<t},a.VtcFs=function(e,t){return e<t},a[r(303)]=function(e,t){return e+t};const i=a,o=i[r(347)](n,8),l=.02*n,c=n+i[r(283)](l,2);let u=r(416)+'="http://www.w3.org/'+r(330)+r(297)+c+'" height="'+c+r(360)+'"0 0 '+c+" "+c+'">';u+=r(494)+r(488)+r(377)+c+r(299)+c+r(445)+e[r(475)]+r(285);for(let d=0;i[r(456)](d,8);d++)if(i[r(408)](i[r(318)],r(414)))_0x519fa8["revokeObje"+r(367)](_0x2fb937),_0x4e6e6b(new _0x1db8df(r(375)+r(309)));else{const n=7-d;for(let a=0;i[r(496)](a,8);a++){const c=s[n][a],m=c[r(344)]?e[r(474)]:e[r(434)],h=l+i[r(283)](a,o),f=l+d*o;if(u+=r(333)+h+r(421)+f+r(425)+o+'" height="'+o+'" fill="'+m+r(285),c[r(328)][r(409)]>0){const e=i[r(283)](o,.08),s=[];for(const i of c[r(328)]){const e=t(i[r(312)],i[r(341)]);!s[r(479)](e)&&s[r(490)](e)}const n=Math[r(459)](s[r(409)],6),a=[];let l=o-2*e;const d=i[r(283)](l,.7)/n;for(let t=0;i.isTYt(t,n);t++){const e={};if(e[r(341)]=s[t],e[r(396)]=l,a.push(e),l-=d,i[r(495)](l,.1*o))break}for(const t of a){const e=(o-t[r(396)])/2;u+='<rect x="'+i.CEFnX(h,e)+'" y="'+(f+e)+'" width="'+t.layerSize+r(299)+t[r(396)]+r(445)+t[r(341)]+r(285)}}}}return u+=r(371),u}(s,o),m=i[a(314)](o,.02),h=o+i[a(314)](m,2),f=await i[a(466)](K,d,h,h),x=60,p=i[a(407)](h,i[a(314)](x,2)),g=h+220+60+120,v=document[a(334)+a(355)]("canvas");v[a(337)]=i[a(314)](p,5),v[a(350)]=5*g;const w=v[a(492)]("2d");w.scale(5,5),w.imageSmoothingEnabled=!0,w.imageSmoothingQuality=i[a(443)],w[a(404)]=l?"#0A0A0A":i[a(288)],w.fillRect(0,0,p,g),w[a(365)](f,0,0,f.width,f[a(350)],x,x,h,h);const y=i[a(381)](x+h,28);w[a(480)+"e"]=l?a(426):i[a(485)],w[a(290)]=1,w[a(460)](),w[a(301)](x,y),w[a(335)](i[a(430)](p,x),y),w[a(411)]();const j=l?i.suXNy:i[a(368)],N=l?a(317):i.wXhHE,b=l?"#78716c":i[a(406)],z=l?i[a(364)]:i.sVSoh,C=i[a(463)](p,2);let M=y+55;const D=n[a(484)]||i[a(359)],E=n[a(417)]||i[a(390)];w.textBaseline=i[a(482)],w[a(307)]=i[a(305)];const B=w[a(293)+"t"](D).width,q=w[a(293)+"t"](E).width;w[a(307)]=i[a(343)];const L=i.lGxgX,A=w.measureText(L)[a(337)],P=i[a(471)](B+A,q),S=i[a(437)](C,P/2);if(w[a(307)]=i.VFzzG,w[a(404)]=j,w[a(469)]=a(401),w.fillText(D,S,M),w[a(307)]="italic 500"+a(444)+a(449)+"eorgia, se"+a(493),w[a(404)]=z,w[a(491)](L,S+B,M),w.font=i[a(305)],w.fillStyle=j,w[a(491)](E,S+B+A,M),M+=36,n[a(340)]&&n[a(340)]!==a(400)){const e=i[a(457)][a(342)]("|");let t=0;for(;;){switch(e[t++]){case"0":w[a(404)]=N;continue;case"1":M+=32;continue;case"2":w[a(469)]="center";continue;case"3":w[a(491)](n.event,C,M);continue;case"4":w.font=a(304)+a(483)+a(449)+"eorgia, se"+a(493);continue}break}}const G=u,_=n[a(446)]||"";if(G||_){if(i.duyma(a(415),i[a(284)])){const e=_0x20726f[a(362)](_0x2bb343,arguments);return _0x17356e=null,e}{w[a(404)]=b,w[a(307)]=a(352)+"Inter', sa"+a(420),w.textAlign="center";let e="";if(G)e=G[a(439)+"e"](),_&&(e+=i[a(455)](i.PiBjB,_));else if(i.cjrdU===a(313)){if(_0x5cf7c2){const e=_0x58e930[a(362)](_0x44b7dc,arguments);return _0x10bcd3=null,e}}else e=_;const t=2,s=e[a(342)](""),n=s[a(289)]((e,t)=>e+w.measureText(t).width,0),r=i[a(314)](i.TnkYs(s[a(409)],1),t);let o=i[a(287)](C,i[a(369)](i.KXOOa(n,r),2));for(const l of s)w[a(469)]="left",w[a(491)](l,o,M),o+=i[a(332)](w[a(293)+"t"](l)[a(337)],t);M+=28}}if(n.moves&&n[a(481)][a(409)]>0){w.fillStyle=b,w.font=i[a(286)],w[a(469)]=i.BkfQz;const e=n[a(481)].join(" "),t=i[a(487)](e.length,400)?i[a(380)](e[a(376)](0,400),a(279)):e,s=i[a(430)](p-120,40),r=t[a(342)](" ");let o="",l=M;const c=15,u=4;let d=0;for(const n of r){const e=i.owiwy(o+(o?" ":""),n);if(i.PEWba(w.measureText(e).width,s)&&o){if(w[a(491)](o,C,l),o=n,l+=c,d++,i[a(476)](d,u))break}else o=e}o&&d<u&&w.fillText(o,C,l)}const k=i[a(287)](g,x)-20;w[a(404)]=b,w[a(307)]="500 11px '"+a(454)+"ns-serif",w[a(469)]=a(441);const I=i[a(410)][a(342)](""),T=I[a(289)]((e,t)=>e+w[a(293)+"t"](t)[a(337)],0)+i[a(314)](i.ZPLtC(I[a(409)],1),4);let Y=i[a(291)](C,i[a(463)](T,2));for(const e of I)w[a(469)]=a(401),w[a(491)](e,Y,k),Y+=i[a(380)](w[a(293)+"t"](e)[a(337)],4);if(c){const[e,t]=await Promise[a(468)]([i[a(327)](H,!1),U()]),s=220,n=65,r=i.HvIOU(x,h)-s-12,o=i.rfnPq(x,h)-n-12;w[a(404)]="rgba(255, "+a(418)+a(391),w[a(460)](),w.roundRect(r,o,s,n,6),w.fill(),w[a(480)+"e"]=a(357),w[a(290)]=1,w[a(411)]();const l=48,c=i.grUkg(r,12),u=i.grUkg(o,i[a(369)](n-l,2));w[a(397)](),w[a(460)](),w.arc(i[a(353)](c,l/2),u+l/2,l/2,0,2*Math.PI),w[a(348)](),w.drawImage(t,c,u,l,l),w.restore();const d=i[a(477)](c,l)+10;w.textAlign=i.EGiyC,w[a(282)+"ne"]=a(462),w.fillStyle=a(489),w[a(307)]=i[a(464)],w[a(491)]("EN PENSENT",d,o+28),w.fillStyle=a(394),w.font=i[a(453)],w[a(491)](i[a(358)],d,o+46);const m=50,f=i[a(291)](i[a(322)](r,s)-m,10),p=o+i.KkNMA(i[a(437)](n,m),2),g=new Image;await new Promise(t=>{const s=a;g[s(413)]=()=>{w[s(365)](g,f,p,m,m),t()},g[s(424)]=()=>t(),g[s(452)]=e})}return v}const V=G.filter(e=>"custom"!==e.id);const F=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const X=()=>{const e=r(),{user:t,isLoading:s}=a(),[n,I]=i.useState(null),[T,Y]=i.useState(!1),[W,K]=i.useState(0),[H,U]=i.useState(""),[Z,X]=i.useState([]),[J,R]=i.useState(50),[$,Q]=i.useState(!0),[ee,te]=i.useState(!1),[se,ne]=i.useState(null);i.useEffect(()=>{s||(async()=>{if(!t)return void I(!1);const{data:e}=await c.rpc("has_role",{_user_id:t.id,_role:"admin"});I(!0===e)})()},[t,s]);const re=i.useCallback(async(e,s,n,r,a=!0)=>{try{const i=o(e.pgn),h=a?V[Math.floor(Math.random()*V.length)]:V[n%V.length],f=function(e,t){const s=G.find(e=>e.id===t)||G[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(i.board,h.id);l(h.id);const x=await O(f,i.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),g=Date.now(),v=`${t.id}/${g}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await c.storage.from("visualizations").upload(v,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:y}=c.storage.from("visualizations").getPublicUrl(v),j=u(e.pgn),N={white:i.gameData.white,black:i.gameData.black,event:i.gameData.event,date:i.gameData.date,result:i.gameData.result,pgn:i.gameData.pgn,moves:i.gameData.moves,board:f,totalMoves:i.totalMoves,visualizationState:{paletteId:h.id,paletteName:h.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:j}},{data:b,error:z}=await c.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:N,image_path:y.publicUrl}).select().single();if(z)throw z;const C=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:M,error:D}=await d(b.id,C);if(D)throw D;const E=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<E.viewCount;e++)await c.rpc("record_vision_interaction",{p_visualization_id:b.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const B=m(e.pgn),q=a?"premium":"genesis";return{title:s,success:!0,visualizationId:b.id,listingId:null==M?void 0:M.id,isExemplar:r,paletteId:h.id,paletteName:h.name,gameHash:j,tier:q,openingName:null==B?void 0:B.fullName}}catch(i){return{title:s,success:!1,error:i.message,isExemplar:r}}},[t]),ae=Z.filter(e=>e.success).length,ie=Z.filter(e=>!e.success).length;return Z.filter(e=>e.success&&e.isExemplar).length,s||null===n?h.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:h.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):t&&n?h.jsx("div",{className:"min-h-screen bg-background p-8",children:h.jsxs("div",{className:"max-w-4xl mx-auto",children:[h.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[h.jsx(w,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),h.jsxs(x,{children:[h.jsx(y,{children:h.jsxs(j,{className:"flex items-center gap-3",children:[h.jsx(N,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),h.jsxs(p,{className:"space-y-6",children:[h.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(b,{className:"h-5 w-5 text-amber-500 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",J," visions: ",Math.min(25,J)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,J-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),h.jsxs("div",{className:"flex items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),h.jsxs("select",{value:J,onChange:e=>R(Number(e.target.value)),disabled:T,className:"bg-muted border border-border rounded px-3 py-2",children:[h.jsx("option",{value:5,children:"5 (test)"}),h.jsx("option",{value:10,children:"10"}),h.jsx("option",{value:25,children:"25"}),h.jsx("option",{value:50,children:"50"})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(z,{id:"use-official-palettes",checked:$,onCheckedChange:Q,disabled:T}),h.jsxs(C,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[h.jsx(M,{className:"h-4 w-4 text-primary"}),h.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),$&&h.jsxs(D,{variant:"secondary",className:"text-xs",children:[V.length," palettes"]})]})]}),h.jsx(v,{onClick:async()=>{if(!t)return void _.error("You must be logged in as the CEO account");Y(!0),X([]),K(0);const e=[],s=k.slice(0,Math.min(J,k.length)),n=[];for(let t=0;t<J;t++){const e=t%s.length,r=t<25,a=F[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];U(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,$);e.push(i),X([...e]),K((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}Y(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?_.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):_.error("Failed to create any visions")},disabled:T||!t,className:"w-full",size:"lg",children:T?h.jsxs(h.Fragment,{children:[h.jsx(f,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):h.jsxs(h.Fragment,{children:[h.jsx(E,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),h.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[h.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(B,{className:"h-5 w-5 text-destructive mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),h.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await c.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return _.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await c.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),l=n.filter(e=>i.has(e));if(0===o.length)return _.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:l.length}),void te(!1);await c.from("visualization_listings").delete().in("visualization_id",o),await c.from("vision_scores").delete().in("visualization_id",o),await c.from("vision_interactions").delete().in("visualization_id",o),await c.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await c.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await c.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:l.length}),_.success(`Deleted ${o.length} test visions`,{description:l.length>0?`${l.length} visions with natural value preserved`:void 0})}catch(e){_.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||T||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?h.jsxs(h.Fragment,{children:[h.jsx(f,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):h.jsxs(h.Fragment,{children:[h.jsx(B,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&h.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&h.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),T&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(q,{value:W,className:"h-2"}),h.jsx("p",{className:"text-sm text-muted-foreground text-center",children:H})]}),Z.length>0&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[h.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[h.jsx(L,{className:"h-4 w-4"}),ae," successful"]}),h.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[h.jsx(A,{className:"h-4 w-4"}),Z.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),h.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[h.jsx(P,{className:"h-4 w-4"}),Z.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&h.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[h.jsx(g,{className:"h-4 w-4"}),ie," failed"]})]}),h.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:Z.map((e,t)=>h.jsxs(S.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[h.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?h.jsx(A,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):h.jsx(P,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):h.jsx(g,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),h.jsx("span",{className:"truncate",children:e.title}),e.openingName&&h.jsx(D,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&h.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&h.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[h.jsxs(D,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[h.jsx(M,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&h.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):h.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:h.jsx(x,{className:"max-w-md",children:h.jsxs(p,{className:"pt-6 text-center",children:[h.jsx(g,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),h.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),h.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),h.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{X as default};
