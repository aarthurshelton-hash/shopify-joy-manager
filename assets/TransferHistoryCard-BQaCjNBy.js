const n="import React, { useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Loader2, ArrowRight, Gift, DollarSign, Sparkles, History, User } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { format } from 'date-fns';\n\ninterface Transfer {\n  id: string;\n  from_user_id: string | null;\n  to_user_id: string;\n  transfer_type: string;\n  created_at: string;\n  from_display_name?: string | null;\n  to_display_name?: string | null;\n}\n\ninterface TransferHistoryCardProps {\n  visualizationId: string;\n  compact?: boolean;\n}\n\nexport const TransferHistoryCard: React.FC<TransferHistoryCardProps> = ({\n  visualizationId,\n  compact = false,\n}) => {\n  const [transfers, setTransfers] = useState<Transfer[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const fetchTransferHistory = async () => {\n      setIsLoading(true);\n      \n      // Fetch transfers for this visualization\n      const { data: transferData, error } = await supabase\n        .from('visualization_transfers')\n        .select('*')\n        .eq('visualization_id', visualizationId)\n        .order('created_at', { ascending: false });\n\n      if (error || !transferData) {\n        setIsLoading(false);\n        return;\n      }\n\n      // Get unique user IDs\n      const userIds = new Set<string>();\n      transferData.forEach((t) => {\n        if (t.from_user_id) userIds.add(t.from_user_id);\n        if (t.to_user_id) userIds.add(t.to_user_id);\n      });\n\n      // Fetch profiles for all users\n      let profilesMap: Record<string, string | null> = {};\n      if (userIds.size > 0) {\n        const { data: profiles } = await supabase\n          .from('profiles')\n          .select('user_id, display_name')\n          .in('user_id', Array.from(userIds));\n\n        profilesMap = (profiles || []).reduce((acc, p) => {\n          acc[p.user_id] = p.display_name;\n          return acc;\n        }, {} as Record<string, string | null>);\n      }\n\n      // Enrich transfers with display names\n      const enrichedTransfers = transferData.map((t) => ({\n        ...t,\n        from_display_name: t.from_user_id ? profilesMap[t.from_user_id] : null,\n        to_display_name: profilesMap[t.to_user_id] || null,\n      }));\n\n      setTransfers(enrichedTransfers);\n      setIsLoading(false);\n    };\n\n    fetchTransferHistory();\n  }, [visualizationId]);\n\n  const getTransferIcon = (type: string) => {\n    switch (type) {\n      case 'purchase':\n        return <DollarSign className=\"h-3.5 w-3.5 text-green-500\" />;\n      case 'free_claim':\n        return <Gift className=\"h-3.5 w-3.5 text-blue-500\" />;\n      case 'gift':\n        return <Sparkles className=\"h-3.5 w-3.5 text-purple-500\" />;\n      default:\n        return <ArrowRight className=\"h-3.5 w-3.5 text-muted-foreground\" />;\n    }\n  };\n\n  const getTransferLabel = (type: string) => {\n    switch (type) {\n      case 'purchase':\n        return 'Purchased';\n      case 'free_claim':\n        return 'Claimed';\n      case 'gift':\n        return 'Gifted';\n      default:\n        return 'Transferred';\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card className={compact ? 'border-0 shadow-none' : ''}>\n        <CardContent className=\"flex items-center justify-center py-6\">\n          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (transfers.length === 0) {\n    return (\n      <Card className={compact ? 'border-0 shadow-none' : ''}>\n        <CardContent className=\"flex flex-col items-center justify-center py-6 text-center\">\n          <History className=\"h-8 w-8 text-muted-foreground/30 mb-2\" />\n          <p className=\"text-sm text-muted-foreground\">No transfer history</p>\n          <p className=\"text-xs text-muted-foreground/70\">This vision hasn't been traded yet</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const content = (\n    <ScrollArea className={compact ? 'max-h-48' : 'max-h-64'}>\n      <div className=\"space-y-2\">\n        {transfers.map((transfer, index) => (\n          <div\n            key={transfer.id}\n            className=\"flex items-center gap-2 p-2 rounded-lg bg-muted/50 text-sm\"\n          >\n            <div className=\"flex items-center justify-center h-7 w-7 rounded-full bg-background shrink-0\">\n              {getTransferIcon(transfer.transfer_type)}\n            </div>\n            \n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center gap-1 flex-wrap\">\n                {transfer.from_user_id ? (\n                  <span className=\"text-muted-foreground truncate max-w-[80px]\">\n                    {transfer.from_display_name || 'Unknown'}\n                  </span>\n                ) : (\n                  <span className=\"text-muted-foreground italic\">Unclaimed</span>\n                )}\n                <ArrowRight className=\"h-3 w-3 text-muted-foreground/50 shrink-0\" />\n                <span className=\"font-medium truncate max-w-[80px]\">\n                  {transfer.to_display_name || 'Unknown'}\n                </span>\n              </div>\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">\n                  {getTransferLabel(transfer.transfer_type)}\n                </Badge>\n                <span>{format(new Date(transfer.created_at), 'MMM d, yyyy')}</span>\n              </div>\n            </div>\n            \n            {index === 0 && (\n              <Badge variant=\"outline\" className=\"text-[10px] shrink-0\">\n                Latest\n              </Badge>\n            )}\n          </div>\n        ))}\n      </div>\n    </ScrollArea>\n  );\n\n  if (compact) {\n    return content;\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-base flex items-center gap-2\">\n          <History className=\"h-4 w-4\" />\n          Transfer History\n          <Badge variant=\"secondary\" className=\"text-xs ml-auto\">\n            {transfers.length} transfer{transfers.length !== 1 ? 's' : ''}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"pt-0\">\n        {content}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default TransferHistoryCard;\n";export{n as default};
