import{a as e,u as s,r as a,j as i,H as n,aA as t,au as r,bC as d,B as l,A as o,b7 as c,b4 as m,C as x,p as u,t as h,w as j,x as p,v as g,dp as v,al as f,cR as N,bo as w,ay as b,D as y,y as k,s as _,dB as z}from"./index-Byyho7FJ.js";import{A as D,a as C,b as I}from"./alert-D3REXXub.js";import{C as U}from"./calendar-D7nu8es0.js";const E=()=>{var E,S,A,W,R,V,L;const P=e(),{user:B,isLoading:F}=s(),[T,O]=a.useState(null),[q,H]=a.useState(!1),[M,Y]=a.useState(!1),[$,G]=a.useState(null),[J,K]=a.useState(null),Q=a.useRef(null),X=a.useRef(null);a.useEffect(()=>{F||(async()=>{if(!B)return void O(!1);const{data:e}=await _.rpc("has_role",{_user_id:B.id,_role:"admin"});O(!0===e)})()},[B,F]);const Z=async e=>{Y(!0),G(null);try{const s=URL.createObjectURL(e);K(s);const a=new Image;await new Promise((e,i)=>{a.onload=()=>e(),a.onerror=()=>i(new Error("Failed to load image")),a.src=s});const i=X.current;if(!i)throw new Error("Canvas not available");i.width=a.width,i.height=a.height;const n=i.getContext("2d");if(!n)throw new Error("Could not get canvas context");n.drawImage(a,0,0);const t=z(i);if(!t)return void G({found:!1});let r=null,d=null;const{data:l}=await _.from("saved_visualizations").select("id, title, created_at, public_share_id").eq("id",t.visualizationId).single();l&&(r=l);const{data:o}=await _.from("profiles").select("user_id, display_name").eq("user_id",t.userId).single();o&&(d={id:o.user_id,display_name:o.display_name||"Unknown"}),G({found:!0,data:t,visualization:r||void 0,owner:d||void 0})}catch(s){G({found:!1})}finally{Y(!1)}};return F||null===T?i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsxs("main",{className:"container mx-auto px-4 py-12 max-w-4xl",children:[i.jsx(t,{className:"h-8 w-64 mb-4"}),i.jsx(t,{className:"h-64 w-full"})]}),i.jsx(r,{})]}):T?i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsxs("main",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[i.jsxs(l,{variant:"ghost",onClick:()=>P("/admin/dmca"),className:"mb-6",children:[i.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to DMCA Reports"]}),i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx(c,{className:"w-8 h-8 text-primary"}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Watermark Verification"}),i.jsx("p",{className:"text-muted-foreground",children:"Extract and verify ownership data from En Pensent visualization images"})]}),i.jsxs(l,{variant:"outline",onClick:()=>P("/admin/batch-watermark-verification"),children:[i.jsx(m,{className:"w-4 h-4 mr-2"}),"Batch Analysis"]})]}),i.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[i.jsxs(x,{children:[i.jsxs(u,{children:[i.jsx(h,{children:"Upload Image"}),i.jsx(j,{children:"Upload a suspicious image to check for embedded ownership data"})]}),i.jsxs(p,{children:[i.jsxs("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer "+(q?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"),onDragOver:e=>{e.preventDefault(),H(!0)},onDragLeave:e=>{e.preventDefault(),H(!1)},onDrop:e=>{e.preventDefault(),H(!1);const s=e.dataTransfer.files[0];s&&s.type.startsWith("image/")&&Z(s)},onClick:()=>{var e;return null==(e=Q.current)?void 0:e.click()},children:[i.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&a.type.startsWith("image/")&&Z(a)},className:"hidden"}),M?i.jsxs("div",{className:"space-y-3",children:[i.jsx(g,{className:"w-12 h-12 mx-auto text-primary animate-spin"}),i.jsx("p",{className:"text-muted-foreground",children:"Analyzing image..."})]}):J?i.jsxs("div",{className:"space-y-3",children:[i.jsx("img",{src:J,alt:"Uploaded",className:"max-h-48 mx-auto rounded-lg shadow-lg"}),i.jsx(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),G(null),K(null),Q.current&&(Q.current.value="")},children:"Upload Different Image"})]}):i.jsxs(i.Fragment,{children:[i.jsx(v,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),i.jsx("p",{className:"text-lg font-medium mb-1",children:"Drag & drop an image here"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"or click to browse"})]})]}),i.jsx("canvas",{ref:X,className:"hidden"})]})]}),i.jsxs(x,{children:[i.jsxs(u,{children:[i.jsx(h,{children:"Verification Result"}),i.jsx(j,{children:"Extracted ownership information from the uploaded image"})]}),i.jsxs(p,{children:[!$&&!M&&i.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[i.jsx(f,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),i.jsx("p",{children:"Upload an image to analyze"})]}),M&&i.jsxs("div",{className:"text-center py-12",children:[i.jsx(t,{className:"h-6 w-48 mx-auto mb-4"}),i.jsx(t,{className:"h-4 w-32 mx-auto mb-2"}),i.jsx(t,{className:"h-4 w-40 mx-auto"})]}),$&&!M&&i.jsx("div",{className:"space-y-4",children:$.found?i.jsxs(i.Fragment,{children:[i.jsxs(D,{className:"border-green-500/20 bg-green-500/5",children:[i.jsx(N,{className:"h-4 w-4 text-green-500"}),i.jsx(C,{className:"text-green-600",children:"Watermark Found"}),i.jsx(I,{children:"This image contains valid En Pensent ownership data."})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[i.jsx(w,{className:"w-5 h-5 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Owner"}),i.jsx("p",{className:"font-medium",children:(null==(E=$.owner)?void 0:E.display_name)||"Unknown User"}),i.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:null==(S=$.data)?void 0:S.userId})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[i.jsx(f,{className:"w-5 h-5 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualization"}),i.jsx("p",{className:"font-medium",children:(null==(A=$.visualization)?void 0:A.title)||"Unknown Vision"}),i.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:null==(W=$.data)?void 0:W.visualizationId})]})]}),i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[i.jsx(U,{className:"w-5 h-5 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Export Date"}),i.jsx("p",{className:"font-medium",children:(null==(R=$.data)?void 0:R.timestamp)?new Date($.data.timestamp).toLocaleString():"Unknown"})]})]}),(null==(V=$.data)?void 0:V.shareId)&&i.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[i.jsx(b,{className:"w-5 h-5 text-muted-foreground"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Share ID"}),i.jsx("p",{className:"font-medium font-mono",children:$.data.shareId})]})]}),(null==(L=$.visualization)?void 0:L.public_share_id)&&i.jsx(l,{variant:"outline",className:"w-full",onClick:()=>{var e;return P(`/vision/${null==(e=$.visualization)?void 0:e.public_share_id}`)},children:"View Original Vision"})]})]}):i.jsxs(D,{variant:"destructive",children:[i.jsx(y,{className:"h-4 w-4"}),i.jsx(C,{children:"No Watermark Found"}),i.jsx(I,{children:"This image does not contain valid En Pensent ownership data. It may be an unauthorized copy, a modified image, or not created through our platform."})]})})]})]})]}),i.jsxs(x,{className:"mt-6",children:[i.jsx(u,{children:i.jsx(h,{children:"How Watermark Verification Works"})}),i.jsx(p,{className:"text-sm text-muted-foreground",children:i.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[i.jsx(k,{className:"mb-2",children:"Step 1"}),i.jsx("p",{children:"All visualization exports from En Pensent automatically embed invisible ownership data using LSB steganography."})]}),i.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[i.jsx(k,{className:"mb-2",children:"Step 2"}),i.jsx("p",{children:"This tool extracts the hidden data from suspicious images without affecting the visible content."})]}),i.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[i.jsx(k,{className:"mb-2",children:"Step 3"}),i.jsx("p",{children:"The extracted data is cross-referenced with our database to verify ownership and track distribution."})]})]})})]})]}),i.jsx(r,{})]}):i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsx(n,{}),i.jsx("main",{className:"container mx-auto px-4 py-12 max-w-2xl",children:i.jsxs(D,{variant:"destructive",children:[i.jsx(d,{className:"h-4 w-4"}),i.jsx(C,{children:"Access Denied"}),i.jsx(I,{children:"You do not have permission to access this page."})]})}),i.jsx(r,{})]})};export{E as default};
