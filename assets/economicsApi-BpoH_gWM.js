const n="import { supabase } from '@/integrations/supabase/client';\nimport { \n  PROFIT_ECONOMICS, \n  calculateProfitDistribution, \n  estimateOrderCosts \n} from '@/lib/economics/profitBasedRoyalties';\n\nexport interface VisionEconomics {\n  visualization_id: string;\n  total_print_revenue_cents: number;\n  total_royalties_earned_cents: number;\n  total_trades: number;\n  trade_volume_cents: number;\n  vision_score: number;\n}\n\nexport interface PortfolioEconomics {\n  user_id: string;\n  total_visions_owned: number;\n  total_royalties_earned_cents: number;\n  total_print_orders: number;\n  total_marketplace_sales: number;\n  total_sale_proceeds_cents: number;\n  total_portfolio_score: number;\n}\n\n/**\n * Get economics data for a specific vision\n */\nexport async function getVisionEconomics(visualizationId: string): Promise<{\n  data: VisionEconomics | null;\n  error: Error | null;\n}> {\n  try {\n    const { data, error } = await supabase.rpc('get_vision_economics', {\n      p_visualization_id: visualizationId,\n    });\n\n    if (error) throw error;\n    return { data: data as unknown as VisionEconomics, error: null };\n  } catch (error) {\n    return { data: null, error: error as Error };\n  }\n}\n\n/**\n * Get portfolio economics for the current user\n */\nexport async function getUserPortfolioEconomics(): Promise<{\n  data: PortfolioEconomics | null;\n  error: Error | null;\n}> {\n  try {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) throw new Error('Not authenticated');\n\n    const { data, error } = await supabase.rpc('get_user_portfolio_economics', {\n      p_user_id: user.id,\n    });\n\n    if (error) throw error;\n    return { data: data as unknown as PortfolioEconomics, error: null };\n  } catch (error) {\n    return { data: null, error: error as Error };\n  }\n}\n\n/**\n * Calculate estimated royalty for a potential print order\n */\nexport function estimatePrintRoyalty(\n  productType: 'print' | 'framedPrint' | 'book' | 'infoCard',\n  size: string,\n  priceCents: number\n): {\n  grossProfitCents: number;\n  creatorRoyaltyCents: number;\n  educationFundCents: number;\n  palettePoolCents: number;\n  gamecardPoolCents: number;\n  profitMarginPercent: number;\n} {\n  const costs = estimateOrderCosts(productType, size, priceCents);\n  const distribution = calculateProfitDistribution(costs);\n  \n  return {\n    grossProfitCents: distribution.grossProfitCents,\n    creatorRoyaltyCents: distribution.creatorRoyaltyCents,\n    educationFundCents: distribution.educationFundCents,\n    palettePoolCents: distribution.palettePoolCents,\n    gamecardPoolCents: distribution.gamecardPoolCents,\n    profitMarginPercent: distribution.profitMarginPercent,\n  };\n}\n\n/**\n * Calculate marketplace fee and seller proceeds\n */\nexport function calculateMarketplaceFee(priceCents: number): {\n  feeCents: number;\n  sellerProceedsCents: number;\n  feePercent: number;\n} {\n  // Free gifts have no fee\n  if (priceCents === 0) {\n    return { feeCents: 0, sellerProceedsCents: 0, feePercent: 0 };\n  }\n  \n  const feePercent = PROFIT_ECONOMICS.marketplaceFee * 100; // 5%\n  const feeCents = Math.round(priceCents * PROFIT_ECONOMICS.marketplaceFee);\n  const sellerProceedsCents = priceCents - feeCents;\n  \n  return { feeCents, sellerProceedsCents, feePercent };\n}\n\n/**\n * Get economics breakdown explanation for UI\n */\nexport function getEconomicsExplanation(): {\n  printOrderBreakdown: {\n    label: string;\n    percent: number;\n    description: string;\n  }[];\n  marketplaceBreakdown: {\n    label: string;\n    percent: number;\n    description: string;\n  }[];\n} {\n  const pool = PROFIT_ECONOMICS.poolDistribution;\n  \n  return {\n    printOrderBreakdown: [\n      {\n        label: 'Creator Value',\n        percent: pool.creatorRoyalty * 100,\n        description: 'Adds to your vision\\'s tradeable value',\n      },\n      {\n        label: 'Education Fund',\n        percent: pool.educationFund * 100,\n        description: 'Supports chess education scholarships',\n      },\n      {\n        label: 'Palette Pool',\n        percent: pool.palettePool * 100,\n        description: 'Rewards popular color palettes',\n      },\n      {\n        label: 'Gamecard Pool',\n        percent: pool.gamecardPool * 100,\n        description: 'Values legendary chess games',\n      },\n    ],\n    marketplaceBreakdown: [\n      {\n        label: 'Seller Receives',\n        percent: 95,\n        description: '95% goes directly to the seller',\n      },\n      {\n        label: 'Platform Fee',\n        percent: 5,\n        description: 'Supports platform operations',\n      },\n    ],\n  };\n}\n\n/**\n * Format cents to display currency\n */\nexport function formatCentsToDisplay(cents: number): string {\n  return `$${(cents / 100).toFixed(2)}`;\n}\n\n/**\n * Get platform-wide economics summary (for admin/dashboard)\n */\nexport async function getPlatformEconomicsSummary(): Promise<{\n  data: {\n    totalPrintRevenue: number;\n    totalMarketplaceVolume: number;\n    totalRoyaltiesDistributed: number;\n    totalEducationFundContributions: number;\n    totalPalettePoolValue: number;\n    totalGamecardPoolValue: number;\n  } | null;\n  error: Error | null;\n}> {\n  try {\n    // Get order financials totals\n    const { data: orderData, error: orderError } = await supabase\n      .from('order_financials')\n      .select('order_type, gross_revenue_cents, creator_royalty_cents, education_fund_cents, palette_pool_cents, gamecard_pool_cents');\n    \n    if (orderError) throw orderError;\n\n    const totals = (orderData || []).reduce(\n      (acc, row) => {\n        if (row.order_type === 'print_order') {\n          acc.totalPrintRevenue += row.gross_revenue_cents || 0;\n        } else if (row.order_type === 'marketplace_sale') {\n          acc.totalMarketplaceVolume += row.gross_revenue_cents || 0;\n        }\n        acc.totalRoyaltiesDistributed += row.creator_royalty_cents || 0;\n        acc.totalEducationFundContributions += row.education_fund_cents || 0;\n        acc.totalPalettePoolValue += row.palette_pool_cents || 0;\n        acc.totalGamecardPoolValue += row.gamecard_pool_cents || 0;\n        return acc;\n      },\n      {\n        totalPrintRevenue: 0,\n        totalMarketplaceVolume: 0,\n        totalRoyaltiesDistributed: 0,\n        totalEducationFundContributions: 0,\n        totalPalettePoolValue: 0,\n        totalGamecardPoolValue: 0,\n      }\n    );\n\n    return { data: totals, error: null };\n  } catch (error) {\n    return { data: null, error: error as Error };\n  }\n}\n";export{n as default};
