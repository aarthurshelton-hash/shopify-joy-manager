import{d6 as e,d7 as t,cp as s,a as n,u as a,r,J as i,o,s as c,aH as l,aa as u,cM as d,j as m,L as h,C as f,x,D as p,B as g,A as v,p as w,t as j,cN as y,bC as N,S as b,a6 as z,P as C,y as M,bG as B,T as L,aq as D,z as A,cU as E,aj as q,aT as G,ca as P,b as S,d8 as W}from"./index-D4HOopRf.js";function I(e,t){e-=285;const s=k();let n=s[e];if(void 0===I.ZwCHfW){var a=function(e){let t="",s="",n=t+a;for(let a,r,i=0,o=0;r=e.charAt(o++);~r&&(a=i%4?64*a+r:r,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&a>>(-2*i&6)):i:0)r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let a=0,r=t.length;a<r;a++)s+="%"+("00"+t.charCodeAt(a).toString(16)).slice(-2);return decodeURIComponent(s)};I.dQcXmu=a,I.ScYssm={},I.ZwCHfW=!0}const r=e+s[0],i=I.ScYssm[r];if(i)n=i;else{const e=function(e){this.GrPCEl=e,this.wudABo=[1,0,0],this.oPLIml=function(){return"newState"},this.DFXMoI="\\w+ *\\(\\) *{\\w+ *",this.YOAqkl="['|\"].+['|\"];? *}"};e.prototype.Vjuntq=function(){const e=new RegExp(this.DFXMoI+this.YOAqkl).test(this.oPLIml.toString())?--this.wudABo[1]:--this.wudABo[0];return this.nRNRwx(e)},e.prototype.nRNRwx=function(e){return Boolean(~e)?this.Lskcvg(this.GrPCEl):e},e.prototype.Lskcvg=function(e){for(let t=0,s=this.wudABo.length;t<s;t++)this.wudABo.push(Math.round(Math.random())),s=this.wudABo.length;return e(this.wudABo[0])},new e(I).Vjuntq(),n=I.dQcXmu(n),I.ScYssm[r]=n}return n}!function(){const e=I,t=k();for(;;)try{if(357906===parseInt(e(395))/1*(parseInt(e(351))/2)+-parseInt(e(319))/3+parseInt(e(471))/4+parseInt(e(480))/5*(parseInt(e(352))/6)+parseInt(e(305))/7+-parseInt(e(370))/8*(parseInt(e(313))/9)+parseInt(e(457))/10)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const Y=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[I(324)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}()(void 0,function(){const e=I,t={};t[e(298)]=e(421)+"+$";const s=t;return Y.toString()[e(349)](e(421)+"+$")[e(450)]()[e(332)+"r"](Y)[e(349)](s[e(298)])});Y();const T=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[I(324)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}();T(void 0,function(){const e=I,t={YuCWh:function(e,t){return e(t)},mApph:function(e){return e()},ejIjQ:"exception"};let s;try{const n=t.YuCWh(Function,e(472)+e(318)+'{}.constructor("return this")( ));');s=t[e(465)](n)}catch(r){s=window}const n=s.console=s[e(362)]||{},a=[e(406),e(467),e(293),"error",t[e(426)],e(359),e(355)];for(let i=0;i<a.length;i++){const t=T[e(332)+"r"][e(368)].bind(T),s=a[i],r=n[s]||t;t[e(372)]=T.bind(T),t[e(450)]=r[e(450)][e(481)](r),n[s]=t}})();async function _(){const e=I;document.fonts&&document[e(462)].ready&&await document[e(462)][e(420)],await new Promise(e=>setTimeout(e,150))}function k(){const e=["vgLTzxmGtMv3ia","Dg9eyxrHvvjm","zwPjALe","zxjYB3jdB3jYzq","C1L6svy","twTdt1u","AxrHBgLJiduWma","zLf6BLK","rezntvO","nJaWidi0ChGGjW","B3v1sMG","rKz2sLe","v0PPwKe","y3rvuKW","zhrOpsi","BvPLz3q","phjLy3qGEd0Ima","Eg1So2nOyxjZzq","D3CUDZmUB3jNlW","Aw1Hz2vtBw9VDa","AxnmAwDODa","sw50zxiNlcbZyq","q2LUEMvSjYWGjW","zwLLDhK","qMXHy2S","CMDIysGYntuSia","Dg9tDhjPBMC","Dg9vChbLCKnHCW","mJu1lcaYntuSia","ChvZAa","zhjHD0LTywDL","EhzxzM4","iIb5psiWiIb3Aq","mtiZmtyZmg9Kugf1yq","EKncz3u","B25LCNjVCG","txPfC1u","Bw92zxm","zM9UDhm","B25SB2fK","rMfPBgvKihrVia","BufWCgG","rKjvrLu","D2fYBG","Dgv4DefSAwDU","BNmTC2vYAwy","iIbOzwLNAhq9iG","mZaYotjMvM5WA28","CMv0DxjUicHMDq","CMvKDwnL","Bw92zvrV","D2LKDgG","iIb3Awr0Ad0I","AgLNAa","D2HPDgu","rgH5v3e","mJbzA05AA20","yMLUza","iZq0ndaZyW","iI8+","y1rev0K","tMPiv1a","AM9PBG","BgLUzvrV","D2LKDgG9iG","Ahr0Chm6lY9LBG","zgfYAW","zgvMyxvSDa","t0X3yNa","wuD2Ewm","uM9Tyw4NlcbZzq","Aw5MBW","CMvZDg9Yzq","Au5xD1C","ntaWideYChGGjW","BwvHC3vYzvrLEa","suLeBMm","i2zHzMfMoq","AgvPz2H0","C3rYB2TL","y3jLyxrLrwXLBq","y1fLCwq","z2v0q29UDgv4Da","mtyXmdmXnuTKsfHIsW","i0zbrKfgqq","zMLSBfjLy3q","i2e4yti5zq","zw5Wzw5Zzw50lG","z0jNzhe","y3jLyxrLt2jQzq","iZfbmueXqq","nZaWmNv0uvrxzq","wwnqDKO","vwTUEwu","sgrTEvO","Bg9HzcbtvKC","BMn0Aw9UkcKG","mtyYntm2neXjDwLIra","DMLZAxrZ","ndaWideXChGGjW","Aw5JBhvKzxm","Bef5sxC","yxbWBhK","uhvzCgy","DhjHBNnWyxjLBG","u2ngDNO","4PMuievoifbftLnf","CM91BMrszwn0","sMjoAg4","ihzZia","y29UC3rYDwn0BW","zxzLBNq","BwLU","vfLRC0q","C3rYB2TLu3r5Ba","tMzZyxq","zw50","wK5nseW","BwfYz2LU","EK9Os1G","BgvUz3rO","y3jVC3npCMLNAq","Dd11DgyToa","mc45nsK","EMLhDgm","mJaWmc9ZDMCIia","iIbMAwXSpsi","C2vHCMnO","rhvNtMy","mM9wB3HTyG","mta1otCZoe9XreHIAa","Bw9Yyw50jYWGrW","uNb1BK0","DhjHy2u","vgX3tLa","rLzUDfi","C3jJ","DgfIBgu","AgLUz1f1ywXPDa","y29T","y29UC29Szq","AfvREe4","y29SB3i","uM9Tyw4NlcbuAq","z0zNsey","AwjQB20","ChjVDg90ExbL","ywXS","mJC3nMP0teT2sG","iZbbmeeWqq","x19WCM90B19F","BgvMDa","yw5VBNLTB3vZ","i2u3ztvLna","phjLy3qGEd0I","iIb5psi","pZ8/pY4/pY4/pW","BwLKzgXL","zMLSBfrLEhq","ntaWideXChGGjW","y0TMteG","CMLM","lI4U","vw5RBM93BG","zMLSBfn0EwXL","BgLNAhq","vhncC2K","rKjPv08","C3bSAxq","Bg5pqwm","A3H3rNC","zM9UDa","u0LPu0O","mtaYmZG3yK5KwNjv","BwT4teq","ndaWideWChGGjW","uNjJzvq","Awn0q3e","zMLSBa","Bgf5zxjtAxPL","y2fUDMfZ","q0zIu1K","C2nHBgu","iZC4nZe2yW","Bg9N","CMv2B2TLt2jQzq","C2f2zq","iZi5mJuYna","pc9ZDMC+","y2vUDgvY","zwPiDhu","nJaWideZChGGjW","BgLUzvDPzhrO","zw9Yz2LHlcbZzq","DhLWzq","BM5xzfm","icdIGkiGia","t0T2zK4","CMvHzhK","kcGOlISPkYKRkq","y3rPB25mzxzLBa","idiWChGGj0nVCG"];return(k=function(){return e})()}function K(s,n){const a=I,r={DhyWq:function(e,t){return e-t},CFbSY:function(e,t){return e/t},QCVlK:function(e,t){return e*t},DFMMZ:function(e,t){return e+t},iNWwW:function(e,t){return e*t},Nfsat:function(e,t){return e-t},ibjom:function(e,t){return e<t},NjHWP:function(e,t){return e*t},TyEpP:function(e,t,s){return e(t,s)},aafys:a(363),DugNf:function(e,t){return e<t},ouuJh:function(e,t){return e*t},FVntR:a(410)},i=r[a(403)](n,8),o=r.QCVlK(n,.02),c=r[a(432)](n,r[a(295)](o,2));let l='<svg xmlns="http://w'+a(442)+a(347)+a(286)+c+a(470)+c+'" viewBox="0 0 '+c+" "+c+'">';l+=a(440)+a(456)+a(438)+c+a(470)+c+'" fill="'+e.border+a(483);for(let u=0;u<8;u++){const n=r[a(337)](7,u);for(let c=0;r[a(367)](c,8);c++){const d=s[n][c],m=d[a(444)]?e[a(387)]:e[a(288)],h=r[a(432)](o,r[a(485)](c,i)),f=o+u*i;if(l+=a(376)+h+a(377)+f+'" width="'+i+a(470)+i+a(348)+m+a(483),d[a(320)][a(342)]>0){const e=.08*i,s=[];for(const i of d[a(320)]){const e=r.TyEpP(t,i.piece,i[a(364)]);!s[a(322)](e)&&s.push(e)}const n=Math[a(334)](s[a(342)],6),o=[];let c=r[a(479)](i,r[a(485)](e,2));const u=.7*c/n;for(let t=0;t<n;t++)if(r.aafys!==a(363)){const e=r[a(479)](_0x45ec25,_0x4bc578[a(401)])/2;_0x41fba6+=a(376)+(_0xcf2996+e)+a(377)+(_0x23350b+e)+a(476)+_0x58cace[a(401)]+'" height="'+_0x3f68bd[a(401)]+a(348)+_0x432013[a(364)]+a(483)}else{const e={};if(e[a(364)]=s[t],e.layerSize=c,o[a(453)](e),c-=u,r[a(350)](c,r[a(434)](i,.1)))break}for(const t of o){const e=(i-t[a(401)])/2;l+=a(376)+(h+e)+a(377)+(f+e)+a(476)+t[a(401)]+'" height="'+t[a(401)]+a(348)+t.color+a(483)}}}}return l+=r[a(357)],l}async function H(e){const t=I,s={SIiSJ:"qrcode"};s[t(310)]=t(312);const n=s,a=(await import(n[t(394)]))[t(289)],r={};r[t(288)]=e?t(306):n[t(310)],r[t(387)]=t(326)+"t";const i={width:200};return i[t(340)]=1,i[t(364)]=r,i[t(427)+t(422)]="M",a[t(425)](t(287)+"pensent.com",i)}async function U(){return new Promise((e,t)=>{const n=I,a=new Image;a[n(343)+"n"]=n(374),a[n(463)]=()=>e(a),a[n(459)]=t,a[n(358)]=s})}async function Z(e,t,s={}){const n=I,a={nnWdS:"(((.+)+)+)+$",qCaVK:function(e){return e()},LaxYs:function(e,t,s){return e(t,s)},lnOAc:function(e,t){return e*t},OLwbp:function(e,t){return e+t},sYzIV:function(e,t){return e+t},YGvyc:function(e,t){return e*t},DYQDo:n(477),kxwFw:n(371),mkxLD:"#FDFCFB",cKfLH:function(e,t){return e+t},ejHtu:n(409),xvWfn:n(375),ZNMHL:n(299),cTDWI:n(308),PuYpf:n(405),FBiWO:"White",RTNlU:n(448),SGluu:function(e,t){return e+t},TYksD:function(e,t){return e-t},JbNhn:function(e,t){return e/t},YcPvJ:n(433)+n(446)+n(424)+n(292)+n(383),PgVbr:"italic 500 20px 'Cor"+n(353)+n(415)+"rif",ScFvz:function(e,t){return e+t},RrceT:function(e,t){return e!==t},WJiZA:n(385),jPnbj:n(430)+" 18px 'Cormorant', G"+n(415)+"rif",eiety:function(e,t){return e||t},FFvJQ:n(296)+n(445)+n(469),OKvfN:function(e,t){return e+t},RpunM:n(418),gDajH:"pqnBv",HdmyZ:function(e,t){return e+t},MzEsU:n(373),VRPRt:n(397)+n(424)+n(365)+"mes, serif",lAyIw:n(411),TlwNP:function(e,t){return e>t},gFgHF:function(e,t){return e+t},Uknye:n(384),NhPGr:function(e,t){return e>t},ictCq:function(e,t){return e>=t},cQeqd:function(e,t){return e-t},ziGtc:function(e,t){return e-t},TsBsi:function(e,t){return e(t)},XyKBS:function(e,t){return e-t},zCBgu:n(449)+n(452)+n(345),fQznY:function(e,t){return e/t},ViLFG:function(e,t){return e/t},FBUFU:n(482)};await a.qCaVK(_);const{boardSize:r=600,darkMode:i=!1,withWatermark:o=!1,title:c}=s,l=a.LaxYs(K,e,r),u=a.lnOAc(r,.02),d=a.OLwbp(r,2*u),m=await async function(e,t,s){const n=I,a={vfnLl:function(e,t){return e*t},FAUsv:function(e,t){return e(t)},tnawf:n(464)+n(317)};return new Promise((r,i)=>{const o=n,c=new Image,l={};l[o(416)]="image/svg+"+o(441)+o(344);const u=new Blob([e],l),d=URL[o(311)+"ctURL"](u);c[o(463)]=()=>{const e=o,n=document[e(302)+e(338)](e(402));n.width=5*t,n[e(300)]=a.vfnLl(s,5);const i=n[e(304)]("2d");i[e(404)](5,5),i.drawImage(c,0,0,t,s),URL[e(407)+e(437)](d),r(n)},c[o(459)]=()=>{const e=o;URL[e(407)+e(437)](d),a.FAUsv(i,new Error(a.tnawf))},c[o(358)]=d})}(l,d,d),h=60,f=d+a[n(391)](h,2),x=a[n(428)](a[n(290)](d,220),60)+120,p=document[n(302)+n(338)]("canvas");p.width=a.YGvyc(f,5),p[n(300)]=5*x;const g=p[n(304)]("2d");g.scale(5,5),g[n(443)+"hingEnabled"]=!0,g["imageSmoot"+n(360)+"y"]=a.DYQDo,g[n(386)]=i?a[n(392)]:a[n(396)],g[n(307)](0,0,f,x),g.drawImage(m,0,0,m[n(475)],m[n(300)],h,h,d,d);const v=a[n(428)](a[n(382)](h,d),28);g[n(336)+"e"]=i?a[n(412)]:a[n(455)],g[n(414)]=1,g.beginPath(),g[n(474)](h,v),g[n(285)](f-h,v),g[n(301)]();const w=i?a[n(339)]:n(409),j=i?a[n(484)]:n(405),y=i?n(405):a[n(484)],N=i?a[n(325)]:a[n(484)],b=f/2;let z=v+55;const C=t[n(478)]||a[n(389)],M=t.black||a.RTNlU;g.textBaseline=n(379),g[n(393)]=n(433)+n(446)+n(424)+n(292)+n(383);const B=g[n(297)+"t"](C)[n(475)],L=g[n(297)+"t"](M)[n(475)];g[n(393)]=n(430)+n(423)+n(353)+n(415)+n(383);const D=n(331),A=g.measureText(D)[n(475)],E=a.SGluu(B+A,L),q=a.TYksD(b,a.JbNhn(E,2));g[n(393)]=a.YcPvJ,g[n(386)]=w,g[n(468)]=n(373),g[n(380)](C,q,z),g.font=a.PgVbr,g[n(386)]=N,g[n(380)](D,a[n(327)](q,B),z),g[n(393)]=a[n(314)],g[n(386)]=w,g[n(380)](M,q+B+A,z),z+=36,t[n(333)]&&a.RrceT(t.event,a[n(436)])&&(g[n(386)]=j,g[n(393)]=a.jPnbj,g[n(468)]="center",g[n(380)](t.event,b,z),z+=32);const G=c,P=t.date||"";if(a[n(447)](G,P)){g[n(386)]=y,g[n(393)]=a[n(435)],g.textAlign=n(411);let e="";if(G)e=G[n(451)+"e"](),P&&(e+=a[n(419)](a[n(354)],P));else{if(!a[n(398)](n(439),a.gDajH))return _0x58a1f4[n(450)]()[n(349)](n(421)+"+$")[n(450)]()[n(332)+"r"](_0x52acee)[n(349)](LSaCdd[n(417)]);e=P}const t=2,s=e[n(390)](""),r=s[n(473)]((e,t)=>e+g.measureText(t).width,0),i=(s[n(342)]-1)*t;let o=b-a[n(316)](r,i)/2;for(const c of s)g[n(468)]=a[n(460)],g[n(380)](c,o,z),o+=g[n(297)+"t"](c)[n(475)]+t;z+=28}if(t.moves&&t[n(461)][n(342)]>0){g[n(386)]=y,g.font=a.VRPRt,g[n(468)]=a[n(323)];const e=t.moves[n(486)](" "),s=a[n(356)](e[n(342)],400)?a[n(366)](e.substring(0,400),a[n(315)]):e,r=f-a[n(291)](h,2)-40,i=s[n(390)](" ");let o="",c=z;const l=15,u=4;let d=0;for(const t of i){const e=a[n(290)](a[n(327)](o,o?" ":""),t);if(a.NhPGr(g[n(297)+"t"](e).width,r)&&o){if(g[n(380)](o,b,c),o=t,c+=l,d++,a[n(399)](d,u))break}else o=e}o&&d<u&&g[n(380)](o,b,c)}const S=a[n(303)](a[n(346)](x,h),20);g[n(386)]=y,g[n(393)]=n(381)+n(445)+n(469),g[n(468)]=a.lAyIw;const W=(n(328)+"NT â™š")[n(390)](""),Y=W[n(473)]((e,t)=>e+g.measureText(t)[n(475)],0);let T=b-a[n(382)](Y,4*(W[n(342)]-1))/2;for(const I of W)g[n(468)]=n(373),g[n(380)](I,T,S),T+=a[n(290)](g[n(297)+"t"](I)[n(475)],4);if(o){const[e,t]=await Promise[n(369)]([a[n(388)](H,!1),U()]),s=220,r=65,i=a[n(303)](a[n(346)](h+d,s),12),o=a.XyKBS(a.cKfLH(h,d)-r,12);g[n(386)]=a[n(458)],g.beginPath(),g[n(329)](i,o,s,r,6),g[n(400)](),g[n(336)+"e"]=a[n(455)],g[n(414)]=1,g[n(301)]();const c=48,l=i+12,u=o+a[n(330)](r-c,2);g[n(408)](),g.beginPath(),g.arc(l+a[n(330)](c,2),a[n(290)](u,a[n(431)](c,2)),a.ViLFG(c,2),0,2*Math.PI),g.clip(),g[n(454)](t,l,u,c,c),g[n(294)]();const m=a.cKfLH(a[n(366)](l,c),10);g[n(468)]=n(373),g.textBaseline="alphabetic",g[n(386)]=a[n(466)],g[n(393)]=n(413)+"Inter', sa"+n(469),g[n(380)]("EN PENSENT",m,a[n(419)](o,28)),g[n(386)]=a.PuYpf,g[n(393)]=n(321)+n(445)+n(469),g[n(380)](n(309)+n(361),m,o+46);const f=50,x=a[n(346)](a[n(428)](i,s),f)-10,p=a[n(316)](o,a[n(431)](a[n(335)](r,f),2)),v=new Image;await new Promise(t=>{const s=n;v.onload=()=>{g[I(454)](v,x,p,f,f),a.qCaVK(t)},v[s(459)]=()=>t(),v.src=e})}return p}const F=P.filter(e=>"custom"!==e.id);const O=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const V=()=>{const e=n(),{user:t,isLoading:s}=a(),[I,Y]=r.useState(null),[T,_]=r.useState(!1),[k,K]=r.useState(0),[H,U]=r.useState(""),[V,R]=r.useState([]),[$,X]=r.useState(50),[J,Q]=r.useState(!0),[ee,te]=r.useState(!1),[se,ne]=r.useState(null);r.useEffect(()=>{s||(async()=>{if(!t)return void Y(!1);const{data:e}=await c.rpc("has_role",{_user_id:t.id,_role:"admin"});Y(!0===e)})()},[t,s]);const ae=r.useCallback(async(e,s,n,a,r=!0)=>{try{const m=i(e.pgn),h=r?F[Math.floor(Math.random()*F.length)]:F[n%F.length],f=function(e,t){const s=P.find(e=>e.id===t)||P[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,h.id);o(h.id);const x=await Z(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),g=Date.now(),v=`${t.id}/${g}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await c.storage.from("visualizations").upload(v,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:j}=c.storage.from("visualizations").getPublicUrl(v),y=l(e.pgn),N={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:h.id,paletteName:h.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:a,exemplarNumber:a?n+1:void 0,gameHash:y}},{data:b,error:z}=await c.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:N,image_path:j.publicUrl}).select().single();if(z)throw z;const C=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(a,n),{data:M,error:B}=await u(b.id,C);if(B)throw B;const L=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(a,n);for(let e=0;e<L.viewCount;e++)await c.rpc("record_vision_interaction",{p_visualization_id:b.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const D=d(e.pgn),A=r?"premium":"genesis";return{title:s,success:!0,visualizationId:b.id,listingId:null==M?void 0:M.id,isExemplar:a,paletteId:h.id,paletteName:h.name,gameHash:y,tier:A,openingName:null==D?void 0:D.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:a}}},[t]),re=V.filter(e=>e.success).length,ie=V.filter(e=>!e.success).length;return V.filter(e=>e.success&&e.isExemplar).length,s||null===I?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}):t&&I?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(g,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(j,{className:"flex items-center gap-3",children:[m.jsx(y,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(x,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(N,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",$," visions: ",Math.min(25,$)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,$-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:$,onChange:e=>X(Number(e.target.value)),disabled:T,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(b,{id:"use-official-palettes",checked:J,onCheckedChange:Q,disabled:T}),m.jsxs(z,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(C,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),J&&m.jsxs(M,{variant:"secondary",className:"text-xs",children:[F.length," palettes"]})]})]}),m.jsx(g,{onClick:async()=>{if(!t)return void S.error("You must be logged in as the CEO account");_(!0),R([]),K(0);const e=[],s=W.slice(0,Math.min($,W.length)),n=[];for(let t=0;t<$;t++){const e=t%s.length,a=t<25,r=O[t]||`Vision ${t+1}`;n.push({game:s[e],title:r,isExemplar:a})}for(let t=0;t<n.length;t++){const{game:s,title:a,isExemplar:r}=n[t];U(`${r?"ðŸ†":"ðŸŽ¨"} ${a} (${t+1}/${n.length})`);const i=await ae(s,a,t,r,J);e.push(i),R([...e]),K((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}_(!1);const a=e.filter(e=>e.success).length,r=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;a>0?S.success(`Created ${a} visions`,{description:`${i} Exemplars, ${a-i} Creative${r>0?` (${r} failed)`:""}`}):S.error("Failed to create any visions")},disabled:T||!t,className:"w-full",size:"lg",children:T?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(B,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(L,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(g,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await c.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return S.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:a,error:r}=await c.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(r)throw r;const i=new Set((a||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),l=n.filter(e=>i.has(e));if(0===o.length)return S.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:l.length}),void te(!1);await c.from("visualization_listings").delete().in("visualization_id",o),await c.from("vision_scores").delete().in("visualization_id",o),await c.from("vision_interactions").delete().in("visualization_id",o),await c.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await c.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await c.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:l.length}),S.success(`Deleted ${o.length} test visions`,{description:l.length>0?`${l.length} visions with natural value preserved`:void 0})}catch(e){S.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||T||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(L,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),T&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(D,{value:k,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:H})]}),V.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(A,{className:"h-4 w-4"}),re," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(E,{className:"h-4 w-4"}),V.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(q,{className:"h-4 w-4"}),V.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:V.map((e,t)=>m.jsxs(G.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(E,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(q,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(M,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(M,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(C,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(x,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(g,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{V as default};
