const n="/**\n * Scaling Infrastructure - Rate Limiting & Caching\n * For enpensent.com platform scale\n * \n * For Alec Arthur Shelton - The Artist\n */\n\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n  ttl: number;\n}\n\nclass ScalingCache {\n  private cache = new Map<string, CacheEntry<unknown>>();\n  private maxSize = 10000;\n\n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n    \n    if (Date.now() - entry.timestamp > entry.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n    \n    return entry.data as T;\n  }\n\n  set<T>(key: string, data: T, ttlMs = 60000): void {\n    if (this.cache.size >= this.maxSize) {\n      const oldest = this.cache.keys().next().value;\n      this.cache.delete(oldest);\n    }\n    \n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n      ttl: ttlMs\n    });\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n}\n\n// Rate limiter per user/IP\nclass RateLimiter {\n  private requests = new Map<string, number[]>();\n  private limits = {\n    public: { requests: 100, window: 60000 },    // 100/min public\n    premium: { requests: 1000, window: 60000 },  // 1000/min premium\n    admin: { requests: 10000, window: 60000 }    // 10000/min admin\n  };\n\n  checkLimit(key: string, tier: 'public' | 'premium' | 'admin' = 'public'): boolean {\n    const limit = this.limits[tier];\n    const now = Date.now();\n    const userRequests = this.requests.get(key) || [];\n    \n    // Filter to window\n    const recent = userRequests.filter(t => now - t < limit.window);\n    \n    if (recent.length >= limit.requests) {\n      return false;\n    }\n    \n    recent.push(now);\n    this.requests.set(key, recent);\n    return true;\n  }\n}\n\n// Connection pooling for 55 adapters\nclass AdapterConnectionPool {\n  private activeConnections = 0;\n  private maxConnections = 50;\n  private queue: (() => void)[] = [];\n\n  async acquire(): Promise<boolean> {\n    if (this.activeConnections < this.maxConnections) {\n      this.activeConnections++;\n      return true;\n    }\n    \n    return new Promise(resolve => {\n      this.queue.push(() => {\n        this.activeConnections++;\n        resolve(true);\n      });\n    });\n  }\n\n  release(): void {\n    this.activeConnections--;\n    const next = this.queue.shift();\n    if (next) next();\n  }\n}\n\nexport const scalingCache = new ScalingCache();\nexport const rateLimiter = new RateLimiter();\nexport const adapterPool = new AdapterConnectionPool();\n\n// Database query optimizer\nexport function optimizeQuery(table: string, filters: Record<string, unknown>): string {\n  // Add index hints for common queries\n  const indexHints: Record<string, string> = {\n    'autonomous_trades': 'created_at DESC',\n    'prediction_outcomes': 'resolved_at DESC',\n    'market_tick_history': 'timestamp DESC',\n    'visions': 'owner_id, created_at',\n    'marketplace_listings': 'status, created_at'\n  };\n  \n  return `/* ${table}: ${indexHints[table] || 'default'} */`;\n}\n";export{n as default};
