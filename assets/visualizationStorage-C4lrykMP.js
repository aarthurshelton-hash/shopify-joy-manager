import{s as t,ca as n,dG as r,dH as e}from"./index-BKigiLhM.js";import{v as o,a,b as i}from"./visualizationSchemas-FTFAqcvP.js";import"./flagContent-dD8E5eJf.js";!function(){const t=c,n=f();for(;;)try{if(639586===-parseInt(t(376))/1*(parseInt(t(369))/2)+parseInt(t(408))/3+parseInt(t(464))/4*(-parseInt(t(450))/5)+-parseInt(t(440))/6*(-parseInt(t(475))/7)+parseInt(t(352))/8+parseInt(t(373))/9*(-parseInt(t(433))/10)+parseInt(t(332))/11*(parseInt(t(483))/12))break;n.push(n.shift())}catch(r){n.push(n.shift())}}();const s=function(){let t=!0;return function(n,r){const e=t?function(){if(r){const t=r[c(355)](n,arguments);return r=null,t}}:function(){};return t=!1,e}}()(void 0,function(){const t=c;return s[t(427)]().search(t(470)+"+$")[t(427)]()[t(359)+"r"](s)[t(409)](t(470)+"+$")});s();const u=function(){const t=c,n={};n[t(455)]=function(t,n){return t===n},n[t(374)]="WQbqJ";const r=n;let e=!0;return function(t,n){const o=e?function(){const e=c;if(!r[e(455)]("WQbqJ",r[e(374)])){const t={};return t[e(444)]=_0x2bc348,t}if(n){const r=n.apply(t,arguments);return n=null,r}}:function(){};return e=!1,o}}();function c(t,n){t-=313;const r=f();let e=r[t];if(void 0===c.YQWWhc){var o=function(t){let n="",r="",e=n+o;for(let o,a,i=0,s=0;a=t.charAt(s++);~a&&(o=i%4?64*o+a:a,i++%4)?n+=e.charCodeAt(s+10)-10!=0?String.fromCharCode(255&o>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let o=0,a=n.length;o<a;o++)r+="%"+("00"+n.charCodeAt(o).toString(16)).slice(-2);return decodeURIComponent(r)};c.dYTkCh=o,c.CoLBAK={},c.YQWWhc=!0}const a=t+r[0],i=c.CoLBAK[a];if(i)e=i;else{const t=function(t){this.IxicWx=t,this.IyNWlo=[1,0,0],this.FbxSzD=function(){return"newState"},this.ezuiuP="\\w+ *\\(\\) *{\\w+ *",this.ciBDqg="['|\"].+['|\"];? *}"};t.prototype.yAEaES=function(){const t=new RegExp(this.ezuiuP+this.ciBDqg).test(this.FbxSzD.toString())?--this.IyNWlo[1]:--this.IyNWlo[0];return this.jRQvrk(t)},t.prototype.jRQvrk=function(t){return Boolean(~t)?this.tZEzwZ(this.IxicWx):t},t.prototype.tZEzwZ=function(t){for(let n=0,r=this.IyNWlo.length;n<r;n++)this.IyNWlo.push(Math.round(Math.random())),r=this.IyNWlo.length;return t(this.IyNWlo[0])},new t(c).yAEaES(),e=c.dYTkCh(e),c.CoLBAK[a]=e}return e}function f(){const t=["E30Uy29UC3rYDq","kcGOlISPkYKRkq","q3HxEwy","Aw4GEw91CIbNyq","vgL0BguGy29UDa","AxnjBNrYAw5ZAq","mJa0mJm4m0LOtvHZAq","CgfSzxr0zuLK","BgXLCNK","CM4GDgHPCYiPka","C29YDa","BgLUA2vKugfSzq","zcWGCgDUlcbNyq","AxPnseS","mJu1ntaZmJHABNngA08","ChjVzMLSzxm","yMLUza","vvjrzLy","Aw1Hz2uVCg5N","y3jLyxrLzf9HDa","zxzLBNq","ywLUCYbPBMfWCa","CYbVD25LzcbIEq","Bwf0y2HLzfbHBa","BgL6yxrPB24GAq","svfwwMm","C3vJy2vZCW","y3vZDg9Tq29SBW","zgf0zq","zMLUzeLUzgv4","zNjVBq","tgLbDey","Bwf0y2HLzeDHBq","Bw92zxm","CgDU","zunHCMq","DMLZDwfSAxPHDa","yxjPDhK","Bg9JywXLq29TCa","DgXL","y2f0zxm6","C2LUz2XL","y0DHBwu","AxneDxbSAwnHDa","x19WCM90B19F","y1bHBgv0Dgu","C3rVCMfNzq","sw52ywXPzcbqrW","Bg9N","BgL6yxrPB246ia","DxbSB2fKigLTyq","mtfWDKvIsgy","CwTWu1G","CgLLy2vuExbL","jsbZAw1PBgfYia","DxnLCL9Pza","Cu1cyLK","B3jKzxi","zxHPC3rPBMDjza","AxPHDgLVBIaTia","ywX0vLe","zxr0zvnPBwLSyq","BIbIEsa","Aw9Uig5VDcbMBW","tMPNs3O","DhjHy2u","BM93","CM9WCMLHDguGyW","AM9PBG","BMn0Aw9UkcKG","zgvSzxrL","odCYmtm4neXxu2L0BG","AwqSihvZzxjFAq","Dg90ywXnB3zLCW","yxbWBhK","z2u6ia","DxnzB2i","DxbSB2fK","y29UC3rYDwn0BW","CML0Eq","B3DUzxjeAxnWBa","y29SB3jtAw1PBa","zxr0zuLK","DhHvt3e","ChvIBgLJvxjS","tIbKyxrH","CMvWBgfJzq","zgfYA01Vzgu","otK0odu4v3P3EeHk","zxHPC3rPBMDwAq","qKnQqK4","ihzLCNKGC2LTAq","mteXntm2ndzbshLMA3m","r09Vt3O","ywXPEMf0Aw9UCW","mxLkuuD4CW","y29UC29Szq","vgHPCYb2Axn1yq","BgXLy3rVCG","ywXPEMf0Aw9UoG","DwfSAxPHDgLVBG","yMXHy2S","C2XPy2u","rxHHy3qGzhvWBa","BwvZC2fNzq","rxjYB3iGy2HLyW","ueDsu1qXmty","Dhj5ignOyw5NAq","D2fYBG","y29UDgvUDfr5Ca","vvbnsey","zgLZCgXHEv9Uyq","z1DkyKm","uwv2zNa","q3L4C1K","sxrUvLG","BMCGyxqGBgvHCW","CMvZDwX0","vLrHB1u","CNnZALu","C3rYAw5NAwz5","y3jxBeG","Bg9YCW","DhjPBq","Cgf0Ag5HBwu","AvPYuKG","yMTAt1O","mJyZnde4ChPXsKrK","C2vHCMnO","CMvHC29U","z2fTzurHDge","CMvTB3zL","y3vYCMvUDe1VDG","uM1MweC","zgvSzxrLihzPCW","Aw9Uu3rHDgu","tM1gANK","DhrLswq","sg1Ht1m","CgLLy2vdB2XVCG","BfPstxG","we1UwxC","ChjVDg90ExbL","yw5VDgHLCIbJBW","rxjYB3iGAw4Gza","yxnJzw5KAw5N","Dg9tDhjPBMC","sw52ywXPzcb0Aq","AgvJAZO","C2f2zwrFDMLZDq","zw5LC3m","yvfrCgC","mtbzwffIEvy","r0Tnr2i","AxnuB29tAw1PBa","Dw5K","z2v0uhvIBgLJvq","Aw5MBW","BKLK","nNbjrePMBW","zgf0yq","C2vSzwn0","Bw9KzxjU","zxjYB3i","C3vHBgL6yxrPBW","B3DUzwrcEun1CG","Dg9mB3DLCKnHCW","CMvUDfvZzxi","rMfPBgvKihrVia","nJeXmZe2nwvtt3DcEa","lNbUzW","zxHPC3rPBMDdBW","D2HPDgu","DNb4EKq","txL0z0u","txf2vw4","Aw9UCW","BwvFzgf0yq","ww91igHHDMuGyq","Dca4ignVBg9YCW","wu92ru0","DxbSAwnHDguGyW","BgfYihzPC3vHBa","neD0A0XKwG","DxbZzxj0","yxLoyw1L","uvvszfa","vgHPCYbPCYa"];return(f=function(){return t})()}function l(t,n,r){const e=c,o={};o[e(357)]=function(t,n){return t===n};const a=o;return(t||n[e(315)]||"")[e(404)]().replace(/\s+/g," ")+"::"+(r?JSON[e(401)]({palette:r[e(476)]||"modern",darkMode:r[e(368)]||!1,currentMove:a[e(357)](r.currentMove,1/0)?"all":r[e(413)+"e"],lockedPieces:(r.lockedPieces||[])[e(479)]((t,n)=>(t[e(420)]+"-"+t[e(334)])[e(319)+"are"](n[e(420)]+"-"+n[e(334)]))}):"{}")}async function w(o,a,i,s){const u=c,f={QURdP:function(t,n,r,e){return t(n,r,e)},qkpSX:u(430)+u(375),LiAtF:u(353)+u(481)+u(458),BCjBN:u(386)+"king dupli"+u(321),rtkZB:function(t,n){return t===n},Qevfp:u(425)+u(462)+u(429)};try{const c=f[u(467)](l,a,i,s),{data:w,error:y}=await t[u(499)](f[u(333)])[u(442)](f[u(500)]);if(y){const t={};return t[u(324)+"e"]=!1,t[u(435)+"ar"]=!1,t}for(const n of w||[]){const r=n.game_data;if(c===l(n[u(315)]||void 0,r,r[u(317)+u(416)])){const r=f.rtkZB(n[u(336)],o);let e;if(!r){const{data:r}=await t[u(499)](u(484)).select(u(392)+"me").eq(u(336),n[u(336)])[u(322)]();e=(null==r?void 0:r.display_name)||"Another co"+u(379)}const a={isDuplicate:!0};return a[u(435)+"ar"]=!0,a[u(339)]=n.id,a[u(446)+u(448)]=r,a[u(361)+u(466)]=e,a[u(362)+u(318)]=100,a[u(410)]=u(384)+"icate exists",a}}const C=(null==s?void 0:s[u(476)])||u(443);let B;if(null==s?void 0:s[u(496)+"rs"])B=s[u(496)+"rs"];else if("custom"===C){const t=n.find(t=>"custom"===t.id);if(t){const n={};n.white=t[u(453)],n[u(382)]=t[u(382)],B=n}}const g=await r(o,a,i,C,B);if(g[u(435)+"ar"]){const t={};return t[u(324)+"e"]=!1,t.isTooSimilar=!0,t[u(339)]=g[u(370)+u(445)+u(439)],t["ownedByCur"+u(448)]=g["ownedByCur"+u(448)],t["ownerDispl"+u(466)]=g[u(361)+"ayName"],t[u(362)+u(318)]=g[u(362)+u(318)],t.reason=g.reason,t[u(452)+u(403)]=g.existingColors,t[u(474)+u(326)]=g[u(474)+"cPalette"],t[u(474)+u(323)]=g[u(474)+u(323)],t["matchedGam"+u(316)]=g[u(313)+"eCard"],t["matchedPal"+u(363)]=g.matchedPaletteId,t[u(492)+"etteSimila"+u(360)]=g[u(492)+u(342)+u(360)],t}let z;B&&(z=e(B)||void 0);const v={};return v[u(324)+"e"]=!1,v.isTooSimilar=!1,v[u(480)+u(418)]=z,v[u(362)+u(318)]=g[u(362)+u(318)],v[u(474)+u(326)]=g[u(474)+u(326)],v[u(474)+u(323)]=g[u(474)+u(323)],v[u(313)+"eCard"]=g[u(313)+u(316)],v.matchedPaletteId=g["matchedPal"+u(363)],v[u(492)+"etteSimila"+u(360)]=g[u(492)+"etteSimila"+u(360)],v}catch(w){const t={};return t[u(324)+"e"]=!1,t[u(435)+"ar"]=!1,t}}async function y(n,r,e,s,u,f){const l=c,y={VTaoU:function(t,n){return t(n)},crWlH:l(328)+l(366),lZRMx:function(t,n,r,e,o){return t(n,r,e,o)},XMnYw:"This visua"+l(493)+"s already "+l(472)+l(477),toUIu:l(424)+l(379),RmfXG:function(t,n){return t||n},gWJbC:"visualizations"};try{const c=y[l(399)](o,r);if(!c.success)return{data:null,error:new Error(c[l(444)]||l(428)+l(320))};const C=await a(r);if(!C.safe)return{data:null,error:new Error(C[l(410)]||l(473)+l(490)+l(348)+"ontent")};const B=i(u);if(!B[l(495)])return{data:null,error:new Error(B[l(444)]||y[l(402)])};const g=await y[l(421)](w,n,u,e[l(411)],f);if(g.isDuplicate){const t=g.ownedByCurrentUser?y[l(422)]:l(378)+l(493)+l(491)+" "+(g[l(361)+"ayName"]||y.toUIu);return{data:null,error:new Error(t),isDuplicate:!0,ownedByCurrentUser:g[l(446)+"rentUser"],ownerDisplayName:g[l(361)+l(466)],colorSimilarity:100}}if(g[l(435)+"ar"]){const t=g[l(446)+l(448)]?l(459)+l(372)+l(463)+l(340)+l(388)+l(397)+l(460)+" for uniqu"+l(431):l(468)+Math.round(g["colorSimil"+l(318)]||30)+(l(335)+"to a visio")+l(343)+(g[l(361)+l(466)]||y.toUIu);return{data:null,error:new Error(t),isTooSimilar:!0,ownedByCurrentUser:g[l(446)+l(448)],ownerDisplayName:g[l(361)+l(466)],colorSimilarity:g.colorSimilarity,reason:g[l(410)]}}const z={...f};z[l(480)+"tteId"]=g.linkedPaletteId;const v=z,D=n+"/"+Date[l(347)]()+"-"+r[l(367)](/[^a-z0-9]/gi,"-")[l(447)+"e"]()+l(451),x={};x[l(390)+"e"]=l(487),x[l(465)]=!1;const{error:d}=await t.storage[l(499)](l(317)+l(457))[l(358)](D,s,x);if(d)throw new Error("Failed to "+l(331)+l(356)+d[l(385)]);const{data:h}=t[l(327)][l(499)]("visualizat"+l(457))[l(437)+"rl"](D),L={};L[l(453)]=e[l(411)][l(453)],L[l(382)]=e.gameData.black,L[l(489)]=e[l(411)][l(489)],L[l(497)]=e[l(411)][l(497)],L[l(398)]=e[l(411)][l(398)],L.pgn=e[l(411)][l(315)],L[l(314)]=e[l(411)][l(314)],L.board=e.board,L[l(354)]=e[l(354)],L[l(317)+l(416)]=v;const m=L,{data:A,error:q}=await t.from("saved_visu"+l(375)).insert({user_id:n,title:r,pgn:y[l(414)](u,null),game_data:m,image_path:h[l(365)]})[l(442)]().single();if(q)throw await t[l(327)].from(y[l(393)])[l(412)]([D]),new Error(l(449)+"save visua"+l(330)+q[l(385)]);const M={};return M.data=A,M[l(444)]=null,M}catch(C){const t={};return t[l(441)]=null,t[l(444)]=C,t}}async function C(n){const r=c,e={};e.MqvUn=r(336),e.YOvEM=r(488);const o=e;try{{const e={};e[r(426)]=!1;const{data:a,error:i}=await t[r(499)](r(430)+"alizations")[r(442)]("*").eq(o[r(456)],n)[r(338)](o[r(461)],e);if(i)throw new Error(r(449)+"fetch visualizations: "+i[r(385)]);const s={};return s[r(441)]=a||[],s[r(444)]=null,s}}catch(a){const t={data:[]};return t[r(444)]=a,t}}async function B(n,r){const e=c,o={};o[e(417)]=function(t,n){return t+n},o.HmaOS="visualizat"+e(457);const a=o;try{const o=new URL(r)[e(405)].split("/"),i=o[e(498)](t=>t===e(317)+e(457)),s=o[e(383)](a[e(417)](i,1))[e(349)]("/");s&&await t.storage[e(499)](a[e(419)])[e(412)]([s]);const{error:u}=await t[e(499)](e(430)+e(375))[e(351)]().eq("id",n);if(u)throw new Error(e(449)+e(415)+e(381)+": "+u[e(385)]);const c={};return c[e(444)]=null,c}catch(i){const t={};return t.error=i,t}}u(void 0,function(){const t=c,n={izMHK:t(328)+t(366),URQfV:t(406),CyxsY:function(t,n){return t(n)},aQQpg:function(t,n){return t+n},xzwof:"return (fu"+t(350),UPMHF:t(469)+'ctor("retu'+t(478)+" )",IbgAL:t(389),GKMGb:t(438),txUOq:function(t,n){return t<n}};let r;try{if(t(406)!==n[t(486)])return{data:null,error:new _0x4f68e8(_0x18c2bf[t(444)]||n[t(482)])};r=n[t(395)](Function,n[t(432)](n.aQQpg(n.xzwof,n[t(391)]),");"))()}catch(a){r=window}const e=r[t(377)]=r[t(377)]||{},o=[t(329),n.IbgAL,n[t(434)],t(444),"exception","table",t(346)];for(let i=0;n[t(364)](i,o.length);i++){const n=u[t(359)+"r"][t(423)][t(485)](u),r=o[i],a=e[r]||n;n[t(325)]=u[t(485)](u),n[t(427)]=a[t(427)][t(485)](a),e[r]=n}})();export{w as checkDuplicateVisualization,B as deleteVisualization,C as getUserVisualizations,y as saveVisualization};
