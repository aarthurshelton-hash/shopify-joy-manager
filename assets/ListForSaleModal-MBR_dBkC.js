const e="import React, { useState } from 'react';\nimport { Gift, DollarSign, Loader2, AlertCircle } from 'lucide-react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { toast } from 'sonner';\nimport { createListing } from '@/lib/marketplace/marketplaceApi';\nimport { z } from 'zod';\n\n// Validation schema for listing price\nconst listingPriceSchema = z.object({\n  priceCents: z.number()\n    .int('Price must be a whole number of cents')\n    .min(0, 'Price cannot be negative')\n    .max(1000000, 'Maximum price is $10,000') // $10,000 max\n});\n\ninterface ListForSaleModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  visualizationId: string;\n  visualizationTitle: string;\n  onSuccess?: () => void;\n}\n\nconst ListForSaleModal: React.FC<ListForSaleModalProps> = ({\n  isOpen,\n  onClose,\n  visualizationId,\n  visualizationTitle,\n  onSuccess,\n}) => {\n  const [listingType, setListingType] = useState<'free' | 'paid'>('free');\n  const [priceUsd, setPriceUsd] = useState('5.00');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [priceError, setPriceError] = useState<string | null>(null);\n\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    setPriceError(null);\n\n    const priceCents = listingType === 'free' ? 0 : Math.round(parseFloat(priceUsd) * 100);\n\n    // Validate with zod schema\n    const validation = listingPriceSchema.safeParse({ priceCents });\n    if (!validation.success) {\n      const errorMessage = validation.error.errors[0]?.message || 'Invalid price';\n      setPriceError(errorMessage);\n      toast.error(errorMessage);\n      setIsSubmitting(false);\n      return;\n    }\n\n    if (listingType === 'paid' && (isNaN(priceCents) || priceCents < 100)) {\n      setPriceError('Minimum price is $1.00');\n      toast.error('Minimum price is $1.00');\n      setIsSubmitting(false);\n      return;\n    }\n\n    const { error } = await createListing(visualizationId, priceCents);\n\n    setIsSubmitting(false);\n\n    if (error) {\n      toast.error('Failed to create listing', { description: error.message });\n      return;\n    }\n\n    toast.success(listingType === 'free' \n      ? 'Listed as gift!' \n      : `Listed for $${(priceCents / 100).toFixed(2)}!`,\n      { description: 'Your visualization is now on the marketplace' }\n    );\n\n    onSuccess?.();\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>List for Sale or Gift</DialogTitle>\n          <DialogDescription>\n            Transfer \"{visualizationTitle}\" to another collector\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          <RadioGroup\n            value={listingType}\n            onValueChange={(v) => setListingType(v as 'free' | 'paid')}\n            className=\"grid grid-cols-2 gap-4\"\n          >\n            <Label\n              htmlFor=\"free\"\n              className={`flex flex-col items-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all ${\n                listingType === 'free' \n                  ? 'border-green-500 bg-green-500/10' \n                  : 'border-border hover:border-muted-foreground/50'\n              }`}\n            >\n              <RadioGroupItem value=\"free\" id=\"free\" className=\"sr-only\" />\n              <Gift className={`h-8 w-8 ${listingType === 'free' ? 'text-green-500' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium\">Gift (Free)</span>\n              <span className=\"text-xs text-muted-foreground text-center\">\n                No fees — first to claim gets full value\n              </span>\n            </Label>\n\n            <Label\n              htmlFor=\"paid\"\n              className={`flex flex-col items-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all ${\n                listingType === 'paid' \n                  ? 'border-primary bg-primary/10' \n                  : 'border-border hover:border-muted-foreground/50'\n              }`}\n            >\n              <RadioGroupItem value=\"paid\" id=\"paid\" className=\"sr-only\" />\n              <DollarSign className={`h-8 w-8 ${listingType === 'paid' ? 'text-primary' : 'text-muted-foreground'}`} />\n              <span className=\"font-medium\">Sell</span>\n              <span className=\"text-xs text-muted-foreground text-center\">\n                5% fee — you receive 95%\n              </span>\n            </Label>\n          </RadioGroup>\n\n          {/* Fee explanation based on selection */}\n          <div className={`text-xs p-3 rounded-lg ${\n            listingType === 'free' \n              ? 'bg-green-500/10 border border-green-500/30' \n              : 'bg-muted/50'\n          }`}>\n            {listingType === 'free' ? (\n              <p className=\"text-green-600\">\n                <strong>Gift:</strong> The recipient receives full ownership and all accrued value. No platform fees are charged.\n              </p>\n            ) : (\n              <p className=\"text-muted-foreground\">\n                <strong>Sale:</strong> 5% platform fee supports the Education Fund. Buyer pays with Platform Credits; you receive 95% instantly.\n              </p>\n            )}\n          </div>\n\n          {listingType === 'paid' && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"price\">Price (Platform Credits)</Label>\n              <div className=\"relative\">\n                <DollarSign className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"price\"\n                  type=\"number\"\n                  min=\"1\"\n                  step=\"0.01\"\n                  value={priceUsd}\n                  onChange={(e) => {\n                    setPriceUsd(e.target.value);\n                    setPriceError(null);\n                  }}\n                  className={`pl-9 ${priceError ? 'border-destructive' : ''}`}\n                  placeholder=\"5.00\"\n                  max=\"10000\"\n                />\n              </div>\n              {priceError ? (\n                <p className=\"text-xs text-destructive flex items-center gap-1\">\n                  <AlertCircle className=\"h-3 w-3\" />\n                  {priceError}\n                </p>\n              ) : (\n                <div className=\"text-xs text-muted-foreground space-y-1\">\n                  <p>Minimum $1.00, maximum $10,000.</p>\n                  <p className=\"text-primary/80\">\n                    You receive: ${(parseFloat(priceUsd || '0') * 0.95).toFixed(2)} (95%)\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex gap-3\">\n          <Button variant=\"outline\" onClick={onClose} className=\"flex-1\">\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} disabled={isSubmitting} className=\"flex-1\">\n            {isSubmitting ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : listingType === 'free' ? (\n              'List as Gift'\n            ) : (\n              `List for $${parseFloat(priceUsd || '0').toFixed(2)}`\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default ListForSaleModal;";export{e as default};
