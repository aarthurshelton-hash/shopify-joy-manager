const n='import React, { useEffect, useMemo } from \'react\';\nimport { useTimeline, GamePhase } from \'@/contexts/TimelineContext\';\nimport { Slider } from \'@/components/ui/slider\';\nimport { Button } from \'@/components/ui/button\';\nimport { Play, Pause, SkipBack, SkipForward, RotateCcw, Gauge } from \'lucide-react\';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \'@/components/ui/dropdown-menu\';\nimport {\n  TooltipProvider,\n} from \'@/components/ui/tooltip\';\nimport { analyzeTimeline, getMomentCounts, TimelineAnalysisResult } from \'@/lib/chess/timelineAnalysis\';\nimport { TimelineMarker, PhaseButton, momentConfig, phaseConfig } from \'./EnhancedTimelineMarker\';\n\ninterface TimelineSliderProps {\n  totalMoves: number;\n  moves?: string[];\n  pgn?: string;\n}\n\nconst TimelineSlider: React.FC<TimelineSliderProps> = ({ totalMoves, moves = [], pgn }) => {\n  const {\n    currentMove,\n    isPlaying,\n    playbackSpeed,\n    selectedPhase,\n    phaseRanges,\n    setCurrentMove,\n    setMaxMoves,\n    togglePlayback,\n    reset,\n    stepForward,\n    stepBackward,\n    setPlaybackSpeed,\n    setSelectedPhase,\n  } = useTimeline();\n\n  // Comprehensive timeline analysis\n  const analysis: TimelineAnalysisResult | null = useMemo(() => {\n    if (!pgn || moves.length === 0) return null;\n    try {\n      return analyzeTimeline(pgn, moves);\n    } catch {\n      return null;\n    }\n  }, [pgn, moves]);\n\n  // Update max moves when totalMoves changes\n  useEffect(() => {\n    setMaxMoves(totalMoves);\n  }, [totalMoves, setMaxMoves]);\n\n  const range = phaseRanges[selectedPhase];\n  const displayMove = currentMove === Infinity ? range.end : Math.min(currentMove, range.end);\n  const isAtEnd = displayMove >= range.end;\n  const isAtStart = currentMove <= range.start || currentMove === 0;\n\n  // Filter moments to current phase\n  const visibleMoments = useMemo(() => \n    analysis?.moments.filter(m => m.moveNumber >= range.start && m.moveNumber <= range.end) || [],\n    [analysis, range]\n  );\n\n  // Get phase info from analysis\n  const getPhaseInfo = (phase: GamePhase) => {\n    if (phase === \'all\' || !analysis) return undefined;\n    return analysis.phases.find(p => p.name === phase);\n  };\n\n  // Moment counts for summary\n  const momentCounts = useMemo(() => getMomentCounts(visibleMoments), [visibleMoments]);\n\n  // Format move display\n  const getMoveLabel = () => {\n    if (currentMove === Infinity || currentMove >= range.end) {\n      if (selectedPhase === \'all\') return \'All Moves\';\n      return `All ${phaseConfig[selectedPhase].label}`;\n    }\n    if (currentMove === 0 || currentMove === range.start) {\n      if (selectedPhase !== \'all\') return `${phaseConfig[selectedPhase].label} Start`;\n      return \'Start\';\n    }\n    const moveIndex = currentMove - 1;\n    if (moves[moveIndex]) {\n      const moveNum = Math.floor(moveIndex / 2) + 1;\n      const isWhite = moveIndex % 2 === 0;\n      return `${moveNum}.${isWhite ? \'\' : \'..\'} ${moves[moveIndex]}`;\n    }\n    return `Move ${currentMove}`;\n  };\n\n  // Get current player\n  const getCurrentPlayer = () => {\n    if (currentMove === 0 || currentMove === Infinity) return null;\n    return (currentMove % 2 === 1) ? \'white\' : \'black\';\n  };\n\n  const handleSliderChange = (value: number[]) => {\n    const newValue = value[0];\n    if (newValue >= range.end) {\n      setCurrentMove(Infinity);\n    } else {\n      setCurrentMove(Math.max(newValue, range.start));\n    }\n  };\n\n  const handleMomentClick = (moveNumber: number) => {\n    setCurrentMove(moveNumber);\n  };\n\n  const speedOptions = [\n    { label: \'0.25x\', value: 2000 },\n    { label: \'0.5x\', value: 1000 },\n    { label: \'1x\', value: 500 },\n    { label: \'2x\', value: 250 },\n    { label: \'4x\', value: 125 },\n  ];\n\n  const currentSpeedLabel = speedOptions.find(s => s.value === playbackSpeed)?.label || \'1x\';\n  const player = getCurrentPlayer();\n  const phaseMoveCount = Math.max(range.end - range.start, 1);\n\n  // Calculate position for a moment marker\n  const getMomentPosition = (moveNumber: number) => {\n    return ((moveNumber - range.start) / phaseMoveCount) * 100;\n  };\n\n  return (\n    <TooltipProvider>\n      <div className="bg-card/80 backdrop-blur-sm rounded-lg border border-border/50 p-4 space-y-4">\n        {/* Header with phase selector */}\n        <div className="flex items-center justify-between gap-2">\n          <div className="flex items-center gap-2">\n            <span className="text-xs font-semibold uppercase tracking-widest text-muted-foreground">\n              Timeline\n            </span>\n            {player && (\n              <div className={`w-2 h-2 rounded-full ${player === \'white\' ? \'bg-sky-400\' : \'bg-rose-400\'}`} />\n            )}\n          </div>\n          \n          {/* Phase filter buttons with hover tooltips */}\n          <div className="flex items-center gap-1">\n            {([\'all\', \'opening\', \'middlegame\', \'endgame\'] as const).map((phase) => {\n              const phaseRange = phaseRanges[phase];\n              const moveCount = phaseRange.end - phaseRange.start;\n              \n              return (\n                <PhaseButton\n                  key={phase}\n                  phase={phase}\n                  isActive={selectedPhase === phase}\n                  moveCount={moveCount}\n                  onClick={() => setSelectedPhase(phase)}\n                  phaseInfo={getPhaseInfo(phase)}\n                  compact\n                />\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Key moments summary with category icons */}\n        {visibleMoments.length > 0 && (\n          <div className="flex items-center gap-3 text-[10px]">\n            <span className="text-muted-foreground">Key moments:</span>\n            <div className="flex items-center gap-2 flex-wrap">\n              {/* Quality */}\n              {momentCounts.brilliant > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.brilliant.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.brilliant.icon className="w-3 h-3" />\n                  <span>{momentCounts.brilliant}</span>\n                </div>\n              )}\n              {momentCounts.great > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.great.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.great.icon className="w-3 h-3" />\n                  <span>{momentCounts.great}</span>\n                </div>\n              )}\n              {momentCounts.blunder > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.blunder.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.blunder.icon className="w-3 h-3" />\n                  <span>{momentCounts.blunder}</span>\n                </div>\n              )}\n              {/* Tactical */}\n              {momentCounts.fork > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.fork.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.fork.icon className="w-3 h-3" />\n                  <span>{momentCounts.fork}</span>\n                </div>\n              )}\n              {momentCounts.sacrifice > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.sacrifice.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.sacrifice.icon className="w-3 h-3" />\n                  <span>{momentCounts.sacrifice}</span>\n                </div>\n              )}\n              {/* Events */}\n              {momentCounts.capture > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.capture.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.capture.icon className="w-3 h-3" />\n                  <span>{momentCounts.capture}</span>\n                </div>\n              )}\n              {momentCounts.check > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.check.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.check.icon className="w-3 h-3" />\n                  <span>{momentCounts.check}</span>\n                </div>\n              )}\n              {momentCounts.checkmate > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.checkmate.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.checkmate.icon className="w-3 h-3" />\n                  <span>{momentCounts.checkmate}</span>\n                </div>\n              )}\n              {momentCounts.castling > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.castling.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.castling.icon className="w-3 h-3" />\n                  <span>{momentCounts.castling}</span>\n                </div>\n              )}\n              {momentCounts.promotion > 0 && (\n                <div className={`flex items-center gap-1 ${momentConfig.promotion.color} hover:scale-110 transition-transform`}>\n                  <momentConfig.promotion.icon className="w-3 h-3" />\n                  <span>{momentCounts.promotion}</span>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Move label */}\n        <div className="flex items-center justify-between">\n          <div className="text-sm font-medium">\n            {getMoveLabel()}\n          </div>\n          {selectedPhase !== \'all\' && (\n            <div className="text-xs text-muted-foreground">\n              Moves {range.start + 1}-{range.end}\n            </div>\n          )}\n        </div>\n\n        {/* Slider with moment markers */}\n        <div className="relative">\n          {/* Key moment markers with enhanced tooltips */}\n          <div className="absolute inset-x-0 top-0 h-5 pointer-events-none z-10">\n            {visibleMoments.slice(0, 30).map((moment, idx) => (\n              <div key={`${moment.moveNumber}-${moment.type}-${idx}`} className="pointer-events-auto">\n                <TimelineMarker\n                  moment={moment}\n                  position={getMomentPosition(moment.moveNumber)}\n                  orientation="horizontal"\n                  onClick={() => handleMomentClick(moment.moveNumber)}\n                  size="sm"\n                />\n              </div>\n            ))}\n          </div>\n\n          <Slider\n            value={[displayMove]}\n            min={range.start}\n            max={range.end}\n            step={1}\n            onValueChange={handleSliderChange}\n            className="w-full mt-2"\n          />\n          {/* Move markers for key positions */}\n          <div className="flex justify-between text-[9px] text-muted-foreground mt-1 px-0.5">\n            <span>{selectedPhase === \'all\' ? \'Start\' : `Move ${range.start + 1}`}</span>\n            <span className="text-center">\n              {phaseMoveCount} moves\n            </span>\n            <span>{selectedPhase === \'all\' ? `End (${range.end})` : `Move ${range.end}`}</span>\n          </div>\n        </div>\n\n        {/* Controls */}\n        <div className="flex items-center justify-center gap-2">\n          {/* Reset button */}\n          <Button\n            variant="ghost"\n            size="sm"\n            onClick={reset}\n            className="h-8 w-8 p-0"\n            title={`Show all ${selectedPhase === \'all\' ? \'moves\' : phaseConfig[selectedPhase].label.toLowerCase() + \' moves\'}`}\n          >\n            <RotateCcw className="h-4 w-4" />\n          </Button>\n\n          {/* Step backward */}\n          <Button\n            variant="ghost"\n            size="sm"\n            onClick={stepBackward}\n            disabled={isAtStart}\n            className="h-8 w-8 p-0"\n            title="Previous move"\n          >\n            <SkipBack className="h-4 w-4" />\n          </Button>\n\n          {/* Play/Pause */}\n          <Button\n            variant={isPlaying ? "secondary" : "default"}\n            size="sm"\n            onClick={togglePlayback}\n            className="h-10 w-10 p-0 rounded-full"\n            title={isPlaying ? "Pause" : "Play"}\n          >\n            {isPlaying ? (\n              <Pause className="h-5 w-5" />\n            ) : (\n              <Play className="h-5 w-5 ml-0.5" />\n            )}\n          </Button>\n\n          {/* Step forward */}\n          <Button\n            variant="ghost"\n            size="sm"\n            onClick={stepForward}\n            disabled={isAtEnd}\n            className="h-8 w-8 p-0"\n            title="Next move"\n          >\n            <SkipForward className="h-4 w-4" />\n          </Button>\n\n          {/* Speed selector */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant="ghost"\n                size="sm"\n                className="h-8 px-2 gap-1 text-xs"\n                title="Playback speed"\n              >\n                <Gauge className="h-3 w-3" />\n                {currentSpeedLabel}\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align="end">\n              {speedOptions.map((option) => (\n                <DropdownMenuItem\n                  key={option.value}\n                  onClick={() => setPlaybackSpeed(option.value)}\n                  className={playbackSpeed === option.value ? \'bg-accent\' : \'\'}\n                >\n                  {option.label}\n                </DropdownMenuItem>\n              ))}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n\n        {/* Progress indicator */}\n        {isPlaying && (\n          <div className="h-1 bg-muted rounded-full overflow-hidden">\n            <div \n              className="h-full bg-gradient-to-r from-sky-500 via-purple-500 to-rose-500 transition-all duration-100"\n              style={{ width: `${((displayMove - range.start) / phaseMoveCount) * 100}%` }}\n            />\n          </div>\n        )}\n      </div>\n    </TooltipProvider>\n  );\n};\n\nexport default TimelineSlider;\n';export{n as default};
