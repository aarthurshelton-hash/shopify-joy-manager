import{d6 as e,d7 as t,cp as s,a as n,u as r,r as a,J as i,o,s as l,aH as c,aa as u,cM as d,j as m,L as h,C as f,x,D as p,B as v,A as g,p as w,t as j,cN as y,bC as N,S as b,a6 as z,P as C,y as D,bG as M,T as L,aq as A,z as B,cU as G,aj as E,aT as q,ca as S,b as k,d8 as P}from"./index-Dq7M-Dd_.js";!function(){const e=H,t=W();for(;;)try{if(344060===parseInt(e(272))/1*(-parseInt(e(278))/2)+-parseInt(e(231))/3*(-parseInt(e(323))/4)+parseInt(e(169))/5*(-parseInt(e(105))/6)+parseInt(e(108))/7*(parseInt(e(301))/8)+parseInt(e(319))/9+parseInt(e(189))/10*(parseInt(e(259))/11)+parseInt(e(224))/12)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const _=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[H(322)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}()(void 0,function(){const e=H,t={};t[e(310)]="(((.+)+)+)+$";const s=t;return _[e(116)]()[e(216)](s.zkVvk)[e(116)]()[e(205)+"r"](_).search(s[e(310)])});_();const I=function(){let e=!0;return function(t,s){const n=e?function(){if(s){const e=s[H(322)](t,arguments);return s=null,e}}:function(){};return e=!1,n}}();I(void 0,function(){const e=H,t={TfzVF:function(e,t){return e!==t},STrNX:e(125),Mchyk:e(188),eGAHJ:function(e,t){return e(t)},tQRzj:function(e,t){return e+t},iCNoG:e(295)+e(200),tsjFX:e(103),tjPrV:function(e){return e()},VDsEX:e(131),RpBcZ:e(334),ixNJX:e(141),kzRSs:e(242),rXOjC:e(104),CUFfY:function(e,t){return e<t}},s=t[e(159)](function(){const s=e;let n;try{if(t.TfzVF(t[s(151)],t.Mchyk))n=t[s(239)](Function,t[s(178)](t[s(170)],s(117)+s(254)+s(140)+" )")+");")();else{const e=_0x596d2e(_0x30273b[s(157)],_0x24da3d.color);!_0x2c3526[s(138)](e)&&_0x28ab6b.push(e)}}catch(r){if(t[s(164)](t[s(243)],s(160)))n=window;else if(_0xae123d){const e=_0x303224[s(322)](_0x4bfcd9,arguments);return _0x38e3d4=null,e}}return n}),n=s[e(233)]=s[e(233)]||{},r=[t[e(174)],"warn",t[e(235)],e(152),t[e(161)],t[e(317)],t[e(225)]];for(let a=0;t.CUFfY(a,r[e(212)]);a++){const t=I[e(205)+"r"][e(230)].bind(I),s=r[a],i=n[s]||t;t[e(285)]=I[e(240)](I),t[e(116)]=i[e(116)].bind(i),n[s]=t}})();function W(){const e=["y3PfBe0","zNvVuxy","vw5RBM93BG","x19WCM90B19F","zhjHD0LTywDL","CM91BMrszwn0","iIb3Awr0Ad0I","Bw92zxm","zfPTDxi","BNmTC2vYAwy","iIbMAwXSpsi","uM9Tyw4NlcbZzq","CgvUC2vUDc5JBW","CMv0DxjUicHMDq","y29SB3i","zgf0zq","iIb5psi","rg5suwi","qMXHy2S","mti3mNj5rKrHyW","phjLy3qGEd0I","zKncwNm","B25LCNjVCG","ueHhEuK","BhPfAKS","y3jLyxrLrwXLBq","zgfYAW","u3vLB3e","EMTwDMS","ide4ChGGj0nVCG","A1vut2q","zM9UDa","Ahr0Chm6lY9LBG","C3rYB2TLu3r5Ba","Bgf5zxjtAxPL","A3Psu3m","i0zerKngqG","ote4nZiWzLP3wLDL","Bw9Yyw50jYWGrW","uvvuC20","yxbWBhK","neX5uLvXDG","z2v0q29UDgv4Da","y2jZz1K","D2HPDgu","y2vUDgvY","i2e4yti5zq","zM9UDhm","psjODhrWoI8VDW","iIb5psiWiIb3Aq","q1zTBvO","D3CUDZmUB3jNlW","Aw5MBW","Dgv4DejHC2vSAq","yMvNAw5qyxrO","yxfKyLq","DhjHy2u","nK9OtfrXEa","y29T","ve1tt2S","mZK4m3b6vuf4zq","wKnTyxG","BgvMDa","D2LKDgG","AgLUz0vUywjSzq","ywXS","Dg9eyxrHvvjm","sw50zxiNlcbZyq","Dg9tDhjPBMC","E30Uy29UC3rYDq","yMPkwgK","AgLNAa","uNHJr1a","uvbbBee","qKrTseK","uvv0Efq","Eu5HAgy","tKPiveu","C1fhEe8","zMLSBfn0EwXL","vNfvrKy","iIbOzwLNAhq9iG","AuX4Dwi","Bg9N","z1vVr3y","iJaGmca","y3jLyxrLt2jQzq","y2fUDMfZ","uMrHrgu","Dg9vChbLCKnHCW","Aw5JBhvKzxm","y3rvuKW","CM4GDgHPCYiPka","zxHJzxb0Aw9U","nJaWideZChGGjW","A2vXwfu","z2f0wem","Bg9HzcbtvKC","CMLM","BgLUzvDPzhrO","AgvPz2H0","DhjHBNnWyxjLBG","Eg1So2nOyxjZzq","u1rYtLG","zxjYB3i","DwXiDwi","C3jJ","rwLdCKO","EerAz3m","CgLLy2u","iIb2Awv3qM94pq","DgPqCLy","D21VsxC","AxHosLG","iZbbmeeWqq","tMzXz2y","vgz6vKy","mJaWmc9ZDMCIia","q3Dyuw8","q2LUEMvSjYWGjW","Dgv4DefSAwDU","mZm1mtKYmhfWu0Tjvq","AunoB0C","ihzZia","lI4U","yMXHy2S","vKrZrvG","zeP4D1G","Aw1Hz2uVC3zNkW","Aw9kreC","DffsEMO","zMLSBfrLEhq","iZq0ndaZyW","Aw1Hz2vtBw9VDa","nJaWidi0ChGGjW","suzeAMm","v0f3v3q","uvzAAgW","tu9SEvi","DxvZrMi","AvHoB2G","mJKYmhbJsNPpwq","EvzPseO","phjLy3qGEd0Ima","EvrpBw8","ntaWideXChGGjW","ndaWideXChGGjW","BwPVALq","y3rPB25mzxzLBa","y3jVC3npCMLNAq","ru4Guevou0vova","BefJzxm","BMn0Aw9UkcKG","zw50","uLnkB0i","rMfPBgvKihrVia","zMLSBa","y29UC3rYDwn0BW","phn2zYb4BwXUCW","qxvJALa","v29ywKC","vvnzsNC","C2f2zq","BwvHC3vYzvrLEa","BgvUz3rO","ue1OwLy","ndaWideWChGGjW","zMLSBfjLy3q","C2vHCMnO","EMn1q1e","BwfYz2LU","wfHvrgW","zgvMyxvSDa","D2LKDgG9iG","zw9Yz2LHlcbZzq","iZC4nZe2yW","nZuXmdi4ngz6swjqtG","CLHpAKm","z3nhtwm","qu5ruuK","idiWChGGj0nVCG","yM9YzgvY","ChjVDg90ExbL","otm2nJGXvLb6BLDJ","AxnmAwDODa","y29UC29Szq","C3vIC3rYAw5N","uNbcy1O","CMDIysGYntuSia","iI8+","ntaWideYChGGjW","zuDbseO","yMLUza","AM9PBG","DgfIBgu","DhnQrLG","vgLTzxmGtMv3ia","s2LNteO","tNDQtLa","su1XwvO","qKnAv1O","BgLUzvrV","CuvPz2q","Bw92zvrV","Dw5Ryvy","DMLZAxrZ","y3rVCIGICMv0Dq","BwLU","CMv2B2TLt2jQzq","i2u3ztvLna","BKjrz0u","mJa0nZfNDerqzem","ChvZAa","CMvHzhK","qLvpBu4","zxzLBNq","CMvKDwnL","BgLNAhq","C09TDMG","DhLWzq","iZi5mJuYna","icdIGkiGia","A1bKreK","t1jYvhu","otqYmJLRsgjgre0","DMTKs1G","AgLUz1f1ywXPDa","C3rYB2TL","wMvStfq","sMLLwwC","mtrmD1D2Cuy","zw5Wzw5Zzw50lG","B25SB2fK","AxrHBgLJiduWma"];return(W=function(){return e})()}async function K(){const e=H;document[e(329)]&&document[e(329)][e(261)]&&await document.fonts[e(261)],await new Promise(e=>setTimeout(e,150))}function T(s,n){const r=H,a={fuoQv:function(e,t){return e+t},zpzuY:function(e,t){return e+t},lAces:function(e,t){return e+t},czElM:function(e,t){return e*t},jAMtd:function(e,t,s){return e(t,s)},IFDjc:function(e,t){return e!==t},IMqYZ:r(306),ZCmax:function(e,t){return e-t},BCZWZ:function(e,t){return e*t},fCBZs:function(e,t){return e/t},KigLJ:function(e,t){return e*t},NwjNP:function(e,t){return e-t}},i=n/8,o=.02*n,l=a.fuoQv(n,2*o);let c=r(206)+r(330)+r(333)+r(165)+r(221)+l+r(129)+l+(r(158)+r(133))+l+" "+l+'">';c+=r(191)+r(331)+'dth="'+l+'" height="'+l+r(292)+e[r(229)]+r(237);for(let u=0;u<8;u++){const n=7-u;for(let l=0;l<8;l++){const d=s[n][l],m=d[r(232)]?e[r(265)]:e[r(308)],h=a.zpzuY(o,l*i),f=a[r(199)](o,u*i);if(c+=r(302)+h+'" y="'+f+r(288)+i+r(129)+i+r(292)+m+r(237),d.visits[r(212)]>0){const e=a[r(282)](i,.08),s=[];for(const i of d[r(253)]){const e=a.jAMtd(t,i[r(157)],i[r(296)]);if(!s[r(138)](e)){if(!a[r(183)](a[r(247)],r(122))){const e=_0x2180be[r(322)](_0x1e03c9,arguments);return _0x5d3518=null,e}s[r(260)](e)}}const n=Math[r(255)](s[r(212)],6),o=[];let l=a[r(109)](i,a[r(248)](e,2));const u=a[r(303)](a[r(245)](l,.7),n);for(let t=0;t<n;t++){const e={};if(e[r(296)]=s[t],e[r(316)]=l,o.push(e),l-=u,l<a[r(282)](i,.1))break}for(const t of o){if(a[r(183)](r(271),r(271))){const e=_0xe81126[r(322)](_0x29d67d,arguments);return _0x45a648=null,e}{const e=a.fCBZs(a[r(246)](i,t[r(316)]),2);c+='<rect x="'+a[r(283)](h,e)+r(298)+a[r(283)](f,e)+r(288)+t.layerSize+r(129)+t[r(316)]+r(292)+t.color+'"/>'}}}}}return c+="</svg>",c}function H(e,t){e-=101;const s=W();let n=s[e];if(void 0===H.QYYXPX){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};H.QcsSZj=r,H.bWipYC={},H.QYYXPX=!0}const a=e+s[0],i=H.bWipYC[a];if(i)n=i;else{const e=function(e){this.bbnNrT=e,this.AnLkGN=[1,0,0],this.rpGZhW=function(){return"newState"},this.eiqbWC="\\w+ *\\(\\) *{\\w+ *",this.hIzhzu="['|\"].+['|\"];? *}"};e.prototype.bEsoed=function(){const e=new RegExp(this.eiqbWC+this.hIzhzu).test(this.rpGZhW.toString())?--this.AnLkGN[1]:--this.AnLkGN[0];return this.uoHvNt(e)},e.prototype.uoHvNt=function(e){return Boolean(~e)?this.DKvpkj(this.bbnNrT):e},e.prototype.DKvpkj=function(e){for(let t=0,s=this.AnLkGN.length;t<s;t++)this.AnLkGN.push(Math.round(Math.random())),s=this.AnLkGN.length;return e(this.AnLkGN[0])},new e(H).bEsoed(),n=H.QcsSZj(n),H.bWipYC[a]=n}return n}async function U(e){const t=H,s={};s[t(290)]="qrcode",s[t(184)]="#FAFAFA",s[t(132)]="#1A1A1A",s[t(276)]=t(149)+"t";const n=s,r=(await import(n[t(290)]))[t(220)],a={};a[t(308)]=e?n[t(184)]:n.gUoGv,a[t(265)]=n[t(276)];const i={width:200};return i[t(218)]=1,i[t(296)]=a,i["errorCorre"+t(196)]="M",r[t(114)](t(314)+t(294)+"m",i)}async function Y(){const e=H,t={};t[e(107)]="anonymous";const n=t;return new Promise((t,r)=>{const a=e,i=new Image;i[a(197)+"n"]=n.TMSOk,i[a(280)]=()=>t(i),i.onerror=r,i.src=s})}async function Z(e,t,s={}){const n=H,r={WoXZG:function(e,t){return e(t)},yNahf:function(e,t){return e+t},nBQgE:function(e,t){return e+t},CVmmZ:n(117)+n(254)+n(140)+" )",EiCrJ:function(e){return e()},yTOmo:function(e,t,s){return e(t,s)},QPAlA:function(e,t){return e*t},JPXVS:function(e,t){return e+t},etXmv:n(135),mjojT:n(119),JieYg:function(e,t){return e+t},RxcGP:n(268),dJxwX:"#e7e5e4",PMhZV:function(e,t){return e-t},PHGyI:n(223),XXUDl:"White",uusFb:n(300),bjJXi:"middle",kUTOd:n(182)+n(167)+n(244)+n(293)+n(146),kPdDI:n(171),xDZgs:function(e,t){return e/t},QUTsm:n(281)+" 20px 'Cor"+n(320)+n(222)+"rif",zcuCQ:function(e,t){return e+t},QUtxT:function(e,t){return e!==t},RSJoB:"italic 500"+n(311)+n(320)+n(222)+n(146),CwXQo:n(327),KpuNH:n(269),CaKJF:n(214)+n(244)+"Roman', Times, serif",USYJw:function(e,t){return e>=t},cbsgY:function(e,t){return e<t},ANQQI:function(e,t){return e-t},AucjP:n(193)+n(115)+n(291),iLxub:"â™” EN PENSENT â™š",keqXU:function(e,t){return e(t)},ulHub:function(e,t){return e-t},vkdKX:function(e,t){return e+t},RdaDe:function(e,t){return e-t},klfRk:n(236)+"255, 255, 0.95)",unkaV:function(e,t){return e/t},noKuf:n(180),DnRQb:n(142)+"Inter', sans-serif",IIZqS:function(e,t){return e+t},ftPlg:n(279)+n(106)};await r[n(155)](K);const{boardSize:a=600,darkMode:i=!1,withWatermark:o=!1,title:l}=s,c=r[n(192)](T,e,a),u=r[n(121)](a,.02),d=r[n(258)](a,r.QPAlA(u,2)),m=await async function(e,t,s){const n=H,r={bHPPz:function(e,t){return e(t)},sOmvh:n(203)+n(145),yViHJ:n(135),VqUFF:function(e,t){return e*t}};return new Promise((a,i)=>{const o=n,l={gsGMc:r[o(190)],hcEuX:function(e,t){return r[o(128)](e,t)},QVZhl:function(e,t){return e*t},Sueoq:function(e,t){return e(t)}};if(o(144)!==o(250)){const n=new Image,c={};c[o(267)]=o(176)+o(150)+"t=utf-8";const u=new Blob([e],c),d=URL[o(134)+o(139)](u);n[o(280)]=()=>{const e=o,r=document["createElem"+e(201)](l[e(226)]);r[e(111)]=l.hcEuX(t,5),r[e(148)]=l[e(185)](s,5);const i=r[e(324)]("2d");i.scale(5,5),i[e(286)](n,0,0,t,s),URL[e(256)+e(139)](d),l[e(309)](a,r)},n[o(304)]=()=>{const e=o;URL[e(256)+e(139)](d),r.bHPPz(i,new Error(r[e(266)]))},n[o(154)]=d}else _0x33325d[o(179)](_0x5b639c,_0xbfc7f3,_0xe96384)})}(c,d,d),h=60,f=d+120,x=r.JPXVS(d,220)+60+120,p=document[n(307)+n(201)](r.etXmv);p[n(111)]=r[n(121)](f,5),p[n(148)]=5*x;const v=p[n(324)]("2d");v.scale(5,5),v[n(181)+n(112)+"d"]=!0,v[n(181)+n(274)+"y"]=r[n(195)],v.fillStyle=n(i?162:318),v[n(215)](0,0,f,x),v[n(286)](m,0,0,m[n(111)],m[n(148)],h,h,d,d);const g=r[n(277)](h,d)+28;v[n(315)+"e"]=i?r[n(120)]:r[n(175)],v[n(147)]=1,v[n(102)](),v[n(251)](h,g),v[n(249)](r[n(213)](f,h),g),v[n(275)]();const w=i?"#fafaf9":r.RxcGP,j=i?"#a8a29e":r[n(305)],y=i?r[n(305)]:n(328),N=i?r.PHGyI:n(328),b=f/2;let z=g+55;const C=t[n(326)]||r[n(219)],D=t[n(173)]||r[n(187)];v[n(101)+"ne"]=r[n(118)],v[n(313)]=r.kUTOd;const M=v.measureText(C)[n(111)],L=v[n(211)+"t"](D)[n(111)];v[n(313)]=n(281)+n(228)+n(320)+"eorgia, se"+n(146);const A=r[n(270)],B=v[n(211)+"t"](A).width,G=M+B+L,E=b-r[n(156)](G,2);v.font=n(182)+"Cinzel', 'Times New Roman', se"+n(146),v.fillStyle=w,v.textAlign=n(110),v[n(179)](C,E,z),v[n(313)]=r[n(321)],v[n(127)]=N,v[n(179)](A,E+M,z),v[n(313)]=r[n(312)],v[n(127)]=w,v[n(179)](D,r[n(217)](E,M)+B,z),z+=36,t.event&&r[n(123)](t.event,n(284))&&(v[n(127)]=j,v[n(313)]=r[n(202)],v[n(168)]=r[n(166)],v.fillText(t[n(263)],b,z),z+=32);const q=l,S=t[n(297)]||"";if(q||S){v[n(127)]=y,v[n(313)]=n(238)+n(115)+"ns-serif",v.textAlign=r[n(166)];let e="";q?(e=q[n(137)+"e"](),S&&(e+=r[n(258)](r.KpuNH,S))):e=S;const t=2,s=e.split(""),a=s[n(264)]((e,t)=>e+v.measureText(t).width,0),i=r[n(121)](s[n(212)]-1,t);let o=b-r[n(156)](r.JieYg(a,i),2);for(const l of s)n(262)!==n(163)?(v[n(168)]=n(110),v[n(179)](l,o,z),o+=r[n(277)](v.measureText(l).width,t)):_0x2f5ec5=cBknLq[n(208)](_0x15dbc9,cBknLq.yNahf(cBknLq[n(258)](n(295)+n(200),cBknLq[n(332)]),");"))();z+=28}if(t[n(289)]&&t[n(289)][n(212)]>0){v.fillStyle=y,v[n(313)]=r.CaKJF,v[n(168)]="center";const e=t[n(289)][n(241)](" "),s=f-120-40,a=(e.length>400?e[n(234)](0,400)+n(172):e).split(" ");let i="",o=z;const l=15,c=4;let u=0;for(const t of a){const e=r[n(124)](i+(i?" ":""),t);if(v[n(211)+"t"](e).width>s&&i){if(v[n(179)](i,b,o),i=t,o+=l,u++,r[n(209)](u,c))break}else i=e}i&&r[n(325)](u,c)&&v[n(179)](i,b,o)}const k=r[n(227)](x-h,20);v[n(127)]=y,v.font=r[n(207)],v.textAlign=r[n(166)];const P=r[n(130)].split(""),_=P.reduce((e,t)=>e+v[n(211)+"t"](t)[n(111)],0)+r[n(121)](P.length-1,4);let I=r[n(213)](b,_/2);for(const W of P)v[n(168)]=n(110),v.fillText(W,I,k),I+=v[n(211)+"t"](W)[n(111)]+4;if(o){const[e,t]=await Promise[n(113)]([r[n(143)](U,!1),Y()]),s=220,a=65,i=r[n(153)](r[n(273)](h,d)-s,12),o=r[n(136)](r.zcuCQ(h,d),a)-12;v[n(127)]=r.klfRk,v[n(102)](),v[n(287)](i,o,s,a,6),v[n(204)](),v[n(315)+"e"]=n(257),v[n(147)]=1,v[n(275)]();const l=48,c=r[n(258)](i,12),u=o+r[n(252)](a-l,2);v[n(210)](),v[n(102)](),v.arc(r[n(277)](c,l/2),r.nBQgE(u,l/2),l/2,0,2*Math.PI),v.clip(),v.drawImage(t,c,u,l,l),v.restore();const m=c+l+10;v[n(168)]=n(110),v[n(101)+"ne"]="alphabetic",v.fillStyle=r.noKuf,v[n(313)]=r[n(299)],v[n(179)](n(198),m,r.IIZqS(o,28)),v[n(127)]=r.PHGyI,v[n(313)]=n(194)+n(115)+n(291),v[n(179)](r.ftPlg,m,o+46);const f=50,x=r[n(213)](i+s-f,10),p=o+(a-f)/2,g=new Image;await new Promise(t=>{const s=n;g[s(280)]=()=>{v[s(286)](g,x,p,f,f),t()},g[s(304)]=()=>t(),g.src=e})}return p}const X=S.filter(e=>"custom"!==e.id);const O=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const V=()=>{const e=n(),{user:t,isLoading:s}=r(),[_,I]=a.useState(null),[W,K]=a.useState(!1),[T,H]=a.useState(0),[U,Y]=a.useState(""),[V,J]=a.useState([]),[F,R]=a.useState(50),[Q,$]=a.useState(!0),[ee,te]=a.useState(!1),[se,ne]=a.useState(null);a.useEffect(()=>{s||(async()=>{if(!t)return void I(!1);const{data:e}=await l.rpc("has_role",{_user_id:t.id,_role:"admin"});I(!0===e)})()},[t,s]);const re=a.useCallback(async(e,s,n,r,a=!0)=>{try{const m=i(e.pgn),h=a?X[Math.floor(Math.random()*X.length)]:X[n%X.length],f=function(e,t){const s=S.find(e=>e.id===t)||S[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,h.id);o(h.id);const x=await Z(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{x.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),v=Date.now(),g=`${t.id}/${v}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await l.storage.from("visualizations").upload(g,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:j}=l.storage.from("visualizations").getPublicUrl(g),y=c(e.pgn),N={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:h.id,paletteName:h.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:y}},{data:b,error:z}=await l.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:N,image_path:j.publicUrl}).select().single();if(z)throw z;const C=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:D,error:M}=await u(b.id,C);if(M)throw M;const L=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<L.viewCount;e++)await l.rpc("record_vision_interaction",{p_visualization_id:b.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const A=d(e.pgn),B=a?"premium":"genesis";return{title:s,success:!0,visualizationId:b.id,listingId:null==D?void 0:D.id,isExemplar:r,paletteId:h.id,paletteName:h.name,gameHash:y,tier:B,openingName:null==A?void 0:A.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:r}}},[t]),ae=V.filter(e=>e.success).length,ie=V.filter(e=>!e.success).length;return V.filter(e=>e.success&&e.isExemplar).length,s||null===_?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(h,{className:"h-8 w-8 animate-spin text-primary"})}):t&&_?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(j,{className:"flex items-center gap-3",children:[m.jsx(y,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(x,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(N,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",F," visions: ",Math.min(25,F)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,F-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:F,onChange:e=>R(Number(e.target.value)),disabled:W,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(b,{id:"use-official-palettes",checked:Q,onCheckedChange:$,disabled:W}),m.jsxs(z,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(C,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),Q&&m.jsxs(D,{variant:"secondary",className:"text-xs",children:[X.length," palettes"]})]})]}),m.jsx(v,{onClick:async()=>{if(!t)return void k.error("You must be logged in as the CEO account");K(!0),J([]),H(0);const e=[],s=P.slice(0,Math.min(F,P.length)),n=[];for(let t=0;t<F;t++){const e=t%s.length,r=t<25,a=O[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];Y(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,Q);e.push(i),J([...e]),H((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}K(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?k.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):k.error("Failed to create any visions")},disabled:W||!t,className:"w-full",size:"lg",children:W?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(M,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(L,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await l.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return k.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await l.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),c=n.filter(e=>i.has(e));if(0===o.length)return k.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:c.length}),void te(!1);await l.from("visualization_listings").delete().in("visualization_id",o),await l.from("vision_scores").delete().in("visualization_id",o),await l.from("vision_interactions").delete().in("visualization_id",o),await l.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await l.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await l.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:c.length}),k.success(`Deleted ${o.length} test visions`,{description:c.length>0?`${c.length} visions with natural value preserved`:void 0})}catch(e){k.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||W||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(h,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(L,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),W&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{value:T,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:U})]}),V.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(B,{className:"h-4 w-4"}),ae," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(G,{className:"h-4 w-4"}),V.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(E,{className:"h-4 w-4"}),V.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:V.map((e,t)=>m.jsxs(q.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(G,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(E,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(D,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(D,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(C,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(x,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{V as default};
