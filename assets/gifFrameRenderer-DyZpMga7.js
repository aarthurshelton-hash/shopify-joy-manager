const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1k5cZzy0.js","assets/index-MGWJ9q8p.css","assets/gif-CWrVRXCH.js","assets/_commonjs-dynamic-modules-BHR_E30J.js"])))=>i.map(i=>d[i]);
import{bN as e}from"./index-1k5cZzy0.js";function t(e,t){return e.map(e=>e.map(e=>({...e,visits:e.visits.filter(e=>e.moveNumber<=t)})))}async function n(n){const{board:o,currentMove:a,totalMoves:i,size:r,darkMode:s=!1,showCoordinates:l=!1,gameData:c,showPieces:d=!1,pieceOpacity:p=.7,pgn:m}=n,u=(await e(async()=>{const{default:e}=await import("./html2canvas.esm-C2s7aB6S.js");return{default:e}},[])).default,f=await e(()=>import("./index-1k5cZzy0.js").then(e=>e.R),__vite__mapDeps([0,1])),g=await e(()=>import("./index-1k5cZzy0.js").then(e=>e.c),__vite__mapDeps([0,1])),{default:h}=await e(async()=>{const{default:e}=await import("./index-1k5cZzy0.js").then(e=>e.g8);return{default:e}},__vite__mapDeps([0,1])),{default:w}=await e(async()=>{const{default:e}=await import("./index-1k5cZzy0.js").then(e=>e.g7);return{default:e}},__vite__mapDeps([0,1])),{default:y}=await e(async()=>{const{default:e}=await import("./index-1k5cZzy0.js").then(e=>e.g9);return{default:e}},__vite__mapDeps([0,1])),E=t(o,a),x=document.createElement("div");x.style.position="absolute",x.style.left="-9999px",x.style.top="-9999px",document.body.appendChild(x);const v=s?"#0A0A0A":"#FDFCFB",_=s?"#292524":"#e7e5e4",C=s?"#78716c":"#a8a29e",b=s?"#e7e5e4":"#292524",O=s?"#a8a29e":"#78716c";try{const e=document.createElement("div");Object.assign(e.style,{padding:"20px",backgroundColor:v,borderRadius:"8px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",border:`1px solid ${_}`}),x.appendChild(e);const t=document.createElement("div");t.style.position="relative",e.appendChild(t);const n=g.createRoot(t);if(await new Promise(e=>{n.render(f.createElement("div",{style:{position:"relative",width:r,height:r}},l&&f.createElement(w,{size:r,position:"inside"}),f.createElement(h,{board:E,size:r}),d&&m&&f.createElement(y,{pgn:m,currentMoveNumber:a,size:r,pieceOpacity:p}))),setTimeout(e,d?80:50)}),c){const t=document.createElement("div");Object.assign(t.style,{width:"100%",paddingTop:"12px",borderTop:`1px solid ${_}`,textAlign:"center"});const n=document.createElement("div");Object.assign(n.style,{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"6px"});const o=document.createElement("span");Object.assign(o.style,{fontSize:"14px",fontWeight:"600",color:b,textTransform:"uppercase",letterSpacing:"0.05em",fontFamily:"'Cinzel', 'Times New Roman', serif"}),o.textContent=c.white||"White";const r=document.createElement("span");Object.assign(r.style,{fontSize:"10px",color:O,fontStyle:"italic"}),r.textContent="vs";const s=document.createElement("span");if(Object.assign(s.style,{fontSize:"14px",fontWeight:"600",color:b,textTransform:"uppercase",letterSpacing:"0.05em",fontFamily:"'Cinzel', 'Times New Roman', serif"}),s.textContent=c.black||"Black",n.appendChild(o),n.appendChild(r),n.appendChild(s),t.appendChild(n),c.event||c.date){const e=document.createElement("div");Object.assign(e.style,{fontSize:"10px",color:C,marginBottom:"4px"}),e.textContent=[c.event,c.date].filter(Boolean).join(" • "),t.appendChild(e)}const l=document.createElement("div");Object.assign(l.style,{fontSize:"9px",color:C,marginTop:"4px"}),l.textContent=`Move ${a} of ${i}`,t.appendChild(l),e.appendChild(t)}const o=document.createElement("div");Object.assign(o.style,{fontSize:"8px",letterSpacing:"0.25em",textTransform:"uppercase",fontWeight:"500",color:C,fontFamily:"'Inter', system-ui, sans-serif"}),o.textContent="♔ En Pensent ♚",e.appendChild(o);const s=await u(e,{scale:2,backgroundColor:v,useCORS:!0,allowTaint:!0,logging:!1});return n.unmount(),s}finally{document.body.removeChild(x)}}async function o(t){const{simulation:o,size:a=400,darkMode:i=!1,showCoordinates:r=!0,frameDelay:s=150,quality:l=10,maxFrames:c=60,onProgress:d,showPieces:p=!1,pieceOpacity:m=.7}=t;if(!o||!o.board||void 0===o.totalMoves)throw new Error("Invalid simulation data provided for GIF generation");const{board:u,totalMoves:f,gameData:g}=o;if(0===f)throw new Error("Cannot generate GIF for a game with no moves");try{const t=(await e(async()=>{const{default:e}=await import("./gif-CWrVRXCH.js").then(e=>e.g);return{default:e}},__vite__mapDeps([2,0,1,3]))).default,o=f>c?Math.ceil(f/c):1,y=[0];for(let e=o;e<=f;e+=o)y.push(e);y[y.length-1]!==f&&y.push(f);const E=y.length;let x;null==d||d(0,"Preparing frames...");const v=(null==g?void 0:g.pgn)||"";try{x=await n({board:u,currentMove:0,totalMoves:f,size:a,darkMode:i,showCoordinates:r,gameData:g,showPieces:p,pieceOpacity:m,pgn:v})}catch(h){throw new Error("Failed to render visualization frame. Please try again.")}let _;try{_=new t({workers:2,quality:l,width:x.width,height:x.height,workerScript:"/gif.worker.js"})}catch(w){throw new Error("GIF encoder initialization failed. The worker script may not be available.")}_.addFrame(x,{delay:3*s,copy:!0}),null==d||d(.05,`Captured frame 1 of ${E}`);for(let e=1;e<y.length;e++){const t=y[e],o=e===y.length-1;try{const l=await n({board:u,currentMove:t,totalMoves:f,size:a,darkMode:i,showCoordinates:r,gameData:g,showPieces:p,pieceOpacity:m,pgn:v}),c=o?4*s:s;_.addFrame(l,{delay:c,copy:!0});null==d||d(.05+.75*((e+1)/E),`Captured frame ${e+1} of ${E}`)}catch(h){}}return null==d||d(.8,"Encoding GIF..."),new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("GIF encoding timed out after 60 seconds"))},6e4);_.on("progress",e=>{null==d||d(.8+.2*e,"Encoding GIF...")}),_.on("finished",t=>{clearTimeout(n),null==d||d(1,"Complete!"),e(t)}),_.on("error",e=>{clearTimeout(n),t(new Error("GIF encoding failed: "+e.message))});try{_.render()}catch(o){clearTimeout(n),t(new Error("Failed to start GIF encoding"))}})}catch(y){throw y instanceof Error?y:new Error("Unknown error during GIF generation")}}export{t as filterBoardToMove,o as generateAnimatedGif,n as renderFrameToCanvas};
