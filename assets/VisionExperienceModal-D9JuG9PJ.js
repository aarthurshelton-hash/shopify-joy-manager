const n='import React, { useEffect, useState, useRef, useMemo, useCallback } from \'react\';\nimport { useNavigate } from \'react-router-dom\';\nimport { motion, AnimatePresence } from \'framer-motion\';\nimport {\n  Dialog,\n  DialogContent,\n} from \'@/components/ui/dialog\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \'@/components/ui/tabs\';\nimport { Progress } from \'@/components/ui/progress\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \'@/components/ui/tooltip\';\nimport {\n  Crown,\n  DollarSign,\n  Gift,\n  Eye,\n  Download,\n  Printer,\n  TrendingUp,\n  Calendar,\n  User,\n  Swords,\n  Trophy,\n  Share2,\n  ExternalLink,\n  Loader2,\n  Image as ImageIcon,\n  ChevronDown,\n  ChevronUp,\n  Users,\n  FileImage,\n  Film,\n  ArrowRightLeft,\n  Sun,\n  Moon,\n  Bookmark,\n  Sparkles,\n  BarChart3,\n  Palette,\n  Play,\n  Pause,\n  SkipForward,\n  SkipBack,\n  X,\n  ShoppingBag,\n  Info,\n  BookOpen,\n  Zap,\n} from \'lucide-react\';\nimport { CertifiedBadge } from \'@/components/chess/CertifiedBadge\';\nimport { ShowPiecesToggle } from \'@/components/chess/ShowPiecesToggle\';\nimport { MarketplaceListing } from \'@/lib/marketplace/marketplaceApi\';\nimport { isPremiumPalette, getPaletteArt, getPaletteDisplayName, extractPaletteId } from \'@/lib/marketplace/paletteArtMap\';\nimport { VisionScore, getVisionScore, calculateVisionValue, calculateMembershipMultiplier, SCORING_WEIGHTS, recordVisionInteraction } from \'@/lib/visualizations/visionScoring\';\nimport { analyzeGame, GameAnalysis } from \'@/lib/chess/chessAnalysis\';\nimport { format } from \'date-fns\';\nimport { toast } from \'sonner\';\nimport { SimulationResult, SquareData, GameData } from \'@/lib/chess/gameSimulator\';\nimport InteractiveVisualizationBoard from \'@/components/chess/InteractiveVisualizationBoard\';\nimport { EnhancedLegend } from \'@/components/chess/EnhancedLegend\';\nimport GameInfoDisplay from \'@/components/chess/GameInfoDisplay\';\nimport { TimelineProvider, useTimeline } from \'@/contexts/TimelineContext\';\nimport { LegendHighlightProvider } from \'@/contexts/LegendHighlightContext\';\nimport { setActivePalette, PaletteId, getActivePalette } from \'@/lib/chess/pieceColors\';\nimport { gameImageImports } from \'@/lib/chess/gameImages\';\n\ninterface VisionExperienceModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  listing: MarketplaceListing | null;\n  onPurchase: (listing: MarketplaceListing) => void;\n  isPurchasing: boolean;\n  isOwnListing: boolean;\n  isPremium: boolean;\n}\n\ninterface ExtendedGameData {\n  white?: string;\n  black?: string;\n  event?: string;\n  date?: string;\n  result?: string;\n  pgn?: string;\n  moves?: string[];\n  totalMoves?: number;\n  board?: SquareData[][];\n  visualizationState?: {\n    paletteId?: string;\n    darkMode?: boolean;\n    currentMove?: number;\n  };\n}\n\n// Timeline-aware board component\nconst TimelineBoard: React.FC<{\n  board: SquareData[][];\n  totalMoves: number;\n  size: number;\n  darkMode: boolean;\n}> = ({ board, totalMoves, size, darkMode }) => {\n  const { currentMove } = useTimeline();\n  \n  const filteredBoard = useMemo(() => {\n    if (currentMove >= totalMoves) return board;\n    return board.map(rank =>\n      rank.map(square => ({\n        ...square,\n        visits: square.visits.filter(visit => visit.moveNumber <= currentMove)\n      }))\n    );\n  }, [board, currentMove, totalMoves]);\n\n  return <InteractiveVisualizationBoard board={filteredBoard} size={size} />;\n};\n\n// Timeline controls component\nconst TimelineControls: React.FC<{\n  totalMoves: number;\n  isPlaying: boolean;\n  onPlayToggle: () => void;\n}> = ({ totalMoves, isPlaying, onPlayToggle }) => {\n  const { currentMove, setCurrentMove } = useTimeline();\n  const progress = totalMoves > 0 ? (currentMove / totalMoves) * 100 : 0;\n\n  return (\n    <div className="space-y-3">\n      <div className="flex items-center justify-between text-xs text-muted-foreground">\n        <span>Move {currentMove}</span>\n        <span>{totalMoves} total</span>\n      </div>\n      \n      <Progress value={progress} className="h-2" />\n      \n      <div className="flex items-center justify-center gap-2">\n        <Button \n          variant="ghost" \n          size="icon" \n          className="h-8 w-8"\n          onClick={() => setCurrentMove(0)}\n          disabled={currentMove === 0}\n        >\n          <SkipBack className="h-4 w-4" />\n        </Button>\n        <Button \n          variant="ghost" \n          size="icon" \n          className="h-8 w-8"\n          onClick={() => setCurrentMove(Math.max(0, currentMove - 1))}\n          disabled={currentMove === 0}\n        >\n          <ChevronDown className="h-4 w-4 rotate-90" />\n        </Button>\n        <Button \n          variant="outline" \n          size="icon" \n          className="h-10 w-10 border-primary/50"\n          onClick={onPlayToggle}\n        >\n          {isPlaying ? <Pause className="h-5 w-5" /> : <Play className="h-5 w-5 ml-0.5" />}\n        </Button>\n        <Button \n          variant="ghost" \n          size="icon" \n          className="h-8 w-8"\n          onClick={() => setCurrentMove(Math.min(totalMoves, currentMove + 1))}\n          disabled={currentMove >= totalMoves}\n        >\n          <ChevronUp className="h-4 w-4 rotate-90" />\n        </Button>\n        <Button \n          variant="ghost" \n          size="icon" \n          className="h-8 w-8"\n          onClick={() => setCurrentMove(totalMoves)}\n          disabled={currentMove >= totalMoves}\n        >\n          <SkipForward className="h-4 w-4" />\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nconst VisionExperienceModal: React.FC<VisionExperienceModalProps> = ({\n  isOpen,\n  onClose,\n  listing,\n  onPurchase,\n  isPurchasing,\n  isOwnListing,\n  isPremium,\n}) => {\n  const [activeTab, setActiveTab] = useState<\'experience\' | \'analytics\'>(\'analytics\'); // Default to analytics for marketplace\n  const [visionScore, setVisionScore] = useState<VisionScore | null>(null);\n  const [estimatedValue, setEstimatedValue] = useState<number>(0);\n  const [showFullPgn, setShowFullPgn] = useState(false);\n  const [isLoadingScore, setIsLoadingScore] = useState(false);\n  const [darkMode, setDarkMode] = useState(false);\n  const [showLegend, setShowLegend] = useState(true);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [internalMove, setInternalMove] = useState(0);\n  const playIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const viewRecordedRef = useRef(false);\n  const [gameAnalysis, setGameAnalysis] = useState<GameAnalysis | null>(null);\n\n  // Analyze game when listing changes\n  useEffect(() => {\n    if (listing?.visualization?.game_data && isOpen) {\n      const gameData = listing.visualization.game_data as ExtendedGameData;\n      if (gameData?.pgn) {\n        try {\n          const analysis = analyzeGame(gameData.pgn);\n          setGameAnalysis(analysis);\n        } catch {\n          setGameAnalysis(null);\n        }\n      }\n    }\n    if (!isOpen) {\n      setGameAnalysis(null);\n    }\n  }, [listing?.visualization?.game_data, isOpen]);\n\n  useEffect(() => {\n    if (listing?.visualization?.id && isOpen) {\n      loadVisionScore(listing.visualization.id);\n      \n      // Record view interaction (only once per session)\n      if (!viewRecordedRef.current) {\n        viewRecordedRef.current = true;\n        recordVisionInteraction(listing.visualization.id, \'view\');\n      }\n    }\n    \n    // Reset when modal closes\n    if (!isOpen) {\n      viewRecordedRef.current = false;\n      setActiveTab(\'analytics\'); // Reset to analytics (default for marketplace)\n      setIsPlaying(false);\n      setInternalMove(0);\n    }\n  }, [listing?.visualization?.id, isOpen]);\n\n  // Restore palette from visualization\n  useEffect(() => {\n    if (isOpen && listing?.visualization) {\n      const gameData = listing.visualization.game_data as ExtendedGameData;\n      const paletteId = gameData?.visualizationState?.paletteId;\n      if (paletteId && paletteId !== \'custom\') {\n        setActivePalette(paletteId as PaletteId);\n      }\n      if (gameData?.visualizationState?.darkMode !== undefined) {\n        setDarkMode(gameData.visualizationState.darkMode);\n      }\n    }\n  }, [isOpen, listing]);\n\n  // Auto-play logic\n  useEffect(() => {\n    if (isPlaying) {\n      const gameData = listing?.visualization?.game_data as ExtendedGameData;\n      const totalMoves = gameData?.totalMoves || gameData?.moves?.length || 0;\n      \n      playIntervalRef.current = setInterval(() => {\n        setInternalMove(prev => {\n          if (prev >= totalMoves) {\n            setIsPlaying(false);\n            return prev;\n          }\n          return prev + 1;\n        });\n      }, 150);\n    } else {\n      if (playIntervalRef.current) {\n        clearInterval(playIntervalRef.current);\n      }\n    }\n\n    return () => {\n      if (playIntervalRef.current) {\n        clearInterval(playIntervalRef.current);\n      }\n    };\n  }, [isPlaying, listing]);\n\n  const loadVisionScore = async (visualizationId: string) => {\n    setIsLoadingScore(true);\n    const score = await getVisionScore(visualizationId);\n    setVisionScore(score);\n    \n    if (score) {\n      const multiplier = calculateMembershipMultiplier(100);\n      setEstimatedValue(calculateVisionValue(score, multiplier));\n    }\n    setIsLoadingScore(false);\n  };\n\n  const handleShare = async () => {\n    const shareUrl = `${window.location.origin}/v/${listing?.visualization?.id}`;\n    \n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: listing?.visualization?.title || \'Chess Visualization\',\n          text: \'Check out this unique chess visualization on En Pensent!\',\n          url: shareUrl,\n        });\n      } catch (err) {\n        if ((err as Error).name !== \'AbortError\') {\n          await navigator.clipboard.writeText(shareUrl);\n          toast.success(\'Link copied to clipboard\');\n        }\n      }\n    } else {\n    await navigator.clipboard.writeText(shareUrl);\n      toast.success(\'Link copied to clipboard\');\n    }\n  };\n\n  // Debug logging for modal click\n  useEffect(() => {\n    console.log(\'[VisionExperienceModal] Props changed - isOpen:\', isOpen, \'listing:\', listing?.id);\n    if (isOpen) {\n      console.log(\'[VisionExperienceModal] Modal opened with listing:\', listing?.id);\n      console.log(\'[VisionExperienceModal] Game data:\', listing?.visualization?.game_data);\n    }\n  }, [isOpen, listing]);\n\n  // Always render the Dialog to allow proper open/close animations\n  // Only process game data when we have a listing\n  const gameData = listing?.visualization?.game_data as ExtendedGameData | undefined;\n  const isGenesis = listing?.visualization?.title?.includes(\'Exemplar\') ?? false;\n  const isFree = (listing?.price_cents ?? 0) === 0;\n  const totalMoves = gameData?.totalMoves || gameData?.moves?.length || 0;\n  const paletteId = listing ? (extractPaletteId(listing.visualization?.game_data as Record<string, unknown>) || \'modern\') : \'modern\';\n  const hasPremiumPalette = isPremiumPalette(paletteId);\n  const paletteArt = getPaletteArt(paletteId);\n  const paletteDisplayName = getPaletteDisplayName(paletteId);\n  const isCertifiedPalette = paletteId && paletteId !== \'custom\';\n  const isCertifiedGame = listing?.visualization?.title?.includes(\'Immortal\') || \n                          listing?.visualization?.title?.includes(\'Game of the Century\') ||\n                          listing?.visualization?.title?.includes(\'Deep Blue\');\n  \n  // Get a random game image for background if no palette art - memoized index\n  const gameImageKeys = useMemo(() => Object.keys(gameImageImports), []);\n  const randomImageIndex = useMemo(() => Math.floor(Math.random() * gameImageKeys.length), [gameImageKeys.length]);\n  const randomGameImage = gameImageImports[gameImageKeys[randomImageIndex]];\n  const backgroundArt = paletteArt || randomGameImage;\n\n  // Reconstruct board data\n  const board: SquareData[][] = gameData?.board || \n    Array(8).fill(null).map((_, rank) =>\n      Array(8).fill(null).map((_, file) => ({\n        file,\n        rank,\n        visits: [],\n        isLight: (file + rank) % 2 === 1,\n      }))\n    );\n\n  const formatResult = (result?: string) => {\n    if (!result) return \'Unknown\';\n    if (result === \'1-0\') return \'White wins\';\n    if (result === \'0-1\') return \'Black wins\';\n    if (result === \'1/2-1/2\') return \'Draw\';\n    return result;\n  };\n\n  console.log(\'[VisionExperienceModal] Rendering - isOpen:\', isOpen, \'listing:\', listing?.id);\n\n  const handleOpenChange = useCallback((open: boolean) => {\n    console.log(\'[VisionExperienceModal] onOpenChange called with:\', open);\n    if (!open) onClose();\n  }, [onClose]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n      <DialogContent \n        className={`max-w-6xl max-h-[95vh] overflow-hidden p-0 gap-0 relative ${\n          hasPremiumPalette && listing\n            ? \'ring-2 ring-amber-500/50 shadow-2xl shadow-amber-500/20\' \n            : \'\'\n        }`}\n      >\n        {!listing ? (\n          <div className="flex items-center justify-center h-64">\n            <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />\n          </div>\n        ) : (\n          <>\n        {/* Premium palette background art with shimmer */}\n        {hasPremiumPalette && backgroundArt && (\n          <>\n            <div \n              className="absolute inset-0 z-0 opacity-[0.12] pointer-events-none"\n              style={{\n                backgroundImage: `url(${backgroundArt})`,\n                backgroundSize: \'cover\',\n                backgroundPosition: \'center\',\n                filter: \'blur(1px)\',\n              }}\n            />\n            {/* Gold shimmer overlay */}\n            <div \n              className="absolute inset-0 z-[1] pointer-events-none opacity-30"\n              style={{\n                background: \'linear-gradient(135deg, transparent 0%, rgba(251, 191, 36, 0.08) 25%, rgba(251, 191, 36, 0.15) 50%, rgba(251, 191, 36, 0.08) 75%, transparent 100%)\',\n                backgroundSize: \'200% 200%\',\n                animation: \'shimmer 3s ease-in-out infinite\',\n              }}\n            />\n            {/* Dark overlay for readability */}\n            <div className="absolute inset-0 z-[2] bg-background/85 pointer-events-none" />\n          </>\n        )}\n        \n        <AnimatePresence mode="wait">\n          <motion.div\n            key={activeTab}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2 }}\n            className="h-full flex flex-col relative z-10"\n          >\n            {/* Header with transitional tabs */}\n            <div className={`p-4 border-b ${\n              hasPremiumPalette \n                ? \'bg-gradient-to-r from-amber-950/30 via-background/80 to-amber-950/30 border-amber-500/20\' \n                : \'bg-gradient-to-r from-background via-muted/30 to-background\'\n            }`}>\n              <div className="flex items-center justify-between mb-4">\n                <div className="flex items-center gap-3 flex-wrap">\n                  {/* Premium Palette Badge */}\n                  {hasPremiumPalette && (\n                    <Badge \n                      className="bg-gradient-to-r from-amber-500 to-orange-500 text-black gap-1 shadow-lg shadow-amber-500/30"\n                    >\n                      <Palette className="h-3 w-3" />\n                      {paletteDisplayName || \'Premium Palette\'}\n                    </Badge>\n                  )}\n                  {isGenesis && <CertifiedBadge type="genesis" />}\n                  {isCertifiedGame && !isGenesis && (\n                    <CertifiedBadge \n                      type="game" \n                      name={listing.visualization?.title}\n                      similarity={95}\n                      matchType="exact"\n                    />\n                  )}\n                  {isCertifiedPalette && !isGenesis && !isCertifiedGame && !hasPremiumPalette && (\n                    <CertifiedBadge \n                      type="palette" \n                      name={paletteId}\n                      similarity={100}\n                      matchType="exact"\n                    />\n                  )}\n                  <h2 className="text-xl font-display font-bold truncate max-w-md">\n                    {listing.visualization?.title || \'Untitled Vision\'}\n                  </h2>\n                  <Badge variant="outline" className="hidden sm:flex">\n                    {totalMoves} moves\n                  </Badge>\n                </div>\n                \n                <div className="flex items-center gap-2">\n                  <Badge \n                    className={`text-sm px-3 py-1 ${\n                      isFree \n                        ? \'bg-green-500/90 hover:bg-green-500\' \n                        : \'bg-primary/90 hover:bg-primary\'\n                    }`}\n                  >\n                    {isFree ? (\n                      <><Gift className="h-3 w-3 mr-1" /> Free</>\n                    ) : (\n                      <><DollarSign className="h-3 w-3" />{(listing.price_cents / 100).toFixed(2)}</>\n                    )}\n                  </Badge>\n                  <Button variant="ghost" size="icon" onClick={onClose} className="h-8 w-8">\n                    <X className="h-4 w-4" />\n                  </Button>\n                </div>\n              </div>\n              \n              {/* Addictive Tab Transition */}\n              <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as \'experience\' | \'analytics\')}>\n                <TabsList className="w-full grid grid-cols-2 bg-muted/50 p-1">\n                  <TabsTrigger \n                    value="experience" \n                    className="gap-2 data-[state=active]:bg-background data-[state=active]:shadow-lg transition-all duration-300"\n                  >\n                    <motion.div\n                      animate={{ rotate: activeTab === \'experience\' ? 0 : -10 }}\n                      transition={{ type: \'spring\', stiffness: 300 }}\n                    >\n                      <Sparkles className="h-4 w-4" />\n                    </motion.div>\n                    Experience\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value="analytics" \n                    className="gap-2 data-[state=active]:bg-background data-[state=active]:shadow-lg transition-all duration-300"\n                  >\n                    <motion.div\n                      animate={{ rotate: activeTab === \'analytics\' ? 0 : 10 }}\n                      transition={{ type: \'spring\', stiffness: 300 }}\n                    >\n                      <BarChart3 className="h-4 w-4" />\n                    </motion.div>\n                    Analytics\n                  </TabsTrigger>\n                </TabsList>\n              </Tabs>\n            </div>\n\n            {/* Content area */}\n            <div className="flex-1 overflow-y-auto p-4 sm:p-6">\n              <AnimatePresence mode="wait">\n                {activeTab === \'experience\' ? (\n                  <motion.div\n                    key="experience"\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: 20 }}\n                    transition={{ duration: 0.3, ease: \'easeOut\' }}\n                  >\n                    <TimelineProvider>\n                      <LegendHighlightProvider>\n                        <ExperienceTab \n                          listing={listing}\n                          board={board}\n                          totalMoves={totalMoves}\n                          gameData={gameData}\n                          darkMode={darkMode}\n                          setDarkMode={setDarkMode}\n                          showLegend={showLegend}\n                          setShowLegend={setShowLegend}\n                          isPlaying={isPlaying}\n                          setIsPlaying={setIsPlaying}\n                          onPurchase={onPurchase}\n                          isPurchasing={isPurchasing}\n                          isOwnListing={isOwnListing}\n                          isPremium={isPremium}\n                          isFree={isFree}\n                          handleShare={handleShare}\n                          onClose={onClose}\n                        />\n                      </LegendHighlightProvider>\n                    </TimelineProvider>\n                  </motion.div>\n                ) : (\n                  <motion.div\n                    key="analytics"\n                    initial={{ opacity: 0, x: 20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: -20 }}\n                    transition={{ duration: 0.3, ease: \'easeOut\' }}\n                  >\n                    <AnalyticsTab \n                      listing={listing}\n                      gameData={gameData}\n                      visionScore={visionScore}\n                      estimatedValue={estimatedValue}\n                      isLoadingScore={isLoadingScore}\n                      showFullPgn={showFullPgn}\n                      setShowFullPgn={setShowFullPgn}\n                      paletteId={paletteId}\n                      onPurchase={onPurchase}\n                      isPurchasing={isPurchasing}\n                      isOwnListing={isOwnListing}\n                      isPremium={isPremium}\n                      isFree={isFree}\n                      handleShare={handleShare}\n                      formatResult={formatResult}\n                      gameAnalysis={gameAnalysis}\n                    />\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          </motion.div>\n        </AnimatePresence>\n        </>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n};\n\n// Experience Tab Component\nconst ExperienceTab: React.FC<{\n  listing: MarketplaceListing;\n  board: SquareData[][];\n  totalMoves: number;\n  gameData: ExtendedGameData | undefined;\n  darkMode: boolean;\n  setDarkMode: (v: boolean) => void;\n  showLegend: boolean;\n  setShowLegend: (v: boolean) => void;\n  isPlaying: boolean;\n  setIsPlaying: (v: boolean) => void;\n  onPurchase: (listing: MarketplaceListing) => void;\n  isPurchasing: boolean;\n  isOwnListing: boolean;\n  isPremium: boolean;\n  isFree: boolean;\n  handleShare: () => void;\n  onClose: () => void;\n}> = ({\n  listing,\n  board,\n  totalMoves,\n  gameData,\n  darkMode,\n  setDarkMode,\n  showLegend,\n  setShowLegend,\n  isPlaying,\n  setIsPlaying,\n  onPurchase,\n  isPurchasing,\n  isOwnListing,\n  isPremium,\n  isFree,\n  handleShare,\n  onClose,\n}) => {\n  const [boardSize, setBoardSize] = useState(320);\n  const [showPieces, setShowPieces] = useState(false);\n  const [pieceOpacity, setPieceOpacity] = useState(0.7);\n  \n  useEffect(() => {\n    const updateSize = () => {\n      const maxWidth = Math.min(window.innerWidth - 120, 400);\n      setBoardSize(Math.max(260, maxWidth));\n    };\n    updateSize();\n    window.addEventListener(\'resize\', updateSize);\n    return () => window.removeEventListener(\'resize\', updateSize);\n  }, []);\n\n  return (\n    <ScrollArea className="h-[calc(85vh-150px)]">\n      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 pr-4">\n        {/* Main visualization area */}\n        <div className="lg:col-span-2 space-y-4">\n          {/* Mode controls */}\n          <div className="flex justify-center gap-2 flex-wrap">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={darkMode ? "outline" : "default"}\n                    size="sm"\n                    onClick={() => setDarkMode(false)}\n                    className="gap-2 text-xs"\n                  >\n                    <Sun className="h-3 w-3" />\n                    Light\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>Light background for print-ready look</p>\n                </TooltipContent>\n              </Tooltip>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={darkMode ? "default" : "outline"}\n                    size="sm"\n                    onClick={() => setDarkMode(true)}\n                    className="gap-2 text-xs"\n                  >\n                    <Moon className="h-3 w-3" />\n                    Dark\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>Dark mode for elegant display</p>\n                </TooltipContent>\n              </Tooltip>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant={showLegend ? "default" : "outline"}\n                    size="sm"\n                    onClick={() => setShowLegend(!showLegend)}\n                    className="gap-2 text-xs"\n                  >\n                    <Palette className="h-3 w-3" />\n                    Legend\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>Show color legend with piece mapping</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n            <ShowPiecesToggle\n              showPieces={showPieces}\n              pieceOpacity={pieceOpacity}\n              onToggle={setShowPieces}\n              onOpacityChange={setPieceOpacity}\n              compact\n            />\n          </div>\n\n        {/* The artwork */}\n        <motion.div \n          className={`mx-auto p-4 sm:p-6 rounded-lg shadow-2xl border transition-colors duration-500 ${\n            darkMode \n              ? \'bg-[#0A0A0A] border-stone-800\' \n              : \'bg-[#FDFCFB] border-stone-200\'\n          }`}\n          style={{ width: \'fit-content\' }}\n          layout\n        >\n          <div className="flex flex-col items-center gap-4">\n            <TimelineBoard \n              board={board} \n              totalMoves={totalMoves} \n              size={boardSize}\n              darkMode={darkMode}\n            />\n            \n            {/* Game info */}\n            <div className={`w-full pt-3 border-t ${darkMode ? \'border-stone-800\' : \'border-stone-200\'}`}>\n              <GameInfoDisplay \n                gameData={{\n                  white: gameData?.white || \'White\',\n                  black: gameData?.black || \'Black\',\n                  event: gameData?.event || \'\',\n                  date: gameData?.date || \'\',\n                  result: gameData?.result || \'\',\n                  pgn: gameData?.pgn || \'\',\n                  moves: gameData?.moves || [],\n                }}\n                title={listing.visualization?.title}\n                darkMode={darkMode}\n              />\n            </div>\n            \n            {/* Branding */}\n            <p \n              className={`text-[10px] tracking-[0.3em] uppercase font-medium ${\n                darkMode ? \'text-stone-500\' : \'text-stone-400\'\n              }`}\n            >\n              ‚ôî En Pensent ‚ôö\n            </p>\n          </div>\n        </motion.div>\n\n        {/* Timeline controls */}\n        <div className="max-w-sm mx-auto">\n          <TimelineControls \n            totalMoves={totalMoves}\n            isPlaying={isPlaying}\n            onPlayToggle={() => setIsPlaying(!isPlaying)}\n          />\n        </div>\n      </div>\n\n      {/* Right sidebar */}\n      <div className="space-y-4">\n        {/* Legend */}\n        {showLegend && (\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            className="overflow-hidden"\n          >\n            <EnhancedLegend \n              whitePalette={getActivePalette().white}\n              blackPalette={getActivePalette().black}\n              compact={false}\n              title={getActivePalette().name}\n            />\n          </motion.div>\n        )}\n\n        {/* Action buttons */}\n        <div className="flex flex-col gap-2 p-4 rounded-lg bg-muted/30 border">\n          {/* Order Print - Available to everyone */}\n          <Button\n            variant="outline"\n            size="lg"\n            className="w-full gap-2 border-primary/50 hover:bg-primary/10"\n            onClick={() => {\n              onClose();\n              // Use query params for navigation since we\'re in a modal\n              window.location.href = `/order-print?from=marketplace&visualizationId=${listing.visualization?.id}&title=${encodeURIComponent(listing.visualization?.title || \'\')}&imageUrl=${encodeURIComponent(listing.visualization?.image_path || \'\')}`;\n            }}\n          >\n            <ShoppingBag className="h-4 w-4" />\n            Order Print\n          </Button>\n          \n          {/* Claim Ownership with tooltip */}\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  className="w-full gap-2"\n                  size="lg"\n                  variant={isFree ? "default" : "secondary"}\n                  onClick={() => onPurchase(listing)}\n                  disabled={isPurchasing || isOwnListing}\n                >\n                  {isPurchasing ? (\n                    <><Loader2 className="h-4 w-4 animate-spin" /> Processing...</>\n                  ) : isOwnListing ? (\n                    \'Your Listing\'\n                  ) : isFree ? (\n                    <><Gift className="h-4 w-4" /> Claim Vision</>\n                  ) : (\n                    <><Crown className="h-4 w-4" /> Claim Ownership</>\n                  )}\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent side="top" className="max-w-xs">\n                <p className="font-medium mb-1">What is Ownership?</p>\n                <ul className="text-xs space-y-1 text-muted-foreground">\n                  <li>‚Ä¢ Add this vision to your personal gallery</li>\n                  <li>‚Ä¢ Exclusive digital ownership - only one owner per vision</li>\n                  <li>‚Ä¢ Earn royalties when others order prints</li>\n                  <li>‚Ä¢ List for resale anytime on the marketplace</li>\n                </ul>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n          \n          <div className="flex gap-2">\n            <Button variant="outline" size="sm" className="flex-1 gap-2" onClick={handleShare}>\n              <Share2 className="h-4 w-4" />\n              Share\n            </Button>\n            <Button\n              variant="outline"\n              size="sm"\n              className="flex-1 gap-2"\n              onClick={() => window.open(`/v/${listing.visualization?.id}`, \'_blank\')}\n            >\n              <ExternalLink className="h-4 w-4" />\n              Full View\n            </Button>\n          </div>\n\n          {!isPremium && !isOwnListing && (\n            <p className="text-xs text-muted-foreground text-center mt-2">\n              <Crown className="h-3 w-3 inline mr-1 text-amber-500" />\n              Premium required to claim ownership. <span className="opacity-70">Anyone can order prints.</span>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n    </ScrollArea>\n  );\n};\n\n// Analytics Tab Component  \nconst AnalyticsTab: React.FC<{\n  listing: MarketplaceListing;\n  gameData: ExtendedGameData | undefined;\n  visionScore: VisionScore | null;\n  estimatedValue: number;\n  isLoadingScore: boolean;\n  showFullPgn: boolean;\n  setShowFullPgn: (v: boolean) => void;\n  paletteId: string;\n  onPurchase: (listing: MarketplaceListing) => void;\n  isPurchasing: boolean;\n  isOwnListing: boolean;\n  isPremium: boolean;\n  isFree: boolean;\n  handleShare: () => void;\n  formatResult: (r?: string) => string;\n  gameAnalysis: GameAnalysis | null;\n}> = ({\n  listing,\n  gameData,\n  visionScore,\n  estimatedValue,\n  isLoadingScore,\n  showFullPgn,\n  setShowFullPgn,\n  paletteId,\n  onPurchase,\n  isPurchasing,\n  isOwnListing,\n  isPremium,\n  isFree,\n  handleShare,\n  formatResult,\n  gameAnalysis,\n}) => {\n  const paletteIdFromState = gameData?.visualizationState?.paletteId || \'modern\';\n  const isCertifiedPalette = paletteIdFromState && paletteIdFromState !== \'custom\';\n  \n  return (\n    <ScrollArea className="h-[calc(85vh-150px)]">\n    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 pr-4">\n      {/* Left Column - Image and Quick Stats */}\n      <div className="space-y-4">\n        {/* Vision Image */}\n        <motion.div \n          className="relative rounded-lg overflow-hidden bg-muted aspect-square"\n          whileHover={{ scale: 1.02 }}\n          transition={{ type: \'spring\', stiffness: 300 }}\n        >\n          {listing.visualization?.image_path ? (\n            <img\n              src={listing.visualization.image_path}\n              alt={listing.visualization.title}\n              className="w-full h-full object-cover"\n            />\n          ) : (\n            <div className="w-full h-full flex items-center justify-center">\n              <ImageIcon className="h-16 w-16 text-muted-foreground/30" />\n            </div>\n          )}\n        </motion.div>\n\n        {/* Action Buttons */}\n        <div className="flex gap-2">\n          <Button\n            className="flex-1 gap-2"\n            size="lg"\n            variant={isFree ? "default" : "outline"}\n            onClick={() => onPurchase(listing)}\n            disabled={isPurchasing || isOwnListing}\n          >\n            {isPurchasing ? (\n              <><Loader2 className="h-4 w-4 animate-spin" /> Processing...</>\n            ) : isOwnListing ? (\n              \'Your Listing\'\n            ) : isFree ? (\n              <><Gift className="h-4 w-4" /> Claim Gift</>\n            ) : (\n              <><DollarSign className="h-4 w-4" /> ${(listing.price_cents / 100).toFixed(2)}</>\n            )}\n          </Button>\n          \n          <Button variant="outline" size="icon" onClick={handleShare}>\n            <Share2 className="h-4 w-4" />\n          </Button>\n        </div>\n      </div>\n\n      {/* Right Column - Details */}\n      <div className="space-y-5">\n        {/* Seller Info */}\n        <motion.div \n          className="flex items-center gap-3 p-3 rounded-lg bg-muted/50"\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n        >\n          <div className="h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center">\n            <User className="h-5 w-5 text-primary" />\n          </div>\n          <div>\n            <p className="text-sm text-muted-foreground">Listed by</p>\n            <p className="font-medium">{listing.seller?.display_name || \'Anonymous\'}</p>\n          </div>\n          <Badge variant="outline" className="ml-auto">\n            <Calendar className="h-3 w-3 mr-1" />\n            {format(new Date(listing.created_at), \'MMM d, yyyy\')}\n          </Badge>\n        </motion.div>\n\n        {/* Game Details */}\n        <motion.div \n          className="space-y-3"\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n        >\n          <h3 className="font-semibold flex items-center gap-2">\n            <Swords className="h-4 w-4" />\n            Game Details\n          </h3>\n          \n          <div className="grid grid-cols-2 gap-2 text-sm">\n            {gameData?.white && (\n              <div className="p-2 rounded bg-muted/50">\n                <p className="text-muted-foreground text-xs">White</p>\n                <p className="font-medium truncate">{gameData.white}</p>\n              </div>\n            )}\n            {gameData?.black && (\n              <div className="p-2 rounded bg-muted/50">\n                <p className="text-muted-foreground text-xs">Black</p>\n                <p className="font-medium truncate">{gameData.black}</p>\n              </div>\n            )}\n            {gameData?.result && (\n              <div className="p-2 rounded bg-muted/50 col-span-2">\n                <div className="flex items-center gap-2">\n                  <Trophy className="h-4 w-4 text-amber-500" />\n                  <p className="font-medium">{formatResult(gameData.result)}</p>\n                </div>\n              </div>\n            )}\n          </div>\n        </motion.div>\n\n        {/* Deep Chess Analysis Panel */}\n        {gameAnalysis && (\n          <motion.div \n            className="space-y-3"\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.25 }}\n          >\n            <h3 className="font-semibold flex items-center gap-2">\n              <BookOpen className="h-4 w-4" />\n              Deep Analysis\n            </h3>\n            \n            <div className="space-y-3">\n              {/* Opening Detection */}\n              {gameAnalysis.opening && (\n                <div className="p-3 rounded-lg bg-blue-500/10 border border-blue-500/20">\n                  <div className="flex items-center gap-2 mb-1">\n                    <Badge variant="outline" className="bg-blue-500/20 text-blue-600 border-blue-500/30">\n                      Opening\n                    </Badge>\n                    <span className="text-xs text-muted-foreground">{gameAnalysis.opening.eco}</span>\n                  </div>\n                  <p className="font-medium text-sm">{gameAnalysis.opening.name}</p>\n                  <p className="text-xs text-muted-foreground mt-1">{gameAnalysis.opening.description}</p>\n                </div>\n              )}\n\n              {/* Gambit Detection */}\n              {gameAnalysis.gambit && (\n                <div className="p-3 rounded-lg bg-orange-500/10 border border-orange-500/20">\n                  <div className="flex items-center gap-2 mb-1">\n                    <Badge variant="outline" className="bg-orange-500/20 text-orange-600 border-orange-500/30">\n                      <Zap className="h-3 w-3 mr-1" />\n                      Gambit\n                    </Badge>\n                    <Badge variant="secondary" className="text-[10px]">{gameAnalysis.gambit.frequency}</Badge>\n                  </div>\n                  <p className="font-medium text-sm">{gameAnalysis.gambit.name}</p>\n                  <p className="text-xs text-muted-foreground mt-1">\n                    Sacrifices {gameAnalysis.gambit.sacrificedMaterial} for {gameAnalysis.gambit.compensation}\n                  </p>\n                </div>\n              )}\n\n              {/* Tactical Motifs */}\n              {gameAnalysis.tactics.length > 0 && (\n                <div className="p-3 rounded-lg bg-purple-500/10 border border-purple-500/20">\n                  <div className="flex items-center gap-2 mb-2">\n                    <Badge variant="outline" className="bg-purple-500/20 text-purple-600 border-purple-500/30">\n                      <Swords className="h-3 w-3 mr-1" />\n                      Tactics ({gameAnalysis.tactics.length})\n                    </Badge>\n                  </div>\n                  <div className="flex flex-wrap gap-1">\n                    {gameAnalysis.tactics.slice(0, 8).map((tactic, i) => (\n                      <Badge key={i} variant="secondary" className="text-xs">\n                        {tactic.type === \'fork\' && \'‚ëÇ\'}\n                        {tactic.type === \'pin\' && \'üìå\'}\n                        {tactic.type === \'discovery\' && \'üí°\'}\n                        {tactic.type === \'skewer\' && \'üó°Ô∏è\'}\n                        {tactic.type === \'back_rank\' && \'‚ôõ\'}\n                        {tactic.type === \'smothered_mate\' && \'üèÜ\'}\n                        {tactic.type === \'sacrifice\' && \'üíé\'}\n                        {tactic.type === \'double_attack\' && \'‚öîÔ∏è\'}\n                        {\' \'}{tactic.type.replace(\'_\', \' \')} (m{tactic.moveNumber})\n                      </Badge>\n                    ))}\n                    {gameAnalysis.tactics.length > 8 && (\n                      <Badge variant="outline" className="text-xs">\n                        +{gameAnalysis.tactics.length - 8} more\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Special Moves */}\n              {gameAnalysis.specialMoves.length > 0 && (\n                <div className="p-3 rounded-lg bg-green-500/10 border border-green-500/20">\n                  <div className="flex items-center gap-2 mb-2">\n                    <Badge variant="outline" className="bg-green-500/20 text-green-600 border-green-500/30">\n                      <Sparkles className="h-3 w-3 mr-1" />\n                      Special Moves\n                    </Badge>\n                  </div>\n                  <div className="flex flex-wrap gap-1">\n                    {gameAnalysis.specialMoves.map((move, i) => (\n                      <Badge key={i} variant="secondary" className="text-xs">\n                        {move.type === \'castle_kingside\' && \'0-0\'}\n                        {move.type === \'castle_queenside\' && \'0-0-0\'}\n                        {move.type === \'en_passant\' && \'e.p.\'}\n                        {move.type === \'promotion\' && `=${move.promotedTo?.toUpperCase()}`}\n                        {move.type === \'underpromotion\' && `=${move.promotedTo?.toUpperCase()}!`}\n                        {\' \'}(m{move.moveNumber})\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Game Phase Summary */}\n              {gameAnalysis.phases.length > 0 && (\n                <div className="p-3 rounded-lg bg-muted/50 border border-border/50">\n                  <div className="flex items-center gap-2 mb-2">\n                    <Badge variant="outline">\n                      <Info className="h-3 w-3 mr-1" />\n                      Game Summary\n                    </Badge>\n                  </div>\n                  <div className="grid grid-cols-3 gap-2 text-center text-xs">\n                    {gameAnalysis.phases.map((phase, i) => (\n                      <div key={i}>\n                        <p className="font-bold">{phase.endMove - phase.startMove}</p>\n                        <p className="text-muted-foreground capitalize">{phase.name}</p>\n                      </div>\n                    ))}\n                  </div>\n                  {/* Key Events from phases */}\n                  {gameAnalysis.phases.some(p => p.keyEvents.length > 0) && (\n                    <div className="mt-2 pt-2 border-t border-border/30 text-xs">\n                      <span className="text-muted-foreground">Key moments: </span>\n                      {gameAnalysis.phases.flatMap(p => p.keyEvents).slice(0, 4).map((event, i) => (\n                        <Badge key={i} variant="outline" className="text-[10px] py-0 px-1 mr-1">\n                          {event}\n                        </Badge>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Game Complexity & Stats */}\n              {gameAnalysis.summary && (\n                <div className="p-3 rounded-lg bg-primary/5 border border-primary/20">\n                  <div className="flex items-center justify-between mb-2">\n                    <Badge variant="outline" className="bg-primary/10 border-primary/30">\n                      <TrendingUp className="h-3 w-3 mr-1" />\n                      Statistics\n                    </Badge>\n                    <Badge \n                      variant="secondary" \n                      className={`text-[10px] ${\n                        gameAnalysis.summary.complexity === \'masterpiece\' ? \'bg-amber-500/20 text-amber-600\' :\n                        gameAnalysis.summary.complexity === \'complex\' ? \'bg-purple-500/20 text-purple-600\' :\n                        gameAnalysis.summary.complexity === \'moderate\' ? \'bg-blue-500/20 text-blue-600\' :\n                        \'bg-green-500/20 text-green-600\'\n                      }`}\n                    >\n                      {gameAnalysis.summary.complexity}\n                    </Badge>\n                  </div>\n                  <div className="grid grid-cols-4 gap-2 text-center text-xs">\n                    <div>\n                      <p className="font-bold">{gameAnalysis.summary.totalMoves}</p>\n                      <p className="text-muted-foreground">Moves</p>\n                    </div>\n                    <div>\n                      <p className="font-bold">{gameAnalysis.summary.captureCount}</p>\n                      <p className="text-muted-foreground">Captures</p>\n                    </div>\n                    <div>\n                      <p className="font-bold">{gameAnalysis.summary.checkCount}</p>\n                      <p className="text-muted-foreground">Checks</p>\n                    </div>\n                    <div>\n                      <p className="font-bold">{gameAnalysis.summary.materialBalance > 0 ? \'+\' : \'\'}{gameAnalysis.summary.materialBalance}</p>\n                      <p className="text-muted-foreground">Material</p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </motion.div>\n        )}\n\n        {/* Vision Score Analytics */}\n        <motion.div \n          className="space-y-3"\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n        >\n          <h3 className="font-semibold flex items-center gap-2">\n            <TrendingUp className="h-4 w-4" />\n            Vision Analytics\n          </h3>\n          \n          {isLoadingScore ? (\n            <div className="flex items-center justify-center py-4">\n              <Loader2 className="h-5 w-5 animate-spin text-muted-foreground" />\n            </div>\n          ) : visionScore ? (\n            <div className="space-y-3">\n              {/* Score Breakdown with animations */}\n              <div className="grid grid-cols-4 gap-2 text-center">\n                {[\n                  { icon: Eye, value: visionScore.viewCount, label: \'Views\', color: \'text-blue-500\' },\n                  { icon: FileImage, value: visionScore.downloadHdCount, label: \'HD\', color: \'text-green-500\' },\n                  { icon: Film, value: visionScore.downloadGifCount, label: \'GIF\', color: \'text-purple-500\' },\n                  { icon: Printer, value: visionScore.printOrderCount, label: \'Prints\', color: \'text-amber-500\' },\n                ].map((stat, i) => (\n                  <motion.div \n                    key={stat.label}\n                    className="p-2 rounded bg-muted/50"\n                    initial={{ opacity: 0, scale: 0.8 }}\n                    animate={{ opacity: 1, scale: 1 }}\n                    transition={{ delay: 0.4 + i * 0.05 }}\n                  >\n                    <stat.icon className={`h-4 w-4 mx-auto ${stat.color} mb-1`} />\n                    <p className="text-lg font-bold">{stat.value}</p>\n                    <p className="text-xs text-muted-foreground">{stat.label}</p>\n                  </motion.div>\n                ))}\n              </div>\n\n              {/* Trade Count and Unique Viewers */}\n              <div className="grid grid-cols-2 gap-2">\n                <motion.div \n                  className="p-2 rounded bg-muted/50 flex items-center gap-2"\n                  initial={{ opacity: 0, x: -10 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: 0.6 }}\n                >\n                  <ArrowRightLeft className="h-4 w-4 text-cyan-500" />\n                  <div>\n                    <p className="font-bold">{visionScore.tradeCount}</p>\n                    <p className="text-xs text-muted-foreground">Trades</p>\n                  </div>\n                </motion.div>\n                <motion.div \n                  className="p-2 rounded bg-muted/50 flex items-center gap-2"\n                  initial={{ opacity: 0, x: 10 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: 0.6 }}\n                >\n                  <Users className="h-4 w-4 text-pink-500" />\n                  <div>\n                    <p className="font-bold">{visionScore.uniqueViewers}</p>\n                    <p className="text-xs text-muted-foreground">Unique</p>\n                  </div>\n                </motion.div>\n              </div>\n\n              {/* Total Score & Estimated Value */}\n              <motion.div \n                className="p-3 rounded-lg bg-gradient-to-r from-primary/10 to-green-500/10 border border-primary/20"\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.7 }}\n              >\n                <div className="flex justify-between items-center">\n                  <div>\n                    <p className="text-sm text-muted-foreground">Vision Score</p>\n                    <motion.p \n                      className="text-2xl font-bold text-primary"\n                      initial={{ scale: 0 }}\n                      animate={{ scale: 1 }}\n                      transition={{ type: \'spring\', stiffness: 300, delay: 0.8 }}\n                    >\n                      {visionScore.totalScore.toFixed(2)}\n                    </motion.p>\n                  </div>\n                  <div className="text-right">\n                    <p className="text-sm text-muted-foreground">Est. Value</p>\n                    <motion.p \n                      className="text-2xl font-bold text-green-600"\n                      initial={{ scale: 0 }}\n                      animate={{ scale: 1 }}\n                      transition={{ type: \'spring\', stiffness: 300, delay: 0.9 }}\n                    >\n                      ${estimatedValue.toFixed(2)}\n                    </motion.p>\n                  </div>\n                </div>\n              </motion.div>\n            </div>\n          ) : (\n            <div className="text-center py-4 text-muted-foreground">\n              <TrendingUp className="h-8 w-8 mx-auto mb-2 opacity-30" />\n              <p className="text-sm">No analytics yet</p>\n            </div>\n          )}\n        </motion.div>\n\n        {/* Score Formula */}\n        <div className="text-xs text-muted-foreground bg-muted/30 p-2 rounded">\n          <p className="font-medium mb-1">Scoring Formula:</p>\n          <p>\n            Views ({SCORING_WEIGHTS.view}) ‚Ä¢ HD ({SCORING_WEIGHTS.download_hd}) ‚Ä¢ \n            GIF ({SCORING_WEIGHTS.download_gif}) ‚Ä¢ Trade ({SCORING_WEIGHTS.trade})\n          </p>\n        </div>\n\n        {/* PGN Toggle */}\n        {gameData?.pgn && (\n          <div className="space-y-2">\n            <Button\n              variant="ghost"\n              size="sm"\n              className="w-full justify-between"\n              onClick={() => setShowFullPgn(!showFullPgn)}\n            >\n              <span>View PGN</span>\n              {showFullPgn ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}\n            </Button>\n            \n            <AnimatePresence>\n              {showFullPgn && (\n                <motion.div\n                  initial={{ height: 0, opacity: 0 }}\n                  animate={{ height: \'auto\', opacity: 1 }}\n                  exit={{ height: 0, opacity: 0 }}\n                  className="overflow-hidden"\n                >\n                  <pre className="text-xs bg-muted/50 p-3 rounded overflow-x-auto whitespace-pre-wrap max-h-32 overflow-y-auto">\n                    {gameData.pgn}\n                  </pre>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        )}\n        {/* Certified badges for analytics */}\n        {isCertifiedPalette && (\n          <div className="pt-4 border-t border-border/50">\n            <CertifiedBadge \n              type="palette" \n              name={paletteIdFromState}\n              similarity={100}\n              matchType="exact"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n    </ScrollArea>\n  );\n};\n\nexport default VisionExperienceModal;\n';export{n as default};
