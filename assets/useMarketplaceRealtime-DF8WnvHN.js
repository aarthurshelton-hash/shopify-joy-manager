const n="import { useEffect, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport type { RealtimePostgresChangesPayload } from '@supabase/supabase-js';\n\ntype ListingChange = {\n  id: string;\n  visualization_id: string;\n  seller_id: string;\n  price_cents: number;\n  status: 'active' | 'sold' | 'cancelled';\n  buyer_id: string | null;\n  created_at: string;\n  updated_at: string;\n  sold_at: string | null;\n};\n\ntype VisionScoreChange = {\n  id: string;\n  visualization_id: string;\n  total_score: number;\n  view_count: number;\n  download_hd_count: number;\n  download_gif_count: number;\n  scan_count: number;\n  print_order_count: number;\n  print_revenue_cents: number;\n  royalty_cents_earned: number;\n  royalty_orders_count: number;\n  trade_count: number;\n  unique_viewers: number;\n  updated_at: string;\n};\n\ninterface UseMarketplaceRealtimeOptions {\n  onListingChange?: (payload: RealtimePostgresChangesPayload<ListingChange>) => void;\n  onScoreChange?: (payload: RealtimePostgresChangesPayload<VisionScoreChange>) => void;\n  enabled?: boolean;\n}\n\nexport function useMarketplaceRealtime({\n  onListingChange,\n  onScoreChange,\n  enabled = true,\n}: UseMarketplaceRealtimeOptions = {}) {\n  const handleListingChange = useCallback(\n    (payload: RealtimePostgresChangesPayload<ListingChange>) => {\n      onListingChange?.(payload);\n    },\n    [onListingChange]\n  );\n\n  const handleScoreChange = useCallback(\n    (payload: RealtimePostgresChangesPayload<VisionScoreChange>) => {\n      onScoreChange?.(payload);\n    },\n    [onScoreChange]\n  );\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const channel = supabase\n      .channel('marketplace-realtime')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'visualization_listings',\n        },\n        handleListingChange as (payload: RealtimePostgresChangesPayload<{ [key: string]: unknown }>) => void\n      )\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'vision_scores',\n        },\n        handleScoreChange as (payload: RealtimePostgresChangesPayload<{ [key: string]: unknown }>) => void\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [enabled, handleListingChange, handleScoreChange]);\n}\n\n// Hook specifically for a user's visualizations (My Vision page)\ninterface UseMyVisionRealtimeOptions {\n  userId?: string;\n  onVisualizationChange?: () => void;\n  onScoreChange?: (visualizationId: string) => void;\n  enabled?: boolean;\n}\n\nexport function useMyVisionRealtime({\n  userId,\n  onVisualizationChange,\n  onScoreChange,\n  enabled = true,\n}: UseMyVisionRealtimeOptions = {}) {\n  useEffect(() => {\n    if (!enabled || !userId) return;\n\n    const channel = supabase\n      .channel(`my-vision-${userId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'saved_visualizations',\n          filter: `user_id=eq.${userId}`,\n        },\n        () => {\n          onVisualizationChange?.();\n        }\n      )\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'vision_scores',\n        },\n        (payload) => {\n          const vizId = (payload.new as { visualization_id?: string })?.visualization_id;\n          if (vizId) {\n            onScoreChange?.(vizId);\n          }\n        }\n      )\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'visualization_listings',\n          filter: `seller_id=eq.${userId}`,\n        },\n        () => {\n          onVisualizationChange?.();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [enabled, userId, onVisualizationChange, onScoreChange]);\n}\n";export{n as default};
