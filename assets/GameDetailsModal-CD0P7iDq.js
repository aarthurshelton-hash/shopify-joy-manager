const e='/**\n * Game Details Modal - Shows all analyzed games with clickable details\n * For legal/scientific validation - every game ID is visible\n */\n\nimport { useState, useEffect } from \'react\';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \'@/components/ui/dialog\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Input } from \'@/components/ui/input\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { CheckCircle, XCircle, ExternalLink, Search, Trophy, Brain, Cpu, Filter, Clock, Users } from \'lucide-react\';\nimport { supabase } from \'@/integrations/supabase/client\';\n\ninterface GameDetail {\n  id: string;\n  game_id: string;\n  game_name: string;\n  move_number: number;\n  fen: string;\n  hybrid_prediction: string;\n  hybrid_confidence: number;\n  hybrid_archetype: string;\n  hybrid_correct: boolean;\n  stockfish_prediction: string;\n  stockfish_eval: number;\n  stockfish_correct: boolean;\n  actual_result: string;\n  time_control: string | null;\n  white_elo: number | null;\n  black_elo: number | null;\n  created_at: string;\n  data_source: string | null;\n}\n\ninterface GameDetailsModalProps {\n  trigger: React.ReactNode;\n  filter?: \'all\' | \'hybrid_wins\' | \'stockfish_wins\' | \'both_correct\' | \'both_wrong\';\n  title?: string;\n}\n\nexport function GameDetailsModal({ trigger, filter = \'all\', title = \'All Analyzed Games\' }: GameDetailsModalProps) {\n  const [games, setGames] = useState<GameDetail[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [search, setSearch] = useState(\'\');\n  const [activeTab, setActiveTab] = useState<string>(filter);\n  const [open, setOpen] = useState(false);\n\n  const loadGames = async (filterType: string) => {\n    setLoading(true);\n    try {\n      let query = supabase\n        .from(\'chess_prediction_attempts\')\n        .select(\'*\')\n        .order(\'created_at\', { ascending: false })\n        .limit(500);\n\n      // Apply filter based on type\n      if (filterType === \'hybrid_wins\') {\n        query = query.eq(\'hybrid_correct\', true).eq(\'stockfish_correct\', false);\n      } else if (filterType === \'stockfish_wins\') {\n        query = query.eq(\'hybrid_correct\', false).eq(\'stockfish_correct\', true);\n      } else if (filterType === \'both_correct\') {\n        query = query.eq(\'hybrid_correct\', true).eq(\'stockfish_correct\', true);\n      } else if (filterType === \'both_wrong\') {\n        query = query.eq(\'hybrid_correct\', false).eq(\'stockfish_correct\', false);\n      }\n\n      const { data, error } = await query;\n      \n      if (error) {\n        console.error(\'Error loading games:\', error);\n        return;\n      }\n\n      setGames(data || []);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (open) {\n      loadGames(activeTab);\n    }\n  }, [open, activeTab]);\n\n  // Subscribe to realtime updates\n  useEffect(() => {\n    if (!open) return;\n\n    const channel = supabase\n      .channel(\'game-details-realtime\')\n      .on(\n        \'postgres_changes\',\n        { event: \'INSERT\', schema: \'public\', table: \'chess_prediction_attempts\' },\n        (payload) => {\n          const newGame = payload.new as GameDetail;\n          setGames(prev => [newGame, ...prev].slice(0, 500));\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [open]);\n\n  const filteredGames = games.filter(g => \n    search === \'\' || \n    g.game_id.toLowerCase().includes(search.toLowerCase()) ||\n    g.game_name?.toLowerCase().includes(search.toLowerCase()) ||\n    g.hybrid_archetype?.toLowerCase().includes(search.toLowerCase())\n  );\n\n  const formatTimeControl = (tc: string | null) => {\n    if (!tc) return null;\n    const match = tc.match(/(\\d+)\\+(\\d+)/);\n    if (match) {\n      const [, mins, inc] = match;\n      const total = parseInt(mins) * 60;\n      if (total < 180) return \'Bullet\';\n      if (total < 600) return \'Blitz\';\n      if (total < 1800) return \'Rapid\';\n      return \'Classical\';\n    }\n    return tc;\n  };\n\n  const getResultBadge = (result: string) => {\n    switch(result) {\n      case \'white_wins\': return <Badge variant="outline" className="text-xs">⚪ White</Badge>;\n      case \'black_wins\': return <Badge variant="outline" className="text-xs">⚫ Black</Badge>;\n      case \'draw\': return <Badge variant="outline" className="text-xs">½ Draw</Badge>;\n      default: return <Badge variant="outline" className="text-xs">{result}</Badge>;\n    }\n  };\n\n  const getSourceInfo = (game: GameDetail) => {\n    // Detect source from data_source column or game_id pattern\n    const source = game.data_source || (game.game_id.match(/^\\d+$/) ? \'chesscom\' : \'lichess\');\n    \n    if (source === \'chesscom\') {\n      return {\n        label: \'Chess.com\',\n        color: \'bg-green-500/10 text-green-600 border-green-500/30\',\n        url: `https://www.chess.com/game/live/${game.game_id}`,\n        icon: \'♔\'\n      };\n    }\n    return {\n      label: \'Lichess\',\n      color: \'bg-orange-500/10 text-orange-600 border-orange-500/30\',\n      url: `https://lichess.org/${game.game_id}`,\n      icon: \'♞\'\n    };\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {trigger}\n      </DialogTrigger>\n      <DialogContent className="max-w-4xl max-h-[85vh]">\n        <DialogHeader>\n          <DialogTitle className="flex items-center gap-2">\n            <Trophy className="h-5 w-5 text-primary" />\n            {title}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className="space-y-4">\n          {/* Search and Filter */}\n          <div className="flex gap-2">\n            <div className="relative flex-1">\n              <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />\n              <Input \n                placeholder="Search by Game ID, name, or archetype..." \n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className="pl-9"\n              />\n            </div>\n          </div>\n\n          {/* Filter Tabs */}\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList className="grid w-full grid-cols-5">\n              <TabsTrigger value="all" className="text-xs">\n                All ({games.length})\n              </TabsTrigger>\n              <TabsTrigger value="hybrid_wins" className="text-xs">\n                <Brain className="h-3 w-3 mr-1" />\n                EP Wins\n              </TabsTrigger>\n              <TabsTrigger value="stockfish_wins" className="text-xs">\n                <Cpu className="h-3 w-3 mr-1" />\n                SF Wins\n              </TabsTrigger>\n              <TabsTrigger value="both_correct" className="text-xs">\n                <CheckCircle className="h-3 w-3 mr-1" />\n                Both ✓\n              </TabsTrigger>\n              <TabsTrigger value="both_wrong" className="text-xs">\n                <XCircle className="h-3 w-3 mr-1" />\n                Both ✗\n              </TabsTrigger>\n            </TabsList>\n          </Tabs>\n\n          {/* Games List */}\n          <ScrollArea className="h-[55vh]">\n            {loading ? (\n              <div className="flex items-center justify-center py-12">\n                <div className="animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full" />\n              </div>\n            ) : filteredGames.length === 0 ? (\n              <div className="text-center py-12 text-muted-foreground">\n                No games found matching your criteria\n              </div>\n            ) : (\n              <div className="space-y-2 pr-4">\n                {filteredGames.map((game) => (\n                  <div \n                    key={game.id} \n                    className="p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors"\n                  >\n                    <div className="flex items-start justify-between gap-4">\n                      {/* Left: Game Info */}\n                      <div className="flex-1 min-w-0">\n                        <div className="flex items-center gap-2 flex-wrap">\n                          {(() => {\n                            const sourceInfo = getSourceInfo(game);\n                            return (\n                              <>\n                                <Badge variant="outline" className={`text-xs ${sourceInfo.color}`}>\n                                  {sourceInfo.icon} {sourceInfo.label}\n                                </Badge>\n                                <code className="text-xs font-mono bg-muted px-1.5 py-0.5 rounded">\n                                  {game.game_id}\n                                </code>\n                                <a \n                                  href={sourceInfo.url}\n                                  target="_blank"\n                                  rel="noopener noreferrer"\n                                  className="text-primary hover:underline flex items-center gap-1 text-xs"\n                                >\n                                  <ExternalLink className="h-3 w-3" />\n                                  View Game\n                                </a>\n                              </>\n                            );\n                          })()}\n                          {game.time_control && (\n                            <Badge variant="secondary" className="text-xs">\n                              <Clock className="h-3 w-3 mr-1" />\n                              {formatTimeControl(game.time_control)}\n                            </Badge>\n                          )}\n                          {(game.white_elo || game.black_elo) && (\n                            <Badge variant="secondary" className="text-xs">\n                              <Users className="h-3 w-3 mr-1" />\n                              {game.white_elo || \'?\'} vs {game.black_elo || \'?\'}\n                            </Badge>\n                          )}\n                        </div>\n                        <p className="text-sm text-muted-foreground mt-1 truncate">\n                          Move {game.move_number} • {game.hybrid_archetype || \'Unknown Archetype\'}\n                        </p>\n                        <p className="text-xs text-muted-foreground/70 mt-0.5">\n                          {new Date(game.created_at).toLocaleString()}\n                        </p>\n                      </div>\n\n                      {/* Right: Predictions */}\n                      <div className="flex items-center gap-3 shrink-0">\n                        {/* Hybrid Prediction */}\n                        <div className="text-center">\n                          <div className={`flex items-center gap-1 ${game.hybrid_correct ? \'text-green-500\' : \'text-red-500\'}`}>\n                            {game.hybrid_correct ? <CheckCircle className="h-4 w-4" /> : <XCircle className="h-4 w-4" />}\n                            <span className="text-xs font-medium">EP</span>\n                          </div>\n                          <p className="text-xs text-muted-foreground mt-0.5">\n                            {(game.hybrid_confidence * 100).toFixed(0)}%\n                          </p>\n                        </div>\n\n                        {/* Stockfish Prediction */}\n                        <div className="text-center">\n                          <div className={`flex items-center gap-1 ${game.stockfish_correct ? \'text-green-500\' : \'text-red-500\'}`}>\n                            {game.stockfish_correct ? <CheckCircle className="h-4 w-4" /> : <XCircle className="h-4 w-4" />}\n                            <span className="text-xs font-medium">SF</span>\n                          </div>\n                          <p className="text-xs text-muted-foreground mt-0.5">\n                            {game.stockfish_eval?.toFixed(1) || \'?\'}cp\n                          </p>\n                        </div>\n\n                        {/* Actual Result */}\n                        <div className="text-center">\n                          <p className="text-xs text-muted-foreground mb-0.5">Result</p>\n                          {getResultBadge(game.actual_result)}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </ScrollArea>\n\n          {/* Footer */}\n          <div className="flex items-center justify-between text-xs text-muted-foreground border-t pt-3">\n            <span>Showing {filteredGames.length} games • Click Game ID to verify on Lichess</span>\n            <Button \n              variant="outline" \n              size="sm"\n              onClick={() => loadGames(activeTab)}\n              className="text-xs"\n            >\n              Refresh\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n';export{e as default};
