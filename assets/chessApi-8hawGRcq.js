const n="/**\n * Enterprise Chess Benchmarking API\n * \n * RESTful API endpoints for enterprise customers to integrate\n * En Pensent's chess analysis capabilities into their platforms.\n * \n * @module enterpriseChessApi\n */\n\nimport { supabase } from '@/integrations/supabase/client';\nimport { analyzePositionPotential } from '@/lib/chess/predictiveAnalysis';\nimport { runCloudBenchmark } from '@/lib/chess/cloudBenchmark';\n\nexport interface EnterpriseApiKey {\n  id: string;\n  organization: string;\n  tier: 'starter' | 'professional' | 'enterprise';\n  rateLimit: number;\n  validUntil: Date;\n}\n\nexport interface BenchmarkRequest {\n  gameCount: number;\n  depth: number;\n  useRealGames: boolean;\n  webhookUrl?: string;\n}\n\nexport interface PositionAnalysisRequest {\n  fen: string;\n  depth?: number;\n  includeAlternatives?: boolean;\n}\n\n// Tier-based rate limits\nconst TIER_LIMITS = {\n  starter: { requests: 100, windowMs: 60000 },\n  professional: { requests: 1000, windowMs: 60000 },\n  enterprise: { requests: 10000, windowMs: 60000 },\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FlexibleSupabase = any;\n\n/**\n * Validate enterprise API key and return tier info\n */\nexport async function validateEnterpriseKey(apiKey: string): Promise<EnterpriseApiKey | null> {\n  const client = supabase as FlexibleSupabase;\n  \n  const { data, error } = await client\n    .from('enterprise_api_keys')\n    .select('*')\n    .eq('key', apiKey)\n    .eq('active', true)\n    .single();\n  \n  if (error || !data) return null;\n  \n  const tier = data.tier as keyof typeof TIER_LIMITS;\n  \n  return {\n    id: String(data.id),\n    organization: String(data.organization),\n    tier: tier,\n    rateLimit: TIER_LIMITS[tier]?.requests || 100,\n    validUntil: new Date(String(data.valid_until)),\n  };\n}\n\n/**\n * Run enterprise benchmark with progress tracking\n */\nexport async function runEnterpriseBenchmark(\n  apiKey: string,\n  request: BenchmarkRequest\n): Promise<{ jobId: string; status: string }> {\n  const keyData = await validateEnterpriseKey(apiKey);\n  if (!keyData) throw new Error('Invalid API key');\n  \n  const client = supabase as FlexibleSupabase;\n  \n  const { data: job } = await client\n    .from('enterprise_benchmark_jobs')\n    .insert({\n      organization_id: keyData.id,\n      status: 'queued',\n      config: request,\n    })\n    .select()\n    .single();\n  \n  if (!job) throw new Error('Failed to create job');\n  \n  // Start async processing\n  processEnterpriseBenchmark(job.id, request, keyData).catch(console.error);\n  \n  return { jobId: job.id, status: 'queued' };\n}\n\nasync function processEnterpriseBenchmark(\n  jobId: string,\n  request: BenchmarkRequest,\n  keyData: EnterpriseApiKey\n) {\n  const client = supabase as FlexibleSupabase;\n  \n  try {\n    await client\n      .from('enterprise_benchmark_jobs')\n      .update({ status: 'running', started_at: new Date().toISOString() })\n      .eq('id', jobId);\n    \n    const maxGames = keyData.tier === 'enterprise' ? 500 : keyData.tier === 'professional' ? 100 : 50;\n    \n    const results = await runCloudBenchmark(\n      {\n        gameCount: Math.min(request.gameCount, maxGames),\n        useRealGames: request.useRealGames,\n      },\n      (status, progress) => {\n        // Progress updates\n        client\n          .from('enterprise_benchmark_jobs')\n          .update({ progress, status_message: status })\n          .eq('id', jobId)\n          .then(() => {});\n        \n        // Webhook notification\n        if (request.webhookUrl && progress % 10 === 0) {\n          fetch(request.webhookUrl, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ jobId, progress, status }),\n          }).catch(() => {});\n        }\n      }\n    );\n    \n    await client\n      .from('enterprise_benchmark_jobs')\n      .update({\n        status: 'completed',\n        completed_at: new Date().toISOString(),\n        results,\n        progress: 100,\n      })\n      .eq('id', jobId);\n    \n    // Final webhook\n    if (request.webhookUrl) {\n      fetch(request.webhookUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ jobId, status: 'completed', results }),\n      }).catch(() => {});\n    }\n  } catch (error) {\n    await client\n      .from('enterprise_benchmark_jobs')\n      .update({\n        status: 'failed',\n        error: (error as Error).message,\n        completed_at: new Date().toISOString(),\n      })\n      .eq('id', jobId);\n  }\n}\n\n/**\n * Analyze position for enterprise clients\n */\nexport async function analyzePositionEnterprise(\n  apiKey: string,\n  request: PositionAnalysisRequest\n) {\n  const keyData = await validateEnterpriseKey(apiKey);\n  if (!keyData) throw new Error('Invalid API key');\n  \n  const maxDepth = keyData.tier === 'enterprise' ? 30 : keyData.tier === 'professional' ? 25 : 20;\n  \n  return analyzePositionPotential(request.fen, {\n    depth: Math.min(request.depth || 20, maxDepth),\n    lines: request.includeAlternatives ? 3 : 1,\n  });\n}\n\n/**\n * Get job status for enterprise benchmark\n */\nexport async function getEnterpriseJobStatus(jobId: string, apiKey: string) {\n  const keyData = await validateEnterpriseKey(apiKey);\n  if (!keyData) throw new Error('Invalid API key');\n  \n  const client = supabase as FlexibleSupabase;\n  \n  const { data } = await client\n    .from('enterprise_benchmark_jobs')\n    .select('*')\n    .eq('id', jobId)\n    .eq('organization_id', keyData.id)\n    .single();\n  \n  return data;\n}\n\n/**\n * Enterprise pricing tiers\n */\nexport const ENTERPRISE_PRICING = {\n  starter: {\n    name: 'Starter',\n    price: 499,\n    requests: 100,\n    maxGames: 50,\n    maxDepth: 20,\n    support: 'Email',\n  },\n  professional: {\n    name: 'Professional',\n    price: 1999,\n    requests: 1000,\n    maxGames: 100,\n    maxDepth: 25,\n    support: 'Priority Email + Chat',\n  },\n  enterprise: {\n    name: 'Enterprise',\n    price: 4999,\n    requests: 10000,\n    maxGames: 500,\n    maxDepth: 30,\n    support: '24/7 Phone + Dedicated Manager',\n    features: ['Custom integrations', 'White-label options', 'SLA guarantee'],\n  },\n};\n";export{n as default};
