import{d6 as e,d7 as t,cp as s,a as n,u as r,r as a,J as i,o,s as c,aH as l,aa as u,cM as d,j as m,L as x,C as f,x as h,D as p,B as g,A as v,p as w,t as b,cN as y,bC as j,S as z,a6 as N,P as C,y as M,bG as L,T as D,aq as B,z as q,cU as E,aj as A,aT as S,ca as _,b as H,d8 as G}from"./index-0PGTc9H0.js";function P(e,t){e-=478;const s=I();let n=s[e];if(void 0===P.iRcVLd){var r=function(e){let t="",s="",n=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=n.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)s+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(s)};P.WoXsAn=r,P.PaMkpM={},P.iRcVLd=!0}const a=e+s[0],i=P.PaMkpM[a];if(i)n=i;else{const e=function(e){this.cTXSTb=e,this.RssWoV=[1,0,0],this.xlbraC=function(){return"newState"},this.RcHiRo="\\w+ *\\(\\) *{\\w+ *",this.guYTwn="['|\"].+['|\"];? *}"};e.prototype.zHOLOy=function(){const e=new RegExp(this.RcHiRo+this.guYTwn).test(this.xlbraC.toString())?--this.RssWoV[1]:--this.RssWoV[0];return this.DbMwZQ(e)},e.prototype.DbMwZQ=function(e){return Boolean(~e)?this.SDTHcr(this.cTXSTb):e},e.prototype.SDTHcr=function(e){for(let t=0,s=this.RssWoV.length;t<s;t++)this.RssWoV.push(Math.round(Math.random())),s=this.RssWoV.length;return e(this.RssWoV[0])},new e(P).zHOLOy(),n=P.WoXsAn(n),P.PaMkpM[a]=n}return n}!function(){const e=P,t=I();for(;;)try{if(682200===parseInt(e(572))/1+parseInt(e(523))/2*(parseInt(e(583))/3)+-parseInt(e(501))/4*(parseInt(e(582))/5)+-parseInt(e(492))/6*(-parseInt(e(638))/7)+-parseInt(e(482))/8+parseInt(e(537))/9*(parseInt(e(685))/10)+parseInt(e(588))/11)break;t.push(t.shift())}catch(s){t.push(t.shift())}}();const k=function(){const e=P,t={};t[e(600)]=function(e,t){return e===t},t[e(653)]="hRckL";const s=t;let n=!0;return function(t,r){const a=e,i={chzOh:function(e,t){return s[P(600)](e,t)},kZbEP:a(495),QksGb:function(e,t){return e+t},ZUvMd:function(e,t){return e+t}};if(s[a(600)](s[a(653)],s[a(653)])){const e=n?function(){const e=a;if(r){if(i[e(584)](i.kZbEP,i.kZbEP)){const s=r[e(681)](t,arguments);return r=null,s}return _0x258af0}}:function(){};return n=!1,e}{const e=(_0x15fe0e-_0x624de8[a(522)])/2;_0x5aa853+='<rect x="'+i[a(513)](_0x1da429,e)+a(569)+i[a(503)](_0x2970fc,e)+a(516)+_0x2098a1[a(522)]+'" height="'+_0x2c7faa[a(522)]+a(526)+_0x25a7f6[a(564)]+'"/>'}}}()(void 0,function(){const e=P,t={};t.FQqbQ=e(603)+"+$";const s=t;return k.toString()[e(515)](e(603)+"+$").toString()[e(684)+"r"](k)[e(515)](s.FQqbQ)});k();const T=function(){const e={};e[P(656)]=function(e,t){return e===t};const t=e;let s=!0;return function(e,n){const r=s?function(){const s=P;if(n){if(t.fYuxQ("RzFMo",s(634))){const e=_0x5e62f8.apply(_0x40b036,arguments);return _0x15f028=null,e}{const t=n[s(681)](e,arguments);return n=null,t}}}:function(){};return s=!1,r}}();function I(){const e=["qNLkDva","AxrHBgLJiduWma","zMLSBa","kcGOlISPkYKRkq","ChbMu0q","vu5oqui","iIbOzwLNAhq9iG","sw50zxiNlcbZyq","zgf0zq","Bw9Yyw50jYWGrW","C2f2zq","zhjHD0LTywDL","CfvLC2i","rhjxD2K","C3PpDfy","Aw1Hz2vtBw9VDa","s25uzwC","mJu1lcaYntuSia","BwLKzgXL","AgLNAa","iZfbmueXqq","q1LgAu0","BvnpAfm","rMHUqKW","B25LCNjVCG","psjODhrWoI8VDW","y29UC29Szq","sxfNv0e","vw5RBM93BG","C1rREwq","Eg1So2nOyxjZzq","D2LKDgG","yMLUza","Aw5JBhvKzxm","CfLzswC","zxrRAxq","iIb5psiWiIb3Aq","yxjJ","mtCZmZL1zwnnzNC","C3bSAxq","mc45nsK","wNPLqLe","sKLLwLK","vhjouhC","AxL6tee","z0jbtLa","zw5Wzw5Zzw50lG","ywXWAgfIzxrPyW","y2vUDgvY","CM4GDgHPCYiPka","Ee5Ktgq","s2jltem","yw5VBNLTB3vZ","C2DHCfm","BgLUzvDPzhrO","CMv2B2TLt2jQzq","zLL1Efe","s2jItgi","v1flqu4","sfHJwwi","BgvMDa","v2HPDgu","E30Uy29UC3rYDq","x19WCM90B19F","zxjYB3jdB3jYzq","BNmTC2vYAwy","DhLWzq","BwvZlcbZzxjPzG","AgLUz0vUywjSzq","y3rVCIGICMv0Dq","phjLy3qGEd0I","phn2zYb4BwXUCW","DhjHBNnWyxjLBG","zgvMyxvSDa","AgvPz2H0","y3jLyxrLrwXLBq","i2e4yti5zq","B2nbwNm","zw9Yz2LHlcbZzq","CxjJB2rL","AM9PBG","yxbWBhK","C1j5B3G","CuvUzLe","y29UC3rYDwn0BW","nJi1mZu3me1gruvitG","q2LUEMvSjYWGjW","Bw92zxm","ywXS","DgfIBgu","z2v0q29UDgv4Da","AxnmAwDODa","y29T","BgLNAhq","CMDIysGYntuSia","i0zerKngqG","icdIGkiGia","y3rPB25mzxzLBa","i2zHzMfMoq","DMLZAxrZ","ody4ode0ngvXt1DNyG","rhHPAwS","yMvNAw5qyxrO","D2LKDgG9iG","A1bHy0u","BwvHC3vYzvrLEa","Bejhz3u","B25SB2fK","nJaWideZChGGjW","tg1nuhu","mtmYnMXbD2zmyq","Dgv4DejHC2vSAq","C3rYB2TL","vMPRzMK","ru4Guevou0vova","Aw1Hz2uVC3zNkW","ENbpq1y","nJaWidi0ChGGjW","ChjVDg90ExbL","mtzyzhvNyMi","CgrAzNO","wLv2twq","C2vLs1q","rxPrv2O","BwfYz2LU","y3rvuKW","BgvUz3rO","Dwn2tgu","zhrOpsi","EKj6s1i","C2jZBKS","uwTZr2i","zgfYAW","C2vHCMnO","iIb3Awr0Ad0I","AgLUz1f1ywXPDa","CMjut0O","ihzZia","yNjfBKO","i0zbrKfgqq","Bgf5zxjtAxPL","mtC3mdi4q2rMCfPM","q3nzELq","vgLTzxmGtMv3ia","iIbMAwXSpsi","CMv0DxjUicHMDq","uM9Tyw4NlcbuAq","yMXHy2S","DNLTwgq","vMHYsvK","mJaWmc9ZDMCIia","q1LZsvy","CKLTEKS","z2rhyKu","ueHRBhG","ouHdsvPjyW","iI8+","y1Hsvei","u2rqDuW","pZ8/pY4/pY4/pW","C3jJ","BwLU","zhbJCvq","zM9UDhm","uM9Tyw4NlcbZzq","tu5UreG","Dgv4DefSAwDU","C3rYB2TLu3r5Ba","lI4U","uw1MzvG","iJaGmca","C2nHBgu","zMLSBfrLEhq","y3jVC3npCMLNAq","CMfZDxi","BhHdy2m","y2fUDMfZ","v3HRz00","zw50","ntaWideYChGGjW","y3nlwM8","Dg9tDhjPBMC","y29SB3i","y3jLyxrLt2jQzq","zxjYB3i","wKLhue4","Aw5MBW","iIb5psi","s0Dvtw8","zxzLBNq","mZq1mtaZr3rgDhDb","zvriz3e","zMLSBfn0EwXL","zhrVzhi","B21Lq0m","r3bwquW","q0PHq3m","AfPSCLK","CMvKDwnL","DhjHy2u","nZi0mJG1qxDerfH1","nKzutwf0Ca","y2H6t2G","Dg9vChbLCKnHCW","iZC4nZe2yW","CMLM","nZe4mde1muvRDMHrwa","Dg9eyxrHvvjm","vKv3yMK","Bw92zvrV","4PMuievoifbftLnf","zM9UDa","BMf2z3m","iZbbmeeWqq","y2XPCa","C09tzue","wLH4CMG","CMvHzhK"];return(I=function(){return e})()}T(void 0,function(){const e=P,t={};t[e(613)]="log",t.csKZo="warn",t[e(629)]=e(568),t[e(557)]=e(566),t[e(642)]="exception",t.yXAJb=e(581);const s=t;let n;try{n=Function(e(527)+"nction() "+(e(662)+e(669)+e(649))+" ));")()}catch(i){n=window}const r=n.console=n[e(626)]||{},a=[s[e(613)],s[e(562)],s.sTkyd,s[e(557)],s[e(642)],e(689),s.yXAJb];for(let o=0;o<a[e(508)];o++){const t=T[e(684)+"r"][e(500)][e(632)](T),s=a[o],n=r[s]||t;t[e(663)]=T[e(632)](T),t.toString=n[e(563)][e(632)](n),r[s]=t}})();async function W(e){const t=P,s={};s.KGUMo=t(672)+"t";const n=s,r=(await import(t(679)))[t(673)],a={};a.dark=t(e?521:620),a.light=n[t(570)];const i={};return i[t(631)]=200,i[t(506)]=1,i[t(564)]=a,i[t(664)+t(479)]="M",r[t(589)]("https://enpensent.com",i)}async function K(){return new Promise((e,t)=>{const n=P,r=new Image;r[n(555)+"n"]=n(652),r[n(489)]=()=>e(r),r[n(624)]=t,r[n(542)]=s})}async function Z(s,n,r={}){const a=P,i={rbTOJ:function(e,t){return e+t},ZIGPN:function(e,t){return e*t},iyzLA:function(e,t){return e+t},qEnfQ:function(e,t){return e+t},ZXxrh:a(558),brEnJ:function(e,t){return e*t},EvAtb:a(619),pXKdw:a(695),CYsIV:function(e,t){return e+t},FhnBL:a(480),cXRTB:a(676),CJaCs:"#78716c",QmfeX:a(661),navgs:"Black",VhrIY:a(618),KnTeg:"italic 500 20px 'Cor"+a(609)+a(678)+a(587),Meqbf:a(519),CsYzT:function(e,t){return e+t},zpOCV:function(e,t){return e-t},eTHgq:a(499)+a(686)+a(525)+"Roman', serif",ppfSD:function(e,t){return e!==t},SdPuL:function(e,t){return e||t},EzQWj:a(648),ucvLe:a(478),IqgWA:function(e,t){return e>t},GpVAL:function(e,t){return e+t},ZzeBQ:function(e,t){return e*t},iNPRz:a(614),zBzKR:function(e,t){return e<t},CoJLF:a(576),TrNPw:function(e,t){return e-t},dpcqT:function(e,t){return e-t},sRyox:"500 11px '"+a(607)+a(665),Dxiik:a(592)+"NT â™š",PHklx:function(e,t){return e/t},WxkgM:function(e,t){return e(t)},xZEit:function(e){return e()},sOSeA:function(e,t){return e-t},gBANP:function(e,t){return e-t},ocAZs:function(e,t){return e-t},hZlrY:function(e,t){return e+t},wItIH:function(e,t){return e-t},kPacE:function(e,t){return e*t},etkit:function(e,t){return e+t},nfEVz:a(660),VEwbi:"#44403c",seeKT:a(490)+a(607)+a(665),mSOhS:a(646)+a(692),rImzK:function(e,t){return e+t}};await async function(){const e=P;document.fonts&&document[e(545)][e(599)]&&await document.fonts[e(599)],await new Promise(e=>setTimeout(e,150))}();const{boardSize:o=600,darkMode:c=!1,withWatermark:l=!1,title:u}=r,d=function(s,n){const r=P,a={xNdLd:function(e,t){return e/t},CYFiM:function(e,t){return e+t},UNNAB:function(e,t){return e*t},rJHGV:function(e,t){return e<t},HXcYb:function(e,t){return e-t},mVTQD:function(e,t){return e+t},WQKAN:function(e,t){return e+t},gdGbE:function(e,t,s){return e(t,s)},MNnDH:function(e,t){return e/t},rasur:function(e,t){return e/t},KXujK:function(e,t){return e-t},lBGgu:"</svg>"},i=a[r(650)](n,8),o=.02*n,c=a[r(621)](n,a[r(605)](o,2));let l=r(671)+r(625)+"ww.w3.org/"+r(532)+r(485)+c+r(606)+c+'" viewBox='+r(552)+c+" "+c+'">';l+='<rect x="0'+r(636)+r(510)+c+r(606)+c+r(526)+e.border+r(538);for(let u=0;a.rJHGV(u,8);u++){const n=a[r(659)](7,u);for(let c=0;a.rJHGV(c,8);c++){const d=s[n][c],m=d[r(691)]?e[r(693)]:e[r(514)],x=a.mVTQD(o,c*i),f=a[r(658)](o,a[r(605)](u,i));if(l+=r(670)+x+r(569)+f+'" width="'+i+'" height="'+i+r(526)+m+r(538),d[r(481)].length>0){const e=.08*i,s=[];for(const i of d.visits){const e=a[r(535)](t,i.piece,i.color);!s[r(633)](e)&&s.push(e)}const n=Math[r(543)](s.length,6),o=[];let c=a.HXcYb(i,2*e);const u=a[r(547)](.7*c,n);for(let t=0;a.rJHGV(t,n);t++){const e={};if(e[r(564)]=s[t],e[r(522)]=c,o.push(e),c-=u,c<.1*i)break}for(const t of o){const e=a[r(556)](a.KXujK(i,t[r(522)]),2);l+=r(670)+(x+e)+'" y="'+a.mVTQD(f,e)+r(516)+t[r(522)]+'" height="'+t[r(522)]+r(526)+t[r(564)]+'"/>'}}}}return l+=a[r(488)],l}(s,o),m=o+2*(.02*o),x=await async function(e,t,s){const n=P,r={qkCZa:function(e,t){return e*t},sbsnK:function(e,t){return e(t)},pUesb:"Failed to load SVG",KbKLC:n(497)+n(630)+"t=utf-8"};return new Promise((a,i)=>{const o=n,c=new Image,l={};l[o(666)]=r[o(651)];const u=new Blob([e],l),d=URL[o(565)+o(507)](u);c[o(489)]=()=>{const e=o,n=document[e(675)+e(560)](e(558));n.width=5*t,n[e(674)]=r.qkCZa(s,5);const i=n.getContext("2d");i[e(553)](5,5),i[e(611)](c,0,0,t,s),URL[e(655)+e(507)](d),r[e(512)](a,n)},c[o(624)]=()=>{const e=o;URL[e(655)+e(507)](d),i(new Error(r[e(612)]))},c[o(542)]=d})}(d,m,m),f=60,h=i[a(518)](m,i[a(567)](f,2)),p=i[a(518)](i[a(644)](i[a(683)](m,220),60),i[a(567)](f,2)),g=document[a(675)+a(560)](i[a(598)]);g[a(631)]=i[a(520)](h,5),g[a(674)]=i.ZIGPN(p,5);const v=g[a(690)]("2d");v[a(553)](5,5),v[a(615)+a(668)+"d"]=!0,v[a(615)+a(517)+"y"]=i.EvAtb,v[a(574)]=c?a(595):i.pXKdw,v.fillRect(0,0,h,p),v[a(611)](x,0,0,x[a(631)],x[a(674)],f,f,m,m);const w=i[a(533)](f,m)+28;v.strokeStyle=c?"#292524":"#e7e5e4",v.lineWidth=1,v[a(484)](),v[a(591)](f,w),v.lineTo(h-f,w),v[a(494)]();const b=c?i[a(623)]:"#292524",y=c?i[a(539)]:i[a(578)],j=c?i[a(578)]:i[a(539)],z=c?"#78716c":a(676),N=h/2;let C=i[a(683)](w,55);const M=n.white||i[a(551)],L=n[a(529)]||i[a(594)];v.textBaseline=i[a(531)],v.font="600 24px 'Cinzel', '"+a(525)+a(546)+"rif";const D=v[a(487)+"t"](M).width,B=v[a(487)+"t"](L)[a(631)];v[a(593)]=i[a(616)];const q=i.Meqbf,E=v[a(487)+"t"](q).width,A=i[a(524)](D,E)+B,S=i[a(498)](N,A/2);v[a(593)]=i[a(573)],v[a(574)]=b,v.textAlign=a(660),v[a(554)](M,S,C),v[a(593)]=i[a(616)],v[a(574)]=z,v[a(554)](q,i[a(683)](S,D),C),v[a(593)]="600 24px 'Cinzel', 'Times New Roman', serif",v.fillStyle=b,v[a(554)](L,i[a(524)](S,D)+E,C),C+=36,n[a(571)]&&i[a(604)](n[a(571)],a(628))&&(v[a(574)]=y,v.font=a(601)+" 18px 'Cor"+a(609)+a(678)+"rif",v[a(548)]="center",v[a(554)](n[a(571)],N,C),C+=32);const _=u,H=n[a(608)]||"";if(i[a(540)](_,H)){v.fillStyle=j,v[a(593)]=a(561)+a(607)+"ns-serif",v.textAlign=i[a(505)];let e="";_?(e=_[a(585)+"e"](),H&&(e+=i[a(683)](i[a(509)],H))):e=H;const t=2,s=e[a(639)](""),n=s[a(580)]((e,t)=>e+v.measureText(t)[a(631)],0),r=(s[a(508)]-1)*t;let o=N-i[a(644)](n,r)/2;for(const i of s)v[a(548)]=a(660),v[a(554)](i,o,C),o+=v[a(487)+"t"](i).width+t;C+=28}if(n[a(687)]&&i[a(627)](n[a(687)].length,0)){v[a(574)]=j,v[a(593)]="400 10px 'Times New "+a(528)+a(667),v.textAlign=i[a(505)];const e=n[a(687)][a(680)](" "),t=e[a(508)]>400?i[a(577)](e.substring(0,400),a(550)):e,s=h-i[a(641)](f,2)-40,r=t[a(639)](" ");let o="",c=C;const l=15,u=4;let d=0;for(const n of r){const e=i[a(683)](o,o?" ":"")+n;if(v[a(487)+"t"](e).width>s&&o){if(a(530)===i.iNPRz){const e=_0x1009bf?function(){if(_0x14dc5f){const e=_0x5ebfe0.apply(_0x3b6f79,arguments);return _0x155f65=null,e}}:function(){};return _0x58ee03=!1,e}if(v.fillText(o,N,c),o=n,c+=l,d++,d>=u)break}else o=e}o&&i[a(511)](d,u)&&("omeCC"!==i.CoJLF?_0x4e540a=_0xbff9ca:v[a(554)](o,N,c))}const G=i[a(643)](i[a(544)](p,f),20);v[a(574)]=j,v[a(593)]=i[a(682)],v[a(548)]=a(648);const k=i[a(483)].split(""),T=k[a(580)]((e,t)=>e+v.measureText(t)[a(631)],0)+4*(k.length-1);let I=i[a(544)](N,i[a(536)](T,2));for(const e of k)"nIJxM"!==a(502)?(v.textAlign=a(660),v[a(554)](e,I,G),I+=v.measureText(e)[a(631)]+4):_0x2ba8b6.fillText(_0x22e7b3,_0x3830f6,_0x1d65ae);if(l){const[e,t]=await Promise[a(688)]([i[a(559)](W,!1),i.xZEit(K)]),s=220,n=65,r=i[a(544)](i[a(597)](f+m,s),12),o=i[a(645)](i[a(677)](i[a(579)](f,m),n),12);v[a(574)]=a(694)+a(617)+a(640),v.beginPath(),v.roundRect(r,o,s,n,6),v[a(602)](),v[a(549)+"e"]="#e7e5e4",v[a(654)]=1,v[a(494)]();const c=48,l=i[a(533)](r,12),u=o+i.wItIH(n,c)/2;v[a(610)](),v[a(484)](),v[a(637)](l+c/2,u+c/2,i[a(536)](c,2),0,i[a(486)](Math.PI,2)),v[a(596)](),v[a(611)](t,l,u,c,c),v.restore();const d=i[a(635)](l,c)+10;v.textAlign=i.nfEVz,v[a(493)+"ne"]=a(647),v[a(574)]=i[a(590)],v[a(593)]=i[a(504)],v[a(554)](a(496),d,o+28),v[a(574)]=a(586),v.font="400 11px '"+a(607)+a(665),v[a(554)](i[a(622)],d,o+46);const x=50,h=i[a(597)](i[a(534)](r,s),x)-10,p=i[a(518)](o,i[a(536)](n-x,2)),g=new Image;await new Promise(t=>{const s=a;g[s(489)]=()=>{v[s(611)](g,h,p,x,x),t()},g[s(624)]=()=>t(),g[s(542)]=e})}return g}const V=_.filter(e=>"custom"!==e.id);const R=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const Y=()=>{const e=n(),{user:t,isLoading:s}=r(),[P,k]=a.useState(null),[T,I]=a.useState(!1),[W,K]=a.useState(0),[Y,U]=a.useState(""),[O,X]=a.useState([]),[J,F]=a.useState(50),[$,Q]=a.useState(!0),[ee,te]=a.useState(!1),[se,ne]=a.useState(null);a.useEffect(()=>{s||(async()=>{if(!t)return void k(!1);const{data:e}=await c.rpc("has_role",{_user_id:t.id,_role:"admin"});k(!0===e)})()},[t,s]);const re=a.useCallback(async(e,s,n,r,a=!0)=>{try{const m=i(e.pgn),x=a?V[Math.floor(Math.random()*V.length)]:V[n%V.length],f=function(e,t){const s=_.find(e=>e.id===t)||_[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?s.white:s.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,x.id);o(x.id);const h=await Z(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:s}),p=await new Promise((e,t)=>{h.toBlob(s=>{s?e(s):t(new Error("Failed to create blob"))},"image/png",.95)}),g=Date.now(),v=`${t.id}/${g}-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await c.storage.from("visualizations").upload(v,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:b}=c.storage.from("visualizations").getPublicUrl(v),y=l(e.pgn),j={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:x.id,paletteName:x.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?n+1:void 0,gameHash:y}},{data:z,error:N}=await c.from("saved_visualizations").insert({user_id:t.id,title:s,pgn:e.pgn,game_data:j,image_path:b.publicUrl}).select().single();if(N)throw N;const C=function(e,t){if(e){const e=99,s=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+s}return 199+Math.floor(600*Math.random())}(r,n),{data:M,error:L}=await u(z.id,C);if(L)throw L;const D=function(e,t){const s=e?1.5:1,n=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*s+5*n),hdDownloads:Math.floor(3*Math.random()*s),gifDownloads:Math.floor(2*Math.random()*s),tradeCount:e?Math.floor(2*Math.random()):0}}(r,n);for(let e=0;e<D.viewCount;e++)await c.rpc("record_vision_interaction",{p_visualization_id:z.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const B=d(e.pgn),q=a?"premium":"genesis";return{title:s,success:!0,visualizationId:z.id,listingId:null==M?void 0:M.id,isExemplar:r,paletteId:x.id,paletteName:x.name,gameHash:y,tier:q,openingName:null==B?void 0:B.fullName}}catch(m){return{title:s,success:!1,error:m.message,isExemplar:r}}},[t]),ae=O.filter(e=>e.success).length,ie=O.filter(e=>!e.success).length;return O.filter(e=>e.success&&e.isExemplar).length,s||null===P?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(x,{className:"h-8 w-8 animate-spin text-primary"})}):t&&P?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(g,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(b,{className:"flex items-center gap-3",children:[m.jsx(y,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(h,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(j,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",J," visions: ",Math.min(25,J)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,J-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:J,onChange:e=>F(Number(e.target.value)),disabled:T,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(z,{id:"use-official-palettes",checked:$,onCheckedChange:Q,disabled:T}),m.jsxs(N,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(C,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),$&&m.jsxs(M,{variant:"secondary",className:"text-xs",children:[V.length," palettes"]})]})]}),m.jsx(g,{onClick:async()=>{if(!t)return void H.error("You must be logged in as the CEO account");I(!0),X([]),K(0);const e=[],s=G.slice(0,Math.min(J,G.length)),n=[];for(let t=0;t<J;t++){const e=t%s.length,r=t<25,a=R[t]||`Vision ${t+1}`;n.push({game:s[e],title:a,isExemplar:r})}for(let t=0;t<n.length;t++){const{game:s,title:r,isExemplar:a}=n[t];U(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${n.length})`);const i=await re(s,r,t,a,$);e.push(i),X([...e]),K((t+1)/n.length*100),await new Promise(e=>setTimeout(e,300))}I(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?H.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):H.error("Failed to create any visions")},disabled:T||!t,className:"w-full",size:"lg",children:T?m.jsxs(m.Fragment,{children:[m.jsx(x,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(L,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(D,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(g,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){te(!0),ne(null);try{const{data:e,error:s}=await c.from("saved_visualizations").select("id").eq("user_id",t.id);if(s)throw s;if(!e||0===e.length)return H.info("No visions to delete"),void te(!1);const n=e.map(e=>e.id),{data:r,error:a}=await c.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",n);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=n.filter(e=>!i.has(e)),l=n.filter(e=>i.has(e));if(0===o.length)return H.info("All your visions have accrued natural value - none deleted"),ne({deleted:0,preserved:l.length}),void te(!1);await c.from("visualization_listings").delete().in("visualization_id",o),await c.from("vision_scores").delete().in("visualization_id",o),await c.from("vision_interactions").delete().in("visualization_id",o),await c.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await c.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await c.storage.from("visualizations").remove([`${t.id}/`]);ne({deleted:o.length,preserved:l.length}),H.success(`Deleted ${o.length} test visions`,{description:l.length>0?`${l.length} visions with natural value preserved`:void 0})}catch(e){H.error("Failed to delete visions",{description:e.message})}finally{te(!1)}}},disabled:ee||T||!t,variant:"destructive",className:"w-full",size:"lg",children:ee?m.jsxs(m.Fragment,{children:[m.jsx(x,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(D,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),se&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",se.deleted," deleted"]}),se.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",se.preserved," preserved (has value)"]})]})})]}),T&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(B,{value:W,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:Y})]}),O.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(q,{className:"h-4 w-4"}),ae," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(E,{className:"h-4 w-4"}),O.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(A,{className:"h-4 w-4"}),O.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),ie>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),ie," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:O.map((e,t)=>m.jsxs(S.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(E,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(A,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(M,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(M,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(C,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(h,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(g,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{Y as default};
