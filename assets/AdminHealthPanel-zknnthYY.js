const e='import React, { useState } from \'react\';\nimport { useQuery, useMutation, useQueryClient } from \'@tanstack/react-query\';\nimport { Activity, AlertCircle, CheckCircle, Clock, Play, RefreshCw, Shield, TrendingUp } from \'lucide-react\';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Skeleton } from \'@/components/ui/skeleton\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { toast } from \'sonner\';\nimport { supabase } from \'@/integrations/supabase/client\';\nimport { HealthTrendsDashboard } from \'./HealthTrendsDashboard\';\n\ninterface ErrorSummary {\n  total_unresolved: number;\n  last_24h_errors: number;\n  by_type: Array<{ type: string; count: number }>;\n  top_errors: Array<{\n    id: string;\n    message: string;\n    component: string | null;\n    count: number;\n    last_seen: string;\n  }>;\n  recent_health_checks: Array<{\n    id: string;\n    type: string;\n    status: string;\n    issues_found: number;\n    issues_fixed: number;\n    completed_at: string;\n  }>;\n}\n\nexport function AdminHealthPanel() {\n  const [isRunningCheck, setIsRunningCheck] = useState(false);\n  const queryClient = useQueryClient();\n\n  const { data: errorSummary, isLoading } = useQuery({\n    queryKey: [\'error-summary\'],\n    queryFn: async () => {\n      const { data, error } = await supabase.rpc(\'get_error_summary\', { p_days: 7 });\n      if (error) throw error;\n      return data as unknown as ErrorSummary;\n    },\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  const runHealthCheckMutation = useMutation({\n    mutationFn: async () => {\n      const { data, error } = await supabase.functions.invoke(\'health-check\');\n      if (error) throw error;\n      return data as { issues_fixed: number; success: boolean };\n    },\n    onSuccess: (data) => {\n      toast.success(`Health check completed: ${data?.issues_fixed || 0} issues fixed`);\n      queryClient.invalidateQueries({ queryKey: [\'error-summary\'] });\n    },\n    onError: (error: Error) => {\n      toast.error(`Health check failed: ${error.message}`);\n    },\n  });\n\n  const runDataIntegrityCheck = async () => {\n    setIsRunningCheck(true);\n    try {\n      const { data, error } = await supabase.rpc(\'validate_and_fix_data_integrity\');\n      if (error) throw error;\n      const result = data as unknown as { issues_fixed: number };\n      toast.success(`Data integrity check: ${result?.issues_fixed || 0} issues fixed`);\n      queryClient.invalidateQueries({ queryKey: [\'error-summary\'] });\n    } catch (err) {\n      toast.error(`Check failed: ${err instanceof Error ? err.message : \'Unknown error\'}`);\n    } finally {\n      setIsRunningCheck(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className="space-y-4">\n        <Skeleton className="h-32 w-full" />\n        <Skeleton className="h-64 w-full" />\n      </div>\n    );\n  }\n\n  return (\n    <Tabs defaultValue="overview" className="space-y-6">\n      <TabsList>\n        <TabsTrigger value="overview">Overview</TabsTrigger>\n        <TabsTrigger value="trends">\n          <TrendingUp className="h-4 w-4 mr-2" />\n          Trends & Alerts\n        </TabsTrigger>\n      </TabsList>\n\n      <TabsContent value="overview" className="space-y-6">\n        {/* Quick Actions */}\n        <Card>\n        <CardHeader>\n          <CardTitle className="flex items-center gap-2">\n            <Shield className="h-5 w-5" />\n            Automated Monitoring\n          </CardTitle>\n          <CardDescription>\n            Run health checks and data integrity validation\n          </CardDescription>\n        </CardHeader>\n        <CardContent className="flex flex-wrap gap-3">\n          <Button\n            onClick={() => runHealthCheckMutation.mutate()}\n            disabled={runHealthCheckMutation.isPending}\n          >\n            {runHealthCheckMutation.isPending ? (\n              <RefreshCw className="h-4 w-4 mr-2 animate-spin" />\n            ) : (\n              <Play className="h-4 w-4 mr-2" />\n            )}\n            Run Full Health Check\n          </Button>\n          <Button\n            variant="outline"\n            onClick={runDataIntegrityCheck}\n            disabled={isRunningCheck}\n          >\n            {isRunningCheck ? (\n              <RefreshCw className="h-4 w-4 mr-2 animate-spin" />\n            ) : (\n              <Activity className="h-4 w-4 mr-2" />\n            )}\n            Data Integrity Check\n          </Button>\n        </CardContent>\n      </Card>\n\n      {/* Error Summary */}\n      <div className="grid gap-4 md:grid-cols-2">\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <AlertCircle className="h-5 w-5 text-destructive" />\n              Error Summary\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className="space-y-4">\n              <div className="flex justify-between items-center">\n                <span className="text-muted-foreground">Unresolved Errors</span>\n                <Badge variant={errorSummary?.total_unresolved ? \'destructive\' : \'secondary\'}>\n                  {errorSummary?.total_unresolved || 0}\n                </Badge>\n              </div>\n              <div className="flex justify-between items-center">\n                <span className="text-muted-foreground">Last 24 Hours</span>\n                <Badge variant="outline">{errorSummary?.last_24h_errors || 0}</Badge>\n              </div>\n              {errorSummary?.by_type && errorSummary.by_type.length > 0 && (\n                <div className="pt-2 border-t">\n                  <p className="text-sm font-medium mb-2">By Type:</p>\n                  <div className="flex flex-wrap gap-2">\n                    {errorSummary.by_type.map((item) => (\n                      <Badge key={item.type} variant="outline" className="text-xs">\n                        {item.type}: {item.count}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className="flex items-center gap-2">\n              <Clock className="h-5 w-5" />\n              Recent Health Checks\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className="h-[200px]">\n              {errorSummary?.recent_health_checks && errorSummary.recent_health_checks.length > 0 ? (\n                <div className="space-y-3">\n                  {errorSummary.recent_health_checks.map((check) => (\n                    <div\n                      key={check.id}\n                      className="flex items-center justify-between p-2 rounded bg-muted/50"\n                    >\n                      <div className="flex items-center gap-2">\n                        {check.status === \'completed\' ? (\n                          <CheckCircle className="h-4 w-4 text-green-500" />\n                        ) : (\n                          <RefreshCw className="h-4 w-4 animate-spin" />\n                        )}\n                        <span className="text-sm font-medium">{check.type}</span>\n                      </div>\n                      <div className="text-right">\n                        <p className="text-xs text-muted-foreground">\n                          Fixed: {check.issues_fixed}\n                        </p>\n                        <p className="text-xs text-muted-foreground">\n                          {new Date(check.completed_at).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className="text-sm text-muted-foreground text-center py-4">\n                  No recent health checks\n                </p>\n              )}\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      </div>\n\n        {/* Top Errors */}\n        {errorSummary?.top_errors && errorSummary.top_errors.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Top Unresolved Errors</CardTitle>\n              <CardDescription>Most frequently occurring errors</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className="h-[300px]">\n                <div className="space-y-3">\n                  {errorSummary.top_errors.map((error) => (\n                    <div\n                      key={error.id}\n                      className="p-3 rounded-lg border bg-card"\n                    >\n                      <div className="flex items-start justify-between gap-4">\n                        <div className="flex-1 min-w-0">\n                          <p className="text-sm font-medium truncate">{error.message}</p>\n                          {error.component && (\n                            <p className="text-xs text-muted-foreground mt-1">\n                              Component: {error.component}\n                            </p>\n                          )}\n                        </div>\n                        <div className="text-right shrink-0">\n                          <Badge variant="destructive">{error.count}x</Badge>\n                          <p className="text-xs text-muted-foreground mt-1">\n                            {new Date(error.last_seen).toLocaleString()}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            </CardContent>\n          </Card>\n        )}\n      </TabsContent>\n\n      <TabsContent value="trends">\n        <HealthTrendsDashboard />\n      </TabsContent>\n    </Tabs>\n  );\n}\n';export{e as default};
