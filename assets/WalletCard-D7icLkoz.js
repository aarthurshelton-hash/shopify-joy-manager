const e='import React, { useState, useEffect, useCallback } from \'react\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\nimport { Separator } from \'@/components/ui/separator\';\nimport { ScrollArea } from \'@/components/ui/scroll-area\';\nimport {\n  Wallet,\n  ArrowUpRight,\n  ArrowDownLeft,\n  Clock,\n  DollarSign,\n  TrendingUp,\n  ShoppingBag,\n  Loader2,\n  History,\n  Plus,\n  Banknote,\n} from \'lucide-react\';\nimport { \n  getUserWallet, \n  getWalletTransactions, \n  UserWallet,\n  WalletTransaction,\n  formatBalance,\n} from \'@/lib/marketplace/walletApi\';\nimport { getWithdrawableBalance } from \'@/lib/marketplace/withdrawalApi\';\nimport { formatDistanceToNow } from \'date-fns\';\nimport { WalletDepositModal } from \'./WalletDepositModal\';\nimport { WalletWithdrawModal } from \'./WalletWithdrawModal\';\nimport { useWalletRealtime } from \'@/hooks/useWalletRealtime\';\n\ninterface WalletCardProps {\n  compact?: boolean;\n}\n\nconst WalletCard: React.FC<WalletCardProps> = ({ compact = false }) => {\n  const [wallet, setWallet] = useState<UserWallet | null>(null);\n  const [transactions, setTransactions] = useState<WalletTransaction[]>([]);\n  const [withdrawableBalance, setWithdrawableBalance] = useState(0);\n  const [isLoading, setIsLoading] = useState(true);\n  const [showHistory, setShowHistory] = useState(false);\n  const [showDepositModal, setShowDepositModal] = useState(false);\n  const [showWithdrawModal, setShowWithdrawModal] = useState(false);\n\n  const loadWalletData = useCallback(async () => {\n    setIsLoading(true);\n    const [walletResult, transactionsResult, withdrawableResult] = await Promise.all([\n      getUserWallet(),\n      getWalletTransactions(20),\n      getWithdrawableBalance(),\n    ]);\n    \n    if (walletResult.data) {\n      setWallet(walletResult.data);\n    }\n    if (transactionsResult.data) {\n      setTransactions(transactionsResult.data);\n    }\n    setWithdrawableBalance(withdrawableResult.data);\n    setIsLoading(false);\n  }, []);\n\n  // Subscribe to real-time wallet updates\n  useWalletRealtime({\n    onWalletChange: (newWallet) => {\n      setWallet({\n        id: newWallet.id,\n        user_id: newWallet.user_id,\n        balance_cents: newWallet.balance_cents,\n        total_deposited_cents: newWallet.total_deposited_cents,\n        total_withdrawn_cents: newWallet.total_withdrawn_cents,\n        total_earned_cents: newWallet.total_earned_cents,\n        total_spent_cents: newWallet.total_spent_cents,\n        created_at: newWallet.created_at,\n        updated_at: newWallet.updated_at,\n      });\n      // Also refresh withdrawable balance when wallet changes\n      getWithdrawableBalance().then(result => {\n        setWithdrawableBalance(result.data);\n      });\n    },\n    onTransactionChange: () => {\n      // Reload transactions when new one arrives\n      getWalletTransactions(20).then(result => {\n        if (result.data) {\n          setTransactions(result.data);\n        }\n      });\n    },\n    enabled: true,\n  });\n\n  useEffect(() => {\n    loadWalletData();\n  }, [loadWalletData]);\n\n  const getTransactionIcon = (type: WalletTransaction[\'transaction_type\']) => {\n    switch (type) {\n      case \'deposit\':\n        return <ArrowDownLeft className="h-4 w-4 text-green-500" />;\n      case \'withdrawal\':\n        return <ArrowUpRight className="h-4 w-4 text-orange-500" />;\n      case \'sale\':\n        return <TrendingUp className="h-4 w-4 text-green-500" />;\n      case \'purchase\':\n        return <ShoppingBag className="h-4 w-4 text-blue-500" />;\n      case \'platform_fee\':\n        return <DollarSign className="h-4 w-4 text-muted-foreground" />;\n      default:\n        return <Clock className="h-4 w-4" />;\n    }\n  };\n\n  const getTransactionLabel = (type: WalletTransaction[\'transaction_type\']) => {\n    switch (type) {\n      case \'deposit\': return \'Deposit\';\n      case \'withdrawal\': return \'Withdrawal\';\n      case \'sale\': return \'Vision Sale\';\n      case \'purchase\': return \'Vision Purchase\';\n      case \'platform_fee\': return \'Platform Fee\';\n      default: return type;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className="flex items-center justify-center py-8">\n          <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (compact) {\n    return (\n      <>\n        <Card className="bg-gradient-to-br from-primary/10 via-background to-primary/5 border-primary/20">\n          <CardContent className="p-4">\n            <div className="flex items-center justify-between">\n              <div className="flex items-center gap-3">\n                <div className="h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center">\n                  <Wallet className="h-5 w-5 text-primary" />\n                </div>\n                <div>\n                  <p className="text-xs text-muted-foreground">Wallet Balance</p>\n                  <p className="text-2xl font-bold">{formatBalance(wallet?.balance_cents || 0)}</p>\n                </div>\n              </div>\n              <div className="flex gap-2">\n                <Button variant="outline" size="sm" onClick={() => setShowDepositModal(true)}>\n                  <Plus className="h-4 w-4" />\n                </Button>\n                <Button variant="outline" size="sm" onClick={() => setShowHistory(!showHistory)}>\n                  <History className="h-4 w-4" />\n                </Button>\n              </div>\n            </div>\n\n            {showHistory && transactions.length > 0 && (\n              <div className="mt-4 pt-4 border-t space-y-2">\n                {transactions.slice(0, 5).map((tx) => (\n                  <div key={tx.id} className="flex items-center justify-between text-sm">\n                    <div className="flex items-center gap-2">\n                      {getTransactionIcon(tx.transaction_type)}\n                      <span className="text-muted-foreground">{getTransactionLabel(tx.transaction_type)}</span>\n                    </div>\n                    <span className={tx.amount_cents >= 0 ? \'text-green-500\' : \'text-red-500\'}>\n                      {tx.amount_cents >= 0 ? \'+\' : \'\'}{formatBalance(tx.amount_cents)}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n        <WalletDepositModal open={showDepositModal} onOpenChange={setShowDepositModal} onSuccess={loadWalletData} />\n        <WalletWithdrawModal open={showWithdrawModal} onOpenChange={setShowWithdrawModal} onSuccess={loadWalletData} />\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Card>\n        <CardHeader className="flex flex-row items-center justify-between">\n          <CardTitle className="flex items-center gap-2">\n            <Wallet className="h-5 w-5" />\n            Platform Wallet\n          </CardTitle>\n          <div className="flex gap-2">\n            <Button variant="outline" size="sm" onClick={() => setShowDepositModal(true)}>\n              <Plus className="h-4 w-4 mr-1" />\n              Add Funds\n            </Button>\n            {withdrawableBalance > 0 && (\n              <Button variant="outline" size="sm" onClick={() => setShowWithdrawModal(true)}>\n                <Banknote className="h-4 w-4 mr-1" />\n                Withdraw\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent className="space-y-6">\n          {/* Balance Display */}\n          <div className="p-6 rounded-xl bg-gradient-to-br from-primary/20 via-primary/10 to-transparent border border-primary/20">\n            <p className="text-sm text-muted-foreground mb-1">Available Balance</p>\n            <p className="text-4xl font-bold">{formatBalance(wallet?.balance_cents || 0)}</p>\n            \n            <div className="grid grid-cols-3 gap-4 mt-4 pt-4 border-t border-primary/20">\n              <div>\n                <p className="text-xs text-muted-foreground">Total Earned</p>\n                <p className="text-lg font-semibold text-green-500">\n                  {formatBalance(wallet?.total_earned_cents || 0)}\n                </p>\n              </div>\n              <div>\n                <p className="text-xs text-muted-foreground">Withdrawable</p>\n                <p className="text-lg font-semibold text-emerald-500">\n                  {formatBalance(withdrawableBalance)}\n                </p>\n              </div>\n              <div>\n              <p className="text-xs text-muted-foreground">Total Spent</p>\n              <p className="text-lg font-semibold text-blue-500">\n                {formatBalance(wallet?.total_spent_cents || 0)}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Quick Stats */}\n        <div className="grid grid-cols-2 gap-3">\n          <div className="p-3 rounded-lg bg-muted/50">\n            <div className="flex items-center gap-2 text-green-500 mb-1">\n              <ArrowDownLeft className="h-4 w-4" />\n              <span className="text-xs">Deposited</span>\n            </div>\n            <p className="font-bold">{formatBalance(wallet?.total_deposited_cents || 0)}</p>\n          </div>\n          <div className="p-3 rounded-lg bg-muted/50">\n            <div className="flex items-center gap-2 text-orange-500 mb-1">\n              <ArrowUpRight className="h-4 w-4" />\n              <span className="text-xs">Withdrawn</span>\n            </div>\n            <p className="font-bold">{formatBalance(wallet?.total_withdrawn_cents || 0)}</p>\n          </div>\n        </div>\n\n          <Separator />\n\n          {/* Transaction History */}\n          <div>\n            <h4 className="text-sm font-medium mb-3 flex items-center gap-2">\n              <History className="h-4 w-4" />\n              Recent Transactions\n            </h4>\n            \n            {transactions.length === 0 ? (\n              <p className="text-sm text-muted-foreground text-center py-4">\n                No transactions yet\n              </p>\n            ) : (\n              <ScrollArea className="h-[200px]">\n                <div className="space-y-2">\n                  {transactions.map((tx) => (\n                    <div \n                      key={tx.id} \n                      className="flex items-center justify-between p-3 rounded-lg bg-muted/30 hover:bg-muted/50 transition-colors"\n                    >\n                      <div className="flex items-center gap-3">\n                        <div className="h-8 w-8 rounded-full bg-muted flex items-center justify-center">\n                          {getTransactionIcon(tx.transaction_type)}\n                        </div>\n                        <div>\n                          <p className="text-sm font-medium">{getTransactionLabel(tx.transaction_type)}</p>\n                          <p className="text-xs text-muted-foreground">\n                            {formatDistanceToNow(new Date(tx.created_at), { addSuffix: true })}\n                          </p>\n                        </div>\n                      </div>\n                      <div className="text-right">\n                        <p className={`font-bold ${tx.amount_cents >= 0 ? \'text-green-500\' : \'text-red-500\'}`}>\n                          {tx.amount_cents >= 0 ? \'+\' : \'\'}{formatBalance(tx.amount_cents)}\n                        </p>\n                        <p className="text-xs text-muted-foreground">\n                          Balance: {formatBalance(tx.balance_after_cents)}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            )}\n          </div>\n\n          {/* Security info */}\n          <div className="text-xs text-muted-foreground bg-muted/30 p-3 rounded-lg space-y-2">\n            <p className="font-medium">ðŸ’¡ How it works:</p>\n            <ul className="space-y-1">\n              <li>â€¢ <strong>Deposits:</strong> Add funds via Stripe to purchase visions</li>\n              <li>â€¢ <strong>Earnings:</strong> Sell visions to earn credits (95% of sale price)</li>\n              <li>â€¢ <strong>Withdrawals:</strong> Only earnings can be withdrawn (fraud protection)</li>\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n      \n      <WalletDepositModal open={showDepositModal} onOpenChange={setShowDepositModal} onSuccess={loadWalletData} />\n      <WalletWithdrawModal open={showWithdrawModal} onOpenChange={setShowWithdrawModal} onSuccess={loadWalletData} />\n    </>\n  );\n};\n\nexport default WalletCard;\n';export{e as default};
