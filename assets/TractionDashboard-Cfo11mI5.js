const e="import { useEffect, useState, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { supabase } from '@/integrations/supabase/client';\nimport { Activity, Eye, Scan, GitBranch, TrendingUp, Database, Target, Zap, Radio } from 'lucide-react';\nimport { useRealtimeAccuracyContext } from '@/providers/RealtimeAccuracyProvider';\n\ninterface TractionMetrics {\n  totalChessPatterns: number;\n  totalCodeAnalyses: number;\n  totalVisions: number;\n  totalScans: number;\n  totalViews: number;\n  weeklyGrowth: number;\n  uniqueOpenings: number;\n  activeUsers: number;\n}\n\nexport default function TractionDashboard() {\n  const { isConnected, updateCount } = useRealtimeAccuracyContext();\n  const [metrics, setMetrics] = useState<TractionMetrics>({\n    totalChessPatterns: 0,\n    totalCodeAnalyses: 0,\n    totalVisions: 0,\n    totalScans: 0,\n    totalViews: 0,\n    weeklyGrowth: 0,\n    uniqueOpenings: 0,\n    activeUsers: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [lastRefresh, setLastRefresh] = useState<Date>(new Date());\n\n  const fetchMetrics = useCallback(async () => {\n    try {\n      // Fetch real data from various tables\n      const [\n        patternsRes,\n        codeRes,\n        visionsRes,\n        scansRes,\n        openingsRes,\n        usersRes,\n      ] = await Promise.all([\n        supabase.from('color_flow_patterns').select('id', { count: 'exact', head: true }),\n        supabase.from('code_repository_patterns').select('id', { count: 'exact', head: true }),\n        supabase.from('saved_visualizations').select('id', { count: 'exact', head: true }),\n        supabase.from('scan_history').select('id', { count: 'exact', head: true }),\n        supabase.from('opening_value_pool').select('id', { count: 'exact', head: true }),\n        supabase.from('profiles').select('id', { count: 'exact', head: true }),\n      ]);\n\n      // Get aggregated views from vision_scores\n      const viewsRes = await supabase\n        .from('vision_scores')\n        .select('view_count, scan_count');\n      \n      const totalViews = viewsRes.data?.reduce((acc, v) => acc + (v.view_count || 0), 0) || 0;\n      const totalScansFromScores = viewsRes.data?.reduce((acc, v) => acc + (v.scan_count || 0), 0) || 0;\n\n      setMetrics({\n        totalChessPatterns: patternsRes.count || 0,\n        totalCodeAnalyses: codeRes.count || 0,\n        totalVisions: visionsRes.count || 0,\n        totalScans: (scansRes.count || 0) + totalScansFromScores,\n        totalViews: totalViews,\n        weeklyGrowth: 23, // Placeholder - would calculate from time-series\n        uniqueOpenings: openingsRes.count || 0,\n        activeUsers: usersRes.count || 0,\n      });\n      setLastRefresh(new Date());\n    } catch (error) {\n      console.error('Error fetching traction metrics:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Initial fetch\n  useEffect(() => {\n    fetchMetrics();\n  }, [fetchMetrics]);\n\n  // Re-fetch when realtime updates occur\n  useEffect(() => {\n    if (updateCount > 0) {\n      fetchMetrics();\n    }\n  }, [updateCount, fetchMetrics]);\n\n  // Set up realtime subscriptions for investor-relevant tables\n  useEffect(() => {\n    const channel = supabase\n      .channel('investor-traction-metrics')\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'saved_visualizations' }, () => fetchMetrics())\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'color_flow_patterns' }, () => fetchMetrics())\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'code_repository_patterns' }, () => fetchMetrics())\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'scan_history' }, () => fetchMetrics())\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'profiles' }, () => fetchMetrics())\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [fetchMetrics]);\n\n  const metricCards = [\n    {\n      title: 'Chess Patterns Analyzed',\n      value: metrics.totalChessPatterns,\n      icon: <Target className=\"h-5 w-5\" />,\n      color: 'text-amber-500',\n      bgColor: 'bg-amber-500/10',\n      description: 'Unique game signatures extracted',\n    },\n    {\n      title: 'Code Repos Analyzed',\n      value: metrics.totalCodeAnalyses,\n      icon: <GitBranch className=\"h-5 w-5\" />,\n      color: 'text-blue-500',\n      bgColor: 'bg-blue-500/10',\n      description: 'GitHub repositories processed',\n    },\n    {\n      title: 'Visions Created',\n      value: metrics.totalVisions,\n      icon: <Eye className=\"h-5 w-5\" />,\n      color: 'text-purple-500',\n      bgColor: 'bg-purple-500/10',\n      description: 'Visual pattern artworks generated',\n    },\n    {\n      title: 'Pattern Scans',\n      value: metrics.totalScans,\n      icon: <Scan className=\"h-5 w-5\" />,\n      color: 'text-green-500',\n      bgColor: 'bg-green-500/10',\n      description: 'Real-world scans performed',\n    },\n    {\n      title: 'Total Views',\n      value: metrics.totalViews,\n      icon: <Activity className=\"h-5 w-5\" />,\n      color: 'text-pink-500',\n      bgColor: 'bg-pink-500/10',\n      description: 'Pattern visualizations viewed',\n    },\n    {\n      title: 'Registered Users',\n      value: metrics.activeUsers,\n      icon: <Database className=\"h-5 w-5\" />,\n      color: 'text-cyan-500',\n      bgColor: 'bg-cyan-500/10',\n      description: 'Platform accounts created',\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Live Status Indicator */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-500 animate-pulse' : 'bg-muted'}`} />\n          <span className=\"text-xs text-muted-foreground\">\n            {isConnected ? 'Live data synchronized' : 'Connecting...'}\n          </span>\n        </div>\n        <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n          <Radio className=\"h-3 w-3\" />\n          Updated {lastRefresh.toLocaleTimeString()}\n        </Badge>\n      </div>\n\n      {/* Main Metrics Grid */}\n      <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n        {metricCards.map((metric, index) => (\n          <motion.div\n            key={metric.title}\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: index * 0.1 }}\n          >\n            <Card className=\"h-full\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div className={`p-2 rounded-lg ${metric.bgColor} ${metric.color}`}>\n                    {metric.icon}\n                  </div>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-muted animate-pulse rounded\" />\n                  ) : (\n                    <span className=\"text-2xl font-bold\">\n                      {metric.value.toLocaleString()}\n                    </span>\n                  )}\n                </div>\n                <h3 className=\"font-medium text-sm\">{metric.title}</h3>\n                <p className=\"text-xs text-muted-foreground\">{metric.description}</p>\n              </CardContent>\n            </Card>\n          </motion.div>\n        ))}\n      </div>\n\n      {/* Growth Indicator */}\n      <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"p-3 rounded-full bg-primary/20\">\n                <TrendingUp className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-lg\">Combined Pattern Recognition</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Total patterns analyzed across chess + code domains\n                </p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              {loading ? (\n                <div className=\"h-10 w-24 bg-muted animate-pulse rounded\" />\n              ) : (\n                <>\n                  <p className=\"text-3xl font-bold text-primary\">\n                    {(metrics.totalChessPatterns + metrics.totalCodeAnalyses + metrics.totalVisions).toLocaleString()}\n                  </p>\n                  <Badge variant=\"secondary\" className=\"mt-1\">\n                    <Zap className=\"h-3 w-3 mr-1\" />\n                    2 domains live\n                  </Badge>\n                </>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Data Flywheel Visualization */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">The Data Flywheel Effect</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center gap-4 flex-wrap\">\n            <FlywheelStep step={1} label=\"More Users\" />\n            <Arrow />\n            <FlywheelStep step={2} label=\"More Patterns\" />\n            <Arrow />\n            <FlywheelStep step={3} label=\"Better Predictions\" />\n            <Arrow />\n            <FlywheelStep step={4} label=\"More Value\" />\n            <Arrow />\n            <span className=\"text-primary font-bold\">↻ Repeat</span>\n          </div>\n          <p className=\"text-center text-sm text-muted-foreground mt-4\">\n            Every analysis makes the system smarter—creating an unbeatable data moat\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction FlywheelStep({ step, label }: { step: number; label: string }) {\n  return (\n    <div className=\"text-center\">\n      <div className=\"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center font-bold mx-auto mb-1\">\n        {step}\n      </div>\n      <p className=\"text-xs font-medium\">{label}</p>\n    </div>\n  );\n}\n\nfunction Arrow() {\n  return <span className=\"text-muted-foreground hidden sm:inline\">→</span>;\n}\n";export{e as default};
