const n="/**\n * Narrative & Mythic Structure Adapter\n * \n * Human meaning-making through story. Plot archetypes, hero's journey,\n * narrative tension, and mythic patterns as temporal sequences.\n * \n * For Alec Arthur Shelton - The Artist\n * Stories are how humans understand time itself.\n */\n\nimport type { DomainAdapter, UniversalSignal, DomainSignature } from '../types';\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// JOSEPH CAMPBELL'S HERO'S JOURNEY (Real Mythic Structure)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nconst HEROS_JOURNEY = {\n  // Act I: Departure\n  ordinaryWorld: {\n    stage: 1,\n    narrativeFunction: 'Establish baseline, show hero in normal context',\n    temporalPosition: 0.0, // 0-1 through story\n    emotionalValence: 1, // 1-10 scale\n    marketAnalogy: 'Market in equilibrium, no trend established'\n  },\n  callToAdventure: {\n    stage: 2,\n    narrativeFunction: 'Disruption enters, hero receives challenge',\n    temporalPosition: 0.08,\n    emotionalValence: 4,\n    marketAnalogy: 'First breakout, trend emergence'\n  },\n  refusalOfCall: {\n    stage: 3,\n    narrativeFunction: 'Hero hesitates, fear of change',\n    temporalPosition: 0.12,\n    emotionalValence: 2,\n    marketAnalogy: 'False breakout, pullback, trader hesitation'\n  },\n  meetingMentor: {\n    stage: 4,\n    narrativeFunction: 'Guidance received, preparation begins',\n    temporalPosition: 0.15,\n    emotionalValence: 3,\n    marketAnalogy: 'Institutional accumulation, smart money entry'\n  },\n  crossingThreshold: {\n    stage: 5,\n    narrativeFunction: 'Point of no return, commitment made',\n    temporalPosition: 0.20,\n    emotionalValence: 6,\n    marketAnalogy: 'Break of structure, trend confirmed'\n  },\n  \n  // Act II: Initiation\n  testsAlliesEnemies: {\n    stage: 6,\n    narrativeFunction: 'Challenges faced, alliances formed',\n    temporalPosition: 0.35,\n    emotionalValence: 5,\n    marketAnalogy: 'Trend continuation with pullbacks, support tests'\n  },\n  approachInmostCave: {\n    stage: 7,\n    narrativeFunction: 'Preparation for supreme ordeal',\n    temporalPosition: 0.50,\n    emotionalValence: 4,\n    marketAnalogy: 'Consolidation before major move, volatility compression'\n  },\n  ordeal: {\n    stage: 8,\n    narrativeFunction: 'Death and rebirth, central crisis',\n    temporalPosition: 0.65,\n    emotionalValence: 9,\n    marketAnalogy: 'Maximum volatility, stop hunts, liquidation cascade'\n  },\n  reward: {\n    stage: 9,\n    narrativeFunction: 'Seizing the sword, victory achieved',\n    temporalPosition: 0.75,\n    emotionalValence: 8,\n    marketAnalogy: 'Breakout to new highs, profit taking zone'\n  },\n  \n  // Act III: Return\n  roadBack: {\n    stage: 10,\n    narrativeFunction: 'Journey home begins, consequences faced',\n    temporalPosition: 0.85,\n    emotionalValence: 5,\n    marketAnalogy: 'Trend exhaustion, distribution begins'\n  },\n  resurrection: {\n    stage: 11,\n    narrativeFunction: 'Final test, transformation complete',\n    temporalPosition: 0.92,\n    emotionalValence: 7,\n    marketAnalogy: 'Final push, bull trap or bear rally'\n  },\n  returnWithElixir: {\n    stage: 12,\n    narrativeFunction: 'Return to ordinary world, changed',\n    temporalPosition: 1.0,\n    emotionalValence: 6,\n    marketAnalogy: 'New equilibrium established, cycle complete'\n  }\n};\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// KURT VONNEGUT'S SHAPES OF STORIES (Real Narrative Archetypes)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nconst STORY_SHAPES = {\n  // Man in Hole: Fall then rise (Cinderella)\n  manInHole: {\n    curve: 'valley_then_peak',\n    emotionalTrajectory: [5, 4, 3, 2, 3, 4, 5, 6, 7],\n    examples: ['Cinderella', 'Wall-E', 'The Godfather'],\n    marketAnalogy: 'Market crash and recovery'\n  },\n  \n  // Boy Meets Girl: Rise, fall, rise (romance arc)\n  boyMeetsGirl: {\n    curve: 'rise_fall_rise',\n    emotionalTrajectory: [5, 6, 7, 8, 4, 3, 4, 7, 8],\n    examples: ['Pride and Prejudice', 'When Harry Met Sally'],\n    marketAnalogy: 'M&A announcement, regulatory denial, eventual approval'\n  },\n  \n  // From Bad to Worse: Steady decline (tragedy)\n  fromBadToWorse: {\n    curve: 'monotonic_decline',\n    emotionalTrajectory: [5, 4, 3, 2, 1, 0],\n    examples: ['1984', 'Breaking Bad', 'Madame Bovary'],\n    marketAnalogy: 'Death spiral, company bankruptcy'\n  },\n  \n  // Which Way Is Up?: Chaos/no clear arc (postmodern)\n  whichWayIsUp: {\n    curve: 'stochastic_walk',\n    emotionalTrajectory: 'random',\n    examples: ['Catch-22', 'Alice in Wonderland'],\n    marketAnalogy: 'Choppy sideways market, no trend'\n  },\n  \n  // Creation Story: Rise from nothing\n  creationStory: {\n    curve: 'monotonic_rise',\n    emotionalTrajectory: [1, 2, 3, 4, 5, 6, 7, 8],\n    examples: ['The Social Network', 'Startup narratives'],\n    marketAnalogy: 'IPO trajectory, unicorn growth'\n  },\n  \n  // Old Testament: High then fall (hubris)\n  oldTestament: {\n    curve: 'peak_then_valley',\n    emotionalTrajectory: [5, 6, 7, 8, 7, 5, 3, 2],\n    examples: ['Adam and Eve', 'Icarus', 'Macbeth'],\n    marketAnalogy: 'Pump and dump, hype cycle crash'\n  },\n  \n  // New Testament: Sacrifice and redemption\n  newTestament: {\n    curve: 'sacrificial_resurrection',\n    emotionalTrajectory: [5, 6, 7, 8, 9, 0, 1, 10],\n    examples: ['Life of Christ', 'Les Miserables'],\n    marketAnalogy: 'Company turnaround, bankruptcy to profitability'\n  }\n};\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// NARRATIVE TENSION MECHANICS\n// ═══════════════════════════════════════════════════════════════════════════════\n\nconst NARRATIVE_MECHANICS = {\n  dramaticIrony: {\n    definition: 'Audience knows more than characters',\n    temporalEffect: 'Creates suspense through information asymmetry',\n    marketAnalogy: 'Insider knowledge vs public information'\n  },\n  \n  foreshadowing: {\n    definition: 'Early hints of later events',\n    temporalEffect: 'Creates coherence in temporal sequence',\n    marketAnalogy: 'Technical analysis, leading indicators'\n  },\n  \n  flashback: {\n    definition: 'Non-linear temporal presentation',\n    temporalEffect: 'Reveals causality backwards',\n    marketAnalogy: 'Historical pattern recognition'\n  },\n  \n  cliffhanger: {\n    definition: 'Suspense at chapter/scene end',\n    temporalEffect: 'Forces continued attention',\n    marketAnalogy: 'Options expiration, earnings announcements'\n  },\n  \n  tickingClock: {\n    definition: 'Time pressure narrative device',\n    temporalEffect: 'Accelerates perceived tempo',\n    marketAnalogy: 'Expiration dates, margin calls'\n  },\n  \n  dramaticQuestion: {\n    definition: 'Central unresolved query',\n    temporalEffect: 'Drives narrative momentum',\n    marketAnalogy: 'Will Fed hike? Will merger close?'\n  }\n};\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MYTHIC ARCHETYPES (Carl Jung + Joseph Campbell)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nconst ARCHETYPES = {\n  hero: {\n    narrativeRole: 'Central protagonist facing challenge',\n    temporalPattern: 'growth_through_adversity',\n    marketRepresentation: 'Breakout stock defying market'\n  },\n  mentor: {\n    narrativeRole: 'Wise guide providing knowledge',\n    temporalPattern: 'intermittent_appearance',\n    marketRepresentation: 'Institutional smart money'\n  },\n  thresholdGuardian: {\n    narrativeRole: 'Tests hero before advancement',\n    temporalPattern: 'appears_at_transitions',\n    marketRepresentation: 'Resistance levels, technical barriers'\n  },\n  herald: {\n    narrativeRole: 'Announces coming change',\n    temporalPattern: 'precursor_signal',\n    marketRepresentation: 'Leading indicators, early warnings'\n  },\n  shapeshifter: {\n    narrativeRole: 'Uncertainty, ally or enemy unclear',\n    temporalPattern: 'ambiguous_alignment',\n    marketRepresentation: 'Volatile stocks, uncertain trends'\n  },\n  shadow: {\n    narrativeRole: 'Antagonist, hero\\'s dark mirror',\n    temporalPattern: 'opposition_and_conflict',\n    marketRepresentation: 'Short sellers, market crash'\n  },\n  trickster: {\n    narrativeRole: 'Chaos, comic relief, change agent',\n    temporalPattern: 'disruptive_interruption',\n    marketRepresentation: 'Meme stocks, retail traders'\n  }\n};\n\ninterface StoryEvent {\n  timestamp: number;\n  storyPosition: number; // 0-1 through narrative\n  herosJourneyStage: keyof typeof HEROS_JOURNEY;\n  storyShape: keyof typeof STORY_SHAPES;\n  emotionalIntensity: number; // 0-10\n  tension: number; // 0-10\n  activeArchetype: keyof typeof ARCHETYPES;\n  dramaticQuestion: string;\n  foreshadowingElements: string[];\n  hasTickingClock: boolean;\n}\n\nclass NarrativeAdapter implements DomainAdapter<StoryEvent> {\n  domain = 'soul' as const;\n  name = 'Narrative & Mythic Structure';\n  isActive = false;\n  lastUpdate = 0;\n  \n  private signalBuffer: UniversalSignal[] = [];\n  private readonly BUFFER_SIZE = 1000;\n  \n  async initialize(): Promise<void> {\n    this.isActive = true;\n    this.lastUpdate = Date.now();\n    console.log('[NarrativeAdapter] Initialized - Story patterns flowing');\n  }\n  \n  processRawData(event: StoryEvent): UniversalSignal {\n    const { timestamp, storyPosition, emotionalIntensity, tension } = event;\n    \n    // Frequency encodes narrative position (beginning = higher, end = lower)\n    const frequency = 1 - storyPosition;\n    \n    // Intensity = emotional intensity × tension\n    const intensity = (emotionalIntensity / 10) * (tension / 10);\n    \n    // Phase encodes hero's journey stage progress\n    const journeyStage = HEROS_JOURNEY[event.herosJourneyStage].stage;\n    const phase = (journeyStage / 12) * Math.PI * 2;\n    \n    const harmonics = [\n      emotionalIntensity / 10,\n      tension / 10,\n      storyPosition,\n      event.hasTickingClock ? 0.9 : 0.1,\n      journeyStage / 12,\n      Object.keys(ARCHETYPES).indexOf(event.activeArchetype) / 7\n    ];\n    \n    const signal: UniversalSignal = {\n      domain: 'soul',\n      timestamp,\n      intensity,\n      frequency,\n      phase,\n      harmonics,\n      rawData: [emotionalIntensity, tension, storyPosition, journeyStage]\n    };\n    \n    this.signalBuffer.push(signal);\n    if (this.signalBuffer.length > this.BUFFER_SIZE) {\n      this.signalBuffer.shift();\n    }\n    \n    this.lastUpdate = timestamp;\n    return signal;\n  }\n  \n  extractSignature(signals: UniversalSignal[]): DomainSignature {\n    if (signals.length === 0) {\n      return this.getDefaultSignature();\n    }\n    \n    const recent = signals.slice(-100);\n    \n    const avgEmotion = recent.reduce((sum, s) => sum + s.rawData[0], 0) / recent.length;\n    const avgTension = recent.reduce((sum, s) => sum + s.rawData[1], 0) / recent.length;\n    const avgPosition = recent.reduce((sum, s) => sum + s.rawData[2], 0) / recent.length;\n    const avgStage = recent.reduce((sum, s) => sum + s.rawData[3], 0) / recent.length;\n    \n    // Quadrant = narrative dynamics\n    const quadrantProfile = {\n      aggressive: avgTension > 7 ? 0.8 : 0.2, // High tension = conflict\n      defensive: avgEmotion < 4 ? 0.7 : 0.1, // Low emotion = exposition\n      tactical: avgPosition > 0.3 && avgPosition < 0.7 ? 0.6 : 0.2, // Middle = development\n      strategic: avgStage > 8 ? 0.8 : 0.3 // Late stages = resolution\n    };\n    \n    // Temporal flow through hero's journey\n    const temporalFlow = {\n      early: avgStage < 5 ? 1 - (avgStage / 5) : 0.1,\n      mid: avgStage >= 5 && avgStage <= 9 ? 0.7 : 0.2,\n      late: avgStage > 9 ? (avgStage - 9) / 3 : 0.1\n    };\n    \n    return {\n      domain: 'soul',\n      quadrantProfile,\n      temporalFlow,\n      intensity: (avgEmotion / 10) * (avgTension / 10),\n      momentum: avgPosition > 0.5 ? 1 : -1,\n      volatility: avgTension / 10,\n      dominantFrequency: 1 - avgPosition,\n      harmonicResonance: 1 - (avgTension / 10),\n      phaseAlignment: avgStage / 12,\n      extractedAt: Date.now()\n    };\n  }\n  \n  private getDefaultSignature(): DomainSignature {\n    return {\n      domain: 'soul',\n      quadrantProfile: { aggressive: 0.25, defensive: 0.25, tactical: 0.25, strategic: 0.25 },\n      temporalFlow: { early: 0.4, mid: 0.3, late: 0.3 },\n      intensity: 0.5,\n      momentum: 0,\n      volatility: 0.5,\n      dominantFrequency: 0.5,\n      harmonicResonance: 0.5,\n      phaseAlignment: 0.5,\n      extractedAt: Date.now()\n    };\n  }\n  \n  // Identify which story shape matches a series of events\n  identifyStoryShape(emotionalTrajectory: number[]): keyof typeof STORY_SHAPES | 'unknown' {\n    const shapes = Object.entries(STORY_SHAPES);\n    let bestMatch: keyof typeof STORY_SHAPES | 'unknown' = 'unknown';\n    let bestScore = -1;\n    \n    for (const [shapeName, shape] of shapes) {\n      if (shape.emotionalTrajectory === 'random') continue;\n      \n      const shapeArr = shape.emotionalTrajectory as number[];\n      if (shapeArr.length !== emotionalTrajectory.length) continue;\n      \n      const correlation = this.calculateCorrelation(emotionalTrajectory, shapeArr);\n      if (correlation > bestScore) {\n        bestScore = correlation;\n        bestMatch = shapeName as keyof typeof STORY_SHAPES;\n      }\n    }\n    \n    return bestScore > 0.7 ? bestMatch : 'unknown';\n  }\n  \n  private calculateCorrelation(a: number[], b: number[]): number {\n    const n = a.length;\n    const sumA = a.reduce((s, v) => s + v, 0);\n    const sumB = b.reduce((s, v) => s + v, 0);\n    const sumAB = a.reduce((s, v, i) => s + v * b[i], 0);\n    const sumA2 = a.reduce((s, v) => s + v * v, 0);\n    const sumB2 = b.reduce((s, v) => s + v * v, 0);\n    \n    const numerator = n * sumAB - sumA * sumB;\n    const denominator = Math.sqrt((n * sumA2 - sumA * sumA) * (n * sumB2 - sumB * sumB));\n    \n    return denominator === 0 ? 0 : numerator / denominator;\n  }\n  \n  // Map market price action to narrative structure\n  mapMarketToNarrative(prices: number[]): {\n    shape: keyof typeof STORY_SHAPES | 'unknown';\n    journeyStage: keyof typeof HEROS_JOURNEY;\n    dramaticQuestion: string;\n  } {\n    // Normalize prices to 0-10 emotional scale\n    const min = Math.min(...prices);\n    const max = Math.max(...prices);\n    const normalized = prices.map(p => ((p - min) / (max - min || 1)) * 10);\n    \n    const shape = this.identifyStoryShape(normalized);\n    \n    // Determine journey stage based on position in series\n    const position = 0.5; // Simplified - would need full series analysis\n    const stageIndex = Math.floor(position * 12);\n    const stageNames = Object.keys(HEROS_JOURNEY) as (keyof typeof HEROS_JOURNEY)[];\n    const journeyStage = stageNames[Math.min(stageIndex, 11)];\n    \n    const dramaticQuestion = normalized[normalized.length - 1] > normalized[0] \n      ? 'Will the uptrend continue?'\n      : 'Will the downtrend reverse?';\n    \n    return { shape: shape || 'whichWayIsUp', journeyStage, dramaticQuestion };\n  }\n}\n\nexport const narrativeAdapter = new NarrativeAdapter();\nexport { HEROS_JOURNEY, STORY_SHAPES, NARRATIVE_MECHANICS, ARCHETYPES };\nexport type { StoryEvent };\n";export{n as default};
