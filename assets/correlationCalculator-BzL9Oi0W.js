const n="/**\n * Correlation Calculator Module\n */\n\nimport { MarketTick, MarketCorrelation, AssetClass, KNOWN_CORRELATIONS } from './types';\n\nexport function calculateCorrelation(history1: MarketTick[], history2: MarketTick[]): number {\n  const len = Math.min(history1.length, history2.length, 50);\n  if (len < 5) return 0;\n\n  const changes1 = history1.slice(-len).map(t => t.changePercent);\n  const changes2 = history2.slice(-len).map(t => t.changePercent);\n\n  const mean1 = changes1.reduce((a, b) => a + b, 0) / len;\n  const mean2 = changes2.reduce((a, b) => a + b, 0) / len;\n\n  let numerator = 0;\n  let denom1 = 0;\n  let denom2 = 0;\n\n  for (let i = 0; i < len; i++) {\n    const d1 = changes1[i] - mean1;\n    const d2 = changes2[i] - mean2;\n    numerator += d1 * d2;\n    denom1 += d1 * d1;\n    denom2 += d2 * d2;\n  }\n\n  const denom = Math.sqrt(denom1 * denom2);\n  return denom === 0 ? 0 : numerator / denom;\n}\n\nexport function calculateLaggedCorrelation(h1: MarketTick[], h2: MarketTick[], lag: number): number {\n  const len = Math.min(h1.length, h2.length) - Math.abs(lag) - 1;\n  if (len < 5) return 0;\n\n  const c1 = lag >= 0 \n    ? h1.slice(lag, lag + len).map(t => t.changePercent)\n    : h1.slice(0, len).map(t => t.changePercent);\n  const c2 = lag >= 0\n    ? h2.slice(0, len).map(t => t.changePercent)\n    : h2.slice(-lag, -lag + len).map(t => t.changePercent);\n\n  if (c1.length !== c2.length || c1.length === 0) return 0;\n\n  const mean1 = c1.reduce((a, b) => a + b, 0) / c1.length;\n  const mean2 = c2.reduce((a, b) => a + b, 0) / c2.length;\n\n  let num = 0, d1 = 0, d2 = 0;\n  for (let i = 0; i < c1.length; i++) {\n    const diff1 = c1[i] - mean1;\n    const diff2 = c2[i] - mean2;\n    num += diff1 * diff2;\n    d1 += diff1 * diff1;\n    d2 += diff2 * diff2;\n  }\n\n  const denom = Math.sqrt(d1 * d2);\n  return denom === 0 ? 0 : num / denom;\n}\n\nexport function detectLag(history1: MarketTick[], history2: MarketTick[]): number {\n  const len = Math.min(history1.length, history2.length, 20);\n  if (len < 10) return 0;\n\n  let maxCorr = 0;\n  let bestLag = 0;\n\n  for (let lag = -5; lag <= 5; lag++) {\n    const corr = calculateLaggedCorrelation(history1, history2, lag);\n    if (Math.abs(corr) > Math.abs(maxCorr)) {\n      maxCorr = corr;\n      bestLag = lag;\n    }\n  }\n\n  return bestLag;\n}\n\nexport function updateCorrelations(tickHistory: Map<AssetClass, MarketTick[]>): MarketCorrelation[] {\n  const correlations: MarketCorrelation[] = [];\n\n  KNOWN_CORRELATIONS.forEach(({ markets, typicalCorrelation }) => {\n    const [m1, m2] = markets;\n    const history1 = tickHistory.get(m1) || [];\n    const history2 = tickHistory.get(m2) || [];\n\n    if (history1.length > 10 && history2.length > 10) {\n      const actualCorrelation = calculateCorrelation(history1, history2);\n      const deviation = Math.abs(actualCorrelation - typicalCorrelation);\n      \n      correlations.push({\n        market1: m1,\n        market2: m2,\n        correlation: actualCorrelation,\n        lag: detectLag(history1, history2),\n        strength: 1 - Math.min(deviation, 1),\n        isInverted: actualCorrelation < 0\n      });\n    }\n  });\n\n  return correlations;\n}\n";export{n as default};
