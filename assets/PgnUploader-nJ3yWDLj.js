const e='import React, { useState, useCallback, useMemo, useRef, useEffect } from \'react\';\nimport { Button } from \'@/components/ui/button\';\nimport { Textarea } from \'@/components/ui/textarea\';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \'@/components/ui/tabs\';\nimport { Upload, FileText, Crown, Sparkles, CheckCircle, XCircle, Loader2, Wrench, ArrowRight, ChevronLeft, ChevronRight, Search, X, Shuffle, Heart, Award, PenTool, Trophy, Star, Grid3X3 } from \'lucide-react\';\nimport uploadHeroArt from \'@/assets/hero-chess-art.jpg\';\nimport { famousGames, carlsenLegendaryGames, FamousGame, getRandomFamousGame } from \'@/lib/chess/famousGames\';\nimport { gameImageImports } from \'@/lib/chess/gameImages\';\nimport { getPoetryPreview, getPoetryStyleLabel } from \'@/lib/chess/gamePoetry\';\nimport { validatePgn, cleanPgn, PgnValidationResult } from \'@/lib/chess/pgnValidator\';\nimport { fixPgn, PgnFixResult } from \'@/lib/chess/pgnFixer\';\nimport { detectGameCard } from \'@/lib/chess/gameCardDetection\';\nimport { detectEmergingGame, formatSignificanceDisplay, EmergingGameSignificance } from \'@/lib/chess/emergingGameDetection\';\nimport { toast } from \'sonner\';\nimport { useFavoriteGames } from \'@/hooks/useFavoriteGames\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { incrementGamecardUsage } from \'@/lib/analytics/financialTrends\';\nimport FenInput from \'./FenInput\';\n\nconst GAMES_PER_MOBILE_PAGE = 4;\nconst GAMES_PER_DESKTOP_PAGE = 16;\n\ninterface PgnUploaderProps {\n  onPgnSubmit: (pgn: string, gameTitle?: string) => void;\n  onFenSubmit?: (fen: string, title?: string) => void;\n}\n\n// Custom hook for touch swipe detection\nconst useSwipe = (onSwipeLeft: () => void, onSwipeRight: () => void) => {\n  const touchStartX = useRef<number | null>(null);\n  const touchEndX = useRef<number | null>(null);\n  const minSwipeDistance = 50;\n\n  const onTouchStart = (e: React.TouchEvent) => {\n    touchEndX.current = null;\n    touchStartX.current = e.targetTouches[0].clientX;\n  };\n\n  const onTouchMove = (e: React.TouchEvent) => {\n    touchEndX.current = e.targetTouches[0].clientX;\n  };\n\n  const onTouchEnd = () => {\n    if (!touchStartX.current || !touchEndX.current) return;\n    \n    const distance = touchStartX.current - touchEndX.current;\n    const isLeftSwipe = distance > minSwipeDistance;\n    const isRightSwipe = distance < -minSwipeDistance;\n    \n    if (isLeftSwipe) {\n      onSwipeLeft();\n    } else if (isRightSwipe) {\n      onSwipeRight();\n    }\n    \n    touchStartX.current = null;\n    touchEndX.current = null;\n  };\n\n  return { onTouchStart, onTouchMove, onTouchEnd };\n};\n\nconst PgnUploader: React.FC<PgnUploaderProps> = ({ onPgnSubmit, onFenSubmit }) => {\n  const [inputMode, setInputMode] = useState<\'pgn\' | \'fen\'>(\'pgn\');\n  const [pgn, setPgn] = useState(\'\');\n  const [isDragging, setIsDragging] = useState(false);\n  const [selectedGame, setSelectedGame] = useState<FamousGame | null>(null);\n  const [validation, setValidation] = useState<PgnValidationResult | null>(null);\n  const [isValidating, setIsValidating] = useState(false);\n  const [fixResult, setFixResult] = useState<PgnFixResult | null>(null);\n  const [isFixing, setIsFixing] = useState(false);\n  const [pageIndex, setPageIndex] = useState(0);\n  const [isMobile, setIsMobile] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\'\');\n  const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const gamesContainerRef = useRef<HTMLDivElement>(null);\n  \n  const { isFavorite, toggleFavorite, isAuthenticated } = useFavoriteGames();\n  \n  // Check if mobile on mount and resize\n  useEffect(() => {\n    const checkMobile = () => setIsMobile(window.innerWidth < 640);\n    checkMobile();\n    window.addEventListener(\'resize\', checkMobile, { passive: true });\n    return () => window.removeEventListener(\'resize\', checkMobile);\n  }, []);\n  \n  // Combine all games including Carlsen collection and sort by year\n  const sortedGames = useMemo(() => {\n    const allGames = [...famousGames, ...carlsenLegendaryGames];\n    return allGames.sort((a, b) => {\n      if (a.year !== b.year) {\n        return a.year - b.year;\n      }\n      return a.title.localeCompare(b.title);\n    });\n  }, []);\n  \n  // Filter games by search query and favorites\n  const filteredGames = useMemo(() => {\n    let games = sortedGames;\n    \n    // Filter by favorites first if enabled\n    if (showFavoritesOnly) {\n      games = games.filter(game => isFavorite(game.id));\n    }\n    \n    // Then filter by search query\n    if (searchQuery.trim()) {\n      const query = searchQuery.toLowerCase();\n      games = games.filter(game => \n        game.title.toLowerCase().includes(query) || \n        game.year.toString().includes(query)\n      );\n    }\n    \n    return games;\n  }, [sortedGames, searchQuery, showFavoritesOnly, isFavorite]);\n  \n  const gamesPerPage = isMobile ? GAMES_PER_MOBILE_PAGE : GAMES_PER_DESKTOP_PAGE;\n  const totalPages = useMemo(() => Math.ceil(filteredGames.length / gamesPerPage), [filteredGames.length, gamesPerPage]);\n  \n  const handleValidate = useCallback(() => {\n    if (!pgn.trim()) {\n      toast.error(\'No PGN to validate\', {\n        description: \'Please enter or upload a PGN first.\',\n      });\n      return;\n    }\n\n    setIsValidating(true);\n    setFixResult(null);\n    \n    setTimeout(() => {\n      const cleanedPgn = cleanPgn(pgn);\n      const result = validatePgn(cleanedPgn);\n      setValidation(result);\n      setIsValidating(false);\n\n      if (result.isValid) {\n        toast.success(\'PGN is valid!\', {\n          description: `${result.moveCount} moves detected.`,\n        });\n      } else {\n        // Automatically try to fix the PGN\n        setIsFixing(true);\n        setTimeout(() => {\n          const fix = fixPgn(cleanedPgn);\n          setFixResult(fix);\n          setIsFixing(false);\n          \n          if (fix.canFix && fix.suggestions.length > 0) {\n            toast.info(\'Fix suggestions available\', {\n              description: `Found ${fix.suggestions.length} issue(s) that can be corrected.`,\n              duration: 5000,\n            });\n          } else if (!fix.canFix) {\n            toast.error(\'Cannot auto-fix this PGN\', {\n              description: fix.originalError,\n              duration: 6000,\n            });\n          }\n        }, 50);\n      }\n    }, 50);\n  }, [pgn]);\n\n  const handleApplyFix = useCallback(() => {\n    if (fixResult?.fixedPgn) {\n      setPgn(fixResult.fixedPgn);\n      setValidation(null);\n      setFixResult(null);\n      setSelectedGame(null);\n      toast.success(\'Fixes applied!\', {\n        description: \'The corrected PGN has been loaded. Click Validate to verify.\',\n      });\n    }\n  }, [fixResult]);\n\n  const handleSubmit = useCallback(() => {\n    if (pgn.trim()) {\n      onPgnSubmit(pgn.trim(), selectedGame?.title);\n    }\n  }, [pgn, onPgnSubmit, selectedGame]);\n  \n  const handleLoadGame = useCallback((game: FamousGame) => {\n    setPgn(game.pgn);\n    setSelectedGame(game);\n    setValidation(null);\n    setFixResult(null);\n    \n    // Track gamecard interaction for value pool accrual\n    incrementGamecardUsage(game.id).catch(console.error);\n  }, []);\n  \n  // Auto-detect if uploaded/pasted PGN matches a famous game card OR is an emerging classic\n  const checkForGameCardMatch = useCallback(async (pgnText: string) => {\n    // First check for famous game card match\n    const match = detectGameCard(pgnText);\n    \n    if (match.isMatch && match.matchedGame) {\n      const game = match.matchedGame;\n      setSelectedGame(game);\n      \n      // Show toast with match details\n      const matchPercentage = Math.round(match.similarity * 100);\n      \n      if (match.matchType === \'exact\') {\n        toast.success(\n          <div className="flex items-center gap-2">\n            <Award className="h-4 w-4 text-primary" />\n            <span>En Pensent Game Card Detected!</span>\n          </div>,\n          {\n            description: `This is "${game.title}" (${game.year}) - an Intrinsically Valued Game Card.`,\n            duration: 6000,\n          }\n        );\n      } else {\n        toast.info(\n          <div className="flex items-center gap-2">\n            <Crown className="h-4 w-4 text-primary" />\n            <span>Similar Game Card Found</span>\n          </div>,\n          {\n            description: `${matchPercentage}% match with "${game.title}" (${game.year}).`,\n            duration: 5000,\n          }\n        );\n      }\n      \n      return true;\n    }\n    \n    // If not a famous game, check if it\'s an emerging classic (new high-value game)\n    try {\n      const emergingResult = await detectEmergingGame(pgnText);\n      \n      if (emergingResult.isEmergingClassic) {\n        const display = formatSignificanceDisplay(emergingResult);\n        \n        toast.success(\n          <div className="flex items-center gap-2">\n            {emergingResult.projectedRarity === \'legendary\' ? (\n              <Trophy className="h-4 w-4 text-amber-400" />\n            ) : (\n              <Star className="h-4 w-4 text-purple-400" />\n            )}\n            <span>{display.badge}</span>\n          </div>,\n          {\n            description: (\n              <div className="space-y-1">\n                <p>{display.description}</p>\n                {emergingResult.reasons.slice(0, 2).map((reason, i) => (\n                  <p key={i} className="text-xs opacity-80">‚Ä¢ {reason}</p>\n                ))}\n                {emergingResult.firstClaimBonus && (\n                  <p className="text-xs font-medium text-amber-400">üèÜ Be the first to claim this game!</p>\n                )}\n              </div>\n            ),\n            duration: 8000,\n          }\n        );\n      } else if (emergingResult.significanceScore >= 25) {\n        // Show subtle notification for moderately interesting games\n        toast.info(\n          <div className="flex items-center gap-2">\n            <Sparkles className="h-4 w-4 text-blue-400" />\n            <span>Interesting Game Detected</span>\n          </div>,\n          {\n            description: emergingResult.reasons[0] || \'This game has collecting potential.\',\n            duration: 4000,\n          }\n        );\n      }\n    } catch (error) {\n      console.error(\'Error detecting emerging game:\', error);\n    }\n    \n    return false;\n  }, []);\n\n  const handleFileUpload = useCallback((file: File) => {\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n      const text = e.target?.result as string;\n      if (text) {\n        setPgn(text);\n        setValidation(null);\n        setFixResult(null);\n        \n        // Check for game card match (async)\n        const matched = await checkForGameCardMatch(text);\n        if (!matched) {\n          setSelectedGame(null);\n        }\n      }\n    };\n    reader.readAsText(file);\n  }, [checkForGameCardMatch]);\n  \n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    \n    const file = e.dataTransfer.files[0];\n    if (file && file.name.endsWith(\'.pgn\')) {\n      handleFileUpload(file);\n    }\n  }, [handleFileUpload]);\n  \n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  }, []);\n  \n  const handleDragLeave = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n  \n  const handleFileInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n  }, [handleFileUpload]);\n  \n  // Reset page when switching between mobile/desktop, search changes, or favorites filter changes\n  useEffect(() => {\n    setPageIndex(0);\n  }, [isMobile, searchQuery, showFavoritesOnly]);\n  \n  // Handle favorite toggle\n  const handleToggleFavorite = useCallback(async (e: React.MouseEvent, gameId: string) => {\n    e.stopPropagation(); // Prevent game selection\n    \n    if (!isAuthenticated) {\n      toast.error(\'Sign in required\', {\n        description: \'Please sign in to save favorites.\',\n      });\n      return;\n    }\n    \n    const success = await toggleFavorite(gameId);\n    if (success) {\n      const isNowFavorite = !isFavorite(gameId);\n      toast.success(isNowFavorite ? \'Added to favorites\' : \'Removed from favorites\');\n    }\n  }, [isAuthenticated, toggleFavorite, isFavorite]);\n  \n  const goToNextPage = useCallback(() => {\n    setPageIndex(prev => Math.min(prev + 1, totalPages - 1));\n  }, [totalPages]);\n  \n  const goToPrevPage = useCallback(() => {\n    setPageIndex(prev => Math.max(prev - 1, 0));\n  }, []);\n  \n  // Keyboard navigation for desktop\n  useEffect(() => {\n    if (isMobile) return;\n    \n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Only respond if games container is in view or focused\n      const container = gamesContainerRef.current;\n      if (!container) return;\n      \n      const rect = container.getBoundingClientRect();\n      const isInView = rect.top < window.innerHeight && rect.bottom > 0;\n      \n      // Don\'t interfere with input fields\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return;\n      \n      if (isInView) {\n        if (e.key === \'ArrowLeft\') {\n          e.preventDefault();\n          goToPrevPage();\n        } else if (e.key === \'ArrowRight\') {\n          e.preventDefault();\n          goToNextPage();\n        }\n      }\n    };\n    \n    window.addEventListener(\'keydown\', handleKeyDown);\n    return () => window.removeEventListener(\'keydown\', handleKeyDown);\n  }, [isMobile, goToNextPage, goToPrevPage]);\n  \n  const swipeHandlers = useSwipe(goToNextPage, goToPrevPage);\n  \n  const visibleGames = useMemo(() => {\n    const start = pageIndex * gamesPerPage;\n    return filteredGames.slice(start, start + gamesPerPage);\n  }, [filteredGames, pageIndex, gamesPerPage]);\n\n  // Carlsen-specific games for dedicated section\n  const carlsenGames = useMemo(() => {\n    return carlsenLegendaryGames.sort((a, b) => {\n      if (a.year !== b.year) return a.year - b.year;\n      return a.title.localeCompare(b.title);\n    });\n  }, []);\n\n  // Render a game card\n  const renderGameCard = (game: FamousGame) => {\n    const gameImage = gameImageImports[game.id];\n    const poetryPreview = getPoetryPreview(game.id);\n    return (\n      <button\n        key={game.id}\n        onClick={() => handleLoadGame(game)}\n        className={`group text-left rounded-lg border transition-all duration-200 overflow-hidden ${\n          isMobile ? \'flex flex-col\' : \'flex gap-3 p-2 hover:scale-[1.02]\'\n        } ${\n          selectedGame?.id === game.id \n            ? \'border-primary ring-1 ring-primary/30 bg-primary/5\' \n            : \'border-border/40 bg-card/50 hover:border-primary/50 hover:bg-card active:scale-[0.98]\'\n        }`}\n      >\n        {/* Thumbnail */}\n        <div className={`relative overflow-hidden bg-muted ${\n          isMobile ? \'w-full aspect-[4/3]\' : \'w-14 h-14 flex-shrink-0 rounded-md\'\n        }`}>\n          {gameImage ? (\n            <img \n              src={gameImage} \n              alt={game.title}\n              className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"\n            />\n          ) : (\n            <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5">\n              <Crown className={isMobile ? "h-6 w-6 text-primary/40" : "h-5 w-5 text-primary/40"} />\n            </div>\n          )}\n          {/* Poetry indicator badge */}\n          {poetryPreview && (\n            <div className={`absolute ${isMobile ? \'bottom-1 left-1\' : \'bottom-0 left-0\'} px-1.5 py-0.5 bg-primary/90 rounded-tr-md rounded-bl-md`}>\n              <PenTool className="h-2.5 w-2.5 text-primary-foreground" />\n            </div>\n          )}\n          {/* Favorite button */}\n          <button\n            onClick={(e) => handleToggleFavorite(e, game.id)}\n            className={`absolute ${isMobile ? \'top-1.5 right-1.5\' : \'top-0.5 right-0.5\'} p-1 rounded-full transition-all ${\n              isFavorite(game.id)\n                ? \'bg-red-500/90 text-white\'\n                : \'bg-black/40 text-white/70 opacity-0 group-hover:opacity-100\'\n            }`}\n            aria-label={isFavorite(game.id) ? \'Remove from favorites\' : \'Add to favorites\'}\n          >\n            <Heart className={`${isMobile ? \'h-3.5 w-3.5\' : \'h-3 w-3\'} ${isFavorite(game.id) ? \'fill-current\' : \'\'}`} />\n          </button>\n        </div>\n        {/* Text info */}\n        <div className={`flex flex-col justify-center ${isMobile ? \'p-2 flex-1\' : \'flex-1 min-w-0\'}`}>\n          <p className="text-xs font-semibold text-foreground leading-tight line-clamp-1">{game.title}</p>\n          <p className={`text-muted-foreground ${isMobile ? \'text-[10px] mt-0.5\' : \'text-[10px] mt-0.5\'}`}>{game.year}</p>\n          {/* Poetry preview */}\n          {poetryPreview && (\n            <p className={`italic text-primary/70 line-clamp-1 ${isMobile ? \'text-[9px] mt-1\' : \'text-[9px] mt-0.5\'}`}>\n              "{poetryPreview}"\n            </p>\n          )}\n        </div>\n      </button>\n    );\n  };\n\n  return (\n    <div className="space-y-6">\n      {/* Magnus Carlsen Dedicated Section */}\n      <div className="rounded-lg border border-amber-500/30 bg-gradient-to-br from-amber-500/5 via-card/50 to-card/50 overflow-hidden">\n        <div className="px-4 sm:px-6 py-4 sm:py-5 border-b border-amber-500/20">\n          <div className="flex items-center gap-3">\n            <div className="p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">\n              <Trophy className="h-5 w-5 text-amber-500" />\n            </div>\n            <div>\n              <h3 className="font-display text-base sm:text-lg font-semibold text-amber-100">\n                Magnus Carlsen Collection\n              </h3>\n              <p className="text-xs sm:text-sm text-muted-foreground font-serif">\n                {carlsenGames.length} masterpieces from the World Champion\n              </p>\n            </div>\n          </div>\n        </div>\n        \n        <div className="p-3 sm:p-4">\n          <div className="overflow-x-auto pb-2 -mx-3 px-3 scrollbar-thin scrollbar-thumb-amber-500/30 scrollbar-track-transparent">\n            <div className="flex gap-3" style={{ minWidth: \'max-content\' }}>\n              {carlsenGames.map((game) => {\n                const gameImage = gameImageImports[game.id];\n                const poetryPreview = getPoetryPreview(game.id);\n                return (\n                  <button\n                    key={game.id}\n                    onClick={() => handleLoadGame(game)}\n                    className={`group flex-shrink-0 w-40 sm:w-48 text-left rounded-lg border transition-all duration-200 overflow-hidden hover:scale-[1.02] ${\n                      selectedGame?.id === game.id \n                        ? \'border-amber-500 ring-1 ring-amber-500/30 bg-amber-500/10\' \n                        : \'border-amber-500/20 bg-card/50 hover:border-amber-500/50 hover:bg-card active:scale-[0.98]\'\n                    }`}\n                  >\n                    {/* Thumbnail */}\n                    <div className="relative w-full aspect-[4/3] overflow-hidden bg-muted">\n                      {gameImage ? (\n                        <img \n                          src={gameImage} \n                          alt={game.title}\n                          className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"\n                        />\n                      ) : (\n                        <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-amber-500/20 to-amber-500/5">\n                          <Trophy className="h-8 w-8 text-amber-500/40" />\n                        </div>\n                      )}\n                      {/* Poetry indicator badge */}\n                      {poetryPreview && (\n                        <div className="absolute bottom-1 left-1 px-1.5 py-0.5 bg-amber-500/90 rounded-tr-md rounded-bl-md">\n                          <PenTool className="h-2.5 w-2.5 text-amber-900" />\n                        </div>\n                      )}\n                      {/* Favorite button */}\n                      <button\n                        onClick={(e) => handleToggleFavorite(e, game.id)}\n                        className={`absolute top-1.5 right-1.5 p-1 rounded-full transition-all ${\n                          isFavorite(game.id)\n                            ? \'bg-red-500/90 text-white\'\n                            : \'bg-black/40 text-white/70 opacity-0 group-hover:opacity-100\'\n                        }`}\n                        aria-label={isFavorite(game.id) ? \'Remove from favorites\' : \'Add to favorites\'}\n                      >\n                        <Heart className={`h-3.5 w-3.5 ${isFavorite(game.id) ? \'fill-current\' : \'\'}`} />\n                      </button>\n                    </div>\n                    {/* Text info */}\n                    <div className="p-2.5">\n                      <p className="text-xs font-semibold text-foreground leading-tight line-clamp-1">{game.title}</p>\n                      <p className="text-[10px] text-amber-500/70 mt-0.5">{game.year}</p>\n                      {poetryPreview && (\n                        <p className="italic text-amber-500/60 line-clamp-1 text-[9px] mt-1">\n                          "{poetryPreview}"\n                        </p>\n                      )}\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* All Legendary Games Showcase */}\n      <div ref={gamesContainerRef} className="rounded-lg border border-border/50 bg-card/50 overflow-hidden">\n        <div className="px-4 sm:px-6 py-4 sm:py-5 border-b border-border/50">\n          <div className="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">\n            <div className="flex-1">\n              <h3 className="flex items-center gap-2 font-display text-base sm:text-lg font-semibold">\n                <Crown className="h-4 w-4 sm:h-5 sm:w-5 text-primary" />\n                Legendary Games\n              </h3>\n              <p className="text-xs sm:text-sm text-muted-foreground mt-1 font-serif">\n                {searchQuery \n                  ? `Found ${filteredGames.length} game${filteredGames.length !== 1 ? \'s\' : \'\'}`\n                  : isMobile \n                    ? \'Swipe to explore\' \n                    : `Showing ${filteredGames.length > 0 ? pageIndex * gamesPerPage + 1 : 0}‚Äì${Math.min((pageIndex + 1) * gamesPerPage, filteredGames.length)} of ${filteredGames.length} legendary games`\n                }\n                {!isMobile && !searchQuery && <span className="ml-2 text-muted-foreground/60">‚Ä¢ Use ‚Üê ‚Üí arrow keys</span>}\n              </p>\n            </div>\n            \n            {/* Favorites filter button */}\n            {isAuthenticated && (\n              <button\n                onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}\n                className={`flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium border rounded-md transition-colors flex-shrink-0 ${\n                  showFavoritesOnly \n                    ? \'bg-red-500/10 hover:bg-red-500/20 text-red-500 border-red-500/30\' \n                    : \'bg-muted/50 hover:bg-muted text-muted-foreground border-border/50\'\n                }`}\n                aria-label={showFavoritesOnly ? \'Show all games\' : \'Show favorites only\'}\n              >\n                <Heart className={`h-3.5 w-3.5 ${showFavoritesOnly ? \'fill-current\' : \'\'}`} />\n                <span className="hidden sm:inline">Favorites</span>\n              </button>\n            )}\n            \n            {/* Random game button */}\n            <button\n              onClick={() => {\n                const randomGame = getRandomFamousGame();\n                handleLoadGame(randomGame);\n                toast.success(\'Random game loaded!\', {\n                  description: `${randomGame.title} (${randomGame.year})`,\n                });\n              }}\n              className="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium bg-primary/10 hover:bg-primary/20 text-primary border border-primary/30 rounded-md transition-colors flex-shrink-0"\n              aria-label="Load random game"\n            >\n              <Shuffle className="h-3.5 w-3.5" />\n              <span className="hidden sm:inline">Random</span>\n            </button>\n            \n            {/* Search input */}\n            <div className="relative flex-shrink-0 w-full sm:w-48">\n              <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />\n              <input\n                type="text"\n                placeholder="Search games..."\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className="w-full pl-8 pr-8 py-1.5 text-xs bg-background/50 border border-border/50 rounded-md focus:outline-none focus:border-primary/50 transition-colors"\n              />\n              {searchQuery && (\n                <button\n                  onClick={() => setSearchQuery(\'\')}\n                  className="absolute right-2 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-muted transition-colors"\n                  aria-label="Clear search"\n                >\n                  <X className="h-3 w-3 text-muted-foreground" />\n                </button>\n              )}\n            </div>\n            \n            {/* Pagination controls */}\n            {totalPages > 1 && (\n              <div className="flex items-center gap-2 flex-shrink-0">\n                <button \n                  onClick={goToPrevPage}\n                  disabled={pageIndex === 0}\n                  className="p-1.5 sm:p-2 rounded-full bg-card border border-border/50 disabled:opacity-30 hover:border-primary/50 transition-all"\n                  aria-label="Previous games"\n                >\n                  <ChevronLeft className="h-4 w-4 sm:h-5 sm:w-5" />\n                </button>\n                <span className="text-xs sm:text-sm text-muted-foreground tabular-nums min-w-[3rem] text-center">\n                  {pageIndex + 1}/{totalPages}\n                </span>\n                <button \n                  onClick={goToNextPage}\n                  disabled={pageIndex === totalPages - 1}\n                  className="p-1.5 sm:p-2 rounded-full bg-card border border-border/50 disabled:opacity-30 hover:border-primary/50 transition-all"\n                  aria-label="Next games"\n                >\n                  <ChevronRight className="h-4 w-4 sm:h-5 sm:w-5" />\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n        \n        <div className="p-3 sm:p-4">\n          {filteredGames.length === 0 ? (\n            <div className="flex flex-col items-center justify-center py-8 text-center">\n              {showFavoritesOnly ? (\n                <>\n                  <Heart className="h-8 w-8 text-muted-foreground/40 mb-2" />\n                  <p className="text-sm text-muted-foreground">No favorite games yet</p>\n                  <button \n                    onClick={() => setShowFavoritesOnly(false)}\n                    className="mt-2 text-xs text-primary hover:underline"\n                  >\n                    Browse all games\n                  </button>\n                </>\n              ) : (\n                <>\n                  <Search className="h-8 w-8 text-muted-foreground/40 mb-2" />\n                  <p className="text-sm text-muted-foreground">No games found for "{searchQuery}"</p>\n                  <button \n                    onClick={() => setSearchQuery(\'\')}\n                    className="mt-2 text-xs text-primary hover:underline"\n                  >\n                    Clear search\n                  </button>\n                </>\n              )}\n            </div>\n          ) : (\n            <div \n              ref={scrollContainerRef}\n              className={isMobile ? "touch-pan-x" : ""}\n              {...(isMobile ? swipeHandlers : {})}\n            >\n              <div \n                className={`grid gap-2 sm:gap-3 transition-opacity duration-200 ${\n                  isMobile ? \'grid-cols-2\' : \'grid-cols-2 sm:grid-cols-3 md:grid-cols-4\'\n                }`}\n                style={{ minHeight: isMobile ? \'180px\' : \'200px\' }}\n              >\n                {visibleGames.map((game) => renderGameCard(game))}\n            </div>\n            \n            {/* Pagination dots */}\n            <div className="flex justify-center gap-1.5 mt-3 sm:mt-4">\n              {Array.from({ length: totalPages }).map((_, idx) => (\n                <button\n                  key={idx}\n                  onClick={() => setPageIndex(idx)}\n                  className={`h-1.5 sm:h-2 rounded-full transition-all ${\n                    idx === pageIndex \n                      ? \'bg-primary w-4 sm:w-6\' \n                      : \'bg-muted-foreground/30 w-1.5 sm:w-2 hover:bg-muted-foreground/50\'\n                  }`}\n                  aria-label={`Go to page ${idx + 1}`}\n                />\n              ))}\n            </div>\n          </div>\n          )}\n        </div>\n      </div>\n\n      {/* Upload Card - with AI Art Background */}\n      <div className="relative rounded-lg border border-border/50 overflow-hidden">\n        {/* AI-generated background art */}\n        <div \n          className="absolute inset-0 bg-cover bg-center opacity-45"\n          style={{ backgroundImage: `url(${uploadHeroArt})` }}\n        />\n        <div className="absolute inset-0 bg-gradient-to-br from-card/95 via-card/85 to-card/95" />\n        \n        {/* Content */}\n        <div className="relative">\n          {/* Input Mode Tabs */}\n          <Tabs value={inputMode} onValueChange={(v) => setInputMode(v as \'pgn\' | \'fen\')} className="w-full">\n            <div className="px-5 py-4 border-b border-border/50">\n              <TabsList className="grid w-full grid-cols-2 h-10 bg-muted/30">\n                <TabsTrigger value="pgn" className="gap-2 text-sm data-[state=active]:bg-primary/10 data-[state=active]:text-primary">\n                  <FileText className="h-4 w-4" />\n                  Game (PGN)\n                </TabsTrigger>\n                <TabsTrigger value="fen" className="gap-2 text-sm data-[state=active]:bg-primary/10 data-[state=active]:text-primary">\n                  <Grid3X3 className="h-4 w-4" />\n                  Position (FEN)\n                </TabsTrigger>\n              </TabsList>\n            </div>\n\n            {/* PGN Tab Content */}\n            <TabsContent value="pgn" className="mt-0">\n        <div className="p-4 space-y-4">\n          {/* Drop zone */}\n          <div\n            className={`border-2 border-dashed rounded-lg p-5 text-center transition-all duration-300 ${\n              isDragging \n                ? \'border-primary bg-primary/10 glow-gold\' \n                : \'border-border hover:border-primary/30\'\n            }`}\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n          >\n            <Upload className="h-8 w-8 mx-auto mb-2 text-muted-foreground" />\n            <p className="text-xs text-muted-foreground mb-1 font-serif">\n              Drag & drop a .pgn file here, or\n            </p>\n            <label className="cursor-pointer">\n              <span className="text-primary hover:text-primary/80 text-xs font-medium transition-colors">browse files</span>\n              <input\n                type="file"\n                accept=".pgn"\n                className="hidden"\n                onChange={handleFileInputChange}\n              />\n            </label>\n          </div>\n          \n          {/* Text area for manual input */}\n          <div className="relative">\n            <Textarea\n              placeholder="Or paste PGN notation here..."\n              value={pgn}\n              onChange={(e) => {\n                const newPgn = e.target.value;\n                setPgn(newPgn);\n                setValidation(null);\n                setFixResult(null);\n                \n                // Check for game card match when paste is detected (large text change)\n                if (newPgn.length > 50 && Math.abs(newPgn.length - pgn.length) > 30) {\n                  if (!checkForGameCardMatch(newPgn)) {\n                    setSelectedGame(null);\n                  }\n                } else if (newPgn.length < 20) {\n                  // Clear selection for very short input\n                  setSelectedGame(null);\n                }\n              }}\n              onBlur={(e) => {\n                // Also check on blur for manually typed PGNs\n                const currentPgn = e.target.value;\n                if (currentPgn.length > 50 && !selectedGame) {\n                  checkForGameCardMatch(currentPgn);\n                }\n              }}\n              className="min-h-[100px] font-mono text-xs bg-background/50 border-border/50 focus:border-primary/50"\n            />\n          </div>\n          \n          {/* Validation status */}\n          {validation && (\n            <div className={`p-4 rounded-lg flex items-start gap-3 ${\n              validation.isValid \n                ? \'bg-green-500/10 border border-green-500/30\' \n                : \'bg-destructive/10 border border-destructive/30\'\n            }`}>\n              {validation.isValid ? (\n                <CheckCircle className="h-5 w-5 text-green-500 flex-shrink-0 mt-0.5" />\n              ) : (\n                <XCircle className="h-5 w-5 text-destructive flex-shrink-0 mt-0.5" />\n              )}\n              <div className="flex-1">\n                <p className={`text-sm font-medium ${validation.isValid ? \'text-green-500\' : \'text-destructive\'}`}>\n                  {validation.isValid ? `Valid PGN ‚Äî ${validation.moveCount} moves` : \'Invalid PGN\'}\n                </p>\n                {!validation.isValid && validation.error && (\n                  <p className="text-xs text-muted-foreground mt-1">{validation.error}</p>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* PGN Fix Suggestions */}\n          {fixResult && !validation?.isValid && (\n            <div className={`p-4 rounded-lg border ${\n              fixResult.canFix \n                ? \'bg-amber-500/10 border-amber-500/30\' \n                : \'bg-destructive/10 border-destructive/30\'\n            }`}>\n              <div className="flex items-center gap-2 mb-3">\n                <Wrench className={`h-5 w-5 ${fixResult.canFix ? \'text-amber-500\' : \'text-destructive\'}`} />\n                <p className={`text-sm font-medium ${fixResult.canFix ? \'text-amber-500\' : \'text-destructive\'}`}>\n                  {fixResult.canFix \n                    ? `Found ${fixResult.suggestions.length} issue(s) - suggested corrections:` \n                    : \'Unable to automatically fix this PGN\'}\n                </p>\n              </div>\n              \n              {fixResult.canFix && fixResult.suggestions.length > 0 && (\n                <div className="space-y-2 mb-4">\n                  {fixResult.suggestions.map((suggestion, index) => (\n                    <div \n                      key={index}\n                      className="p-3 rounded-lg bg-background/50 border border-border/50"\n                    >\n                      <div className="flex items-center gap-2 text-sm">\n                        <span className="text-muted-foreground">Move {suggestion.moveNumber}:</span>\n                        <code className="px-1.5 py-0.5 rounded bg-destructive/20 text-destructive font-mono text-xs">\n                          {suggestion.originalMove}\n                        </code>\n                        <ArrowRight className="h-3 w-3 text-muted-foreground" />\n                        <code className="px-1.5 py-0.5 rounded bg-green-500/20 text-green-600 font-mono text-xs">\n                          {suggestion.suggestedMove}\n                        </code>\n                        <span className={`ml-auto text-xs px-2 py-0.5 rounded ${\n                          suggestion.confidence === \'high\' \n                            ? \'bg-green-500/20 text-green-600\' \n                            : suggestion.confidence === \'medium\'\n                            ? \'bg-amber-500/20 text-amber-600\'\n                            : \'bg-muted text-muted-foreground\'\n                        }`}>\n                          {suggestion.confidence} confidence\n                        </span>\n                      </div>\n                      <p className="text-xs text-muted-foreground mt-1.5">{suggestion.reason}</p>\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {!fixResult.canFix && (\n                <p className="text-xs text-muted-foreground mb-3">{fixResult.originalError}</p>\n              )}\n              \n              {fixResult.canFix && fixResult.suggestions.length > 0 && (\n                <Button\n                  onClick={handleApplyFix}\n                  className="w-full gap-2"\n                  variant="outline"\n                >\n                  <CheckCircle className="h-4 w-4" />\n                  Apply {fixResult.suggestions.length} Correction{fixResult.suggestions.length > 1 ? \'s\' : \'\'}\n                </Button>\n              )}\n            </div>\n          )}\n\n          {/* Loading state for fixing */}\n          {isFixing && (\n            <div className="p-4 rounded-lg bg-muted/50 border border-border/50 flex items-center gap-3">\n              <Loader2 className="h-5 w-5 animate-spin text-primary" />\n              <p className="text-sm text-muted-foreground">Analyzing PGN for possible fixes...</p>\n            </div>\n          )}\n          \n          {/* Selected game info */}\n          {selectedGame && !validation && !fixResult && (\n            <div className="p-4 rounded-lg bg-primary/5 border border-primary/20">\n              <p className="text-sm font-display font-semibold">{selectedGame.title}</p>\n              <p className="text-xs text-muted-foreground mt-1 font-serif">{selectedGame.description}</p>\n            </div>\n          )}\n          \n          {/* Action buttons */}\n          <div className="flex gap-3">\n            <Button \n              onClick={handleValidate} \n              disabled={!pgn.trim() || isValidating}\n              variant="outline"\n              className="gap-2 flex-1"\n              size="lg"\n            >\n              {isValidating ? (\n                <Loader2 className="h-4 w-4 animate-spin" />\n              ) : (\n                <CheckCircle className="h-4 w-4" />\n              )}\n              Validate PGN\n            </Button>\n            <Button \n              onClick={handleSubmit} \n              disabled={!pgn.trim()}\n              className="gap-2 flex-[2] btn-luxury py-6 text-base font-medium"\n              size="lg"\n            >\n              <Sparkles className="h-5 w-5" />\n              Generate Visualization\n            </Button>\n          </div>\n        </div>\n            </TabsContent>\n\n            {/* FEN Tab Content */}\n            <TabsContent value="fen" className="mt-0 p-4">\n              {onFenSubmit ? (\n                <FenInput onFenSubmit={onFenSubmit} />\n              ) : (\n                <div className="text-center py-8 text-muted-foreground">\n                  <Grid3X3 className="h-8 w-8 mx-auto mb-2 opacity-50" />\n                  <p className="text-sm">FEN input not available in this context</p>\n                </div>\n              )}\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PgnUploader;\n';export{e as default};
