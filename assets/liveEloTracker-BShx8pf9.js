const n="/**\n * Live ELO Tracker with Platform-Aware Calibration\n * \n * Continuously calculates and updates FIDE ELO estimates for En Pensent\n * compared against Stockfish 17's baseline of 3600-3700 ELO.\n * \n * PLATFORM ELO CALIBRATION:\n * Different platforms have different rating pools and inflation levels.\n * We track the source platform and apply appropriate FIDE conversion:\n * \n * - Lichess (Glicko-2): Tends to run ~100-150 higher than FIDE\n * - Chess.com (Glicko): Tends to run ~50-100 higher than FIDE\n * - FIDE: The gold standard for competitive chess ratings\n * \n * Uses official FIDE formulas with TCEC-calibrated D(P) values.\n */\n\nimport { getExpectedScore } from './eloCalculator';\n\n// Stockfish 17 TCEC/CCRL calibrated ratings\nexport const STOCKFISH_17_ELO = {\n  baseline: 3650,      // Mid-point estimate\n  cloud: 3580,         // Lichess Cloud (cached, lower depth)\n  localDepth20: 3200,  // WASM depth 20\n  localDepth30: 3450,  // WASM depth 30  \n  localDepth40: 3550,  // WASM depth 40\n  localDepth50: 3620,  // WASM depth 50\n  localDepth60: 3700,  // WASM depth 60 (maximum)\n  unlimited: 3700,     // True unlimited (TCEC conditions)\n} as const;\n\n// Platform-specific ELO calibration factors\nexport const PLATFORM_ELO_CALIBRATION = {\n  lichess: {\n    offset: -100,          // Lichess ratings tend to run ~100 higher than FIDE\n    volatility: 1.1,       // Slightly more volatile due to faster time controls\n    description: 'Lichess Glicko-2 (tends +100 vs FIDE)',\n  },\n  chesscom: {\n    offset: -50,           // Chess.com ratings closer to FIDE\n    volatility: 1.0,       // More stable rating pool\n    description: 'Chess.com Glicko (tends +50 vs FIDE)',\n  },\n  fide: {\n    offset: 0,             // FIDE is the baseline\n    volatility: 0.9,       // Lower volatility (classical time controls)\n    description: 'FIDE Official Rating',\n  },\n} as const;\n\nexport type RatingPlatform = keyof typeof PLATFORM_ELO_CALIBRATION;\n\n/**\n * Convert platform-specific ELO to approximate FIDE equivalent\n */\nexport function toFideElo(platformElo: number, source: RatingPlatform): number {\n  const calibration = PLATFORM_ELO_CALIBRATION[source];\n  return Math.round(platformElo + calibration.offset);\n}\n\n/**\n * Convert FIDE ELO to platform-specific equivalent\n */\nexport function fromFideElo(fideElo: number, target: RatingPlatform): number {\n  const calibration = PLATFORM_ELO_CALIBRATION[target];\n  return Math.round(fideElo - calibration.offset);\n}\n\n/**\n * Get average game strength in FIDE-equivalent terms\n */\nexport function getGameStrengthFide(\n  whiteElo: number, \n  blackElo: number, \n  source: RatingPlatform\n): number {\n  const avgPlatform = (whiteElo + blackElo) / 2;\n  return toFideElo(avgPlatform, source);\n}\n\n/**\n * Get calibration description for display\n */\nexport function getPlatformCalibrationInfo(source: RatingPlatform): {\n  description: string;\n  offset: number;\n  example: string;\n} {\n  const cal = PLATFORM_ELO_CALIBRATION[source];\n  const examplePlatform = 2500;\n  const exampleFide = toFideElo(examplePlatform, source);\n  return {\n    description: cal.description,\n    offset: cal.offset,\n    example: `${examplePlatform} ${source} â‰ˆ ${exampleFide} FIDE`,\n  };\n}\n\nexport interface LiveEloState {\n  enPensentElo: number;\n  stockfishElo: number;\n  gamesAnalyzed: number;\n  wins: number;\n  losses: number;\n  draws: number;\n  performanceRating: number;\n  confidenceInterval: [number, number];\n  title: string;\n  titleColor: string;\n  vsStockfish: 'winning' | 'losing' | 'even';\n  eloDifference: number;\n}\n\nexport interface GameResult {\n  enPensentCorrect: boolean;\n  stockfishCorrect: boolean;\n  stockfishDepth: number;\n}\n\n// FIDE D(P) table - maps win probability to rating difference\nconst FIDE_DP_TABLE: [number, number][] = [\n  [1.00, 800], [0.99, 677], [0.98, 589], [0.97, 538], [0.96, 501],\n  [0.95, 470], [0.94, 444], [0.93, 422], [0.92, 401], [0.91, 383],\n  [0.90, 366], [0.89, 351], [0.88, 336], [0.87, 322], [0.86, 309],\n  [0.85, 296], [0.84, 284], [0.83, 273], [0.82, 262], [0.81, 251],\n  [0.80, 240], [0.79, 230], [0.78, 220], [0.77, 211], [0.76, 202],\n  [0.75, 193], [0.74, 184], [0.73, 175], [0.72, 166], [0.71, 158],\n  [0.70, 149], [0.69, 141], [0.68, 133], [0.67, 125], [0.66, 117],\n  [0.65, 110], [0.64, 102], [0.63, 95], [0.62, 87], [0.61, 80],\n  [0.60, 72], [0.59, 65], [0.58, 57], [0.57, 50], [0.56, 43],\n  [0.55, 36], [0.54, 29], [0.53, 21], [0.52, 14], [0.51, 7],\n  [0.50, 0]\n];\n\n/**\n * Get FIDE D(P) value from performance percentage\n */\nfunction getDpFromPerformance(p: number): number {\n  if (p <= 0) return -800;\n  if (p >= 1) return 800;\n  \n  // Find closest entry in table\n  for (let i = 0; i < FIDE_DP_TABLE.length; i++) {\n    if (p >= FIDE_DP_TABLE[i][0]) {\n      return FIDE_DP_TABLE[i][1];\n    }\n  }\n  \n  // Mirror for losses\n  return -getDpFromPerformance(1 - p);\n}\n\n/**\n * Get Stockfish ELO based on analysis depth\n */\nexport function getStockfishEloForDepth(depth: number): number {\n  if (depth >= 60) return STOCKFISH_17_ELO.unlimited;\n  if (depth >= 50) return STOCKFISH_17_ELO.localDepth50;\n  if (depth >= 40) return STOCKFISH_17_ELO.localDepth40;\n  if (depth >= 30) return STOCKFISH_17_ELO.localDepth30;\n  if (depth >= 20) return STOCKFISH_17_ELO.localDepth20;\n  \n  // Linear interpolation for other depths\n  const baseElo = 2800;\n  const maxElo = 3700;\n  const ratio = Math.min(1, depth / 60);\n  return Math.round(baseElo + (maxElo - baseElo) * ratio);\n}\n\n/**\n * Calculate FIDE performance rating\n */\nexport function calculatePerformanceRating(\n  wins: number,\n  losses: number,\n  draws: number,\n  opponentElo: number\n): number {\n  const totalGames = wins + losses + draws;\n  if (totalGames === 0) return opponentElo;\n  \n  const score = wins + (draws * 0.5);\n  const performance = score / totalGames;\n  \n  const dp = getDpFromPerformance(performance);\n  return Math.round(opponentElo + dp);\n}\n\n/**\n * Get title based on ELO rating\n */\nexport function getEloTitle(elo: number): { title: string; color: string } {\n  if (elo >= 3800) return { title: 'Transcendent', color: 'from-purple-400 via-pink-500 to-red-500' };\n  if (elo >= 3700) return { title: 'Beyond Stockfish 17', color: 'from-yellow-400 via-amber-500 to-orange-500' };\n  if (elo >= 3600) return { title: 'Stockfish 17 Equivalent', color: 'from-blue-400 to-cyan-500' };\n  if (elo >= 3500) return { title: 'Super-GM Level', color: 'from-purple-500 to-violet-600' };\n  if (elo >= 3400) return { title: 'Elite Engine', color: 'from-green-500 to-emerald-500' };\n  if (elo >= 3200) return { title: 'Strong Engine', color: 'from-teal-500 to-cyan-500' };\n  if (elo >= 3000) return { title: 'Master Level', color: 'from-blue-500 to-indigo-500' };\n  if (elo >= 2800) return { title: 'Grandmaster', color: 'from-orange-500 to-red-500' };\n  if (elo >= 2600) return { title: 'International Master', color: 'from-yellow-500 to-orange-500' };\n  return { title: 'Strong Player', color: 'from-gray-400 to-gray-500' };\n}\n\n/**\n * Calculate confidence interval based on game count\n */\nfunction calculateConfidenceInterval(elo: number, games: number): [number, number] {\n  // Standard error decreases with sqrt of games\n  const baseError = 200;\n  const error = Math.round(baseError / Math.sqrt(Math.max(1, games / 10)));\n  return [Math.max(2400, elo - error), elo + error];\n}\n\n/**\n * Create initial ELO state\n */\nexport function createInitialEloState(): LiveEloState {\n  return {\n    enPensentElo: 3400, // Starting estimate\n    stockfishElo: STOCKFISH_17_ELO.baseline,\n    gamesAnalyzed: 0,\n    wins: 0,\n    losses: 0,\n    draws: 0,\n    performanceRating: 3400,\n    confidenceInterval: [3200, 3600],\n    title: 'Elite Engine',\n    titleColor: 'from-green-500 to-emerald-500',\n    vsStockfish: 'even',\n    eloDifference: 0,\n  };\n}\n\n/**\n * Update ELO state after a game result\n */\nexport function updateEloState(\n  state: LiveEloState,\n  result: GameResult\n): LiveEloState {\n  const newState = { ...state };\n  \n  // Determine outcome\n  // Win = En Pensent correct AND Stockfish wrong (or both correct with higher confidence)\n  // Loss = Stockfish correct AND En Pensent wrong\n  // Draw = Both correct or both wrong\n  \n  if (result.enPensentCorrect && !result.stockfishCorrect) {\n    newState.wins++;\n  } else if (!result.enPensentCorrect && result.stockfishCorrect) {\n    newState.losses++;\n  } else {\n    newState.draws++;\n  }\n  \n  newState.gamesAnalyzed++;\n  \n  // Get Stockfish ELO for this depth\n  newState.stockfishElo = getStockfishEloForDepth(result.stockfishDepth);\n  \n  // Calculate performance rating\n  newState.performanceRating = calculatePerformanceRating(\n    newState.wins,\n    newState.losses,\n    newState.draws,\n    newState.stockfishElo\n  );\n  \n  // Update En Pensent ELO with momentum\n  const k = newState.gamesAnalyzed < 30 ? 40 : 20;\n  const score = (newState.wins + newState.draws * 0.5) / newState.gamesAnalyzed;\n  const expected = getExpectedScore(state.enPensentElo, newState.stockfishElo);\n  const actualChange = k * (score - expected);\n  \n  // Blend performance rating with incremental update\n  const performanceWeight = Math.min(0.7, newState.gamesAnalyzed / 50);\n  newState.enPensentElo = Math.round(\n    newState.performanceRating * performanceWeight +\n    (state.enPensentElo + actualChange) * (1 - performanceWeight)\n  );\n  \n  // Ensure reasonable bounds\n  newState.enPensentElo = Math.max(2400, Math.min(4000, newState.enPensentElo));\n  \n  // Calculate confidence interval\n  newState.confidenceInterval = calculateConfidenceInterval(\n    newState.enPensentElo,\n    newState.gamesAnalyzed\n  );\n  \n  // Get title\n  const titleInfo = getEloTitle(newState.enPensentElo);\n  newState.title = titleInfo.title;\n  newState.titleColor = titleInfo.color;\n  \n  // Compare to Stockfish\n  newState.eloDifference = newState.enPensentElo - newState.stockfishElo;\n  if (newState.eloDifference > 50) {\n    newState.vsStockfish = 'winning';\n  } else if (newState.eloDifference < -50) {\n    newState.vsStockfish = 'losing';\n  } else {\n    newState.vsStockfish = 'even';\n  }\n  \n  return newState;\n}\n\n/**\n * Calculate ELO from benchmark results\n */\nexport function calculateEloFromBenchmark(\n  hybridAccuracy: number,\n  stockfishAccuracy: number,\n  hybridWins: number,\n  stockfishWins: number,\n  bothCorrect: number,\n  totalGames: number,\n  averageDepth: number\n): LiveEloState {\n  const stockfishElo = getStockfishEloForDepth(averageDepth);\n  \n  // Calculate score (wins = 1, draws = 0.5, losses = 0)\n  const draws = bothCorrect + (totalGames - hybridWins - stockfishWins - bothCorrect);\n  const wins = hybridWins;\n  const losses = stockfishWins;\n  \n  // Performance rating\n  const performanceRating = calculatePerformanceRating(wins, losses, draws, stockfishElo);\n  \n  // Get title\n  const titleInfo = getEloTitle(performanceRating);\n  \n  // Confidence interval\n  const confidenceInterval = calculateConfidenceInterval(performanceRating, totalGames);\n  \n  // Vs Stockfish comparison\n  const eloDifference = performanceRating - stockfishElo;\n  let vsStockfish: 'winning' | 'losing' | 'even';\n  if (eloDifference > 50) vsStockfish = 'winning';\n  else if (eloDifference < -50) vsStockfish = 'losing';\n  else vsStockfish = 'even';\n  \n  return {\n    enPensentElo: performanceRating,\n    stockfishElo,\n    gamesAnalyzed: totalGames,\n    wins,\n    losses,\n    draws,\n    performanceRating,\n    confidenceInterval,\n    title: titleInfo.title,\n    titleColor: titleInfo.color,\n    vsStockfish,\n    eloDifference,\n  };\n}\n\n/**\n * Format ELO for display\n */\nexport function formatElo(elo: number): string {\n  return Math.round(elo).toString();\n}\n\n/**\n * Get ELO comparison description\n */\nexport function getEloComparisonText(state: LiveEloState): string {\n  const diff = Math.abs(state.eloDifference);\n  \n  if (state.vsStockfish === 'winning') {\n    if (diff > 200) return `Dominating Stockfish 17 by +${diff} ELO`;\n    if (diff > 100) return `Outperforming Stockfish 17 by +${diff} ELO`;\n    return `Slightly ahead of Stockfish 17 (+${diff} ELO)`;\n  } else if (state.vsStockfish === 'losing') {\n    if (diff > 200) return `Behind Stockfish 17 by -${diff} ELO`;\n    if (diff > 100) return `Trailing Stockfish 17 by -${diff} ELO`;\n    return `Slightly behind Stockfish 17 (-${diff} ELO)`;\n  }\n  \n  return 'Competitive with Stockfish 17';\n}\n";export{n as default};
