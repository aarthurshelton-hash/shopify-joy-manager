const n='import React, { useEffect, useState, useCallback } from \'react\';\nimport { Card, CardContent } from \'@/components/ui/card\';\nimport { Badge } from \'@/components/ui/badge\';\nimport { Button } from \'@/components/ui/button\';\nimport { Loader2, Gift, Sparkles, Crown, Printer } from \'lucide-react\';\nimport { toast } from \'sonner\';\nimport { useNavigate } from \'react-router-dom\';\nimport { useAuth } from \'@/hooks/useAuth\';\nimport { getOrphanedVisualizations, claimOrphanedVisualization } from \'@/lib/marketplace/marketplaceApi\';\nimport { TransferLimitBadge } from \'./TransferLimitBadge\';\nimport { trackMarketplaceClick } from \'@/lib/analytics/marketplaceAnalytics\';\nimport { ClaimableGridSkeleton } from \'./MarketplaceSkeletons\';\nimport { usePrintOrderStore } from \'@/stores/printOrderStore\';\n\ninterface OrphanedVision {\n  id: string;\n  title: string;\n  image_path: string;\n  game_data: unknown;\n  pgn?: string | null;\n}\n\ninterface ClaimableVisionsSectionProps {\n  onClaim?: () => void;\n}\n\nexport const ClaimableVisionsSection: React.FC<ClaimableVisionsSectionProps> = ({ onClaim }) => {\n  const { user, isPremium } = useAuth();\n  const navigate = useNavigate();\n  const { setOrderData } = usePrintOrderStore();\n  const [visions, setVisions] = useState<OrphanedVision[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [claimingId, setClaimingId] = useState<string | null>(null);\n\n  const handleOrderPrint = (e: React.MouseEvent, vision: OrphanedVision) => {\n    e.stopPropagation();\n    // Extract game data from vision if available\n    const gameData = vision.game_data as { white?: string; black?: string; event?: string; date?: string; result?: string } | null;\n    setOrderData({\n      title: vision.title || \'Untitled Vision\',\n      imagePath: vision.image_path,\n      pgn: vision.pgn || undefined,\n      gameData: {\n        white: gameData?.white || \'Unknown\',\n        black: gameData?.black || \'Unknown\',\n        event: gameData?.event,\n        date: gameData?.date,\n        result: gameData?.result,\n      },\n      returnPath: \'/marketplace\',\n    });\n    navigate(\'/order-print\');\n  };\n\n  const loadOrphanedVisions = useCallback(async () => {\n    setIsLoading(true);\n    const { data, error } = await getOrphanedVisualizations();\n    if (!error) {\n      setVisions(data);\n    }\n    setIsLoading(false);\n  }, []);\n\n  useEffect(() => {\n    loadOrphanedVisions();\n  }, [loadOrphanedVisions]);\n\n  const handleCardClick = (visionId: string) => {\n    trackMarketplaceClick({\n      click_type: \'claimable_vision\',\n      visualization_id: visionId,\n      section: \'claimable_visions\',\n      metadata: { is_premium: isPremium },\n    });\n    // Navigate to vision detail for full interactive experience\n    navigate(`/my-vision/${visionId}`);\n  };\n\n  const handleClaim = async (visionId: string, title: string) => {\n    // Track claim button click\n    trackMarketplaceClick({\n      click_type: \'claim_button\',\n      visualization_id: visionId,\n      section: \'claimable_visions\',\n      metadata: { is_premium: isPremium, user_authenticated: !!user },\n    });\n\n    if (!user) {\n      toast.error(\'Please sign in to claim visions\');\n      return;\n    }\n    if (!isPremium) {\n      toast.error(\'Premium membership required\', {\n        description: \'Upgrade to claim and own visions\',\n      });\n      return;\n    }\n\n    setClaimingId(visionId);\n    const { success, error } = await claimOrphanedVisualization(visionId);\n\n    if (error) {\n      toast.error(\'Failed to claim vision\', { description: error.message });\n    } else if (success) {\n      toast.success(\'Vision claimed!\', {\n        description: `"${title}" is now in your gallery`,\n        action: {\n          label: \'View\',\n          onClick: () => navigate(`/my-vision/${visionId}`),\n        },\n      });\n      // Refresh the list\n      loadOrphanedVisions();\n      onClaim?.();\n    }\n    setClaimingId(null);\n  };\n\n  // Don\'t show section if no orphaned visions\n  if (!isLoading && visions.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className="space-y-4">\n      <div className="flex items-center gap-3">\n        <div className="h-10 w-10 rounded-lg bg-green-500/10 flex items-center justify-center">\n          <Gift className="h-5 w-5 text-green-500" />\n        </div>\n        <div>\n          <h2 className="text-lg font-semibold flex items-center gap-2">\n            Claimable Visions\n            <Badge variant="secondary" className="text-xs">\n              {visions.length} available\n            </Badge>\n          </h2>\n          <p className="text-sm text-muted-foreground">\n            Unclaimed visions from expired memberships - free for premium members\n          </p>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <ClaimableGridSkeleton count={6} />\n      ) : (\n        <div className="flex gap-3 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory md:grid md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 md:overflow-visible md:pb-0">\n          {visions.map((vision, index) => (\n            <div\n              key={vision.id}\n              onClick={() => handleCardClick(vision.id)}\n              className="animate-fade-in cursor-pointer min-w-[160px] sm:min-w-[180px] md:min-w-0 snap-start"\n            >\n              <Card className="overflow-hidden group border-green-500/30 hover:border-green-500/60 transition-all">\n                <div className="aspect-square relative overflow-hidden bg-muted">\n                  {vision.image_path ? (\n                    <img\n                      src={vision.image_path}\n                      alt={vision.title}\n                      className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"\n                    />\n                  ) : (\n                    <div className="w-full h-full flex items-center justify-center">\n                      <Sparkles className="h-8 w-8 text-muted-foreground/30" />\n                    </div>\n                  )}\n                  \n                  {/* Free badge */}\n                  <Badge className="absolute top-2 right-2 bg-green-500/90 hover:bg-green-500 pointer-events-none">\n                    <Gift className="h-3 w-3 mr-1" />\n                    Free\n                  </Badge>\n\n                  {/* Transfer limit */}\n                  <div className="absolute bottom-2 left-2 pointer-events-none">\n                    <TransferLimitBadge visualizationId={vision.id} variant="compact" />\n                  </div>\n                </div>\n\n                <CardContent className="p-2.5">\n                  <h3 className="font-medium text-xs truncate mb-2">\n                    {vision.title || \'Untitled Vision\'}\n                  </h3>\n                  \n                  <div className="flex gap-1.5">\n                    {/* Order Print - Available to everyone */}\n                    <Button\n                      size="sm"\n                      variant="outline"\n                      className="flex-1 h-7 text-xs gap-1 border-amber-500/30 bg-amber-500/5 hover:bg-amber-500/10 text-amber-700 dark:text-amber-400"\n                      onClick={(e) => handleOrderPrint(e, vision)}\n                    >\n                      <Printer className="h-3 w-3" />\n                      Print\n                    </Button>\n                    \n                    {/* Claim - Premium only */}\n                    <Button\n                      size="sm"\n                      className="flex-1 h-7 text-xs gap-1"\n                      disabled={!isPremium || claimingId === vision.id}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleClaim(vision.id, vision.title);\n                      }}\n                    >\n                      {claimingId === vision.id ? (\n                        <Loader2 className="h-3 w-3 animate-spin" />\n                      ) : !isPremium ? (\n                        <>\n                          <Crown className="h-3 w-3" />\n                          Own\n                        </>\n                      ) : (\n                        <>\n                          <Gift className="h-3 w-3" />\n                          Claim\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {!isPremium && visions.length > 0 && (\n        <div className="flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/30">\n          <Crown className="h-5 w-5 text-amber-500 shrink-0" />\n          <span className="text-sm text-amber-600">\n            Upgrade to Premium to claim these unclaimed visions for free\n          </span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ClaimableVisionsSection;\n';export{n as default};
