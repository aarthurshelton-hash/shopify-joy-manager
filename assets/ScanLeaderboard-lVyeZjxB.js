const n='import { useState, useEffect, forwardRef } from "react";\nimport { motion, AnimatePresence } from "framer-motion";\nimport { Trophy, Medal, Award, Star, Crown, Target, Zap, Users, ChevronDown, ChevronUp } from "lucide-react";\nimport { Button } from "@/components/ui/button";\nimport { Badge } from "@/components/ui/badge";\nimport { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";\nimport { ScrollArea } from "@/components/ui/scroll-area";\nimport { supabase } from "@/integrations/supabase/client";\nimport { useAuth } from "@/hooks/useAuth";\n\ninterface LeaderboardEntry {\n  user_id: string;\n  display_name: string;\n  avatar_url: string | null;\n  unique_visions_scanned: number;\n  total_successful_scans: number;\n  total_scans: number;\n  last_scan_at: string;\n}\n\ninterface Achievement {\n  id: string;\n  type: string;\n  name: string;\n  description: string;\n  icon: React.ComponentType<{ className?: string }>;\n  color: string;\n  threshold: number;\n}\n\nconst ACHIEVEMENTS: Achievement[] = [\n  { id: "first_scan", type: "first_scan", name: "First Scan", description: "Complete your first successful scan", icon: Star, color: "text-yellow-500", threshold: 1 },\n  { id: "explorer_5", type: "explorer_5", name: "Explorer", description: "Scan 5 unique visions", icon: Target, color: "text-blue-500", threshold: 5 },\n  { id: "collector_10", type: "collector_10", name: "Collector", description: "Scan 10 unique visions", icon: Medal, color: "text-green-500", threshold: 10 },\n  { id: "hunter_25", type: "hunter_25", name: "Vision Hunter", description: "Scan 25 unique visions", icon: Award, color: "text-purple-500", threshold: 25 },\n  { id: "master_50", type: "master_50", name: "Scan Master", description: "Scan 50 unique visions", icon: Trophy, color: "text-orange-500", threshold: 50 },\n  { id: "legend_100", type: "legend_100", name: "Legend", description: "Scan 100 unique visions", icon: Crown, color: "text-primary", threshold: 100 },\n  { id: "scan_streak_10", type: "scan_streak_10", name: "Dedicated", description: "Complete 10 total scans", icon: Zap, color: "text-cyan-500", threshold: 10 },\n  { id: "scan_streak_50", type: "scan_streak_50", name: "Enthusiast", description: "Complete 50 total scans", icon: Zap, color: "text-pink-500", threshold: 50 },\n  { id: "scan_streak_100", type: "scan_streak_100", name: "Scanner Elite", description: "Complete 100 total scans", icon: Zap, color: "text-red-500", threshold: 100 },\n];\n\nexport const ScanLeaderboard = forwardRef<HTMLDivElement, object>(function ScanLeaderboard(_props, ref) {\n  const { user } = useAuth();\n  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);\n  const [userAchievements, setUserAchievements] = useState<string[]>([]);\n  const [userStats, setUserStats] = useState<LeaderboardEntry | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [expanded, setExpanded] = useState(false);\n  const [showAchievements, setShowAchievements] = useState(false);\n\n  useEffect(() => {\n    fetchLeaderboard();\n    if (user) {\n      fetchUserAchievements();\n    }\n  }, [user]);\n\n  const fetchLeaderboard = async () => {\n    try {\n      const { data, error } = await supabase\n        .from("scan_leaderboard")\n        .select("*")\n        .limit(20);\n\n      if (error) throw error;\n      setLeaderboard((data as LeaderboardEntry[]) || []);\n      \n      // Find current user in leaderboard\n      if (user && data) {\n        const userEntry = data.find((e: LeaderboardEntry) => e.user_id === user.id);\n        setUserStats(userEntry || null);\n      }\n    } catch (error) {\n      console.error("Error fetching leaderboard:", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchUserAchievements = async () => {\n    if (!user) return;\n    \n    try {\n      const { data, error } = await supabase\n        .from("scan_achievements")\n        .select("achievement_type")\n        .eq("user_id", user.id);\n\n      if (error) throw error;\n      setUserAchievements((data || []).map((a) => a.achievement_type));\n    } catch (error) {\n      console.error("Error fetching achievements:", error);\n    }\n  };\n\n  const getRankIcon = (rank: number) => {\n    switch (rank) {\n      case 1:\n        return <Crown className="h-5 w-5 text-yellow-500" />;\n      case 2:\n        return <Medal className="h-5 w-5 text-gray-400" />;\n      case 3:\n        return <Medal className="h-5 w-5 text-amber-600" />;\n      default:\n        return <span className="w-5 text-center text-sm text-muted-foreground">{rank}</span>;\n    }\n  };\n\n  const getUserRank = () => {\n    if (!user) return null;\n    const rank = leaderboard.findIndex((e) => e.user_id === user.id) + 1;\n    return rank > 0 ? rank : null;\n  };\n\n  if (loading) {\n    return (\n      <div className="p-4 rounded-xl bg-card border border-border">\n        <div className="animate-pulse space-y-3">\n          <div className="h-6 bg-muted rounded w-1/3" />\n          <div className="h-12 bg-muted rounded" />\n          <div className="h-12 bg-muted rounded" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={ref} className="rounded-xl bg-card border border-border overflow-hidden">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className="w-full p-4 flex items-center justify-between hover:bg-muted/50 transition-colors"\n      >\n        <div className="flex items-center gap-2">\n          <Trophy className="h-5 w-5 text-primary" />\n          <span className="font-display font-bold">Scan Leaderboard</span>\n          {getUserRank() && (\n            <Badge variant="secondary" className="text-xs">\n              #{getUserRank()}\n            </Badge>\n          )}\n        </div>\n        {expanded ? (\n          <ChevronUp className="h-4 w-4" />\n        ) : (\n          <ChevronDown className="h-4 w-4" />\n        )}\n      </button>\n\n      <AnimatePresence>\n        {expanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: "auto", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n          >\n            {/* Tab Toggle */}\n            <div className="px-4 pb-2 flex gap-2">\n              <Button\n                variant={!showAchievements ? "default" : "outline"}\n                size="sm"\n                onClick={() => setShowAchievements(false)}\n                className="flex-1"\n              >\n                <Users className="h-4 w-4 mr-1" />\n                Rankings\n              </Button>\n              <Button\n                variant={showAchievements ? "default" : "outline"}\n                size="sm"\n                onClick={() => setShowAchievements(true)}\n                className="flex-1"\n              >\n                <Award className="h-4 w-4 mr-1" />\n                Achievements\n              </Button>\n            </div>\n\n            {!showAchievements ? (\n              /* Leaderboard Rankings */\n              <ScrollArea className="max-h-80">\n                <div className="p-2 space-y-1">\n                  {leaderboard.length === 0 ? (\n                    <div className="p-6 text-center text-muted-foreground">\n                      <Trophy className="h-8 w-8 mx-auto mb-2 opacity-50" />\n                      <p className="text-sm">No scans yet</p>\n                      <p className="text-xs">Be the first to scan a vision!</p>\n                    </div>\n                  ) : (\n                    leaderboard.map((entry, index) => {\n                      const isCurrentUser = user?.id === entry.user_id;\n                      return (\n                        <motion.div\n                          key={entry.user_id}\n                          initial={{ opacity: 0, x: -20 }}\n                          animate={{ opacity: 1, x: 0 }}\n                          transition={{ delay: index * 0.05 }}\n                          className={`flex items-center gap-3 p-3 rounded-lg transition-colors ${\n                            isCurrentUser\n                              ? "bg-primary/10 border border-primary/20"\n                              : "hover:bg-muted/50"\n                          }`}\n                        >\n                          {/* Rank */}\n                          <div className="w-8 flex justify-center">\n                            {getRankIcon(index + 1)}\n                          </div>\n\n                          {/* Avatar */}\n                          <Avatar className="h-8 w-8">\n                            <AvatarImage src={entry.avatar_url || undefined} />\n                            <AvatarFallback>\n                              {entry.display_name?.charAt(0).toUpperCase() || "?"}\n                            </AvatarFallback>\n                          </Avatar>\n\n                          {/* Info */}\n                          <div className="flex-1 min-w-0">\n                            <div className="flex items-center gap-2">\n                              <span className="font-medium text-sm truncate">\n                                {entry.display_name || "Anonymous"}\n                              </span>\n                              {isCurrentUser && (\n                                <Badge variant="outline" className="text-xs">\n                                  You\n                                </Badge>\n                              )}\n                            </div>\n                            <div className="text-xs text-muted-foreground">\n                              {entry.total_successful_scans} scans\n                            </div>\n                          </div>\n\n                          {/* Score */}\n                          <div className="text-right">\n                            <div className="font-bold text-primary">\n                              {entry.unique_visions_scanned}\n                            </div>\n                            <div className="text-xs text-muted-foreground">unique</div>\n                          </div>\n                        </motion.div>\n                      );\n                    })\n                  )}\n                </div>\n              </ScrollArea>\n            ) : (\n              /* Achievements */\n              <ScrollArea className="max-h-80">\n                <div className="p-2 space-y-2">\n                  {ACHIEVEMENTS.map((achievement, index) => {\n                    const earned = userAchievements.includes(achievement.type);\n                    const Icon = achievement.icon;\n                    const progress = userStats\n                      ? achievement.type.includes("streak")\n                        ? userStats.total_successful_scans\n                        : userStats.unique_visions_scanned\n                      : 0;\n                    const progressPercent = Math.min(100, (progress / achievement.threshold) * 100);\n\n                    return (\n                      <motion.div\n                        key={achievement.id}\n                        initial={{ opacity: 0, y: 10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: index * 0.05 }}\n                        className={`p-3 rounded-lg border transition-all ${\n                          earned\n                            ? "bg-primary/10 border-primary/30"\n                            : "bg-muted/30 border-border opacity-60"\n                        }`}\n                      >\n                        <div className="flex items-center gap-3">\n                          <div\n                            className={`p-2 rounded-lg ${\n                              earned ? "bg-primary/20" : "bg-muted"\n                            }`}\n                          >\n                            <Icon\n                              className={`h-5 w-5 ${\n                                earned ? achievement.color : "text-muted-foreground"\n                              }`}\n                            />\n                          </div>\n                          <div className="flex-1">\n                            <div className="flex items-center gap-2">\n                              <span className="font-medium text-sm">\n                                {achievement.name}\n                              </span>\n                              {earned && (\n                                <Badge variant="secondary" className="text-xs">\n                                  Earned\n                                </Badge>\n                              )}\n                            </div>\n                            <p className="text-xs text-muted-foreground">\n                              {achievement.description}\n                            </p>\n                            {!earned && user && (\n                              <div className="mt-2">\n                                <div className="h-1 bg-muted rounded-full overflow-hidden">\n                                  <div\n                                    className="h-full bg-primary transition-all"\n                                    style={{ width: `${progressPercent}%` }}\n                                  />\n                                </div>\n                                <p className="text-xs text-muted-foreground mt-1">\n                                  {progress} / {achievement.threshold}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </motion.div>\n                    );\n                  })}\n                </div>\n              </ScrollArea>\n            )}\n\n            {/* Your Stats Summary */}\n            {user && userStats && (\n              <div className="p-4 border-t border-border">\n                <div className="grid grid-cols-3 gap-2 text-center">\n                  <div>\n                    <div className="text-lg font-bold text-primary">\n                      {userStats.unique_visions_scanned}\n                    </div>\n                    <div className="text-xs text-muted-foreground">Unique</div>\n                  </div>\n                  <div>\n                    <div className="text-lg font-bold">\n                      {userStats.total_successful_scans}\n                    </div>\n                    <div className="text-xs text-muted-foreground">Total</div>\n                  </div>\n                  <div>\n                    <div className="text-lg font-bold">\n                      {userAchievements.length}/{ACHIEVEMENTS.length}\n                    </div>\n                    <div className="text-xs text-muted-foreground">Badges</div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n});\n\nScanLeaderboard.displayName = \'ScanLeaderboard\';\n';export{n as default};
