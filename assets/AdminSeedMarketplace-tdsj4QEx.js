import{d6 as e,d7 as t,cp as n,a as s,u as r,r as a,J as i,o,s as l,aH as c,aa as u,cM as d,j as m,L as x,C as f,x as h,D as p,B as v,A as g,p as w,t as y,cN as j,bC as b,S as C,a6 as N,P as z,y as D,bG as M,T as _,aq as B,z as L,cU as q,aj as E,aT as S,ca as A,b as G,d8 as W}from"./index-ckGSTu6A.js";!function(){const e=Y,t=I();for(;;)try{if(634625===-parseInt(e(430))/1*(parseInt(e(322))/2)+parseInt(e(323))/3+parseInt(e(444))/4+parseInt(e(400))/5*(parseInt(e(326))/6)+-parseInt(e(375))/7+-parseInt(e(382))/8*(-parseInt(e(490))/9)+-parseInt(e(343))/10)break;t.push(t.shift())}catch(n){t.push(t.shift())}}();const k=function(){const e=Y,t={};t[e(347)]="DIevP";const n=t;let s=!0;return function(t,r){const a=e,i={};i[a(284)]=a(447);const o=i;if(a(479)!==n.BSTmW){const e=s?function(){if(r){const e=r.apply(t,arguments);return r=null,e}}:function(){};return s=!1,e}{const e=new _0x5ad70a;e[a(475)+"n"]=o[a(284)],e.onload=()=>_0x3f17a9(e),e[a(312)]=_0x4dbb55,e[a(483)]=_0x57348a}}}()(void 0,function(){const e=Y,t={};t.elbQl=e(480)+"+$";const n=t;return k[e(470)]()[e(295)](n.elbQl).toString()[e(305)+"r"](k).search(n[e(319)])});k();const P=function(){const e=Y,t={};t[e(353)]=e(428);const n=t;let s=!0;return function(t,r){const a=e;if(a(428)===n[a(353)]){const e=s?function(){if(r){const e=r.apply(t,arguments);return r=null,e}}:function(){};return s=!1,e}_0x3e6247=_0x59da27[a(308)+"e"](),_0x2daeb5&&(_0x41671c+=a(389)+_0x576fdd)}}();function I(){const e=["CMvZDg9Yzq","BgvMDa","zxrwA20","zwXIuwW","Bw1ZA0S","x19WCM90B19F","mtm2nJHgDuLvDg0","mZe4ntK0sg53BhnA","v2H0v28","ndaWideWChGGjW","mtmZmLfKqxrdza","tLqG4PMA","BKrnzu8","Bu1fq2e","qwDwD0G","CgLLy2u","quLnEuS","Aw5MBW","q0nbBwK","zw5Wzw5Zzw50lG","iZfbmueXqq","qKrbDMy","Aw1Hz2vtBw9VDa","zw50","ChvZAa","BNmTC2vYAwy","vw5RBM93BG","mtGXotyWotbHyvDksw8","ide4ChGGj0nVCG","AefZzwm","q2LUEMvSjYWGjW","qLnuBvC","D2Tmu1a","v0DcD0m","zM9UDa","Bw92zvrV","sfvJthq","s2zeq0u","ywjmt2W","CMv2B2TLt2jQzq","EK1LBLm","iIb2Awv3qM94pq","nJaWideZChGGjW","sw50zxiNlcbZyq","iZi5mJuYna","DenZDwi","yxbWBhK","zMLSBfjLy3q","y2vUDgvY","B25SB2fK","EfrAA0C","BgLNAhq","Bg9N","D3CUDZmUB3jNlW","C1Dwz2G","Dgv4DefSAwDU","yNj1Ew4","vhrIwe8","vNfiDLK","ntK2nJHjqLjIAeq","BgXOq0e","u2Xht3O","D2fYBG","CMvHzhK","y2XPCa","Bw9Yyw50jYWGrW","mZK2odHnsMX2vMS","zxjYB3i","D2LKDgG9iG","BwLU","i2u3ztvLna","Bgf5zxjtAxPL","u1H2ywi","icdIGkiGia","ywXWAgfIzxrPyW","CM4GDgHPCYiPka","CMLM","iZbbmeeWqq","uNfxy1K","AxnmAwDODa","CxjJB2rL","AxrHBgLJiduWma","sgvcrNK","zMLSBa","mtqZmtvqwejyyNi","r3Pgv04","Dhj6BKy","y29SB3i","C3LJEei","psjODhrWoI8VDW","CMv0DxjUicHMDq","y3jLyxrLrwXLBq","qLH6t2e","Aw1Hz2uVC3zNkW","idiWChGGj0nVCG","tvP4req","rLP5CLm","phn2zYb4BwXUCW","DMLZAxrZ","zxrbExC","CKrgBwW","C2vhzNa","C3vIC3rYAw5N","AM9PBG","AgLUz1f1ywXPDa","q2XZANa","t3D3vhm","yMXHy2S","Ahr0Chm6lY9LBG","iI8+","r1LJu3G","wKnWt1K","uxb5C0q","mJaWmc9ZDMCIia","mJjNEwDYD0y","BwvHC3vYzvrLEa","mc45nsK","zLPpAxm","DuDMD3q","q2rSEvK","Bw92zxm","EgXqB2i","yvzKAe8","y3jLyxrLt2jQzq","rhvqELa","C3rYB2TL","iIb5psi","iIbMAwXSpsi","nde3mtm0mfjwDg9MCq","z3Dbww4","BwLKzgXL","yw5VBNLTB3vZ","D2LKDgG","qKzkyNy","ntaWideYChGGjW","DgrZuhC","qNnzEgm","uM9Tyw4NlcbZzq","C3Hfshy","ruLRDKq","zM9UDhm","AgvPz2H0","DhLWzq","zMLSBfrLEhq","C3rYB2TLu3r5Ba","4PMuievoifbftLnf","y3Dhwve","ChjVDg90ExbL","zxHJzxb0Aw9U","yxjJ","z2v0q29UDgv4Da","y3rVCIGICMv0Dq","wg5HyLO","ru4Guevou0vova","Dg9tDhjPBMC","E30Uy29UC3rYDq","C2f2zq","vLf6Eue","AgLNAa","y3jVC3npCMLNAq","Eg1So2nOyxjZzq","BfjYqKK","DhjHBNnWyxjLBG","yuPKEvu","kcGOlISPkYKRkq","Dgv4DejHC2vSAq","tMzjyum","C3jJ","C3bSAxq","zxzLBNq","BgLUzvrV","zvLuuNi","DNDWy08","pc9ZDMC+","mtuWm1vYv1LpEq","thDZCxi","y29UC29Szq","v2HPDgu","BwvZlcbZzxjPzG","DhjHy2u","Dd11DgyToa","yM9YzgvY","B1ftCg8","AgLUz0vUywjSzq","BhnPuNa","wefODg8","tw5nChK","iIbOzwLNAhq9iG","ihzZia","EgP4tMW","zw9Yz2LHlcbZzq","t05qree","i0zerKngqG","y3rvuKW","rKvTA2S","ndaWideXChGGjW","A0juBeK","zgf0zq","rLb2v1i","rvHIvve","qK1JquC","CM91BMrszwn0","DuXTEM8","BgLUzvDPzhrO","zhjHD0LTywDL","yLDkAxC","mJu1lcaYntuSia","CMDIysGYntuSia","yMvNAw5qyxrO","CNzuuxq","i2e4yti5zq","C2vHCMnO","CLj4s1e","vgLTzxmGtMv3ia","ntaWideXChGGjW","nJaWidi0ChGGjW","yMLUza","zMLSBfn0EwXL","uMfYC24","zgfYAW","iZC4nZe2yW","y29UC3rYDwn0BW","CMvKDwnL","i0zbrKfgqq","Dg9vChbLCKnHCW","BgvUz3rO","BgPYtfy","sxnSDgm","B25LCNjVCG","Dg9eyxrHvvjm","zhrOpsi","phjLy3qGEd0I"];return(I=function(){return e})()}function Y(e,t){e-=283;const n=I();let s=n[e];if(void 0===Y.CJUHqf){var r=function(e){let t="",n="",s=t+r;for(let r,a,i=0,o=0;a=e.charAt(o++);~a&&(r=i%4?64*r+a:a,i++%4)?t+=s.charCodeAt(o+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(a);for(let r=0,a=t.length;r<a;r++)n+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(n)};Y.XZkZil=r,Y.hnVkdB={},Y.CJUHqf=!0}const a=e+n[0],i=Y.hnVkdB[a];if(i)s=i;else{const e=function(e){this.desgrm=e,this.sRyvav=[1,0,0],this.aYWmJK=function(){return"newState"},this.UDXffr="\\w+ *\\(\\) *{\\w+ *",this.QjpnAO="['|\"].+['|\"];? *}"};e.prototype.mvEiKp=function(){const e=new RegExp(this.UDXffr+this.QjpnAO).test(this.aYWmJK.toString())?--this.sRyvav[1]:--this.sRyvav[0];return this.YoaeDh(e)},e.prototype.YoaeDh=function(e){return Boolean(~e)?this.FjPBmP(this.desgrm):e},e.prototype.FjPBmP=function(e){for(let t=0,n=this.sRyvav.length;t<n;t++)this.sRyvav.push(Math.round(Math.random())),n=this.sRyvav.length;return e(this.sRyvav[0])},new e(Y).mvEiKp(),s=Y.XZkZil(s),Y.hnVkdB[a]=s}return s}P(void 0,function(){const e=Y,t={MnMpy:function(e,t){return e===t},AgVwH:e(345),etosB:function(e,t){return e(t)},kBTlI:function(e,t){return e+t},wgeSF:e(406)+"nction() ",FEmkk:function(e){return e()},etVkm:e(378),HUcLt:e(464),vwpcO:e(495)},n=t[e(510)](function(){const n=e;let s;try{t[n(502)](t[n(330)],n(433))?(_0x330bfd[n(288)](_0xc92cf3,_0x2367cb,_0x5a3c12,_0x173d00,_0x30772f),_0x2ec026()):s=t.etosB(Function,t[n(512)](t.wgeSF+(n(471)+n(467)+n(391)+" )"),");"))()}catch(r){s=window}return s}),s=n[e(492)]=n[e(492)]||{},r=[e(368),t[e(318)],e(333),e(383),t[e(352)],"table",t[e(488)]];for(let a=0;a<r[e(309)];a++){const t=P[e(305)+"r"][e(463)][e(300)](P),n=r[a],i=s[n]||t;t[e(321)]=P.bind(P),t.toString=i[e(470)][e(300)](i),s[n]=t}})();async function K(){const e=Y;document[e(456)]&&document[e(456)][e(379)]&&await document[e(456)][e(379)],await new Promise(e=>setTimeout(e,150))}function H(n,s){const r=Y,a={};a[r(374)]=function(e,t){return e*t},a[r(452)]=function(e,t){return e+t},a[r(361)]=function(e,t){return e+t},a[r(426)]=function(e,t){return e*t},a[r(324)]=function(e,t){return e*t},a[r(377)]=function(e,t){return e<t},a[r(311)]=function(e,t){return e/t},a[r(505)]=function(e,t){return e-t},a[r(421)]=function(e,t){return e+t};const i=a,o=s/8,l=i[r(374)](s,.02),c=i[r(452)](s,2*l);let u=r(413)+r(405)+r(369)+r(429)+r(384)+c+r(503)+c+(r(357)+'"0 0 ')+c+" "+c+'">';u+='<rect x="0" y="0" wi'+r(314)+c+r(503)+c+r(443)+e[r(497)]+'"/>';for(let d=0;d<8;d++){const s=7-d;for(let a=0;a<8;a++){const c=n[s][a],m=c[r(395)]?e[r(367)]:e[r(303)],x=i[r(361)](l,i[r(374)](a,o)),f=i.BsYxc(l,i[r(426)](d,o));if(u+=r(315)+x+r(442)+f+'" width="'+o+r(503)+o+r(443)+m+r(425),c[r(414)][r(309)]>0){const e=.08*o,n=[];for(const i of c.visits){const e=t(i[r(331)],i[r(403)]);!n.includes(e)&&n[r(340)](e)}const s=Math[r(385)](n[r(309)],6),a=[];let l=o-i[r(324)](e,2);const d=i[r(374)](l,.7)/s;for(let t=0;i[r(377)](t,s);t++){const e={};if(e[r(403)]=n[t],e[r(387)]=l,a.push(e),l-=d,l<i[r(374)](o,.1))break}for(const t of a){const e=i[r(311)](i[r(505)](o,t.layerSize),2);u+='<rect x="'+i[r(421)](x,e)+r(442)+i[r(361)](f,e)+'" width="'+t.layerSize+r(503)+t.layerSize+r(443)+t[r(403)]+r(425)}}}}return u+=r(489),u}async function O(e,t,n){const s=Y,r={rDFml:function(e,t){return e(t)},EIkvD:"Failed to load SVG",QWGQH:"canvas",ljrLV:function(e,t){return e*t},oQSpo:s(415)};return new Promise((a,i)=>{const o=s,l={RqWcY:r.QWGQH,XAhto:function(e,t){return r[Y(310)](e,t)},trznF:function(e,t){return r.rDFml(e,t)}};if(r[o(498)]!=r[o(498)]){if(_0x3339bd){const e=_0x592949[o(362)](_0x478470,arguments);return _0x3a2b49=null,e}}else{const s=new Image,c={};c[o(458)]=o(409)+o(476)+o(496);const u=new Blob([e],c),d=URL[o(439)+o(509)](u);s[o(365)]=()=>{const e=o,r=document[e(407)+"ent"](l[e(394)]);r[e(448)]=5*t,r[e(457)]=l[e(501)](n,5);const i=r[e(466)]("2d");i.scale(5,5),i[e(288)](s,0,0,t,n),URL[e(355)+e(509)](d),l[e(402)](a,r)},s.onerror=()=>{const e=o;URL["revokeObje"+e(509)](d),r[e(416)](i,new Error(r[e(455)]))},s[o(483)]=d}})}async function T(e){const t=Y,n={};n[t(449)]=t(396),n[t(332)]=t(307),n[t(445)]=t(336);const s=n,r=(await import(s[t(449)])).default,a={};a[t(303)]=e?s[t(332)]:s[t(445)],a[t(367)]=t(478)+"t";const i={width:200,margin:1};return i[t(403)]=a,i.errorCorrectionLevel="M",r[t(313)](t(424)+"pensent.com",i)}async function Z(){const e=Y,t={SXvab:function(e){return e()},tvXOg:function(e,t){return e!==t},zDDwP:e(348)};return new Promise((s,r)=>{const a=e,i={NfIaC:function(e){return t[Y(388)](e)}};if(t.tvXOg(t.zDDwP,"wkLSP")){const e={rvTQt:function(e){return i[Y(482)](e)}};_0x231817[a(365)]=()=>{const t=a;_0x91997b[t(288)](_0x2340b0,_0x3668ee,_0x19a753,_0x5cf72c,_0x477f73),e[t(293)](_0xe43bdf)},_0x580387[a(312)]=()=>_0x5c16ba(),_0x566eb2[a(483)]=_0x99bbe6}else{const e=new Image;e[a(475)+"n"]=a(447),e[a(365)]=()=>s(e),e[a(312)]=r,e[a(483)]=n}})}const U=A.filter(e=>"custom"!==e.id);const F=["Exemplar â„–001 â€¢ Genesis","Exemplar â„–002 â€¢ Prototype","Exemplar â„–003 â€¢ Blueprint","Exemplar â„–004 â€¢ Foundation","Exemplar â„–005 â€¢ Pioneer","Exemplar â„–006 â€¢ Alpha","Exemplar â„–007 â€¢ Benchmark","Exemplar â„–008 â€¢ Catalyst","Exemplar â„–009 â€¢ Origin","Exemplar â„–010 â€¢ Spectrum","Exemplar â„–011 â€¢ Prism","Exemplar â„–012 â€¢ Vertex","Exemplar â„–013 â€¢ Meridian","Exemplar â„–014 â€¢ Zenith","Exemplar â„–015 â€¢ Nexus","Exemplar â„–016 â€¢ Axiom","Exemplar â„–017 â€¢ Epoch","Exemplar â„–018 â€¢ Vector","Exemplar â„–019 â€¢ Cipher","Exemplar â„–020 â€¢ Matrix","Exemplar â„–021 â€¢ Helix","Exemplar â„–022 â€¢ Synthesis","Exemplar â„–023 â€¢ Thesis","Exemplar â„–024 â€¢ Opus","Exemplar â„–025 â€¢ Finale","Sunset Clash","Ocean Depths","Earth Tones","Forest Canopy","Copper Age","Midnight Purple","Rustic Charm","Steel Gray","Olive Grove","Slate Dreams","Berry Burst","Sandy Beach","Wine Country","Mint Fresh","Mahogany Dreams","Arctic Ice","Coral Reef","Lavender Fields","Bronze Medal","Neon Nights","Autumn Leaves","Crystal Cave","Desert Dusk","Emerald City","Fire Dance"];const R=()=>{const e=s(),{user:t,isLoading:n}=r(),[k,P]=a.useState(null),[I,R]=a.useState(!1),[X,V]=a.useState(0),[J,$]=a.useState(""),[Q,ee]=a.useState([]),[te,ne]=a.useState(50),[se,re]=a.useState(!0),[ae,ie]=a.useState(!1),[oe,le]=a.useState(null);a.useEffect(()=>{n||(async()=>{if(!t)return void P(!1);const{data:e}=await l.rpc("has_role",{_user_id:t.id,_role:"admin"});P(!0===e)})()},[t,n]);const ce=a.useCallback(async(e,n,s,r,a=!0)=>{try{const m=i(e.pgn),x=a?U[Math.floor(Math.random()*U.length)]:U[s%U.length],f=function(e,t){const n=A.find(e=>e.id===t)||A[0];return e.map(e=>e.map(e=>({...e,visits:e.visits.map(e=>{const t=("w"===e.color?n.white:n.black)[e.piece]||"#888888";return{...e,hexColor:t}})})))}(m.board,x.id);o(x.id);const h=await async function(e,t,n={}){const s=Y,r={rRxKQ:s(364),TtbXO:function(e,t){return e+t},GzFWN:function(e,t){return e-t},HeBFy:function(e,t){return e/t},uGfwt:function(e,t){return e+t},ZCpOY:function(e){return e()},blfSf:function(e){return e()},CdlyY:function(e,t,n){return e(t,n)},WGBwC:function(e,t){return e*t},XnabZ:function(e,t){return e+t},cpzhh:function(e,t,n,s){return e(t,n,s)},lRrBI:function(e,t){return e+t},sxEHv:"canvas",ONPDA:s(474),eYTRr:s(393),eZTNY:s(508),omfBe:function(e,t){return e+t},tdsPw:s(304),mMECa:s(294),EXbUQ:"Black",lsiRp:s(504),Lwsqr:s(299)+s(346)+s(297)+s(453)+s(392),zMenS:function(e,t){return e+t},DuPzP:function(e,t){return e!==t},sycxB:function(e,t){return e||t},xlPob:s(450)+s(359)+"ns-serif",BDAvf:s(320),cwGYQ:function(e,t){return e+t},FZyrS:function(e,t){return e*t},bWJiw:function(e,t){return e+t},FhFoM:"left",xTZkG:function(e,t){return e+t},bruyn:s(325)+s(297)+"Roman', Ti"+s(494),BXzOa:function(e,t){return e+t},sWVgh:function(e,t){return e===t},nDMeO:"abLOl",zRcXG:function(e,t){return e<t},uLmzo:function(e,t){return e-t},Rarsn:function(e,t){return e(t)},RObRx:function(e){return e()},FPvWR:function(e,t){return e-t},seGfp:s(386),aVdhO:function(e,t){return e+t},llhCA:function(e,t){return e+t},zNxDa:function(e,t){return e*t},OwwTs:function(e,t){return e+t},CCAmi:s(390),uIipm:s(469),VQzyA:s(335)+"com",KeIIR:function(e,t){return e+t}};await r.blfSf(K);const{boardSize:a=600,darkMode:i=!1,withWatermark:o=!1,title:l}=n,c=r[s(435)](H,e,a),u=r[s(349)](a,.02),d=r[s(468)](a,2*u),m=await r.cpzhh(O,c,d,d),x=60,f=d+120,h=r.lRrBI(r[s(373)](r[s(434)](d,220),60),r[s(349)](x,2)),p=document[s(407)+s(339)](r[s(454)]);p.width=5*f,p.height=5*h;const v=p[s(466)]("2d");v.scale(5,5),v[s(338)+s(499)+"d"]=!0,v[s(338)+s(420)+"y"]=r[s(507)],v[s(301)]=i?r[s(487)]:r.eZTNY,v[s(363)](0,0,f,h),v[s(288)](m,0,0,m[s(448)],m[s(457)],x,x,d,d);const g=r.omfBe(r[s(468)](x,d),28);v[s(460)+"e"]=s(i?360:386),v[s(287)]=1,v[s(292)](),v[s(351)](x,g),v[s(486)](f-x,g),v[s(441)]();const w=i?"#fafaf9":"#292524",y=s(i?294:304),j=i?r[s(451)]:r[s(329)],b=i?r[s(451)]:"#a8a29e",C=f/2;let N=g+55;const z=t.white||s(493),D=t[s(423)]||r[s(283)];v[s(481)+"ne"]=s(446),v[s(350)]=s(299)+"Cinzel', 'Times New "+s(453)+s(392);const M=v[s(431)+"t"](z)[s(448)],_=v[s(431)+"t"](D)[s(448)];v[s(350)]=s(397)+s(410)+s(381)+s(506)+"rif";const B=r[s(500)],L=v[s(431)+"t"](B)[s(448)],q=M+L+_,E=C-r[s(398)](q,2);v[s(350)]=s(299)+s(346)+s(297)+"Roman', se"+s(392),v[s(301)]=w,v.textAlign=s(317),v[s(459)](z,E,N),v[s(350)]=s(397)+" 20px 'Cor"+s(381)+s(506)+s(392),v[s(301)]=b,v[s(459)](B,E+M,N),v[s(350)]=r[s(491)],v[s(301)]=w,v.fillText(D,r[s(356)](r[s(477)](E,M),L),N),N+=36,t[s(485)]&&r[s(440)](t[s(485)],"Unknown")&&(v[s(301)]=y,v[s(350)]=s(397)+s(344)+s(381)+s(506)+s(392),v[s(371)]=s(364),v[s(459)](t[s(485)],C,N),N+=32);const S=l,A=t[s(513)]||"";if(r[s(404)](S,A)){v[s(301)]=j,v[s(350)]=r[s(437)],v[s(371)]=s(364);let e="";if(S)if(r[s(337)]==r[s(337)])e=S[s(308)+"e"](),A&&(e+=r[s(462)](s(389),A));else{const e=_0xd9f8be[s(305)+"r"][s(463)][s(300)](_0x514c4a),t=_0x544b23[_0xe52ce6],n=_0x30e3e8[t]||e;e[s(321)]=_0x1a06d6.bind(_0x4a8310),e[s(470)]=n[s(470)][s(300)](n),_0x52ed0a[t]=e}else e=A;const t=2,n=e[s(484)](""),a=n.reduce((e,t)=>e+v[s(431)+"t"](t)[s(448)],0),i=r[s(412)](r[s(401)](n[s(309)],1),t);let o=C-r[s(289)](a,i)/2;for(const l of n)v.textAlign=r.FhFoM,v[s(459)](l,o,N),o+=r[s(366)](v.measureText(l)[s(448)],t);N+=28}if(t[s(436)]&&t[s(436)][s(309)]>0){v.fillStyle=j,v[s(350)]=r[s(372)],v[s(371)]=s(364);const e=t.moves[s(419)](" "),n=e[s(309)]>400?r[s(408)](e[s(418)](0,400),"..."):e,a=r[s(401)](f,120)-40,i=n.split(" ");let o="",l=N;const c=15,u=4;let d=0;for(const t of i){const e=o+(o?" ":"")+t;if(v[s(431)+"t"](e)[s(448)]>a&&o){if(s(411)!=s(411)){const e=_0x378255[s(362)](_0x4409a5,arguments);return _0x30f1bc=null,e}if(v.fillText(o,C,l),o=t,l+=c,d++,d>=u)break}else if(r[s(370)](s(354),r[s(328)]))o=e;else{_0x2ecda3[s(301)]=_0x32c5c3,_0x5561ee[s(350)]=s(450)+s(359)+"ns-serif",_0x1c59f5.textAlign=r[s(296)];let e="";_0x14f17e?(e=_0x3f9806[s(308)+"e"](),_0x134c71&&(e+=r[s(373)](s(389),_0x34aa68))):e=_0x499a7a;const t=2,n=e.split(""),a=n[s(306)]((e,t)=>e+_0x2fdaab[s(431)+"t"](t)[s(448)],0),i=r[s(401)](n[s(309)],1)*t;let o=r[s(401)](_0x2def03,r[s(398)](r.uGfwt(a,i),2));for(const l of n)_0x118687[s(371)]=s(317),_0x4a9886[s(459)](l,o,_0x53c985),o+=r.uGfwt(_0xb2edac.measureText(l)[s(448)],t);_0x2b1a17+=28}}o&&r.zRcXG(d,u)&&v.fillText(o,C,l)}const G=r[s(401)](r[s(286)](h,x),20);v.fillStyle=j,v.font=s(298)+"Inter', sa"+s(341),v.textAlign="center";const W=(s(461)+s(327))[s(484)]("");let k=C-(W[s(306)]((e,t)=>e+v[s(431)+"t"](t)[s(448)],0)+4*r[s(286)](W.length,1))/2;for(const P of W)v[s(371)]=r.FhFoM,v[s(459)](P,k,G),k+=r[s(289)](v[s(431)+"t"](P).width,4);if(o){const[e,t]=await Promise.all([r[s(302)](T,!1),r.RObRx(Z)]),n=220,a=65,i=r[s(286)](r[s(514)](x+d,n),12),o=x+d-a-12;v[s(301)]=s(291)+s(290)+s(432),v[s(292)](),v[s(285)](i,o,n,a,6),v[s(399)](),v.strokeStyle=r[s(417)],v[s(287)]=1,v[s(441)]();const l=48,c=r[s(438)](i,12),u=r[s(376)](o,r.HeBFy(r[s(286)](a,l),2));v[s(472)](),v[s(292)](),v[s(465)](c+l/2,u+r[s(398)](l,2),l/2,0,r.zNxDa(Math.PI,2)),v[s(380)](),v[s(288)](t,c,u,l,l),v[s(316)]();const m=r[s(422)](c+l,10);v[s(371)]=r.FhFoM,v[s(481)+"ne"]=r[s(334)],v[s(301)]="#44403c",v[s(350)]=s(358)+s(359)+"ns-serif",v.fillText(r.uIipm,m,o+28),v[s(301)]=r[s(451)],v.font=s(511)+"Inter', sa"+s(341),v[s(459)](r[s(473)],m,r.KeIIR(o,46));const f=50,h=r[s(514)](r.uLmzo(r.uGfwt(i,n),f),10),p=r[s(462)](o,(a-f)/2),g=new Image;await new Promise(t=>{g.onload=()=>{const e=Y;v[e(288)](g,h,p,f,f),r[e(427)](t)},g.onerror=()=>t(),g.src=e})}return p}(f,m.gameData,{boardSize:600,darkMode:!1,withWatermark:!1,title:n}),p=await new Promise((e,t)=>{h.toBlob(n=>{n?e(n):t(new Error("Failed to create blob"))},"image/png",.95)}),v=Date.now(),g=`${t.id}/${v}-${n.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,{error:w}=await l.storage.from("visualizations").upload(g,p,{contentType:"image/png",upsert:!1});if(w)throw w;const{data:y}=l.storage.from("visualizations").getPublicUrl(g),j=c(e.pgn),b={white:m.gameData.white,black:m.gameData.black,event:m.gameData.event,date:m.gameData.date,result:m.gameData.result,pgn:m.gameData.pgn,moves:m.gameData.moves,board:f,totalMoves:m.totalMoves,visualizationState:{paletteId:x.id,paletteName:x.name,isOfficialPalette:!0,darkMode:!1,currentMove:1/0,isExemplar:r,exemplarNumber:r?s+1:void 0,gameHash:j}},{data:C,error:N}=await l.from("saved_visualizations").insert({user_id:t.id,title:n,pgn:e.pgn,game_data:b,image_path:y.publicUrl}).select().single();if(N)throw N;const z=function(e,t){if(e){const e=99,n=Math.max(0,10*(25-t));return e+Math.floor(300*Math.random())+n}return 199+Math.floor(600*Math.random())}(r,s),{data:D,error:M}=await u(C.id,z);if(M)throw M;const _=function(e,t){const n=e?1.5:1,s=e?Math.max(0,.1*(25-t)):0;return{viewCount:Math.floor((15*Math.random()+3)*n+5*s),hdDownloads:Math.floor(3*Math.random()*n),gifDownloads:Math.floor(2*Math.random()*n),tradeCount:e?Math.floor(2*Math.random()):0}}(r,s);for(let e=0;e<_.viewCount;e++)await l.rpc("record_vision_interaction",{p_visualization_id:C.id,p_user_id:t.id,p_interaction_type:"view"}),await new Promise(e=>setTimeout(e,50));const B=d(e.pgn),L=a?"premium":"genesis";return{title:n,success:!0,visualizationId:C.id,listingId:null==D?void 0:D.id,isExemplar:r,paletteId:x.id,paletteName:x.name,gameHash:j,tier:L,openingName:null==B?void 0:B.fullName}}catch(m){return{title:n,success:!1,error:m.message,isExemplar:r}}},[t]),ue=Q.filter(e=>e.success).length,de=Q.filter(e=>!e.success).length;return Q.filter(e=>e.success&&e.isExemplar).length,n||null===k?m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:m.jsx(x,{className:"h-8 w-8 animate-spin text-primary"})}):t&&k?m.jsx("div",{className:"min-h-screen bg-background p-8",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs(v,{variant:"ghost",onClick:()=>e("/marketplace"),className:"mb-6",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Return to Marketplace"]}),m.jsxs(f,{children:[m.jsx(w,{children:m.jsxs(y,{className:"flex items-center gap-3",children:[m.jsx(j,{className:"h-6 w-6 text-primary"}),"Seed Marketplace with Visions"]})}),m.jsxs(h,{className:"space-y-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/30",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(b,{className:"h-5 w-5 text-amber-500 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-amber-600",children:"CEO Only"}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Generates ",te," visions: ",Math.min(25,te)," Exemplar editions (numbered testers from our humble beginnings) + ",Math.max(0,te-25)," creative community visions. Exemplars: $0.99-$4.99, Creative: $1.99-$7.99."]})]})]})}),m.jsxs("div",{className:"flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("label",{className:"text-sm text-muted-foreground",children:"Number of visions:"}),m.jsxs("select",{value:te,onChange:e=>ne(Number(e.target.value)),disabled:I,className:"bg-muted border border-border rounded px-3 py-2",children:[m.jsx("option",{value:5,children:"5 (test)"}),m.jsx("option",{value:10,children:"10"}),m.jsx("option",{value:25,children:"25"}),m.jsx("option",{value:50,children:"50"})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(C,{id:"use-official-palettes",checked:se,onCheckedChange:re,disabled:I}),m.jsxs(N,{htmlFor:"use-official-palettes",className:"flex items-center gap-2",children:[m.jsx(z,{className:"h-4 w-4 text-primary"}),m.jsx("span",{className:"text-sm",children:"Official Palettes"})]})]}),se&&m.jsxs(D,{variant:"secondary",className:"text-xs",children:[U.length," palettes"]})]})]}),m.jsx(v,{onClick:async()=>{if(!t)return void G.error("You must be logged in as the CEO account");R(!0),ee([]),V(0);const e=[],n=W.slice(0,Math.min(te,W.length)),s=[];for(let t=0;t<te;t++){const e=t%n.length,r=t<25,a=F[t]||`Vision ${t+1}`;s.push({game:n[e],title:a,isExemplar:r})}for(let t=0;t<s.length;t++){const{game:n,title:r,isExemplar:a}=s[t];$(`${a?"ðŸ†":"ðŸŽ¨"} ${r} (${t+1}/${s.length})`);const i=await ce(n,r,t,a,se);e.push(i),ee([...e]),V((t+1)/s.length*100),await new Promise(e=>setTimeout(e,300))}R(!1);const r=e.filter(e=>e.success).length,a=e.filter(e=>!e.success).length,i=e.filter(e=>e.success&&e.isExemplar).length;r>0?G.success(`Created ${r} visions`,{description:`${i} Exemplars, ${r-i} Creative${a>0?` (${a} failed)`:""}`}):G.error("Failed to create any visions")},disabled:I||!t,className:"w-full",size:"lg",children:I?m.jsxs(m.Fragment,{children:[m.jsx(x,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating..."]}):m.jsxs(m.Fragment,{children:[m.jsx(M,{className:"h-5 w-5 mr-2"}),"Start Seeding"]})}),m.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[m.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 border border-destructive/30 mb-4",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsx(_,{className:"h-5 w-5 text-destructive mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-destructive",children:"Delete My Test Visions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Deletes only YOUR visions that have NOT earned royalties from other users' print orders. Visions with natural value accrual are preserved. Safe for testing cleanup."})]})]})}),m.jsx(v,{onClick:async()=>{if(!t)return;if(window.confirm("This will delete all YOUR visions that have NOT earned royalties from other users' print orders.\n\nVisions with natural value accrual will be preserved.\n\nAre you sure?")){ie(!0),le(null);try{const{data:e,error:n}=await l.from("saved_visualizations").select("id").eq("user_id",t.id);if(n)throw n;if(!e||0===e.length)return G.info("No visions to delete"),void ie(!1);const s=e.map(e=>e.id),{data:r,error:a}=await l.from("vision_scores").select("visualization_id, royalty_cents_earned, royalty_orders_count").in("visualization_id",s);if(a)throw a;const i=new Set((r||[]).filter(e=>e.royalty_cents_earned>0||e.royalty_orders_count>0).map(e=>e.visualization_id)),o=s.filter(e=>!i.has(e)),c=s.filter(e=>i.has(e));if(0===o.length)return G.info("All your visions have accrued natural value - none deleted"),le({deleted:0,preserved:c.length}),void ie(!1);await l.from("visualization_listings").delete().in("visualization_id",o),await l.from("vision_scores").delete().in("visualization_id",o),await l.from("vision_interactions").delete().in("visualization_id",o),await l.from("visualization_transfers").delete().in("visualization_id",o);const{error:u}=await l.from("saved_visualizations").delete().in("id",o);if(u)throw u;for(const d of e.filter(e=>o.includes(e.id)))await l.storage.from("visualizations").remove([`${t.id}/`]);le({deleted:o.length,preserved:c.length}),G.success(`Deleted ${o.length} test visions`,{description:c.length>0?`${c.length} visions with natural value preserved`:void 0})}catch(e){G.error("Failed to delete visions",{description:e.message})}finally{ie(!1)}}},disabled:ae||I||!t,variant:"destructive",className:"w-full",size:"lg",children:ae?m.jsxs(m.Fragment,{children:[m.jsx(x,{className:"h-5 w-5 mr-2 animate-spin"}),"Deleting Test Visions..."]}):m.jsxs(m.Fragment,{children:[m.jsx(_,{className:"h-5 w-5 mr-2"}),"Delete My Test Visions"]})}),oe&&m.jsx("div",{className:"mt-4 p-3 rounded-lg bg-muted text-sm",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("span",{className:"text-destructive",children:["ðŸ—‘ ",oe.deleted," deleted"]}),oe.preserved>0&&m.jsxs("span",{className:"text-green-500",children:["âœ“ ",oe.preserved," preserved (has value)"]})]})})]}),I&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(B,{value:X,className:"h-2"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:J})]}),Q.length>0&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[m.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[m.jsx(L,{className:"h-4 w-4"}),ue," successful"]}),m.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[m.jsx(q,{className:"h-4 w-4"}),Q.filter(e=>e.success&&"premium"===e.tier).length," Premium"]}),m.jsxs("span",{className:"flex items-center gap-1 text-blue-500",children:[m.jsx(E,{className:"h-4 w-4"}),Q.filter(e=>e.success&&"genesis"===e.tier).length," Genesis"]}),de>0&&m.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[m.jsx(p,{className:"h-4 w-4"}),de," failed"]})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-border rounded-lg p-2",children:Q.map((e,t)=>m.jsxs(S.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"text-sm p-2 rounded flex items-center justify-between gap-2 "+(e.success?"premium"===e.tier?"bg-purple-500/10 border border-purple-500/20":"bg-blue-500/10 border border-blue-500/20":"bg-red-500/10 text-red-600"),children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.success?"premium"===e.tier?m.jsx(q,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}):m.jsx(E,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):m.jsx(p,{className:"h-4 w-4 text-red-500 flex-shrink-0"}),m.jsx("span",{className:"truncate",children:e.title}),e.openingName&&m.jsx(D,{variant:"secondary",className:"text-[9px] hidden sm:inline-flex",children:e.openingName}),e.error&&m.jsxs("span",{className:"text-xs opacity-70",children:["(",e.error,")"]})]}),e.success&&m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsxs(D,{variant:"outline",className:"text-[10px] "+("premium"===e.tier?"border-purple-500/50":"border-blue-500/50"),children:[m.jsx(z,{className:"h-2.5 w-2.5 mr-1"}),e.paletteName]}),e.gameHash&&m.jsx("a",{href:`/g/${e.gameHash}?p=${e.paletteId}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-primary hover:underline",children:"View â†’"})]})]},t))})]})]})]})]})}):m.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-8",children:m.jsx(f,{className:"max-w-md",children:m.jsxs(h,{className:"pt-6 text-center",children:[m.jsx(p,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),m.jsx("h2",{className:"text-xl font-bold mb-2",children:"Access Denied"}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"You need admin privileges to access this page."}),m.jsx(v,{onClick:()=>e("/"),children:"Go Home"})]})})})};export{R as default};
