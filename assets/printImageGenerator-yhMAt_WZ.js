const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1k5cZzy0.js","assets/index-MGWJ9q8p.css"])))=>i.map(i=>d[i]);
import{bN as e}from"./index-1k5cZzy0.js";import{a as t}from"./browser-DhmD84ER.js";async function a(a,o={}){var i,r;const{darkMode:n=!1,includeQR:c=!1,shareId:l,capturedState:s,withWatermark:d=!1,highlightState:m,pgn:p}=o;if(!a)throw new Error("Invalid simulation data: simulation is null");if(!a.board||!Array.isArray(a.board)||0===a.board.length)throw new Error("Invalid simulation data: board is empty or invalid");if(!a.gameData)throw new Error("Invalid simulation data: gameData is missing");const u=(await e(async()=>{const{default:e}=await import("./html2canvas.esm-C2s7aB6S.js");return{default:e}},[])).default,w=document.createElement("div");w.style.position="absolute",w.style.left="-9999px",w.style.top="-9999px",document.body.appendChild(w);try{const o=await e(()=>import("./index-1k5cZzy0.js").then(e=>e.R),__vite__mapDeps([0,1])),b=await e(()=>import("./index-1k5cZzy0.js").then(e=>e.c),__vite__mapDeps([0,1])),{default:f}=await e(async()=>{const{default:e}=await import("./index-1k5cZzy0.js").then(e=>e.ga);return{default:e}},__vite__mapDeps([0,1])),_=s&&s.currentMove!==1/0&&s.currentMove>0?(h=a.board,(v=s.currentMove)===1/0||v<=0?h:h.map(e=>e.map(e=>({...e,visits:e.visits.filter(e=>e.moveNumber<=v)})))):a.board,k=(null==s?void 0:s.darkMode)??n;let C;if(c&&l)try{C=await(async(e,a=100)=>{const o=`${window.location.origin}/v/${e}`;return t.toDataURL(o,{width:a,margin:0,color:{dark:"#D4AF37",light:"#00000000"},errorCorrectionLevel:"H"})})(l,96)}catch(g){}const E=document.createElement("div");w.appendChild(E);const D=(null==(i=null==s?void 0:s.lockedPieces)?void 0:i.length)??0,P=(null==(r=null==s?void 0:s.lockedSquares)?void 0:r.length)??0,T=m||((D>0||P>0)&&s?{lockedPieces:(s.lockedPieces||[]).map(e=>({pieceType:e.pieceType,pieceColor:"white"===e.pieceColor?"w":"black"===e.pieceColor?"b":e.pieceColor})),lockedSquares:(s.lockedSquares||[]).map(e=>({square:e.square,pieces:e.pieces.map(e=>({pieceType:e.pieceType,pieceColor:"white"===e.pieceColor?"w":"black"===e.pieceColor?"b":e.pieceColor}))})),compareMode:s.compareMode}:void 0),M=(null==s?void 0:s.showPieces)?{showPieces:s.showPieces,pieceOpacity:s.pieceOpacity??.7,currentMoveNumber:s.currentMove!==1/0?s.currentMove:void 0}:void 0,R=b.createRoot(E);let A;await new Promise(e=>{R.render(o.createElement(f,{board:_,gameData:a.gameData,size:440,darkMode:k,showQR:c&&!!C,qrDataUrl:C,compact:!1,highlightState:T,piecesState:M,pgn:p||a.gameData.pgn,withWatermark:d})),setTimeout(e,500)}),await new Promise(e=>setTimeout(e,500));let I=0;const S=3;for(;I<S;)try{A=await u(E,{scale:3,backgroundColor:k?"#0A0A0A":"#FDFCFB",useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:15e3});break}catch(y){if(I++,I>=S)throw new Error(`html2canvas failed after ${S} attempts: ${y}`);await new Promise(e=>setTimeout(e,500))}const x=A.toDataURL("image/png",1);return R.unmount(),x}finally{document.body.removeChild(w)}var h,v}export{a as generateCleanPrintImage};
