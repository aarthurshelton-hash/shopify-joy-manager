import{aJ as e,e0 as s,e1 as a,c_ as t,cQ as r,j as l,C as i,x as n,aP as c,G as d,bF as o,cb as m,p as x,t as u,w as h,dt as p,aT as j,y as g,aq as v,ad as N,cZ as f,s as y,r as b,b as _,F as w,b7 as k,bC as C,bQ as S,bR as A,B as q,ax as M,bT as D,bU as T,v as L,cT as F,a9 as P,b8 as E,b9 as R,ba as $,bb as U,bc as z,z as O,D as I,ah as K,bo as V,az as H,I as B,e2 as W,T as G,am as Q,e3 as J,a1 as Z,a2 as Y,a3 as X,a4 as ee,db as se,dc as ae,dd as te,q as re,ak as le,b4 as ie,a8 as ne,al as ce,ao as de,an as oe,aG as me,bh as xe,b2 as ue,b3 as he,e4 as pe,cR as je,e5 as ge,dZ as ve,a_ as Ne,E as fe,L as ye,bG as be,dg as _e,aA as we,aY as ke,aB as Ce,aC as Se,aD as Ae,aE as qe,aV as Me,aj as De,cn as Te,P as Le,u as Fe,dj as Pe,H as Ee,bs as Re,A as $e,dk as Ue,b1 as ze,e6 as Oe,b0 as Ie,au as Ke}from"./index-Cppn2aUX.js";import{C as Ve}from"./calendar-CEY-FYPj.js";import{T as He}from"./trending-down-BAdE-Alh.js";import{M as Be}from"./message-square-D2C-FKlK.js";import{u as We}from"./useMutation-BgQ2t7tV.js";import{n as Ge,X as Qe,Y as Je,o as Ze,R as Ye,T as Xe,p as es,q as ss,B as as}from"./BarChart-CMxblHiB.js";import{a as ts,C as rs,A as ls}from"./AreaChart-CJ7p8All.js";import{L as is}from"./Line-DAdfO1uf.js";import{C as ns}from"./circle-alert-Df3Vw_Op.js";import{B as cs,A as ds,L as os}from"./LiveCodebaseDebugger-BHIXsCKj.js";import"./file-code-C-g8HfJf.js";import"./waves-C--m-8aI.js";import"./git-branch-DvYJtDbD.js";const ms=e("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),xs=e("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),us=e("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),hs=e("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]),ps=e("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),js=e("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function gs(e,t){const r=s(e);return isNaN(t)?a(e,NaN):t?(r.setDate(r.getDate()+t),r):r}var vs=Ge({chartName:"LineChart",GraphicalChild:is,axisComponents:[{axisType:"xAxis",AxisComp:Qe},{axisType:"yAxis",AxisComp:Je}],formatAxisMap:Ze});const Ns=()=>{const{data:e,isLoading:s}=t({queryKey:["admin-location-analytics"],queryFn:async()=>{const{data:e,error:s}=await y.from("user_location_analytics").select("*");if(s)throw s;return e||[]}}),a=r.useMemo(()=>{if(!(null==e?void 0:e.length))return[];const s=new Map;e.forEach(e=>{if(e.country){const a=s.get(e.country)||{count:0,code:e.country_code||""};s.set(e.country,{count:a.count+1,code:a.code})}});const a=e.length;return Array.from(s.entries()).map(([e,s])=>({country:e,country_code:s.code,user_count:s.count,percentage:s.count/a*100})).sort((e,s)=>s.user_count-e.user_count)},[e]),b=r.useMemo(()=>{if(!(null==e?void 0:e.length))return[];const s=new Map;return e.forEach(e=>{if(e.city){const a=`${e.city}-${e.region}-${e.country}`,t=s.get(a);t?t.user_count++:s.set(a,{city:e.city,region:e.region||"",country:e.country||"",user_count:1})}}),Array.from(s.values()).sort((e,s)=>s.user_count-e.user_count).slice(0,20)},[e]),_=r.useMemo(()=>(null==e?void 0:e.length)?[...e].sort((e,s)=>new Date(s.last_seen_at).getTime()-new Date(e.last_seen_at).getTime()).slice(0,10):[],[e]),w=r.useMemo(()=>{if(!(null==e?void 0:e.length))return[];const s=new Map;return e.forEach(e=>{e.timezone&&s.set(e.timezone,(s.get(e.timezone)||0)+1)}),Array.from(s.entries()).map(([e,s])=>({timezone:e,count:s})).sort((e,s)=>s.count-e.count).slice(0,10)},[e]),k=e=>{if(!e||2!==e.length)return"ðŸŒ";const s=e.toUpperCase().split("").map(e=>127397+e.charCodeAt(0));return String.fromCodePoint(...s)};return s?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(c,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Tracked Users"})]}),l.jsx("p",{className:"text-2xl font-bold",children:(null==e?void 0:e.length)||0})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(d,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Countries"})]}),l.jsx("p",{className:"text-2xl font-bold",children:a.length})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(o,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Cities"})]}),l.jsx("p",{className:"text-2xl font-bold",children:b.length})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(m,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Timezones"})]}),l.jsx("p",{className:"text-2xl font-bold",children:w.length})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(d,{className:"h-5 w-5"}),"Users by Country"]}),l.jsx(h,{children:"Geographic distribution of your user base"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[300px]",children:l.jsx("div",{className:"space-y-3",children:0===a.length?l.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No location data yet"}):a.map((e,s)=>l.jsxs(j.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*s},className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:k(e.country_code)}),l.jsx("span",{className:"font-medium",children:e.country})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(g,{variant:"outline",children:[e.user_count," users"]}),l.jsxs("span",{className:"text-sm text-muted-foreground w-12 text-right",children:[e.percentage.toFixed(1),"%"]})]})]}),l.jsx(v,{value:e.percentage,className:"h-1.5"})]},e.country))})})})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(o,{className:"h-5 w-5"}),"Top Cities"]}),l.jsx(h,{children:"Most active user locations"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[300px]",children:l.jsx("div",{className:"space-y-2",children:0===b.length?l.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No city data yet"}):b.map((e,s)=>l.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.03*s},className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 text-primary text-xs font-bold",children:s+1}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:e.city}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.region&&`${e.region}, `,e.country]})]})]}),l.jsx(g,{variant:"secondary",children:e.user_count})]},`${e.city}-${e.region}`))})})})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(N,{className:"h-5 w-5"}),"Recent Location Activity"]}),l.jsx(h,{children:"Latest user location updates"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[300px]",children:l.jsx("div",{className:"space-y-2",children:0===_.length?l.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No recent activity"}):_.map((e,s)=>l.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05*s},className:"flex items-center justify-between p-2 rounded-lg border border-border/50",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{children:k(e.country_code||"")}),l.jsxs("div",{children:[l.jsxs("p",{className:"text-sm font-medium",children:[e.city||"Unknown",e.region?`, ${e.region}`:""]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:e.country})]})]}),l.jsx("span",{className:"text-xs text-muted-foreground",children:f(new Date(e.last_seen_at),{addSuffix:!0})})]},e.id))})})})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5"}),"Timezone Distribution"]}),l.jsx(h,{children:"When your users are most active"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[300px]",children:l.jsx("div",{className:"space-y-2",children:0===w.length?l.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No timezone data yet"}):w.map((e,s)=>l.jsxs(j.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{delay:.05*s},className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50",children:[l.jsx("span",{className:"text-sm font-medium",children:e.timezone}),l.jsxs(g,{variant:"outline",children:[e.count," users"]})]},e.timezone))})})})]})]})]})},fs={info:{icon:K,color:"text-blue-500",bg:"bg-blue-500/10",border:"border-blue-500/30"},warning:{icon:C,color:"text-amber-500",bg:"bg-amber-500/10",border:"border-amber-500/30"},error:{icon:I,color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/30"},critical:{icon:k,color:"text-red-600",bg:"bg-red-600/10",border:"border-red-600/30"},success:{icon:O,color:"text-green-500",bg:"bg-green-500/10",border:"border-green-500/30"}},ys={login:ps,logout:J,signup:W,view:Q,download:M,delete:G,update:js,create:W,payment:B,settings:H,user:V},bs=()=>{const[e,s]=b.useState(""),[a,c]=b.useState("all"),[d,o]=b.useState("all"),[v,N]=b.useState(!0),{data:O,isLoading:I,refetch:K}=t({queryKey:["admin-security-audit-logs",a,d],queryFn:async()=>{let e=y.from("security_audit_log").select("*").order("created_at",{ascending:!1}).limit(500);"all"!==a&&(e=e.eq("severity",a)),"all"!==d&&(e=e.eq("action_category",d));const{data:s,error:t}=await e;if(t)throw t;return s||[]},refetchInterval:!!v&&1e4});b.useEffect(()=>{const e=y.channel("security-audit-log-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"security_audit_log"},()=>{K()}).subscribe();return()=>{y.removeChannel(e)}},[K]);const V=r.useMemo(()=>{if(!O)return[];const e=new Set(O.map(e=>e.action_category));return Array.from(e).sort()},[O]),H=r.useMemo(()=>{if(!O)return[];if(!e)return O;const s=e.toLowerCase();return O.filter(e=>{var a,t,r;return e.action_type.toLowerCase().includes(s)||e.action_category.toLowerCase().includes(s)||(null==(a=e.target_type)?void 0:a.toLowerCase().includes(s))||(null==(t=e.target_id)?void 0:t.toLowerCase().includes(s))||(null==(r=e.ip_address)?void 0:r.toLowerCase().includes(s))})},[O,e]),B=r.useMemo(()=>{if(!(null==O?void 0:O.length))return{total:0,critical:0,warnings:0,today:0};const e=new Date;return e.setHours(0,0,0,0),{total:O.length,critical:O.filter(e=>"critical"===e.severity||"error"===e.severity).length,warnings:O.filter(e=>"warning"===e.severity).length,today:O.filter(s=>new Date(s.created_at)>=e).length}},[O]),W=b.useCallback(()=>{if(!H.length)return void _.error("No data to export");const e=H.map(e=>[w(new Date(e.created_at),"yyyy-MM-dd HH:mm:ss"),e.action_type,e.action_category,e.severity,e.user_id||"",e.admin_id||"",e.target_type||"",e.target_id||"",e.ip_address||"",e.user_agent||"",JSON.stringify(e.metadata||{})]),s=[["Timestamp","Action Type","Category","Severity","User ID","Admin ID","Target Type","Target ID","IP Address","User Agent","Metadata"].join(","),...e.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(","))].join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),r=URL.createObjectURL(a);t.setAttribute("href",r),t.setAttribute("download",`security-audit-log-${w(new Date,"yyyy-MM-dd-HHmmss")}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),_.success(`Exported ${H.length} events to CSV`)},[H]),G=b.useCallback(()=>{if(!H.length)return void _.error("No data to export");const s={exportedAt:(new Date).toISOString(),filters:{severity:a,category:d,search:e||null},totalEvents:H.length,events:H.map(e=>({id:e.id,timestamp:e.created_at,actionType:e.action_type,actionCategory:e.action_category,severity:e.severity,userId:e.user_id,adminId:e.admin_id,targetType:e.target_type,targetId:e.target_id,ipAddress:e.ip_address,userAgent:e.user_agent,metadata:e.metadata}))},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),r=document.createElement("a"),l=URL.createObjectURL(t);r.setAttribute("href",l),r.setAttribute("download",`security-audit-log-${w(new Date,"yyyy-MM-dd-HHmmss")}.json`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),_.success(`Exported ${H.length} events to JSON`)},[H,a,d,e]);return I?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(k,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Total Events"})]}),l.jsx("p",{className:"text-2xl font-bold",children:B.total})]})}),l.jsx(i,{className:"border-red-500/30 bg-red-500/5",children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-red-500 mb-1",children:[l.jsx(C,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Critical/Errors"})]}),l.jsx("p",{className:"text-2xl font-bold text-red-500",children:B.critical})]})}),l.jsx(i,{className:"border-amber-500/30 bg-amber-500/5",children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-amber-500 mb-1",children:[l.jsx(C,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Warnings"})]}),l.jsx("p",{className:"text-2xl font-bold text-amber-500",children:B.warnings})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(m,{className:"h-4 w-4"}),l.jsx("span",{className:"text-sm",children:"Today"})]}),l.jsx("p",{className:"text-2xl font-bold",children:B.today})]})})]}),l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(k,{className:"h-5 w-5"}),"Security Audit Log"]}),l.jsx(h,{children:"Track all security-related events on the platform"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(S,{children:[l.jsx(A,{asChild:!0,children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2",children:[l.jsx(M,{className:"h-4 w-4"}),"Export"]})}),l.jsxs(D,{align:"end",children:[l.jsxs(T,{onClick:W,className:"gap-2 cursor-pointer",children:[l.jsx(us,{className:"h-4 w-4"}),"Export as CSV"]}),l.jsxs(T,{onClick:G,className:"gap-2 cursor-pointer",children:[l.jsx(xs,{className:"h-4 w-4"}),"Export as JSON"]})]})]}),l.jsxs(q,{variant:v?"default":"outline",size:"sm",onClick:()=>N(!v),className:"gap-2",children:[l.jsx(L,{className:"h-4 w-4 "+(v?"animate-spin":"")}),v?"Live":"Paused"]}),l.jsx(q,{variant:"outline",size:"sm",onClick:()=>K(),children:l.jsx(L,{className:"h-4 w-4"})})]})]})}),l.jsxs(n,{children:[l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l.jsx(P,{placeholder:"Search events...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),l.jsxs(E,{value:a,onValueChange:c,children:[l.jsx(R,{className:"w-full sm:w-40",children:l.jsx($,{placeholder:"Severity"})}),l.jsxs(U,{children:[l.jsx(z,{value:"all",children:"All Severities"}),l.jsx(z,{value:"critical",children:"Critical"}),l.jsx(z,{value:"error",children:"Error"}),l.jsx(z,{value:"warning",children:"Warning"}),l.jsx(z,{value:"info",children:"Info"}),l.jsx(z,{value:"success",children:"Success"})]})]}),l.jsxs(E,{value:d,onValueChange:o,children:[l.jsx(R,{className:"w-full sm:w-40",children:l.jsx($,{placeholder:"Category"})}),l.jsxs(U,{children:[l.jsx(z,{value:"all",children:"All Categories"}),V.map(e=>l.jsx(z,{value:e,children:e},e))]})]})]}),l.jsx(p,{className:"h-[500px]",children:l.jsx("div",{className:"space-y-2",children:0===H.length?l.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[l.jsx(k,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"No audit log entries found"}),l.jsx("p",{className:"text-sm",children:"Events will appear here as they occur"})]}):H.map((e,s)=>{const a=fs[e.severity]||fs.info,t=a.icon,r=(e=>{const s=e.split("_")[0].toLowerCase();return ys[s]||k})(e.action_type);return l.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.02*s},className:`p-4 rounded-lg border ${a.border} ${a.bg}`,children:l.jsxs("div",{className:"flex items-start justify-between gap-4",children:[l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:`p-2 rounded-full ${a.bg}`,children:l.jsx(t,{className:`h-4 w-4 ${a.color}`})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx(r,{className:"h-4 w-4 text-muted-foreground"}),l.jsx("span",{className:"font-medium",children:e.action_type}),l.jsx(g,{variant:"outline",className:"text-xs",children:e.action_category}),l.jsx(g,{variant:"secondary",className:`text-xs ${a.color}`,children:e.severity})]}),l.jsxs("div",{className:"mt-1 text-sm text-muted-foreground flex flex-wrap gap-x-4 gap-y-1",children:[e.target_type&&l.jsxs("span",{children:["Target: ",e.target_type," ",e.target_id?`(${e.target_id.slice(0,8)}...)`:""]}),e.ip_address&&l.jsxs("span",{children:["IP: ",e.ip_address]}),e.user_id&&l.jsxs("span",{children:["User: ",e.user_id.slice(0,8),"..."]}),e.admin_id&&l.jsxs("span",{className:"text-primary",children:["Admin: ",e.admin_id.slice(0,8),"..."]})]}),e.metadata&&Object.keys(e.metadata).length>0&&l.jsxs("details",{className:"mt-2",children:[l.jsx("summary",{className:"text-xs text-muted-foreground cursor-pointer hover:text-foreground",children:"View metadata"}),l.jsx("pre",{className:"mt-1 text-xs bg-muted/50 p-2 rounded overflow-x-auto",children:JSON.stringify(e.metadata,null,2)})]})]})]}),l.jsxs("div",{className:"text-right shrink-0",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:f(new Date(e.created_at),{addSuffix:!0})}),l.jsx("p",{className:"text-xs text-muted-foreground",children:w(new Date(e.created_at),"MMM d, HH:mm:ss")})]})]})},e.id)})})})]})]})]})},_s=({userId:e,open:s,onClose:a})=>{var r,c,d,o,m,h,j,v,b,_,k,C;const{data:S,isLoading:A}=t({queryKey:["admin-user-detail",e],queryFn:async()=>{if(!e)return null;const{data:s}=await y.from("profiles").select("*").eq("user_id",e).single(),{data:a}=await y.from("user_subscriptions").select("*").eq("user_id",e).single(),{data:t}=await y.from("user_wallets").select("*").eq("user_id",e).single(),{data:r}=await y.from("saved_visualizations").select("\n          id,\n          title,\n          created_at,\n          image_path,\n          game_data\n        ").eq("user_id",e).order("created_at",{ascending:!1}),l=(null==r?void 0:r.map(e=>e.id))||[],{data:i}=await y.from("vision_scores").select("*").in("visualization_id",l.length>0?l:["none"]),{data:n}=await y.from("order_financials").select("*").eq("user_id",e).order("created_at",{ascending:!1}),{data:c}=await y.from("wallet_transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(20),{data:d}=await y.from("visualization_listings").select("*").eq("seller_id",e).order("created_at",{ascending:!1}),{data:o}=await y.from("vision_interactions").select("interaction_type, value_cents, created_at").eq("user_id",e),m=(null==i?void 0:i.reduce((e,s)=>e+10*(s.total_score||0)+(s.royalty_cents_earned||0),0))||0,x=.05*m;return{profile:s,subscription:a,wallet:t,visions:null==r?void 0:r.map(e=>{const s=null==i?void 0:i.find(s=>s.visualization_id===e.id);return{...e,score:(null==s?void 0:s.total_score)||0,views:(null==s?void 0:s.view_count)||0,downloads:((null==s?void 0:s.download_hd_count)||0)+((null==s?void 0:s.download_gif_count)||0),trades:(null==s?void 0:s.trade_count)||0,printOrders:(null==s?void 0:s.print_order_count)||0,royaltyEarned:(null==s?void 0:s.royalty_cents_earned)||0,estimatedValue:10*((null==s?void 0:s.total_score)||0)+((null==s?void 0:s.royalty_cents_earned)||0)}}),orders:n,transactions:c,listings:d,interactions:o,portfolioValue:m,projectedGrowth:x,totalOrderValue:(null==n?void 0:n.reduce((e,s)=>e+(s.gross_revenue_cents||0),0))||0,totalRoyalties:(null==i?void 0:i.reduce((e,s)=>e+(s.royalty_cents_earned||0),0))||0}},enabled:!!e}),q=e=>`$${(e/100).toFixed(2)}`,D="active"===(null==(r=null==S?void 0:S.subscription)?void 0:r.subscription_status);return l.jsx(Z,{open:s,onOpenChange:e=>!e&&a(),children:l.jsxs(Y,{className:"max-w-5xl max-h-[90vh] overflow-hidden",children:[l.jsx(X,{children:l.jsxs(ee,{className:"flex items-center gap-4",children:[l.jsxs(se,{className:"h-14 w-14",children:[l.jsx(ae,{src:(null==(c=null==S?void 0:S.profile)?void 0:c.avatar_url)||void 0}),l.jsx(te,{className:"bg-primary/10 text-primary text-xl",children:(null==(o=null==(d=null==S?void 0:S.profile)?void 0:d.display_name)?void 0:o.charAt(0).toUpperCase())||"U"})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{children:(null==(m=null==S?void 0:S.profile)?void 0:m.display_name)||"Anonymous User"}),D?l.jsxs(g,{className:"bg-primary/20 text-primary border-primary/30",children:[l.jsx(re,{className:"h-3 w-3 mr-1"}),"Premium"]}):l.jsx(g,{variant:"outline",children:"Free Account"})]}),l.jsxs("p",{className:"text-sm text-muted-foreground font-normal",children:["User ID: ",e]})]})]})}),A?l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsx(p,{className:"h-[calc(90vh-120px)]",children:l.jsxs("div",{className:"space-y-6 pr-4",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(le,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Wallet Balance"})]}),l.jsx("p",{className:"text-xl font-bold text-green-500",children:q((null==(h=null==S?void 0:S.wallet)?void 0:h.balance_cents)||0)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(ie,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Portfolio Value"})]}),l.jsx("p",{className:"text-xl font-bold text-primary",children:q((null==S?void 0:S.portfolioValue)||0)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(N,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Projected Growth"})]}),l.jsxs("p",{className:"text-xl font-bold text-green-500",children:["+",q((null==S?void 0:S.projectedGrowth)||0),"/mo"]})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(ne,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Total Royalties"})]}),l.jsx("p",{className:"text-xl font-bold",children:q((null==S?void 0:S.totalRoyalties)||0)})]})})]}),l.jsxs(i,{children:[l.jsx(x,{className:"pb-3",children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(V,{className:"h-5 w-5"}),"Account Details"]})}),l.jsx(n,{children:l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-muted-foreground",children:"Joined"}),l.jsx("p",{className:"font-medium",children:(null==(j=null==S?void 0:S.profile)?void 0:j.created_at)?w(new Date(S.profile.created_at),"MMM d, yyyy"):"Unknown"})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-muted-foreground",children:"Subscription"}),l.jsx("p",{className:"font-medium",children:(null==(v=null==S?void 0:S.subscription)?void 0:v.subscription_status)||"None"})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-muted-foreground",children:"Period End"}),l.jsx("p",{className:"font-medium",children:(null==(b=null==S?void 0:S.subscription)?void 0:b.current_period_end)?w(new Date(S.subscription.current_period_end),"MMM d, yyyy"):"N/A"})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-muted-foreground",children:"Total Spent"}),l.jsx("p",{className:"font-medium text-primary",children:q((null==(_=null==S?void 0:S.wallet)?void 0:_.total_spent_cents)||0)})]})]})})]}),l.jsxs(i,{children:[l.jsx(x,{className:"pb-3",children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(ce,{className:"h-5 w-5"}),"Vision Holdings (",(null==(k=null==S?void 0:S.visions)?void 0:k.length)||0,")"]})}),l.jsx(n,{children:(null==S?void 0:S.visions)&&S.visions.length>0?l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.visions.map(e=>l.jsxs("div",{className:"flex gap-4 p-3 rounded-lg border bg-muted/30",children:[l.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:l.jsx("img",{src:e.image_path,alt:e.title,className:"w-full h-full object-cover"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"font-medium truncate",children:e.title}),l.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Created ",f(new Date(e.created_at),{addSuffix:!0})]}),l.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[l.jsxs(g,{variant:"outline",className:"gap-1",children:[l.jsx(Q,{className:"h-3 w-3"}),e.views]}),l.jsxs(g,{variant:"outline",className:"gap-1",children:[l.jsx(M,{className:"h-3 w-3"}),e.downloads]}),l.jsxs(g,{variant:"outline",className:"gap-1",children:[l.jsx(de,{className:"h-3 w-3"}),e.trades]}),l.jsxs(g,{variant:"outline",className:"gap-1",children:[l.jsx(oe,{className:"h-3 w-3"}),e.printOrders]})]}),l.jsxs("div",{className:"flex items-center justify-between mt-2",children:[l.jsx("span",{className:"text-xs text-muted-foreground",children:"Est. Value"}),l.jsx("span",{className:"font-medium text-green-500",children:q(e.estimatedValue)})]})]})]},e.id))}):l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(ce,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),l.jsx("p",{children:"No visions in portfolio"})]})})]}),l.jsxs(i,{children:[l.jsx(x,{className:"pb-3",children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(me,{className:"h-5 w-5"}),"Order History (",(null==(C=null==S?void 0:S.orders)?void 0:C.length)||0,")"]})}),l.jsx(n,{children:(null==S?void 0:S.orders)&&S.orders.length>0?l.jsx("div",{className:"space-y-2",children:S.orders.slice(0,10).map(e=>l.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[l.jsxs("div",{children:[l.jsxs("p",{className:"font-medium capitalize",children:[e.order_type," Order"]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:w(new Date(e.created_at),"MMM d, yyyy h:mm a")})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"font-medium text-green-500",children:q(e.gross_revenue_cents)}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ref: ",e.order_reference||"N/A"]})]})]},e.id))}):l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(me,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),l.jsx("p",{children:"No orders yet"})]})})]}),l.jsxs(i,{children:[l.jsx(x,{className:"pb-3",children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(xe,{className:"h-5 w-5"}),"Recent Transactions"]})}),l.jsx(n,{children:(null==S?void 0:S.transactions)&&S.transactions.length>0?l.jsx("div",{className:"space-y-2",children:S.transactions.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-medium capitalize",children:e.transaction_type.replace("_"," ")}),l.jsx("p",{className:"text-xs text-muted-foreground",children:e.description||w(new Date(e.created_at),"MMM d, yyyy h:mm a")})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"font-medium "+(e.amount_cents>=0?"text-green-500":"text-red-500"),children:[e.amount_cents>=0?"+":"",q(e.amount_cents)]}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:["Balance: ",q(e.balance_after_cents)]})]})]},e.id))}):l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(xe,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),l.jsx("p",{children:"No transactions yet"})]})})]})]})})]})})},ws=({searchQuery:e,setSearchQuery:s,onSelectUser:a})=>{const{data:r,isLoading:c}=t({queryKey:["admin-users-list",e],queryFn:async()=>{const{data:s,error:a}=await y.from("profiles").select("user_id, display_name, avatar_url, created_at");if(a)throw a;const{data:t}=await y.from("user_subscriptions").select("user_id, subscription_status"),{data:r}=await y.from("saved_visualizations").select("user_id"),{data:l}=await y.from("user_wallets").select("user_id, balance_cents, total_spent_cents"),{data:i}=await y.from("order_financials").select("user_id"),{data:n}=await y.from("vision_interactions").select("user_id, created_at").order("created_at",{ascending:!1}),c=(s||[]).map(e=>{const s=null==t?void 0:t.find(s=>s.user_id===e.user_id),a=(null==r?void 0:r.filter(s=>s.user_id===e.user_id))||[],c=null==l?void 0:l.find(s=>s.user_id===e.user_id),d=(null==i?void 0:i.filter(s=>s.user_id===e.user_id))||[],o=null==n?void 0:n.find(s=>s.user_id===e.user_id);return{user_id:e.user_id,display_name:e.display_name,avatar_url:e.avatar_url,email:e.display_name||"Unknown",phone:null,created_at:e.created_at,is_premium:"active"===(null==s?void 0:s.subscription_status),vision_count:a.length,wallet_balance:(null==c?void 0:c.balance_cents)||0,total_orders:d.length,total_spent:(null==c?void 0:c.total_spent_cents)||0,last_activity:(null==o?void 0:o.created_at)||null}});if(e){const s=e.toLowerCase();return c.filter(e=>{var a,t;return(null==(a=e.display_name)?void 0:a.toLowerCase().includes(s))||(null==(t=e.email)?void 0:t.toLowerCase().includes(s))||e.user_id.toLowerCase().includes(s)})}return c.sort((e,s)=>e.last_activity?s.last_activity?new Date(s.last_activity).getTime()-new Date(e.last_activity).getTime():-1:1)},staleTime:3e4}),d=e=>`$${(e/100).toFixed(2)}`;return l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(V,{className:"h-5 w-5"}),"User Database"]}),l.jsx(h,{children:"Click on any user to view their complete profile and holdings"})]}),l.jsxs("div",{className:"relative w-full md:w-80",children:[l.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l.jsx(P,{placeholder:"Search users by name, email, or ID...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]})]})}),l.jsx(n,{children:c?l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsx(p,{className:"h-[600px]",children:l.jsxs("div",{className:"space-y-2",children:[null==r?void 0:r.map(e=>{var s;return l.jsxs("div",{onClick:()=>a(e.user_id),className:"flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-muted/50 cursor-pointer transition-colors group",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs(se,{className:"h-12 w-12",children:[l.jsx(ae,{src:e.avatar_url||void 0}),l.jsx(te,{className:"bg-primary/10 text-primary",children:(null==(s=e.display_name)?void 0:s.charAt(0).toUpperCase())||"U"})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"font-medium",children:e.display_name||"Anonymous"}),e.is_premium?l.jsxs(g,{className:"bg-primary/20 text-primary border-primary/30",children:[l.jsx(re,{className:"h-3 w-3 mr-1"}),"Premium"]}):l.jsx(g,{variant:"outline",className:"text-muted-foreground",children:"Free"})]}),l.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mt-1",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Ve,{className:"h-3 w-3"}),"Joined ",f(new Date(e.created_at),{addSuffix:!0})]}),e.last_activity&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Q,{className:"h-3 w-3"}),"Active ",f(new Date(e.last_activity),{addSuffix:!0})]})]})]})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-sm text-muted-foreground",children:"Visions"}),l.jsxs("p",{className:"font-medium flex items-center gap-1 justify-end",children:[l.jsx(ce,{className:"h-3 w-3"}),e.vision_count]})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-sm text-muted-foreground",children:"Wallet"}),l.jsx("p",{className:"font-medium text-green-500",children:d(e.wallet_balance)})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-sm text-muted-foreground",children:"Orders"}),l.jsx("p",{className:"font-medium",children:e.total_orders})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-sm text-muted-foreground",children:"Spent"}),l.jsx("p",{className:"font-medium",children:d(e.total_spent)})]}),l.jsx(ue,{className:"h-5 w-5 text-muted-foreground group-hover:text-primary transition-colors"})]})]},e.user_id)}),0===(null==r?void 0:r.length)&&l.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[l.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"No users found matching your search"})]})]})})})]})},ks=()=>{const[e,s]=b.useState("all"),[a,r]=b.useState("30"),{data:c,isLoading:d}=t({queryKey:["admin-orders",e,a],queryFn:async()=>{const s=pe((t=new Date,r=parseInt(a),gs(t,-r)));var t,r;let l=y.from("order_financials").select("*").gte("created_at",s.toISOString()).order("created_at",{ascending:!1});"all"!==e&&(l=l.eq("order_type",e));const{data:i,error:n}=await l;if(n)throw n;return i||[]},staleTime:3e4}),o={totalOrders:(null==c?void 0:c.length)||0,totalRevenue:(null==c?void 0:c.reduce((e,s)=>e+(s.gross_revenue_cents||0),0))||0,netRevenue:(null==c?void 0:c.reduce((e,s)=>e+(s.net_revenue_cents||0),0))||0,totalRoyalties:(null==c?void 0:c.reduce((e,s)=>e+(s.creator_royalty_cents||0),0))||0,byType:{print:(null==c?void 0:c.filter(e=>"print"===e.order_type).length)||0,book:(null==c?void 0:c.filter(e=>"book"===e.order_type).length)||0,subscription:(null==c?void 0:c.filter(e=>"subscription"===e.order_type).length)||0,marketplace:(null==c?void 0:c.filter(e=>"marketplace"===e.order_type).length)||0}},m=e=>`$${(e/100).toFixed(2)}`,j=e=>{switch(e){case"print":return l.jsx(oe,{className:"h-4 w-4"});case"book":return l.jsx(he,{className:"h-4 w-4"});case"subscription":return l.jsx(re,{className:"h-4 w-4"});case"marketplace":return l.jsx(de,{className:"h-4 w-4"});default:return l.jsx(me,{className:"h-4 w-4"})}},v=e=>{switch(e){case"print":return"bg-blue-500/10 text-blue-600 border-blue-500/30";case"book":return"bg-purple-500/10 text-purple-600 border-purple-500/30";case"subscription":return"bg-primary/10 text-primary border-primary/30";case"marketplace":return"bg-green-500/10 text-green-600 border-green-500/30";default:return"bg-muted text-muted-foreground"}};return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(me,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Total Orders"})]}),l.jsx("p",{className:"text-xl font-bold",children:o.totalOrders})]})}),l.jsx(i,{className:"border-green-500/30 bg-gradient-to-br from-green-500/5 to-green-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(ne,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Gross Revenue"})]}),l.jsx("p",{className:"text-xl font-bold text-green-500",children:m(o.totalRevenue)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(N,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Net Revenue"})]}),l.jsx("p",{className:"text-xl font-bold",children:m(o.netRevenue)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(re,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Creator Royalties"})]}),l.jsx("p",{className:"text-xl font-bold text-primary",children:m(o.totalRoyalties)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(oe,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Print Orders"})]}),l.jsx("p",{className:"text-xl font-bold",children:o.byType.print})]})})]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs(E,{value:e,onValueChange:s,children:[l.jsx(R,{className:"w-48",children:l.jsx($,{placeholder:"Order Type"})}),l.jsxs(U,{children:[l.jsx(z,{value:"all",children:"All Orders"}),l.jsx(z,{value:"print",children:"Print Orders"}),l.jsx(z,{value:"book",children:"Book Orders"}),l.jsx(z,{value:"subscription",children:"Subscriptions"}),l.jsx(z,{value:"marketplace",children:"Marketplace"})]})]}),l.jsxs(E,{value:a,onValueChange:r,children:[l.jsx(R,{className:"w-48",children:l.jsx($,{placeholder:"Date Range"})}),l.jsxs(U,{children:[l.jsx(z,{value:"7",children:"Last 7 Days"}),l.jsx(z,{value:"30",children:"Last 30 Days"}),l.jsx(z,{value:"90",children:"Last 90 Days"}),l.jsx(z,{value:"365",children:"Last Year"})]})]})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(me,{className:"h-5 w-5"}),"Order Log"]}),l.jsx(h,{children:"Complete order history with financial breakdown"})]}),l.jsx(n,{children:d?l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsx(p,{className:"h-[500px]",children:l.jsxs("div",{className:"space-y-2",children:[null==c?void 0:c.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-muted/30 transition-colors",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs(g,{variant:"outline",className:v(e.order_type),children:[j(e.order_type),l.jsx("span",{className:"ml-1 capitalize",children:e.order_type})]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:e.order_reference||`Order #${e.id.slice(0,8)}`}),l.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[l.jsx(Ve,{className:"h-3 w-3"}),w(new Date(e.created_at),"MMM d, yyyy h:mm a")]})]})]}),l.jsxs("div",{className:"flex items-center gap-6 text-right",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Gross"}),l.jsx("p",{className:"font-medium text-green-500",children:m(e.gross_revenue_cents)})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Fees"}),l.jsxs("p",{className:"font-medium text-red-500",children:["-",m(e.platform_fees_cents)]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Costs"}),l.jsxs("p",{className:"font-medium text-red-500",children:["-",m(e.fulfillment_costs_cents)]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Royalty"}),l.jsx("p",{className:"font-medium text-primary",children:m(e.creator_royalty_cents)})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Net"}),l.jsx("p",{className:"font-bold",children:m(e.net_revenue_cents)})]})]})]},e.id)),0===(null==c?void 0:c.length)&&l.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[l.jsx(me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"No orders found for the selected filters"})]})]})})})]})]})},Cs=()=>{const[e,s]=b.useState("all"),{data:a,isLoading:r}=t({queryKey:["admin-subscriptions",e],queryFn:async()=>{let s=y.from("user_subscriptions").select("*").order("created_at",{ascending:!1});"all"!==e&&(s=s.eq("subscription_status",e));const{data:a,error:t}=await s;if(t)throw t;const r=(null==a?void 0:a.map(e=>e.user_id))||[],{data:l}=await y.from("profiles").select("user_id, display_name, avatar_url").in("user_id",r.length>0?r:["none"]);return(null==a?void 0:a.map(e=>({...e,profile:null==l?void 0:l.find(s=>s.user_id===e.user_id)})))||[]},staleTime:3e4}),c={active:(null==a?void 0:a.filter(e=>"active"===e.subscription_status).length)||0,canceled:(null==a?void 0:a.filter(e=>"canceled"===e.subscription_status).length)||0,pastDue:(null==a?void 0:a.filter(e=>"past_due"===e.subscription_status).length)||0,trialing:(null==a?void 0:a.filter(e=>"trialing"===e.subscription_status).length)||0,mrr:700*((null==a?void 0:a.filter(e=>"active"===e.subscription_status).length)||0),expiringThisWeek:(null==a?void 0:a.filter(e=>{if(!e.current_period_end||"active"!==e.subscription_status)return!1;const s=new Date(e.current_period_end);return s<=gs(new Date,7)&&s>new Date}).length)||0},d=e=>{switch(e){case"active":return l.jsxs(g,{className:"bg-green-500/10 text-green-600 border-green-500/30",children:[l.jsx(je,{className:"h-3 w-3 mr-1"}),"Active"]});case"canceled":return l.jsxs(g,{className:"bg-red-500/10 text-red-600 border-red-500/30",children:[l.jsx(I,{className:"h-3 w-3 mr-1"}),"Canceled"]});case"past_due":return l.jsxs(g,{className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[l.jsx(C,{className:"h-3 w-3 mr-1"}),"Past Due"]});case"trialing":return l.jsxs(g,{className:"bg-blue-500/10 text-blue-600 border-blue-500/30",children:[l.jsx(m,{className:"h-3 w-3 mr-1"}),"Trialing"]});default:return l.jsx(g,{variant:"outline",children:e||"Unknown"})}};return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[l.jsx(i,{className:"border-green-500/30 bg-gradient-to-br from-green-500/5 to-green-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(je,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Active"})]}),l.jsx("p",{className:"text-xl font-bold text-green-500",children:c.active})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(I,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Canceled"})]}),l.jsx("p",{className:"text-xl font-bold",children:c.canceled})]})}),l.jsx(i,{className:"border-yellow-500/30 bg-gradient-to-br from-yellow-500/5 to-yellow-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(C,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Past Due"})]}),l.jsx("p",{className:"text-xl font-bold text-yellow-600",children:c.pastDue})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(m,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Trialing"})]}),l.jsx("p",{className:"text-xl font-bold",children:c.trialing})]})}),l.jsx(i,{className:"border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(ne,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"MRR"})]}),l.jsx("p",{className:"text-xl font-bold text-primary",children:(o=c.mrr,`$${(o/100).toFixed(2)}`)})]})}),l.jsx(i,{className:"border-orange-500/30 bg-gradient-to-br from-orange-500/5 to-orange-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(He,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Expiring Soon"})]}),l.jsx("p",{className:"text-xl font-bold text-orange-500",children:c.expiringThisWeek})]})})]}),l.jsxs(E,{value:e,onValueChange:s,children:[l.jsx(R,{className:"w-48",children:l.jsx($,{placeholder:"Filter by Status"})}),l.jsxs(U,{children:[l.jsx(z,{value:"all",children:"All Subscriptions"}),l.jsx(z,{value:"active",children:"Active"}),l.jsx(z,{value:"canceled",children:"Canceled"}),l.jsx(z,{value:"past_due",children:"Past Due"}),l.jsx(z,{value:"trialing",children:"Trialing"})]})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(re,{className:"h-5 w-5"}),"Subscription Database"]}),l.jsx(h,{children:"All premium subscriptions with renewal tracking"})]}),l.jsx(n,{children:r?l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsx(p,{className:"h-[500px]",children:l.jsxs("div",{className:"space-y-2",children:[null==a?void 0:a.map(e=>{var s,a,t,r;return l.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border bg-card hover:bg-muted/30 transition-colors",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs(se,{className:"h-10 w-10",children:[l.jsx(ae,{src:(null==(s=e.profile)?void 0:s.avatar_url)||void 0}),l.jsx(te,{className:"bg-primary/10 text-primary",children:(null==(t=null==(a=e.profile)?void 0:a.display_name)?void 0:t.charAt(0).toUpperCase())||"U"})]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:(null==(r=e.profile)?void 0:r.display_name)||"Unknown User"}),l.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[l.jsx(Ve,{className:"h-3 w-3"}),"Started ",f(new Date(e.created_at),{addSuffix:!0})]})]})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[d(e.subscription_status),l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Period End"}),l.jsx("p",{className:"font-medium",children:e.current_period_end?w(new Date(e.current_period_end),"MMM d, yyyy"):"N/A"})]}),e.cancel_at_period_end&&l.jsxs(g,{variant:"outline",className:"bg-orange-500/10 text-orange-600 border-orange-500/30",children:[l.jsx(C,{className:"h-3 w-3 mr-1"}),"Canceling"]}),e.grace_period_end&&l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Grace Period"}),l.jsx("p",{className:"font-medium text-orange-500",children:w(new Date(e.grace_period_end),"MMM d")})]}),l.jsx(ue,{className:"h-5 w-5 text-muted-foreground"})]})]},e.id)}),0===(null==a?void 0:a.length)&&l.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[l.jsx(re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"No subscriptions found"})]})]})})})]})]});var o},Ss=()=>{const[e,s]=b.useState([]),{data:a,isLoading:r,refetch:c}=t({queryKey:["admin-activity-feed"],queryFn:async()=>{var e,s,a,t,r,l;const[i,n,c,d,o,m]=await Promise.all([y.from("saved_visualizations").select("id, title, user_id, created_at").order("created_at",{ascending:!1}).limit(10),y.from("vision_interactions").select("id, interaction_type, user_id, value_cents, created_at").order("created_at",{ascending:!1}).limit(20),y.from("wallet_transactions").select("id, transaction_type, amount_cents, user_id, created_at").order("created_at",{ascending:!1}).limit(10),y.from("user_subscriptions").select("id, subscription_status, user_id, created_at, updated_at").order("updated_at",{ascending:!1}).limit(10),y.from("visualization_listings").select("id, status, price_cents, seller_id, created_at, sold_at").order("created_at",{ascending:!1}).limit(10),y.from("withdrawal_requests").select("id, status, amount_cents, user_id, created_at").order("created_at",{ascending:!1}).limit(10)]),x=[];return null==(e=i.data)||e.forEach(e=>{x.push({id:`vision-${e.id}`,type:"vision_created",description:`New vision created: "${e.title}"`,timestamp:e.created_at,user_id:e.user_id||void 0})}),null==(s=n.data)||s.forEach(e=>{const s={view:"Vision viewed",download_hd:"HD download",download_gif:"GIF download",print_order:"Print ordered",trade:"Trade completed"}[e.interaction_type]||e.interaction_type;x.push({id:`interaction-${e.id}`,type:e.interaction_type,description:s,timestamp:e.created_at,user_id:e.user_id||void 0,value:e.value_cents})}),null==(a=c.data)||a.forEach(e=>{x.push({id:`tx-${e.id}`,type:`wallet_${e.transaction_type}`,description:`Wallet ${e.transaction_type}: $${(Math.abs(e.amount_cents)/100).toFixed(2)}`,timestamp:e.created_at,user_id:e.user_id,value:e.amount_cents})}),null==(t=d.data)||t.forEach(e=>{x.push({id:`sub-${e.id}`,type:`subscription_${e.subscription_status}`,description:`Subscription ${e.subscription_status}`,timestamp:e.updated_at,user_id:e.user_id})}),null==(r=o.data)||r.forEach(e=>{"sold"===e.status&&e.sold_at?x.push({id:`listing-${e.id}`,type:"marketplace_sale",description:`Marketplace sale: $${(e.price_cents/100).toFixed(2)}`,timestamp:e.sold_at,user_id:e.seller_id,value:e.price_cents}):"active"===e.status&&x.push({id:`listing-${e.id}`,type:"listing_created",description:`New listing: $${(e.price_cents/100).toFixed(2)}`,timestamp:e.created_at,user_id:e.seller_id,value:e.price_cents})}),null==(l=m.data)||l.forEach(e=>{x.push({id:`withdrawal-${e.id}`,type:`withdrawal_${e.status}`,description:`Withdrawal ${e.status}: $${(e.amount_cents/100).toFixed(2)}`,timestamp:e.created_at,user_id:e.user_id,value:e.amount_cents})}),x.sort((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime()),x.slice(0,50)},staleTime:1e4});b.useEffect(()=>{const e=y.channel("admin-activity").on("postgres_changes",{event:"INSERT",schema:"public",table:"vision_interactions"},()=>c()).on("postgres_changes",{event:"INSERT",schema:"public",table:"wallet_transactions"},()=>c()).on("postgres_changes",{event:"*",schema:"public",table:"visualization_listings"},()=>c()).on("postgres_changes",{event:"*",schema:"public",table:"withdrawal_requests"},()=>c()).subscribe();return()=>{y.removeChannel(e)}},[c]);const d=e=>e.includes("view")?l.jsx(Q,{className:"h-4 w-4"}):e.includes("download")?l.jsx(M,{className:"h-4 w-4"}):e.includes("print")?l.jsx(oe,{className:"h-4 w-4"}):e.includes("trade")||e.includes("marketplace")?l.jsx(de,{className:"h-4 w-4"}):e.includes("subscription")?l.jsx(re,{className:"h-4 w-4"}):e.includes("wallet")||e.includes("withdrawal")?l.jsx(le,{className:"h-4 w-4"}):e.includes("vision")?l.jsx(ce,{className:"h-4 w-4"}):e.includes("listing")?l.jsx(me,{className:"h-4 w-4"}):l.jsx(xe,{className:"h-4 w-4"});return l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(xe,{className:"h-5 w-5"}),"Live Activity Feed"]}),l.jsx(h,{children:"Real-time platform activity monitoring"})]}),l.jsxs(q,{variant:"outline",size:"sm",onClick:()=>c(),className:"gap-2",children:[l.jsx(L,{className:"h-4 w-4"}),"Refresh"]})]})}),l.jsx(n,{children:r?l.jsx("div",{className:"flex items-center justify-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):l.jsx(p,{className:"h-[600px]",children:l.jsxs("div",{className:"space-y-2",children:[null==a?void 0:a.map(e=>{return l.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg border bg-card hover:bg-muted/30 transition-colors",children:[l.jsx("div",{className:"p-2 rounded-full "+(s=e.type,s.includes("sale")||s.includes("completed")?"text-green-500 bg-green-500/10":s.includes("print")?"text-blue-500 bg-blue-500/10":s.includes("subscription_active")?"text-primary bg-primary/10":s.includes("canceled")||s.includes("rejected")?"text-red-500 bg-red-500/10":s.includes("withdrawal_pending")?"text-yellow-500 bg-yellow-500/10":"text-muted-foreground bg-muted"),children:d(e.type)}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"font-medium truncate",children:e.description}),l.jsx("p",{className:"text-sm text-muted-foreground",children:f(new Date(e.timestamp),{addSuffix:!0})})]}),void 0!==e.value&&e.value>0&&l.jsxs(g,{variant:"outline",className:"text-green-500 border-green-500/30",children:["$",(e.value/100).toFixed(2)]})]},e.id);var s}),(!a||0===a.length)&&l.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[l.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"No recent activity"})]})]})})})]})},As=()=>{const[e,s]=b.useState(!1),[a,t]=b.useState(null);return l.jsxs("div",{className:"space-y-6",children:[l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(ge,{className:"h-5 w-5"}),"Data Maintenance"]}),l.jsx(h,{children:"Clean up old records, expired data, and optimize database performance"})]}),l.jsxs(n,{className:"space-y-6",children:[l.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[l.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border bg-card",children:[l.jsx(xe,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-sm",children:"Interactions"}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Deletes vision interactions older than 90 days"})]})]}),l.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border bg-card",children:[l.jsx(Be,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-sm",children:"Expired Offers"}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Removes marketplace offers expired 30+ days"})]})]}),l.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border bg-card",children:[l.jsx(ve,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-sm",children:"Notifications"}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Clears read notifications older than 60 days"})]})]}),l.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border bg-card",children:[l.jsx(Ne,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-sm",children:"Analytics Cache"}),l.jsx("p",{className:"text-xs text-muted-foreground",children:"Removes expired premium analytics data"})]})]})]}),l.jsx(fe,{}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx(q,{onClick:async()=>{s(!0);try{const{data:e,error:s}=await y.functions.invoke("data-maintenance",{method:"POST"});if(s)throw s;t(e),e.success?_.success("Data maintenance completed successfully",{description:"Cleaned up old records from the database"}):_.error("Maintenance completed with errors",{description:e.error})}catch(e){_.error("Failed to run maintenance",{description:e.message}),t({success:!1,error:e.message,executed_at:(new Date).toISOString()})}finally{s(!1)}},disabled:e,className:"gap-2",children:e?l.jsxs(l.Fragment,{children:[l.jsx(ye,{className:"h-4 w-4 animate-spin"}),"Running..."]}):l.jsxs(l.Fragment,{children:[l.jsx(be,{className:"h-4 w-4"}),"Run Maintenance Now"]})}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"This runs automatically daily at 3:00 AM UTC"})]})]})]}),a&&l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs(u,{className:"flex items-center gap-2 text-lg",children:[l.jsx(m,{className:"h-5 w-5"}),"Last Maintenance Result"]})}),l.jsx(n,{children:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[a.success?l.jsxs(g,{className:"bg-green-500/20 text-green-600 border-green-500/30 gap-1",children:[l.jsx(O,{className:"h-3 w-3"}),"Success"]}):l.jsxs(g,{variant:"destructive",className:"gap-1",children:[l.jsx(I,{className:"h-3 w-3"}),"Failed"]}),l.jsx("span",{className:"text-sm text-muted-foreground",children:w(new Date(a.executed_at),"PPpp")})]}),a.success&&a.results&&l.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[l.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(G,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Interactions"})]}),l.jsx("p",{className:"text-lg font-bold",children:a.results.interactions_deleted.toLocaleString()})]}),l.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(G,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Offers"})]}),l.jsx("p",{className:"text-lg font-bold",children:a.results.offers_deleted.toLocaleString()})]}),l.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(G,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Notifications"})]}),l.jsx("p",{className:"text-lg font-bold",children:a.results.notifications_deleted.toLocaleString()})]}),l.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(G,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Analytics"})]}),l.jsx("p",{className:"text-lg font-bold",children:a.results.analytics_deleted.toLocaleString()})]}),l.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(G,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Funnel Events"})]}),l.jsx("p",{className:"text-lg font-bold",children:a.results.funnel_events_deleted.toLocaleString()})]})]}),!a.success&&a.error&&l.jsx("div",{className:"p-3 rounded-lg border border-destructive/30 bg-destructive/10 text-destructive text-sm",children:a.error})]})})]})]})};function qs(){var e,s,a;const[r,c]=b.useState(7),d=_e(),{data:o,isLoading:m}=t({queryKey:["health-trends",r],queryFn:async()=>{const{data:e,error:s}=await y.rpc("get_health_trends",{p_days:r});if(s)throw s;return e},refetchInterval:6e4}),{data:j,isLoading:v}=t({queryKey:["system-alerts"],queryFn:async()=>{const{data:e,error:s}=await y.rpc("get_system_alerts",{p_include_resolved:!1,p_limit:50});if(s)throw s;return e||[]},refetchInterval:3e4}),f=We({mutationFn:async e=>{const{error:s}=await y.rpc("acknowledge_alert",{p_alert_id:e});if(s)throw s},onSuccess:()=>{_.success("Alert acknowledged"),d.invalidateQueries({queryKey:["system-alerts"]})}}),w=We({mutationFn:async e=>{const{error:s}=await y.rpc("resolve_alert",{p_alert_id:e});if(s)throw s},onSuccess:()=>{_.success("Alert resolved"),d.invalidateQueries({queryKey:["system-alerts"]}),d.invalidateQueries({queryKey:["health-trends"]})}}),S=e=>{switch(e){case"critical":return"destructive";case"warning":return"secondary";default:return"outline"}},A=e=>{switch(e){case"critical":return l.jsx(I,{className:"h-4 w-4 text-destructive"});case"warning":return l.jsx(C,{className:"h-4 w-4 text-yellow-500"});default:return l.jsx(ve,{className:"h-4 w-4 text-muted-foreground"})}};if(m)return l.jsxs("div",{className:"space-y-4",children:[l.jsx(we,{className:"h-32 w-full"}),l.jsx(we,{className:"h-64 w-full"})]});const M=(null==o?void 0:o.totals)||{total_errors:0,total_resolved:0,total_issues_found:0,total_issues_fixed:0,total_requests:0,total_rate_limited:0},D=M.total_errors>0?Math.round(M.total_resolved/M.total_errors*100):100,T=M.total_issues_found>0?Math.round(M.total_issues_fixed/M.total_issues_found*100):100;return l.jsxs("div",{className:"space-y-6",children:[((null==o?void 0:o.critical_alerts)||0)>0&&l.jsx(i,{className:"border-destructive bg-destructive/10",children:l.jsx(n,{className:"py-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(I,{className:"h-6 w-6 text-destructive"}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-semibold text-destructive",children:[null==o?void 0:o.critical_alerts," Critical Alert",1!==(null==o?void 0:o.critical_alerts)?"s":""," Require Attention"]}),l.jsx("p",{className:"text-sm text-muted-foreground",children:"Review and resolve critical issues immediately"})]})]})})}),l.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[l.jsxs(i,{children:[l.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(u,{className:"text-sm font-medium",children:"Error Resolution"}),D>=80?l.jsx(N,{className:"h-4 w-4 text-green-500"}):l.jsx(He,{className:"h-4 w-4 text-destructive"})]}),l.jsxs(n,{children:[l.jsxs("div",{className:"text-2xl font-bold",children:[D,"%"]}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[M.total_resolved," / ",M.total_errors," errors resolved"]})]})]}),l.jsxs(i,{children:[l.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(u,{className:"text-sm font-medium",children:"Issues Fixed"}),l.jsx(O,{className:"h-4 w-4 text-green-500"})]}),l.jsxs(n,{children:[l.jsxs("div",{className:"text-2xl font-bold",children:[T,"%"]}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[M.total_issues_fixed," / ",M.total_issues_found," auto-fixed"]})]})]}),l.jsxs(i,{children:[l.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(u,{className:"text-sm font-medium",children:"API Requests"}),l.jsx(ke,{className:"h-4 w-4 text-primary"})]}),l.jsxs(n,{children:[l.jsx("div",{className:"text-2xl font-bold",children:M.total_requests.toLocaleString()}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",r," days"]})]})]}),l.jsxs(i,{children:[l.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[l.jsx(u,{className:"text-sm font-medium",children:"Rate Limited"}),l.jsx(k,{className:"h-4 w-4 text-yellow-500"})]}),l.jsxs(n,{children:[l.jsx("div",{className:"text-2xl font-bold",children:M.total_rate_limited}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[M.total_requests>0?(M.total_rate_limited/M.total_requests*100).toFixed(2):0,"% of requests"]})]})]})]}),l.jsxs(Ce,{defaultValue:"trends",className:"space-y-4",children:[l.jsxs(Se,{children:[l.jsx(Ae,{value:"trends",children:"Trends"}),l.jsxs(Ae,{value:"alerts",className:"relative",children:["Alerts",((null==o?void 0:o.active_alerts)||0)>0&&l.jsx(g,{variant:"destructive",className:"ml-2 h-5 w-5 p-0 text-xs",children:null==o?void 0:o.active_alerts})]}),l.jsx(Ae,{value:"hourly",children:"Hourly"})]}),l.jsxs(qe,{value:"trends",className:"space-y-4",children:[l.jsxs(i,{children:[l.jsxs(x,{className:"flex flex-row items-center justify-between",children:[l.jsxs("div",{children:[l.jsx(u,{children:"Error & Issue Trends"}),l.jsx(h,{children:"Daily error rates and auto-fix performance"})]}),l.jsx("div",{className:"flex gap-2",children:[7,14,30].map(e=>l.jsxs(q,{size:"sm",variant:r===e?"default":"outline",onClick:()=>c(e),children:[e,"d"]},e))})]}),l.jsx(n,{children:l.jsx("div",{className:"h-[300px]",children:l.jsx(Ye,{width:"100%",height:"100%",children:l.jsxs(ts,{data:(null==(e=null==o?void 0:o.daily_trends)?void 0:e.slice().reverse())||[],children:[l.jsx(rs,{strokeDasharray:"3 3",className:"stroke-muted"}),l.jsx(Qe,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),className:"text-xs"}),l.jsx(Je,{className:"text-xs"}),l.jsx(Xe,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))"},labelFormatter:e=>new Date(e).toLocaleDateString()}),l.jsx(es,{}),l.jsx(ls,{type:"monotone",dataKey:"errors_reported",name:"Errors",stackId:"1",stroke:"hsl(var(--destructive))",fill:"hsl(var(--destructive)/0.3)"}),l.jsx(ls,{type:"monotone",dataKey:"errors_resolved",name:"Resolved",stackId:"2",stroke:"hsl(142, 76%, 36%)",fill:"hsl(142, 76%, 36%, 0.3)"}),l.jsx(ls,{type:"monotone",dataKey:"issues_fixed",name:"Auto-Fixed",stackId:"3",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary)/0.3)"})]})})})})]}),l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsx(u,{children:"API Traffic & Rate Limiting"}),l.jsx(h,{children:"Request volume and protection metrics"})]}),l.jsx(n,{children:l.jsx("div",{className:"h-[250px]",children:l.jsx(Ye,{width:"100%",height:"100%",children:l.jsxs(ss,{data:(null==(s=null==o?void 0:o.daily_trends)?void 0:s.slice().reverse())||[],children:[l.jsx(rs,{strokeDasharray:"3 3",className:"stroke-muted"}),l.jsx(Qe,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),className:"text-xs"}),l.jsx(Je,{className:"text-xs"}),l.jsx(Xe,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))"}}),l.jsx(es,{}),l.jsx(as,{dataKey:"api_requests",name:"API Requests",fill:"hsl(var(--primary))",radius:[4,4,0,0]}),l.jsx(as,{dataKey:"rate_limited",name:"Rate Limited",fill:"hsl(var(--destructive))",radius:[4,4,0,0]})]})})})})]})]}),l.jsx(qe,{value:"alerts",children:l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(ve,{className:"h-5 w-5"}),"Active Alerts"]}),l.jsxs(h,{children:[(null==j?void 0:j.length)||0," unresolved alerts"]})]}),l.jsx(n,{children:v?l.jsx(we,{className:"h-32 w-full"}):j&&j.length>0?l.jsx(p,{className:"h-[400px]",children:l.jsx("div",{className:"space-y-3",children:j.map(e=>l.jsx("div",{className:"p-4 rounded-lg border "+("critical"===e.severity?"border-destructive bg-destructive/5":"warning"===e.severity?"border-yellow-500/50 bg-yellow-500/5":"border-border bg-muted/30"),children:l.jsxs("div",{className:"flex items-start justify-between gap-4",children:[l.jsxs("div",{className:"flex items-start gap-3",children:[A(e.severity),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"font-medium",children:e.title}),l.jsx(g,{variant:S(e.severity),children:e.severity}),l.jsx(g,{variant:"outline",className:"text-xs",children:e.alert_type})]}),l.jsx("p",{className:"text-sm text-muted-foreground",children:e.message}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(e.created_at).toLocaleString(),e.acknowledged_at&&l.jsx("span",{className:"ml-2 text-green-600",children:"â€¢ Acknowledged"})]})]})]}),l.jsxs("div",{className:"flex gap-2 shrink-0",children:[!e.acknowledged_at&&l.jsxs(q,{size:"sm",variant:"outline",onClick:()=>f.mutate(e.id),disabled:f.isPending,children:[l.jsx(ms,{className:"h-3 w-3 mr-1"}),"Ack"]}),l.jsxs(q,{size:"sm",variant:"default",onClick:()=>w.mutate(e.id),disabled:w.isPending,children:[l.jsx(O,{className:"h-3 w-3 mr-1"}),"Resolve"]})]})]})},e.id))})}):l.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[l.jsx(O,{className:"h-12 w-12 text-green-500 mb-4"}),l.jsx("p",{className:"text-lg font-medium",children:"All Clear!"}),l.jsx("p",{className:"text-muted-foreground",children:"No active alerts"})]})})]})}),l.jsx(qe,{value:"hourly",children:l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsx(u,{children:"Hourly Activity (Last 48 Hours)"}),l.jsx(h,{children:"Granular view of system activity"})]}),l.jsx(n,{children:l.jsx("div",{className:"h-[300px]",children:l.jsx(Ye,{width:"100%",height:"100%",children:l.jsxs(vs,{data:(null==(a=null==o?void 0:o.hourly_trends)?void 0:a.slice().reverse())||[],children:[l.jsx(rs,{strokeDasharray:"3 3",className:"stroke-muted"}),l.jsx(Qe,{dataKey:"hour",tickFormatter:(e,s)=>{var a;return(null==(a=null==o?void 0:o.hourly_trends)?void 0:a.slice().reverse()[s])?`${e}:00`:""},className:"text-xs"}),l.jsx(Je,{className:"text-xs"}),l.jsx(Xe,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))"},labelFormatter:(e,s)=>{if(s&&s[0]){const e=s[0].payload;return`${e.date} ${e.hour}:00`}return""}}),l.jsx(es,{}),l.jsx(is,{type:"monotone",dataKey:"errors",name:"Errors",stroke:"hsl(var(--destructive))",strokeWidth:2,dot:!1}),l.jsx(is,{type:"monotone",dataKey:"fixed",name:"Fixed",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,dot:!1}),l.jsx(is,{type:"monotone",dataKey:"requests",name:"Requests",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1})]})})})})]})})]})]})}function Ms(){const[e,s]=b.useState(!1),a=_e(),{data:r,isLoading:c}=t({queryKey:["error-summary"],queryFn:async()=>{const{data:e,error:s}=await y.rpc("get_error_summary",{p_days:7});if(s)throw s;return e},refetchInterval:6e4}),d=We({mutationFn:async()=>{const{data:e,error:s}=await y.functions.invoke("health-check");if(s)throw s;return e},onSuccess:e=>{_.success(`Health check completed: ${(null==e?void 0:e.issues_fixed)||0} issues fixed`),a.invalidateQueries({queryKey:["error-summary"]})},onError:e=>{_.error(`Health check failed: ${e.message}`)}});return c?l.jsxs("div",{className:"space-y-4",children:[l.jsx(we,{className:"h-32 w-full"}),l.jsx(we,{className:"h-64 w-full"})]}):l.jsxs(Ce,{defaultValue:"overview",className:"space-y-6",children:[l.jsxs(Se,{children:[l.jsx(Ae,{value:"overview",children:"Overview"}),l.jsxs(Ae,{value:"trends",children:[l.jsx(N,{className:"h-4 w-4 mr-2"}),"Trends & Alerts"]})]}),l.jsxs(qe,{value:"overview",className:"space-y-6",children:[l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(k,{className:"h-5 w-5"}),"Automated Monitoring"]}),l.jsx(h,{children:"Run health checks and data integrity validation"})]}),l.jsxs(n,{className:"flex flex-wrap gap-3",children:[l.jsxs(q,{onClick:()=>d.mutate(),disabled:d.isPending,children:[d.isPending?l.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}):l.jsx(be,{className:"h-4 w-4 mr-2"}),"Run Full Health Check"]}),l.jsxs(q,{variant:"outline",onClick:async()=>{s(!0);try{const{data:e,error:s}=await y.rpc("validate_and_fix_data_integrity");if(s)throw s;const t=e;_.success(`Data integrity check: ${(null==t?void 0:t.issues_fixed)||0} issues fixed`),a.invalidateQueries({queryKey:["error-summary"]})}catch(e){_.error(`Check failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{s(!1)}},disabled:e,children:[e?l.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}):l.jsx(xe,{className:"h-4 w-4 mr-2"}),"Data Integrity Check"]})]})]}),l.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(ns,{className:"h-5 w-5 text-destructive"}),"Error Summary"]})}),l.jsx(n,{children:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-muted-foreground",children:"Unresolved Errors"}),l.jsx(g,{variant:(null==r?void 0:r.total_unresolved)?"destructive":"secondary",children:(null==r?void 0:r.total_unresolved)||0})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"text-muted-foreground",children:"Last 24 Hours"}),l.jsx(g,{variant:"outline",children:(null==r?void 0:r.last_24h_errors)||0})]}),(null==r?void 0:r.by_type)&&r.by_type.length>0&&l.jsxs("div",{className:"pt-2 border-t",children:[l.jsx("p",{className:"text-sm font-medium mb-2",children:"By Type:"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:r.by_type.map(e=>l.jsxs(g,{variant:"outline",className:"text-xs",children:[e.type,": ",e.count]},e.type))})]})]})})]}),l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs(u,{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5"}),"Recent Health Checks"]})}),l.jsx(n,{children:l.jsx(p,{className:"h-[200px]",children:(null==r?void 0:r.recent_health_checks)&&r.recent_health_checks.length>0?l.jsx("div",{className:"space-y-3",children:r.recent_health_checks.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-muted/50",children:[l.jsxs("div",{className:"flex items-center gap-2",children:["completed"===e.status?l.jsx(O,{className:"h-4 w-4 text-green-500"}):l.jsx(L,{className:"h-4 w-4 animate-spin"}),l.jsx("span",{className:"text-sm font-medium",children:e.type})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fixed: ",e.issues_fixed]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.completed_at).toLocaleDateString()})]})]},e.id))}):l.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No recent health checks"})})})]})]}),(null==r?void 0:r.top_errors)&&r.top_errors.length>0&&l.jsxs(i,{children:[l.jsxs(x,{children:[l.jsx(u,{children:"Top Unresolved Errors"}),l.jsx(h,{children:"Most frequently occurring errors"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[300px]",children:l.jsx("div",{className:"space-y-3",children:r.top_errors.map(e=>l.jsx("div",{className:"p-3 rounded-lg border bg-card",children:l.jsxs("div",{className:"flex items-start justify-between gap-4",children:[l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium truncate",children:e.message}),e.component&&l.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Component: ",e.component]})]}),l.jsxs("div",{className:"text-right shrink-0",children:[l.jsxs(g,{variant:"destructive",children:[e.count,"x"]}),l.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.last_seen).toLocaleString()})]})]})},e.id))})})})]})]}),l.jsx(qe,{value:"trends",children:l.jsx(qs,{})})]})}const Ds=[{email:"a.arthur.shelton@gmail.com",name:"Alec Arthur Shelton",role:"CEO & Founder"},{email:"info@mawuli.xyz",name:"Mawuli",role:"Marketplace Tester"},{email:"opecoreug@gmail.com",name:"Product Specialist",role:"Overseas Analyst"}],Ts=e=>`$${(e/100).toFixed(2)}`,Ls=()=>{const e=_e(),{data:s}=t({queryKey:["admin-economics-users"],queryFn:async()=>{const[e,s,a]=await Promise.all([y.from("profiles").select("id",{count:"exact",head:!0}),y.from("user_subscriptions").select("id",{count:"exact",head:!0}).eq("subscription_status","active"),y.from("saved_visualizations").select("id",{count:"exact",head:!0})]),t=e.count||0,r=s.count||0,l=Ds.length;return{total:t,paidPremium:r,visionaryCount:l,totalPremium:r+l,freeUsers:Math.max(0,t-r),totalVisions:a.count||0,conversionRate:t>0?(r/t*100).toFixed(1):"0"}}}),{data:a}=t({queryKey:["admin-live-profit-pools"],queryFn:async()=>{const[e,s,a,t,r,l]=await Promise.all([y.from("company_profit_pool").select("*"),y.from("revenue_stream_summary").select("*"),y.from("gamecard_value_pool").select("earned_value_cents, total_interactions"),y.from("palette_value_pool").select("earned_value_cents, total_interactions"),y.from("opening_value_pool").select("earned_value_cents, total_interactions, total_marketplace_trades"),y.from("user_wallets").select("balance_cents, total_earned_cents, total_spent_cents")]),i=e.data||[],n=i.reduce((e,s)=>e+(s.extractable_profit_cents||0),0),c=i.reduce((e,s)=>e+(s.reinvested_cents||0),0),d=i.reduce((e,s)=>e+(s.gross_revenue_cents||0),0),o=i.reduce((e,s)=>e+(s.stripe_fees_cents||0),0),m=a.data||[],x=t.data||[],u=r.data||[],h=l.data||[];return{totalExtractable:n,totalReinvested:c,totalGross:d,totalStripeFees:o,gamecardPoolTotal:m.reduce((e,s)=>e+(s.earned_value_cents||0),0),palettePoolTotal:x.reduce((e,s)=>e+(s.earned_value_cents||0),0),openingPoolTotal:u.reduce((e,s)=>e+(s.earned_value_cents||0),0),activeGamecards:m.filter(e=>e.earned_value_cents>0).length,activePalettes:x.filter(e=>e.earned_value_cents>0).length,activeOpenings:u.filter(e=>e.earned_value_cents>0).length,totalWalletBalance:h.reduce((e,s)=>e+(s.balance_cents||0),0),totalUserEarnings:h.reduce((e,s)=>e+(s.total_earned_cents||0),0),revenueStreams:s.data||[]}},refetchInterval:1e4,staleTime:5e3});return b.useEffect(()=>{const s=[],a=y.channel("economics-realtime").on("postgres_changes",{event:"*",schema:"public",table:"company_profit_pool"},()=>{e.invalidateQueries({queryKey:["admin-live-profit-pools"]})}).on("postgres_changes",{event:"*",schema:"public",table:"palette_value_pool"},()=>{e.invalidateQueries({queryKey:["admin-live-profit-pools"]})}).on("postgres_changes",{event:"*",schema:"public",table:"gamecard_value_pool"},()=>{e.invalidateQueries({queryKey:["admin-live-profit-pools"]})}).on("postgres_changes",{event:"*",schema:"public",table:"opening_value_pool"},()=>{e.invalidateQueries({queryKey:["admin-live-profit-pools"]})}).on("postgres_changes",{event:"*",schema:"public",table:"user_wallets"},()=>{e.invalidateQueries({queryKey:["admin-live-profit-pools"]})}).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{e.invalidateQueries({queryKey:["admin-economics-users"]})}).on("postgres_changes",{event:"*",schema:"public",table:"user_subscriptions"},()=>{e.invalidateQueries({queryKey:["admin-economics-users"]})}).subscribe();return s.push(a),()=>{s.forEach(e=>y.removeChannel(e))}},[e]),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(c,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Total Users"})]}),l.jsx("p",{className:"text-2xl font-bold",children:(null==s?void 0:s.total)||0})]})}),l.jsx(i,{className:"border-amber-500/30 bg-gradient-to-br from-amber-500/5 to-amber-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(Me,{className:"h-3 w-3 text-amber-500"}),l.jsx("span",{className:"text-xs",children:"Visionaries"})]}),l.jsx("p",{className:"text-2xl font-bold text-amber-500",children:(null==s?void 0:s.visionaryCount)||0}),l.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Permanent Premium"})]})}),l.jsx(i,{className:"border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(re,{className:"h-3 w-3 text-primary"}),l.jsx("span",{className:"text-xs",children:"Paid Premium"})]}),l.jsx("p",{className:"text-2xl font-bold text-primary",children:(null==s?void 0:s.paidPremium)||0}),l.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Stripe Subscribers"})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(c,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Free Users"})]}),l.jsx("p",{className:"text-2xl font-bold",children:(null==s?void 0:s.freeUsers)||0}),l.jsxs("p",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[l.jsx(N,{className:"h-3 w-3"}),null==s?void 0:s.conversionRate,"% conversion"]})]})})]}),l.jsxs(i,{className:"border-green-500/30 bg-gradient-to-br from-green-500/10 via-emerald-500/5 to-green-500/10",children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2 text-xl",children:[l.jsx(cs,{className:"h-6 w-6 text-green-500"}),"Company Profit Pool",l.jsx(g,{className:"ml-auto bg-green-500/20 text-green-600 border-green-500/30",children:"LIVE"})]}),l.jsx(h,{children:"Real money reserves from marketplace fees + net profits"})]}),l.jsx(n,{children:l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"p-4 rounded-xl bg-green-500/10 border border-green-500/20",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Extractable Cash"}),l.jsx("p",{className:"text-2xl font-bold text-green-500",children:Ts((null==a?void 0:a.totalExtractable)||0)})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-blue-500/10 border border-blue-500/20",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Reinvested"}),l.jsx("p",{className:"text-2xl font-bold text-blue-500",children:Ts((null==a?void 0:a.totalReinvested)||0)})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Gross Revenue"}),l.jsx("p",{className:"text-2xl font-bold",children:Ts((null==a?void 0:a.totalGross)||0)})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Stripe Fees"}),l.jsx("p",{className:"text-2xl font-bold text-orange-500",children:Ts((null==a?void 0:a.totalStripeFees)||0)})]})]})})]}),l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(De,{className:"h-5 w-5"}),"Value Attribution Pools",l.jsx(g,{variant:"outline",className:"ml-auto",children:"LIVE"})]})}),l.jsx(n,{children:l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"p-4 rounded-xl bg-purple-500/10 border border-purple-500/20",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(Te,{className:"h-4 w-4 text-purple-500"}),l.jsx("span",{className:"text-sm font-medium",children:"Gamecard Pool"})]}),l.jsx("p",{className:"text-2xl font-bold text-purple-500",children:Ts((null==a?void 0:a.gamecardPoolTotal)||0)}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[(null==a?void 0:a.activeGamecards)||0," active games"]})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-pink-500/10 border border-pink-500/20",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(Le,{className:"h-4 w-4 text-pink-500"}),l.jsx("span",{className:"text-sm font-medium",children:"Palette Pool"})]}),l.jsx("p",{className:"text-2xl font-bold text-pink-500",children:Ts((null==a?void 0:a.palettePoolTotal)||0)}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[(null==a?void 0:a.activePalettes)||0," active palettes"]})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-amber-500/10 border border-amber-500/20",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(he,{className:"h-4 w-4 text-amber-500"}),l.jsx("span",{className:"text-sm font-medium",children:"Opening Pool"})]}),l.jsx("p",{className:"text-2xl font-bold text-amber-500",children:Ts((null==a?void 0:a.openingPoolTotal)||0)}),l.jsxs("p",{className:"text-xs text-muted-foreground",children:[(null==a?void 0:a.activeOpenings)||0," active openings"]})]})]})})]}),l.jsxs(i,{children:[l.jsx(x,{children:l.jsxs(u,{className:"text-lg flex items-center gap-2",children:[l.jsx(le,{className:"h-5 w-5"}),"Wallet Economy"]})}),l.jsx(n,{children:l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Wallet Balances"}),l.jsx("p",{className:"text-2xl font-bold",children:Ts((null==a?void 0:a.totalWalletBalance)||0)})]}),l.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[l.jsx("p",{className:"text-xs text-muted-foreground",children:"Total User Earnings"}),l.jsx("p",{className:"text-2xl font-bold text-green-500",children:Ts((null==a?void 0:a.totalUserEarnings)||0)})]})]})})]}),l.jsxs(i,{className:"border-amber-500/30",children:[l.jsxs(x,{children:[l.jsxs(u,{className:"flex items-center gap-2 text-lg",children:[l.jsx(Me,{className:"h-5 w-5 text-amber-500"}),"Visionary Members"]}),l.jsx(h,{children:"Permanent premium access holders"})]}),l.jsx(n,{children:l.jsx(p,{className:"h-[150px]",children:l.jsx("div",{className:"space-y-2",children:Ds.map((e,s)=>l.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-amber-500/5 border border-amber-500/20",children:[l.jsxs("div",{className:"flex items-center gap-2",children:["CEO & Founder"===e.role?l.jsx(re,{className:"h-4 w-4 text-amber-500"}):l.jsx(k,{className:"h-4 w-4 text-amber-500"}),l.jsx("span",{className:"text-sm font-medium",children:e.name})]}),l.jsx(g,{variant:"outline",className:"text-[10px]",children:e.role})]},s))})})})]})]})},Fs=()=>{const{data:e,isLoading:s}=t({queryKey:["admin-total-user-count"],queryFn:async()=>{const{count:e,error:s}=await y.from("profiles").select("*",{count:"exact",head:!0});if(s)throw s;return e||0},staleTime:3e4,refetchInterval:6e4});return s?l.jsxs(g,{variant:"outline",className:"animate-pulse",children:[l.jsx(c,{className:"h-3 w-3 mr-1"}),"..."]}):l.jsxs(g,{variant:"secondary",className:"bg-primary/10 text-primary",children:[l.jsx(c,{className:"h-3 w-3 mr-1"}),null==e?void 0:e.toLocaleString()," users"]})},Ps=()=>{const{user:e,isLoading:s}=Fe(),[a,r]=b.useState(""),[d,m]=b.useState(null),[x,u]=b.useState("users"),{data:h,isLoading:p}=t({queryKey:["is-admin",null==e?void 0:e.id],queryFn:async()=>{if(!e)return!1;const{data:s}=await y.rpc("has_role",{_user_id:e.id,_role:"admin"});return!0===s},enabled:!!e}),{data:v,refetch:f}=t({queryKey:["admin-ceo-overview"],queryFn:async()=>{const[e,s,a,t,r]=await Promise.all([y.from("profiles").select("id",{count:"exact",head:!0}),y.from("user_subscriptions").select("id",{count:"exact",head:!0}).eq("subscription_status","active"),y.from("saved_visualizations").select("id",{count:"exact",head:!0}),y.from("order_financials").select("gross_revenue_cents"),y.from("user_wallets").select("balance_cents")]),l=t.data||[],i=l.reduce((e,s)=>e+(s.gross_revenue_cents||0),0),n=(r.data||[]).reduce((e,s)=>e+(s.balance_cents||0),0);return{totalUsers:e.count||0,premiumUsers:s.count||0,freeUsers:(e.count||0)-(s.count||0),totalVisions:a.count||0,totalRevenue:i,totalWalletBalance:n,ordersCount:l.length}},enabled:!0===h,staleTime:3e4});if(!(s||p||e&&h))return l.jsx(Pe,{to:"/",replace:!0});if(s||p)return l.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const _=e=>`$${(e/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`;return l.jsxs("div",{className:"min-h-screen bg-background",children:[l.jsx(Ee,{}),l.jsxs("main",{className:"container mx-auto px-4 py-8",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs(Re,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[l.jsx($e,{className:"h-4 w-4"}),"Back to Home"]}),l.jsxs(q,{variant:"outline",size:"sm",onClick:()=>f(),className:"gap-2",children:[l.jsx(L,{className:"h-4 w-4"}),"Refresh"]})]}),l.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-2xl p-8 mb-8 border border-amber-500/30 bg-gradient-to-br from-amber-500/10 via-primary/5 to-amber-500/10",children:l.jsx("div",{className:"relative z-10",children:l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"p-3 rounded-full bg-amber-500/20",children:l.jsx(re,{className:"h-6 w-6 text-amber-500"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold",children:"CEO Command Center"}),l.jsx("p",{className:"text-muted-foreground",children:"Complete user & order management for Alec Arthur Shelton"})]}),l.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[l.jsx(Fs,{}),l.jsxs(g,{className:"bg-amber-500/20 text-amber-600 border-amber-500/30",children:[l.jsx(k,{className:"h-3 w-3 mr-1"}),"CEO Access"]})]})]})})}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-8",children:[l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(c,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Total Users"})]}),l.jsx("p",{className:"text-xl font-bold",children:(null==v?void 0:v.totalUsers)||0})]})}),l.jsx(i,{className:"border-primary/30 bg-gradient-to-br from-primary/5 to-primary/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(re,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Premium"})]}),l.jsx("p",{className:"text-xl font-bold text-primary",children:(null==v?void 0:v.premiumUsers)||0})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(c,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Free Users"})]}),l.jsx("p",{className:"text-xl font-bold",children:(null==v?void 0:v.freeUsers)||0})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(ce,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Total Visions"})]}),l.jsx("p",{className:"text-xl font-bold",children:(null==v?void 0:v.totalVisions)||0})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(me,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Orders"})]}),l.jsx("p",{className:"text-xl font-bold",children:(null==v?void 0:v.ordersCount)||0})]})}),l.jsx(i,{className:"border-green-500/30 bg-gradient-to-br from-green-500/5 to-green-500/10",children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(N,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Revenue"})]}),l.jsx("p",{className:"text-xl font-bold text-green-500",children:_((null==v?void 0:v.totalRevenue)||0)})]})}),l.jsx(i,{children:l.jsxs(n,{className:"pt-4 pb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[l.jsx(le,{className:"h-3 w-3"}),l.jsx("span",{className:"text-xs",children:"Wallet Balance"})]}),l.jsx("p",{className:"text-xl font-bold",children:_((null==v?void 0:v.totalWalletBalance)||0)})]})})]}),l.jsxs("div",{className:"mb-8",children:[l.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"CEO Quick Access"}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsx(Re,{to:"/stock-predictions",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(Ue,{className:"h-4 w-4"}),"Stock Predictions"]})}),l.jsx(Re,{to:"/trading",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(ke,{className:"h-4 w-4"}),"Trading Terminal"]})}),l.jsx(Re,{to:"/strategic-plan",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(ze,{className:"h-4 w-4"}),"Strategic Plan"]})}),l.jsx(Re,{to:"/code-analysis",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(Oe,{className:"h-4 w-4"}),"Code Analyzer"]})}),l.jsx(Re,{to:"/showcase",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(Ie,{className:"h-4 w-4"}),"Showcase Tour"]})}),l.jsx(Re,{to:"/investor-portal",children:l.jsxs(q,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[l.jsx(De,{className:"h-4 w-4"}),"Investor Portal"]})})]})]}),l.jsxs(Ce,{value:x,onValueChange:u,className:"space-y-6",children:[l.jsxs(Se,{className:"grid w-full grid-cols-10",children:[l.jsxs(Ae,{value:"users",className:"gap-2",children:[l.jsx(c,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Users"})]}),l.jsxs(Ae,{value:"economics",className:"gap-2",children:[l.jsx(N,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Econ"})]}),l.jsxs(Ae,{value:"orders",className:"gap-2",children:[l.jsx(me,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Orders"})]}),l.jsxs(Ae,{value:"subscriptions",className:"gap-2",children:[l.jsx(re,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Subs"})]}),l.jsxs(Ae,{value:"activity",className:"gap-2",children:[l.jsx(xe,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Activity"})]}),l.jsxs(Ae,{value:"locations",className:"gap-2",children:[l.jsx(o,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Locations"})]}),l.jsxs(Ae,{value:"security",className:"gap-2",children:[l.jsx(k,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Security"})]}),l.jsxs(Ae,{value:"maintenance",className:"gap-2",children:[l.jsx(ge,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Maint."})]}),l.jsxs(Ae,{value:"health",className:"gap-2",children:[l.jsx(hs,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Health"})]}),l.jsxs(Ae,{value:"codebase",className:"gap-2 text-amber-500",children:[l.jsx(Oe,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Code"})]})]}),l.jsx(qe,{value:"users",children:l.jsx(ws,{searchQuery:a,setSearchQuery:r,onSelectUser:m})}),l.jsx(qe,{value:"economics",children:l.jsx(Ls,{})}),l.jsx(qe,{value:"orders",children:l.jsx(ks,{})}),l.jsx(qe,{value:"subscriptions",children:l.jsx(Cs,{})}),l.jsx(qe,{value:"activity",children:l.jsx(Ss,{})}),l.jsx(qe,{value:"locations",children:l.jsx(Ns,{})}),l.jsx(qe,{value:"security",children:l.jsx(bs,{})}),l.jsx(qe,{value:"maintenance",children:l.jsx(As,{})}),l.jsx(qe,{value:"health",children:l.jsx(Ms,{})}),l.jsx(qe,{value:"codebase",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center mb-4",children:[l.jsxs("h2",{className:"text-2xl font-bold flex items-center justify-center gap-2",children:[l.jsx(Oe,{className:"h-6 w-6 text-amber-500"}),"Self-Healing Codebase System"]}),l.jsx("p",{className:"text-muted-foreground",children:"Continuous analysis and auto-fix capabilities for the En Pensent platform"})]}),l.jsx(ds,{}),l.jsx(os,{})]})})]}),l.jsx(_s,{userId:d,open:!!d,onClose:()=>m(null)})]}),l.jsx(Ke,{})]})};export{Ps as default};
