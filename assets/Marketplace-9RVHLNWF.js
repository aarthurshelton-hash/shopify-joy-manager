import{aJ as e,j as s,C as t,aA as a,x as r,cQ as n,p as i,t as l,b7 as o,y as c,cR as d,a7 as m,ad as u,ah as x,d as h,bC as p,cb as g,v as f,cS as v,aO as j,am as b,ax as y,ao as N,an as w,aK as _,cT as C,a9 as k,b8 as z,b9 as L,ba as P,bb as D,bc as M,b$ as A,c0 as S,B as q,c1 as B,a6 as V,cU as I,aj as E,r as U,s as F,bj as W,bs as O,a8 as T,aG as K,u as H,a as G,ar as R,cV as J,cW as Y,L as Z,q as $,b as X,cX as Q,cY as ee,cB as se,ck as te,cZ as ae,c_ as re,c$ as ne,aq as ie,G as le,b3 as oe,b2 as ce,c9 as de,as as me,d0 as ue,d1 as xe,d2 as he,d3 as pe,d4 as ge,H as fe,aB as ve,aC as je,aD as be,cN as ye,aE as Ne,a$ as we,cM as _e,P as Ce,d5 as ke,be as ze,aS as Le,au as Pe,aw as De,av as Me,cH as Ae,cI as Se}from"./index-Hr12Z3Gc.js";import{A as qe,a as Be,b as Ve,c as Ie}from"./accordion-B-Xkf_sS.js";import{C as Ee}from"./checkbox-PaF5QFHe.js";import{C as Ue}from"./calendar-De9Rowr8.js";import{T as Fe}from"./tag-BlwY9nkZ.js";import{a as We}from"./useMarketplaceRealtime-YRtS6F8W.js";const Oe=e("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),Te=e("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),Ke=()=>s.jsxs(t,{className:"overflow-hidden",children:[s.jsx("div",{className:"aspect-square relative",children:s.jsx(a,{className:"w-full h-full"})}),s.jsxs(r,{className:"p-3 space-y-2",children:[s.jsx(a,{className:"h-4 w-3/4"}),s.jsx(a,{className:"h-3 w-1/2"}),s.jsxs("div",{className:"flex justify-between items-center pt-1",children:[s.jsx(a,{className:"h-5 w-16"}),s.jsx(a,{className:"h-8 w-20 rounded-md"})]})]})]}),He=({count:e=8})=>s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:Array.from({length:e}).map((e,t)=>s.jsx(Ke,{},t))}),Ge=()=>s.jsxs(t,{className:"overflow-hidden",children:[s.jsx("div",{className:"aspect-square relative",children:s.jsx(a,{className:"w-full h-full"})}),s.jsxs(r,{className:"p-2 space-y-1",children:[s.jsx(a,{className:"h-3 w-full"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(a,{className:"h-2.5 w-12"}),s.jsx(a,{className:"h-2.5 w-8"})]})]})]}),Re=({count:e=6})=>s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:Array.from({length:e}).map((e,t)=>s.jsx(Ge,{},t))}),Je=()=>s.jsxs(t,{className:"overflow-hidden",children:[s.jsx("div",{className:"aspect-square relative",children:s.jsx(a,{className:"w-full h-full"})}),s.jsxs(r,{className:"p-2.5 space-y-2",children:[s.jsx(a,{className:"h-3 w-3/4"}),s.jsx(a,{className:"h-7 w-full rounded-md"})]})]}),Ye=({count:e=6})=>s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:Array.from({length:e}).map((e,t)=>s.jsx(Je,{},t))}),Ze=n.forwardRef(function(e,a){const n=[{label:"Holder Ownership",value:"100%",icon:s.jsx(h,{className:"h-5 w-5"}),description:"You own your visualization completely. Full digital rights transfer on purchase."},{label:"Transfer Limit",value:"3/day",icon:s.jsx(f,{className:"h-5 w-5"}),description:"Each vision can be transferred max 3 times per 24 hours to prevent manipulation."},{label:"Sale/Trade Fee",value:"5%",icon:s.jsx(v,{className:"h-5 w-5"}),description:"5% fee on credit-based sales and trades. Gift transfers have NO fees â€” recipient gets full value."},{label:"Grace Period",value:"7 days",icon:s.jsx(g,{className:"h-5 w-5"}),description:"Cancelled subscriptions have 7 days to renew before visions are released."}],_=[{action:"Unique View",points:"0.01",icon:s.jsx(b,{className:"h-4 w-4"}),rateLimit:"3 per 5 min per user"},{action:"HD Download",points:"0.10",icon:s.jsx(y,{className:"h-4 w-4"}),rateLimit:"2 per hour per user"},{action:"GIF Export",points:"0.25",icon:s.jsx(y,{className:"h-4 w-4"}),rateLimit:"2 per hour per user"},{action:"Marketplace Trade (5% fee)",points:"1.00",icon:s.jsx(N,{className:"h-4 w-4"}),rateLimit:"Max 3 per 24h per vision"},{action:"Gift Transfer (No fee)",points:"1.00",icon:s.jsx(m,{className:"h-4 w-4"}),rateLimit:"Max 3 per 24h per vision"},{action:"Print Order",points:"2.00 + $revenue",icon:s.jsx(w,{className:"h-4 w-4"}),rateLimit:"Verified by fulfillment"}];return s.jsx("div",{ref:a,className:"space-y-6",children:s.jsxs("div",{className:"animate-fade-in",children:[s.jsxs(t,{className:"border-primary/30 bg-primary/5",children:[s.jsx(i,{className:"pb-3",children:s.jsxs(l,{className:"flex items-center gap-2 text-lg",children:[s.jsx(o,{className:"h-5 w-5 text-primary"}),"Transparency & Trust"]})}),s.jsxs(r,{children:[s.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["En Pensent is built on radical transparency. We believe collectors should understand exactly what they own and how value is determined. ",s.jsx("strong",{children:"No automatic payouts"})," â€” sell, trade, or gift your vision to realize gains."]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(c,{variant:"outline",className:"gap-1",children:[s.jsx(d,{className:"h-3 w-3 text-green-500"}),"5% Fee on Sales/Trades"]}),s.jsxs(c,{variant:"outline",className:"gap-1",children:[s.jsx(m,{className:"h-3 w-3 text-green-500"}),"Gifts: No Fees"]}),s.jsxs(c,{variant:"outline",className:"gap-1",children:[s.jsx(d,{className:"h-3 w-3 text-green-500"}),"3/day Transfer Limit"]}),s.jsxs(c,{variant:"outline",className:"gap-1",children:[s.jsx(d,{className:"h-3 w-3 text-green-500"}),"20% Value Appreciation"]})]})]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:n.map((e,a)=>s.jsx("div",{className:"animate-fade-in",children:s.jsx(t,{className:"h-full",children:s.jsxs(r,{className:"p-4 text-center",children:[s.jsx("div",{className:"flex justify-center mb-2 text-primary",children:e.icon}),s.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:e.value}),s.jsx("div",{className:"text-xs font-medium mb-1",children:e.label}),s.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})})},e.label))}),s.jsxs(qe,{type:"multiple",className:"w-full",children:[s.jsxs(Be,{value:"scoring",children:[s.jsx(Ve,{className:"text-sm",children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(u,{className:"h-4 w-4 text-primary"}),"How Vision Scores Work"]})}),s.jsxs(Ie,{className:"space-y-4",children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vision Scores measure cultural impact and collector demand. Higher scores correlate with increased interest and potential value appreciation. Our formula is ",s.jsx("strong",{children:"100% public"}),":"]}),s.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-3",children:[s.jsx("div",{className:"text-xs font-mono text-muted-foreground mb-3 p-2 bg-background/50 rounded border border-border/50",children:"Score = (views Ã— 0.01) + (HD Ã— 0.10) + (GIF Ã— 0.25) + (trades Ã— 1.00) + (prints Ã— 2.00) + ($revenue)"}),s.jsx("div",{className:"space-y-2",children:_.map(e=>s.jsxs("div",{className:"flex items-center justify-between text-sm p-2 rounded bg-background/30",children:[s.jsxs("span",{className:"flex items-center gap-2 text-muted-foreground",children:[e.icon,e.action]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-xs text-muted-foreground/70",children:e.rateLimit}),s.jsxs("span",{className:"font-mono text-primary font-medium",children:["+",e.points]})]})]},e.action))})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-green-500/10 rounded-lg border border-green-500/30",children:[s.jsx(d,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("p",{className:"text-xs text-green-600",children:[s.jsx("strong",{children:"Anti-Manipulation:"})," Each interaction type has strict rate limits per user/IP. The same account cannot inflate scores artificially."]})]}),s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-500/10 rounded-lg border border-blue-500/30",children:[s.jsx(x,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),s.jsxs("p",{className:"text-xs text-blue-600",children:[s.jsx("strong",{children:"Verifiable:"})," All interactions are logged with timestamps. Vision Score history is permanently recorded and can be audited."]})]})]})]})]}),s.jsxs(Be,{value:"ownership",children:[s.jsx(Ve,{className:"text-sm",children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-4 w-4 text-primary"}),"Your Ownership Rights"]})}),s.jsx(Ie,{className:"space-y-3",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Complete Digital Ownership"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"When you own a visualization, you hold 100% of its value. We do not retain any rights, royalties, or claims to your digital art."})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Rate-Limited Transfers"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Each vision can be transferred (sold, gifted, or claimed) up to 3 times per 24-hour period. This prevents market manipulation and rapid flipping."})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Value Appreciation (17%)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"When anyone orders a print of your vision, 17% of the order profit adds to your vision's holding value. The remaining 83% covers printing, shipping, and platform operations. Sell your appreciated visions on the marketplace to realize gains."})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(d,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Marketplace Sales (95% to Seller)"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"When you sell a vision, 95% of the sale price goes directly to you. We take only a 5% platform fee to maintain the ecosystem. Barter and negotiate with buyers."})]})]})]})})]}),s.jsxs(Be,{value:"subscription",children:[s.jsx(Ve,{className:"text-sm",children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4 text-primary"}),"Subscription & Vision Retention"]})}),s.jsxs(Ie,{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-500/10 rounded-lg border border-amber-500/30",children:[s.jsx(p,{className:"h-4 w-4 text-amber-500 mt-0.5 shrink-0"}),s.jsxs("p",{className:"text-xs text-amber-600",children:[s.jsx("strong",{children:"Important:"})," Vision ownership requires an active Visionary membership. Cancelled subscriptions enter a 7-day grace period."]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(g,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"7-Day Grace Period"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"When your subscription is cancelled, you have 7 days to renew. During this time, your visions remain yours and you'll receive reminder notifications."})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(m,{className:"h-4 w-4 text-purple-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Visions Become Claimable"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"After the grace period, your visions are released to the marketplace where any active Visionary member can claim them for free. Vision Scores are preserved."})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(f,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Renew Anytime"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Renewing during the grace period immediately restores full access to all your visions. No data is ever lost â€” only ownership transfers if unclaimed."})]})]})]})]})]}),s.jsxs(Be,{value:"pricing",children:[s.jsx(Ve,{className:"text-sm",children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"h-4 w-4 text-primary"}),"Fair Pricing Philosophy"]})}),s.jsxs(Ie,{className:"space-y-3",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Prices are set by sellers, not algorithms. We believe in free market pricing with full transparency about what you're buying:"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[s.jsx("p",{className:"font-medium mb-1",children:"ðŸ† Exemplar Editions"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Numbered genesis visions from En Pensent's development phase. Lower numbers are rarer. Starting at $0.99-$4.99, these humble-beginnings pieces may appreciate as the platform grows."})]}),s.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[s.jsx("p",{className:"font-medium mb-1",children:"ðŸŽ¨ Community Visions"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Created by members using custom color palettes. Prices reflect seller's valuation. Check the Vision Score to gauge community interest."})]}),s.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[s.jsx("p",{className:"font-medium mb-1",children:"ðŸ‘‘ Official Palettes"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Visualizations using En Pensent's curated palettes (Modern, Vintage, etc.) are marked with palette badges. These represent our artistic vision."})]})]})]})]}),s.jsxs(Be,{value:"fees",children:[s.jsx(Ve,{className:"text-sm",children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-4 w-4 text-primary"}),"Platform Sustainability"]})}),s.jsxs(Ie,{className:"space-y-3",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"We're committed to a fair business model that benefits collectors:"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[s.jsx("span",{className:"text-sm",children:"Marketplace Transaction Fee"}),s.jsx(c,{variant:"outline",className:"bg-primary/20 text-primary border-primary/50",children:"5%"})]}),s.jsxs("div",{className:"flex justify-between items-center p-2 bg-green-500/10 rounded-lg border border-green-500/30",children:[s.jsx("span",{className:"text-sm",children:"Seller Receives"}),s.jsx(c,{variant:"outline",className:"bg-green-500/20 text-green-600 border-green-500/50",children:"95%"})]}),s.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[s.jsx("span",{className:"text-sm",children:"Premium Membership"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"$7/month"})]}),s.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[s.jsx("span",{className:"text-sm",children:"Print Value Split"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"20% to holdings / 80% operations"})]})]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Our revenue comes from a small 5% marketplace fee and premium memberships. Print orders add value to your holdings (20%), which you realize when selling on the marketplace."})]})]})]})]})})});Ze.displayName="MarketplaceTransparency";const $e=({searchQuery:e,onSearchChange:t,sortBy:a,onSortChange:r,category:n,onCategoryChange:i,showGenesisOnly:l,onGenesisToggle:o,totalResults:d,totalMarketVisions:x})=>{const h=_(2),p=[{value:"newest",label:"Newest First",icon:s.jsx(Ue,{className:"h-3.5 w-3.5"})},{value:"oldest",label:"Oldest First",icon:s.jsx(Ue,{className:"h-3.5 w-3.5"})},{value:"price-low",label:"Price: Low to High",icon:s.jsx(Oe,{className:"h-3.5 w-3.5"})},{value:"price-high",label:"Price: High to Low",icon:s.jsx(Oe,{className:"h-3.5 w-3.5 rotate-180"})},{value:"score",label:"Vision Score",icon:s.jsx(u,{className:"h-3.5 w-3.5"})},{value:"name",label:"Name (A-Z)",icon:s.jsx(Fe,{className:"h-3.5 w-3.5"})}],g=[{value:"all",label:"All Visions",icon:null},{value:"premium",label:"Premium",icon:s.jsx(I,{className:"h-3.5 w-3.5 text-amber-500"})},{value:"genesis",label:"Genesis",icon:s.jsx(E,{className:"h-3.5 w-3.5 text-violet-500"})},{value:"free",label:"Free Gifts",icon:s.jsx(m,{className:"h-3.5 w-3.5 text-green-500"})},{value:"paid",label:"For Sale",icon:s.jsx(Fe,{className:"h-3.5 w-3.5 text-primary"})}];return s.jsxs("div",{className:"space-y-4 p-4 rounded-xl border border-border/50 relative overflow-hidden",style:{backgroundImage:`linear-gradient(135deg, hsl(var(--card) / 0.95) 0%, hsl(var(--card) / 0.88) 100%), url(${h[0]})`,backgroundSize:"cover",backgroundPosition:"center"},children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 relative z-10",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(k,{placeholder:"Search by title, player, or creator...",value:e,onChange:e=>t(e.target.value),className:"pl-10 bg-card/80 border-border/50 backdrop-blur-sm"})]}),s.jsxs(z,{value:a,onValueChange:e=>r(e),children:[s.jsx(L,{className:"w-full sm:w-48 bg-card/50 border-border/50",children:s.jsx(P,{placeholder:"Sort by..."})}),s.jsx(D,{children:p.map(e=>s.jsx(M,{value:e.value,children:s.jsxs("div",{className:"flex items-center gap-2",children:[e.icon,e.label]})},e.value))})]}),s.jsxs(A,{children:[s.jsx(S,{asChild:!0,children:s.jsx(q,{variant:"outline",size:"icon",className:"shrink-0 bg-card/50 border-border/50",children:s.jsx(Te,{className:"h-4 w-4"})})}),s.jsx(B,{className:"w-64",align:"end",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-sm",children:"Filters"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ee,{id:"certified-only",checked:l,onCheckedChange:e=>o(e)}),s.jsxs(V,{htmlFor:"certified-only",className:"flex items-center gap-2 text-sm cursor-pointer",children:[s.jsx(I,{className:"h-4 w-4 text-amber-500"}),"Certified Only (Premium + Genesis)"]})]})]})})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 relative z-10",children:[s.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 sm:pb-0 scrollbar-hide snap-x snap-mandatory shrink-0",children:g.map(e=>s.jsxs(q,{variant:n===e.value?"default":"outline",size:"sm",onClick:()=>i(e.value),className:"gap-1.5 shrink-0 snap-start "+(n===e.value?"":"bg-card/80 border-border/50 backdrop-blur-sm"),children:[e.icon,e.label]},e.value))}),s.jsxs("div",{className:"flex items-center gap-2 sm:ml-auto shrink-0",children:[void 0!==x&&x>0&&s.jsxs(c,{variant:"outline",className:"backdrop-blur-sm bg-primary/10 border-primary/30 text-primary whitespace-nowrap",children:[x.toLocaleString()," total visions"]}),s.jsxs(c,{variant:"secondary",className:"backdrop-blur-sm whitespace-nowrap",children:[d," ","listed"]})]})]})]})},Xe=({interval:e=8e3,opacity:t=.12,imageCount:a=10,className:r=""})=>{const n=_(a),[i,l]=U.useState(0),[o,c]=U.useState(!1);return U.useEffect(()=>{if(n.length<=1)return;const s=setInterval(()=>{c(!0),setTimeout(()=>{l(e=>(e+1)%n.length),c(!1)},500)},e);return()=>clearInterval(s)},[n.length,e]),0===n.length?null:s.jsxs("div",{className:`absolute inset-0 overflow-hidden pointer-events-none select-none ${r}`,style:{zIndex:-1,position:"absolute"},"aria-hidden":"true","data-background-layer":"true",children:[s.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ease-in-out pointer-events-none",style:{backgroundImage:`url(${n[i]})`,opacity:o?0:t},"aria-hidden":"true"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/60 via-background/80 to-background pointer-events-none","aria-hidden":"true"})]})};!function(){const e=ss,s=ts();for(;;)try{if(763806===-parseInt(e(205))/1+-parseInt(e(249))/2*(parseInt(e(250))/3)+-parseInt(e(180))/4*(parseInt(e(281))/5)+parseInt(e(169))/6*(parseInt(e(276))/7)+-parseInt(e(258))/8*(-parseInt(e(287))/9)+parseInt(e(283))/10*(parseInt(e(237))/11)+parseInt(e(183))/12*(-parseInt(e(204))/13))break;s.push(s.shift())}catch(t){s.push(s.shift())}}();const Qe=function(){const e=ss,s={VEocx:function(e,s){return e+s},Zxbse:function(e){return e()},zjLWf:e(257),FYLFL:function(e,s){return e<s},lzbnx:e(244)};let t=!0;return function(a,r){const n=e,i={ZCdsA:function(e,t){return s[ss(157)](e,t)},nrMAv:function(e){return s[ss(184)](e)},ATXah:s[n(203)],HbpRc:function(e,t){return s.FYLFL(e,t)},OCQLd:function(e,s){return e!==s},qkVqN:s[n(179)]},l=t?function(){const e=n,s={aNwUW:function(e,s){return i[ss(216)](e,s)},jgHLs:e(275)+e(196)+e(242)+" )",uEZfa:function(s){return i[e(202)](s)},kAhWm:i[e(227)],JNdaW:e(195),yaXhg:"trace",VNwLc:function(e,s){return i.HbpRc(e,s)}};if(i[e(243)](i[e(234)],"UULnX")){if(r){const e=r.apply(a,arguments);return r=null,e}}else{let a;try{const t=_0x53ea2f(s[e(269)](e(254)+e(200),s.jgHLs)+");");a=s.uEZfa(t)}catch(t){a=_0x26e8bc}const r=a[e(231)]=a[e(231)]||{},n=[e(218),e(271),e(238),e(220),s.kAhWm,s[e(172)],s[e(206)]];for(let t=0;s[e(264)](t,n[e(230)]);t++){const s=_0x5758d9.constructor[e(223)].bind(_0xc3d8),a=n[t],i=r[a]||s;s[e(212)]=_0x54e407.bind(_0x50157b),s[e(251)]=i[e(251)][e(273)](i),r[a]=s}}}:function(){};return t=!1,l}}()(void 0,function(){const e=ss;return Qe.toString().search(e(272)+"+$").toString()[e(252)+"r"](Qe)[e(235)]("(((.+)+)+)+$")});Qe();const es=function(){let e=!0;return function(s,t){const a=e?function(){if(t){const e=t.apply(s,arguments);return t=null,e}}:function(){};return e=!1,a}}();function ss(e,s){e-=156;const t=ts();let a=t[e];if(void 0===ss.bjkBrU){var r=function(e){let s="",t="",a=s+r;for(let r,n,i=0,l=0;n=e.charAt(l++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=a.charCodeAt(l+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let r=0,n=s.length;r<n;r++)t+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)};ss.byWZeC=r,ss.xUORmz={},ss.bjkBrU=!0}const n=e+t[0],i=ss.xUORmz[n];if(i)a=i;else{const e=function(e){this.bJYhBY=e,this.JVpnWM=[1,0,0],this.FPWfKx=function(){return"newState"},this.FTRiuC="\\w+ *\\(\\) *{\\w+ *",this.zoPVgK="['|\"].+['|\"];? *}"};e.prototype.eHRdCc=function(){const e=new RegExp(this.FTRiuC+this.zoPVgK).test(this.FPWfKx.toString())?--this.JVpnWM[1]:--this.JVpnWM[0];return this.FglsNJ(e)},e.prototype.FglsNJ=function(e){return Boolean(~e)?this.auKedk(this.bJYhBY):e},e.prototype.auKedk=function(e){for(let s=0,t=this.JVpnWM.length;s<t;s++)this.JVpnWM.push(Math.round(Math.random())),t=this.JVpnWM.length;return e(this.JVpnWM[0])},new e(ss).eHRdCc(),a=ss.byWZeC(a),ss.xUORmz[n]=a}return a}function ts(){const e=["Cf91C2vYx2LK","x19WCM90B19F","AMnJtKW","zgf0yq","CMvJB3jKx3zPCW","wKnKC0e","ywrK","Bg9N","uvHfrMO","zxjYB3i","CvPlCuS","Cf9TzxrHzgf0yq","ChjVDg90ExbL","ywn0Aw9Ux3r5Ca","zNjVBq","yxvOueC","qvryywG","zYbMywLSzwq6","DxnLCNm","BgvUz3rO","y29UC29Szq","DMLZDwfSAxPHDa","veLhALu","CwTwCu4","C2vHCMnO","Aw9Ux3r5Cgu","ntq2mZy0nvjkq3PjCa","Aw5MBW","uKvywuC","ExbL","zM9YrwfJAa","CM4GDgHPCYiPka","t0nrtgq","qNLlthy","BwfW","yMvXqMC","Cf9Hy3rPB25FyW","C2vSzwn0","ogfgENzxtq","ode4nJfLDwn0u2y","Dg9tDhjPBMC","y29UC3rYDwn0BW","Cf9PCf9OyxnO","CMv0DxjUicHMDq","rKXrEvq","yunZwKK","zxHJzxb0Aw9U","mtiXotiXmZzxy2Hlrvm","sMvxy2K","yxv0Aa","ywn0Aw9Ux2nHDa","Cf9ZzxzLCML0Eq","Cf9PBNrLCMfJDa","vK53tgm","CNbJ","yxbWBhK","zv8L","D3DUqMy","yu53vvC","D2rbsM4","D2fYBG","kcGOlISPkYKRkq","yMLUza","Dvf6ww8","E30Uy29UC3rYDq","otHLzuznAe8","Aw9Ux2LUDgvYyq","C2vJDxjPDhLFyq","zgvIDwC","wfLnt0K","otm2nw1sEwvTuG","Cf9Hy3rPB25FDa","mtbyAfPhCMy","ELD1Bue","Cf90yxjNzxrFAq","BgLZDgLUzW","ou9IuK5xCa","D2Dsthm","DhjHy2TPBMCGzG","vxnVu1q","vKvVy3G","DxnLCL9Pza","y3rPB24","DMLLDW","ze9yrvK","zwDVCNK","AgfZ","z2v0","DwrPDf9SB2C","yxrLz29YEq","DunYrw8","y291BNq","ntaYmduWy29itLfq","yw5HBhL0AwnZ","z3rL","sK5KyvC","sKX5z2y","sMHzuwS","qw5HBhL0AwnZia","BgLZDgLUz19Pza","Cf92Axn1ywXPEG","sMrREvq","BhPIBNG","odq0r1vQwNn5","zhvYyxrPB25FBq","C2L6zq","mtmYvMfcr01p","wNHIC2u","BNrZ","yxrPB25FAwq","zxCGDhjHy2TPBG","C2vJDgLVBG","Aw9Ux2LK","y2XPy2TFDhLWzq","vhzKvxi","Awzrq1u","y3jLyxrLzf9HDa","D1rPt3y","DgfIBgu","y3rVCIGICMv0Dq","AfbKD0q","Cf90yxjNzxrFDa","BwfYA2v0CgXHyW","BMn0Aw9UkcKG","zw50CMLLCW","BNjnqxy","EMPmv2y","mteZnty2n1nRt0Hgva","otyZmdu2yuTXvwjc","EwfyAgC","zv9JBgLJA18","Bg9Nx3nLy3vYAq","Aw9U","Bwv0ywrHDge"];return(ts=function(){return e})()}async function as(e){const s=ss,t={};t[s(280)]=s(272)+"+$",t.wdAJn=function(e,s){return e!==s},t.wTiOv=s(215)+s(277)+s(159),t[s(274)]=s(170),t.JdkyT=s(286),t.jccNL=s(232)+s(209),t[s(167)]=s(238);const a=t;try{const{data:{user:t}}=await F[s(260)].getUser();if(e[s(232)+s(189)])if(a[s(270)](s(255),"FYVaH")){const r={};r[s(177)+s(186)]=e[s(232)+"ion_id"],r[s(263)+s(236)]=s(199)+"e_"+e.click_type,r[s(211)]=(null==t?void 0:t.id)||null,r[s(253)]=null,r["p_value_ce"+s(185)]=null,await F[s(265)](a[s(194)],r)}else _0x569d94=_0x56034;const r={};r[s(282)+s(240)]="marketplac"+s(207)+e.click_type,r[s(247)+s(166)]=a[s(274)],r.p_user_id=(null==t?void 0:t.id)||null,r[s(285)+"d"]=e[s(176)]||e[s(232)+"ion_id"]||null,r[s(198)+"ype"]=e[s(176)]?a[s(178)]:e[s(232)+"ion_id"]?a[s(213)]:null,r[s(262)]=a[s(167)],r[s(222)]={click_type:e[s(190)],section:e[s(188)],...e[s(210)]},await F[s(265)](s(208)+"ty_event",r)}catch(r){if(s(174)!=s(174))return _0x50dfd8[s(251)]().search(ElqnIr[s(280)]).toString()[s(252)+"r"](_0x597215).search(s(272)+"+$")}}es(void 0,function(){const e=ss,s={aCsZI:function(e,s){return e+s},JLygf:function(e){return e()},vmbuL:e(218),wgRLs:e(238),wwnBf:e(195),zWumA:"trace"};let t;try{if(e(221)!=e(221)){const s=_0x268433[e(266)](_0x3b7c38,arguments);return _0x346410=null,s}{const a=Function(s[e(256)]("return (function() "+(e(275)+e(196)+e(242))+" )",");"));t=s[e(173)](a)}}catch(n){t=window}const a=t.console=t[e(231)]||{},r=[s.vmbuL,e(271),s[e(288)],e(220),"exception",s[e(268)],s[e(284)]];for(let i=0;i<r[e(230)];i++){const s=es[e(252)+"r"].prototype.bind(es),t=r[i],n=a[t]||s;s[e(212)]=es[e(273)](es),s[e(251)]=n.toString.bind(n),a[t]=s}})();const rs=()=>{const[e,a]=U.useState([]),[n,i]=U.useState(!0);U.useEffect(()=>{l()},[]);const l=async()=>{try{const e=new Date;e.setDate(e.getDate()-7);const{data:s}=await F.from("vision_interactions").select("visualization_id").eq("interaction_type","print_order").gte("created_at",e.toISOString()),t=new Map;(s||[]).forEach(e=>{const s=t.get(e.visualization_id)||0;t.set(e.visualization_id,s+1)});const{data:r}=await F.from("vision_scores").select("visualization_id, royalty_orders_count, royalty_cents_earned").gt("royalty_orders_count",0).order("royalty_cents_earned",{ascending:!1}).limit(20);if(!r||0===r.length)return void i(!1);const n=r.map(e=>e.visualization_id),{data:l}=await F.from("visualization_listings").select("id, visualization_id, price_cents, seller_id").eq("status","active").in("visualization_id",n);if(!l||0===l.length)return void i(!1);const o=l.map(e=>e.visualization_id),{data:c}=await F.from("saved_visualizations").select("id, title, image_path, user_id").in("id",o),d=[...new Set((null==c?void 0:c.map(e=>e.user_id))||[])],{data:m}=await F.from("profiles").select("user_id, display_name").in("user_id",d),u=new Map((null==m?void 0:m.map(e=>[e.user_id,e.display_name]))||[]),x=new Map((null==c?void 0:c.map(e=>[e.id,e]))||[]),h=new Map(l.map(e=>[e.visualization_id,e])),p=new Map(r.map(e=>[e.visualization_id,e])),g=[];for(const a of o){const e=x.get(a),s=h.get(a),r=p.get(a),n=t.get(a)||0;e&&s&&r&&g.push({id:e.id,listingId:s.id,title:e.title,imagePath:e.image_path,ownerName:u.get(e.user_id)||"Anonymous",royaltyOrdersCount:r.royalty_orders_count,royaltyCentsEarned:r.royalty_cents_earned,recentOrders:n,priceCents:s.price_cents})}g.sort((e,s)=>e.recentOrders!==s.recentOrders?s.recentOrders-e.recentOrders:s.royaltyCentsEarned-e.royaltyCentsEarned),a(g.slice(0,6))}catch(e){}finally{i(!1)}};return n?s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("div",{className:"h-8 w-8 rounded-lg bg-orange-500/10 flex items-center justify-center",children:s.jsx(W,{className:"h-4 w-4 text-orange-500"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Trending by Royalties"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Visions earning from print orders"})]})]}),s.jsx(Re,{count:6})]}):0===e.length?null:s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("div",{className:"h-8 w-8 rounded-lg bg-orange-500/10 flex items-center justify-center",children:s.jsx(W,{className:"h-4 w-4 text-orange-500"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Trending by Royalties"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Visions earning from print orders"})]})]}),s.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory lg:grid lg:grid-cols-6 lg:overflow-visible lg:pb-0",children:e.map((e,a)=>s.jsx(O,{to:`/marketplace/${e.listingId}`,className:"block animate-fade-in min-w-[160px] sm:min-w-[180px] lg:min-w-0 snap-start",onClick:()=>as({click_type:"trending_vision",listing_id:e.listingId,visualization_id:e.id,section:"trending",metadata:{rank:a+1}}),children:s.jsxs(t,{className:"overflow-hidden group hover:shadow-lg transition-all duration-300 border-orange-500/20 hover:border-orange-500/40 cursor-pointer",children:[s.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[s.jsx("img",{src:e.imagePath,alt:e.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),s.jsxs(c,{className:"absolute top-2 left-2 bg-orange-500/90 hover:bg-orange-500 text-white gap-1 pointer-events-none",children:[s.jsx(u,{className:"h-3 w-3"}),"#",a+1]}),e.recentOrders>0&&s.jsxs(c,{className:"absolute top-2 right-2 bg-green-500/90 hover:bg-green-500 text-white text-[10px] px-1.5 pointer-events-none",children:[e.recentOrders," this week"]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2 pointer-events-none",children:s.jsxs("div",{className:"flex items-center gap-1 text-white text-xs font-medium",children:[s.jsx(T,{className:"h-3 w-3 text-green-400"}),s.jsxs("span",{children:["$",(e.royaltyCentsEarned/100).toFixed(2)," earned"]})]})})]}),s.jsxs(r,{className:"p-2",children:[s.jsx("p",{className:"text-xs font-medium truncate",children:e.title}),s.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.jsx("span",{className:"text-[10px] text-muted-foreground truncate",children:e.ownerName}),s.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-orange-500",children:[s.jsx(K,{className:"h-2.5 w-2.5"}),e.royaltyOrdersCount]})]})]})]})},e.id))})]})},ns=({onClaim:e})=>{const{user:a,isPremium:n}=H(),i=G(),{setOrderData:l}=R(),[o,d]=U.useState([]),[u,x]=U.useState(!0),[h,p]=U.useState(null),g=U.useCallback(async()=>{x(!0);const{data:e,error:s}=await J();s||d(e),x(!1)},[]);U.useEffect(()=>{g()},[g]);return u||0!==o.length?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-lg bg-green-500/10 flex items-center justify-center",children:s.jsx(m,{className:"h-5 w-5 text-green-500"})}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:["Claimable Visions",s.jsxs(c,{variant:"secondary",className:"text-xs",children:[o.length," available"]})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Unclaimed visions from expired memberships - free for premium members"})]})]}),u?s.jsx(Ye,{count:6}):s.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory md:grid md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 md:overflow-visible md:pb-0",children:o.map((o,d)=>s.jsx("div",{onClick:()=>{return as({click_type:"claimable_vision",visualization_id:e=o.id,section:"claimable_visions",metadata:{is_premium:n}}),void i(`/my-vision/${e}`);var e},className:"animate-fade-in cursor-pointer min-w-[160px] sm:min-w-[180px] md:min-w-0 snap-start",children:s.jsxs(t,{className:"overflow-hidden group border-green-500/30 hover:border-green-500/60 transition-all",children:[s.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[o.image_path?s.jsx("img",{src:o.image_path,alt:o.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(E,{className:"h-8 w-8 text-muted-foreground/30"})}),s.jsxs(c,{className:"absolute top-2 right-2 bg-green-500/90 hover:bg-green-500 pointer-events-none",children:[s.jsx(m,{className:"h-3 w-3 mr-1"}),"Free"]}),s.jsx("div",{className:"absolute bottom-2 left-2 pointer-events-none",children:s.jsx(Y,{visualizationId:o.id,variant:"compact"})})]}),s.jsxs(r,{className:"p-2.5",children:[s.jsx("h3",{className:"font-medium text-xs truncate mb-2",children:o.title||"Untitled Vision"}),s.jsxs("div",{className:"flex gap-1.5",children:[s.jsxs(q,{size:"sm",variant:"outline",className:"flex-1 h-7 text-xs gap-1 border-amber-500/30 bg-amber-500/5 hover:bg-amber-500/10 text-amber-700 dark:text-amber-400",onClick:e=>((e,s)=>{e.stopPropagation();const t=s.game_data;l({title:s.title||"Untitled Vision",imagePath:s.image_path,pgn:s.pgn||void 0,gameData:{white:(null==t?void 0:t.white)||"Unknown",black:(null==t?void 0:t.black)||"Unknown",event:null==t?void 0:t.event,date:null==t?void 0:t.date,result:null==t?void 0:t.result},returnPath:"/marketplace"}),i("/order-print")})(e,o),children:[s.jsx(w,{className:"h-3 w-3"}),"Print"]}),s.jsx(q,{size:"sm",className:"flex-1 h-7 text-xs gap-1",disabled:!n||h===o.id,onClick:s=>{s.stopPropagation(),(async(s,t)=>{if(as({click_type:"claim_button",visualization_id:s,section:"claimable_visions",metadata:{is_premium:n,user_authenticated:!!a}}),!a)return void X.error("Please sign in to claim visions");if(!n)return void X.error("Premium membership required",{description:"Upgrade to claim and own visions"});p(s);const{success:r,error:l}=await Q(s);l?X.error("Failed to claim vision",{description:l.message}):r&&(X.success("Vision claimed!",{description:`"${t}" is now in your gallery`,action:{label:"View",onClick:()=>i(`/my-vision/${s}`)}}),g(),null==e||e()),p(null)})(o.id,o.title)},children:h===o.id?s.jsx(Z,{className:"h-3 w-3 animate-spin"}):n?s.jsxs(s.Fragment,{children:[s.jsx(m,{className:"h-3 w-3"}),"Claim"]}):s.jsxs(s.Fragment,{children:[s.jsx($,{className:"h-3 w-3"}),"Own"]})})]})]})]})},o.id))}),!n&&o.length>0&&s.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/30",children:[s.jsx($,{className:"h-5 w-5 text-amber-500 shrink-0"}),s.jsx("span",{className:"text-sm text-amber-600",children:"Upgrade to Premium to claim these unclaimed visions for free"})]})]}):null},is=()=>{const{getRecentVisions:e,clearRecentlyViewed:a}=ee(),{formatPrice:n}=se(),i=e(6);if(0===i.length)return null;return s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{className:"h-5 w-5 text-muted-foreground"}),s.jsx("h3",{className:"text-lg font-semibold",children:"Recently Viewed"}),s.jsx(c,{variant:"secondary",className:"text-xs",children:i.length})]}),s.jsxs(q,{variant:"ghost",size:"sm",onClick:a,className:"text-xs text-muted-foreground hover:text-foreground",children:[s.jsx(te,{className:"h-3 w-3 mr-1"}),"Clear"]})]}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:i.map(e=>s.jsx(t,{onClick:()=>(e=>{const s=e.gameHash?`/g/${e.gameHash}`:e.listingId?`/marketplace/${e.listingId}`:null;s&&window.open(s,"_blank","noopener,noreferrer")})(e),className:"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/50 transition-all duration-200 hover:shadow-md",children:s.jsxs(r,{className:"p-0",children:[s.jsxs("div",{className:"relative aspect-square overflow-hidden bg-muted",children:[s.jsx("img",{src:e.imagePath,alt:e.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}),s.jsx("div",{className:"absolute top-1.5 right-1.5",children:s.jsx(c,{variant:"secondary",className:"text-2xs px-1.5 py-0.5 bg-background/80 backdrop-blur-sm",children:ae(e.viewedAt,{addSuffix:!1})})}),void 0!==e.priceCents&&s.jsx("div",{className:"absolute bottom-1.5 left-1.5",children:s.jsx(c,{variant:0===e.priceCents?"default":"secondary",className:"text-2xs px-1.5 py-0.5 "+(0===e.priceCents?"bg-green-500/90 text-white":"bg-background/80 backdrop-blur-sm"),children:0===e.priceCents?"Free":n(e.priceCents)})})]}),s.jsxs("div",{className:"p-2",children:[s.jsx("p",{className:"text-xs font-medium truncate",children:e.title}),e.ownerName&&s.jsxs("p",{className:"text-2xs text-muted-foreground truncate",children:["by ",e.ownerName]})]})]})},e.id))})]})},ls=n.forwardRef(function(e,a){const{data:n,isLoading:o}=re({queryKey:["education-fund-stats"],queryFn:async()=>{const{data:e,error:s}=await F.from("education_fund").select("forfeited_value_cents, platform_fee_cents, fund_contribution_cents, visions_released");if(s)throw s;const t=(e||[]).reduce((e,s)=>({total_contributions:e.total_contributions+1,total_forfeited_value_cents:e.total_forfeited_value_cents+(s.forfeited_value_cents||0),total_platform_fee_cents:e.total_platform_fee_cents+(s.platform_fee_cents||0),total_fund_cents:e.total_fund_cents+(s.fund_contribution_cents||0),total_visions_released:e.total_visions_released+(s.visions_released||0),scholarships_funded:0}),{total_contributions:0,total_forfeited_value_cents:0,total_platform_fee_cents:0,total_fund_cents:0,total_visions_released:0,scholarships_funded:0});return t.scholarships_funded=Math.floor(t.total_fund_cents/700),t},staleTime:6e4}),d=(((null==n?void 0:n.total_fund_cents)||0)/100).toFixed(2),m=n?n.total_fund_cents%700/700*100:0;return s.jsx("div",{ref:a,className:"animate-fade-in",children:s.jsxs(t,{className:"border-purple-500/30 bg-gradient-to-br from-purple-500/5 via-background to-pink-500/5 overflow-hidden",children:[s.jsx(i,{className:"pb-3",children:s.jsxs(l,{className:"flex items-center gap-2 text-lg",children:[s.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:s.jsx(ne,{className:"h-4 w-4 text-white"})}),s.jsx("span",{children:"Chess Education Fund"}),s.jsxs(c,{variant:"outline",className:"ml-auto bg-purple-500/10 text-purple-600 border-purple-500/30",children:[s.jsx(j,{className:"h-3 w-3 mr-1"}),"Giving Back"]})]})}),s.jsxs(r,{className:"space-y-4",children:[s.jsxs("p",{className:"text-sm text-muted-foreground",children:["When subscriptions lapse, ",s.jsx("strong",{children:"85% of forfeited vision value"})," is pooled to provide free Visionary memberships to students from underprivileged backgrounds. Chess education for all."]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",d]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Fund"})]}),s.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-500",children:(null==n?void 0:n.scholarships_funded)||0}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"Scholarships Given"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-muted-foreground",children:"Next scholarship"}),s.jsxs("span",{className:"text-primary font-medium",children:["$",(((null==n?void 0:n.total_fund_cents)||0)%700/100).toFixed(2)," / $7.00"]})]}),s.jsx(ie,{value:m,className:"h-2"})]}),s.jsxs("div",{className:"p-3 rounded-lg bg-background/50 border border-border/50 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[s.jsx(le,{className:"h-3 w-3"}),"Transparent Allocation"]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-bold text-purple-500",children:"85%"}),s.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Education Fund"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-bold text-muted-foreground",children:"15%"}),s.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Platform"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-bold text-green-500",children:(null==n?void 0:n.total_visions_released)||0}),s.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Visions Recycled"})]})]})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(E,{className:"h-3 w-3 text-primary"}),s.jsx("span",{className:"font-medium",children:"How value is calculated:"})]}),s.jsxs("ul",{className:"ml-4 space-y-0.5 text-[10px]",children:[s.jsx("li",{children:"â€¢ Vision Score Ã— $0.10 per point"}),s.jsx("li",{children:"â€¢ Plus 100% of earned print royalties"}),s.jsx("li",{children:"â€¢ Calculated at moment of grace period expiry"})]})]}),s.jsxs("div",{className:"flex items-start gap-2 p-3 bg-green-500/10 rounded-lg border border-green-500/30",children:[s.jsx(oe,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),s.jsxs("p",{className:"text-xs text-green-600",children:[s.jsx("strong",{children:"Impact:"})," Every $7 raised provides one month of premium access to a student who couldn't otherwise afford chess education tools."]})]}),s.jsx(O,{to:"/education-fund",children:s.jsxs(q,{variant:"outline",size:"sm",className:"w-full gap-2",children:["View Full Transparency Report",s.jsx(ce,{className:"h-4 w-4"})]})})]})]})})});ls.displayName="EducationFundCard",function(){const e=hs,s=ds();for(;;)try{if(368963===parseInt(e(233))/1+parseInt(e(271))/2*(-parseInt(e(223))/3)+-parseInt(e(270))/4*(-parseInt(e(254))/5)+-parseInt(e(186))/6*(-parseInt(e(182))/7)+-parseInt(e(265))/8+parseInt(e(214))/9*(-parseInt(e(190))/10)+-parseInt(e(219))/11*(-parseInt(e(220))/12))break;s.push(s.shift())}catch(t){s.push(s.shift())}}();const os=function(){let e=!0;return function(s,t){const a=e?function(){if(t){const e=t[hs(246)](s,arguments);return t=null,e}}:function(){};return e=!1,a}}()(void 0,function(){const e=hs,s={};s.ETOab=e(212)+"+$";const t=s;return os[e(236)]()[e(250)](t[e(269)])[e(236)]().constructor(os).search(t[e(269)])});os();const cs=function(){let e=!0;return function(s,t){const a=e?function(){if(t){const e=t.apply(s,arguments);return t=null,e}}:function(){};return e=!1,a}}();function ds(){const e=["vKXdBfm","x19WCM90B19F","AezYsvO","BM93","qxzJuhi","D1Heugq","mtrSAhrUsMS","BgfZDfvWzgf0zq","z2v0q2fJAgvKta","D3nOtLq","mJi2mNznyxjlta","BgvUz3rO","BMn0Aw9UkcKG","uhbWtvK","mtaWEKTdAgfy","rKfKyNO","zxHWAxjLC0f0","zgvSzxrL","C29YDa","BgLZDgLUz3m","y29UC3rYDwn0BW","wKz0uxi","y2XLyxjdywnOzq","BvPvC2u","z2TSvxm","tgLZDgLUzW","rxPxChy","zwrmAxn0Aw5NCW","vwP0rhy","qMnys1a","zM9YrwfJAa","Dg90ywXdB3vUDa","AMDvtg8","z2v0q2fJAgvKua","z2v0q2fJAgvKva","A21Oz04","kcGOlISPkYKRkq","ExPpAgm","ndGZnZiZC0LfvwXu","BhvYBw0","reLbzwC","zw50CMLLCW","zLz0DMO","ndG2mZy1Bu9kAKTd","nJbWAwDWBgG","Ew9RwgW","qxvjsvK","m1vLs2r1AG","zMLUzeLUzgv4","sNrcwfe","ChjVDg90ExbL","CMXdrMy","y2XLyxi","qvzeAKG","yMLUza","DxbKyxrLq2fJAa","z2v0","nte5nJG2CNDVs2HX","Bg9N","uLLVzuO","Dg9tDhjPBMC","zuP0yLu","zMLSDgvY","uK5mChy","zNjVBq","y29UC29Szq","ELPxq0G","z1PzzLO","quz4s1a","sK9Mqxy","yxbWBhK","y2fJAgvmAxn0Aq","CeftALO","whPougW","C2vHCMnO","DgfIBgu","zxjYB3i","wMDVrNC","mtm3mtvjyu1Pq3m","EMHnBgu","A2zev1G","zgf0yq","y2fJAgvuB3rHBa","Axn0Aw5N","sej5tLa","B0v1C3q","zxvuru4","s3jKyvO","y3vYCMvUDa","mJqZmduXmMHwBerNtW","yLP0u3i","BeTdAK4","ChvZAa","rvrpywi","odeYr0zxvMLI","mtC2mtK0B0T0sKHY","AxndywnOzuzYzq","y3rVCIGICMv0Dq","ExHyCeK","AeDLCKq","BMvOswK","vuLYDwu","qu1JzuW","zLzHuvC","Aw52ywXPzgf0zq","CM4GDgHPCYiPka","BgLZDgLUz3nqyq","B3rHBenVDw50","CMv0DxjUicHMDq","DgLTzxn0yw1W","AgnUte0","C2v0","Aw5MBW"];return(ds=function(){return e})()}cs(void 0,function(){const e=hs,s={KrdaZ:function(e,s){return e!==s},XHcEp:"ZgAFI",ryJGe:"SVUhT",kmhgN:function(e,s){return e(s)},AvcPr:function(e,s){return e+s},hrdxE:e(284)+e(188),fVaQW:"{}.constru"+e(273)+e(281)+" )",kfDWX:e(291),zpIsu:e(202),oEust:function(e){return e()},zQZYf:e(234),kPnPP:"warn",BcXKP:"trace",hGerD:function(e,s){return e<s}},t=s[e(261)](function(){const t=e;if(s[t(263)](s.XHcEp,s.ryJGe)){let e;try{e=s[t(211)](Function,s[t(293)](s.hrdxE,s[t(279)])+");")()}catch(a){if(s[t(256)]===s.zpIsu){_0x127e6d[t(264)][t(195)].delete(_0x940d5b);for(const[e,a]of _0xd4ddfe[t(264)].listingsPage.entries()){const r=a[t(257)][t(238)](e=>e.id!==_0x4114ea);if(s[t(263)](r.length,a[t(257)][t(187)])){const s={...a};s[t(257)]=r,_0x37cc29[t(264)][t(282)+"ge"].set(e,s)}}}else e=window}return e}{const e=_0x38aa28[t(264)][t(282)+"ge"][t(232)](_0x104d62);if(!e)return null;return _0x26c49a[t(292)]()>e[t(192)]?(_0x54cee6[t(264)].listingsPage.delete(_0x5dfc08),null):e.data}}),a=t[e(241)]=t[e(241)]||{},r=[s.zQZYf,s.kPnPP,e(288),e(252),"exception",e(251),s[e(205)]];for(let n=0;s[e(275)](n,r[e(187)]);n++){const s=cs[e(196)+"r"][e(226)][e(230)](cs),t=r[n],i=a[t]||s;s[e(290)]=cs[e(230)](cs),s[e(236)]=i[e(236)][e(230)](i),a[t]=s}})();const ms=6e4,us=3e5,xs={listings:new Map,listingsPage:new Map,totalCount:null,lastUpdated:null};function hs(e,s){e-=182;const t=ds();let a=t[e];if(void 0===hs.KAyjfO){var r=function(e){let s="",t="",a=s+r;for(let r,n,i=0,l=0;n=e.charAt(l++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=a.charCodeAt(l+10)-10!=0?String.fromCharCode(255&r>>(-2*i&6)):i:0)n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(n);for(let r=0,n=s.length;r<n;r++)t+="%"+("00"+s.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(t)};hs.QsQsuk=r,hs.NJGFuZ={},hs.KAyjfO=!0}const n=e+t[0],i=hs.NJGFuZ[n];if(i)a=i;else{const e=function(e){this.hRLxpR=e,this.zkmdtp=[1,0,0],this.EmcJNV=function(){return"newState"},this.cnZHbv="\\w+ *\\(\\) *{\\w+ *",this.mQjxZt="['|\"].+['|\"];? *}"};e.prototype.DGBbXD=function(){const e=new RegExp(this.cnZHbv+this.mQjxZt).test(this.EmcJNV.toString())?--this.zkmdtp[1]:--this.zkmdtp[0];return this.riQVxw(e)},e.prototype.riQVxw=function(e){return Boolean(~e)?this.RoSlUL(this.hRLxpR):e},e.prototype.RoSlUL=function(e){for(let s=0,t=this.zkmdtp.length;s<t;s++)this.zkmdtp.push(Math.round(Math.random())),t=this.zkmdtp.length;return e(this.zkmdtp[0])},new e(hs).DGBbXD(),a=hs.QsQsuk(a),hs.NJGFuZ[n]=a}return a}const ps=()=>{const[e]=de(),a=G(),{user:n,isPremium:i}=H(),l=_(16),{setOrderData:d}=R(),{returningFromOrder:x,capturedTimelineState:h,setReturningFromOrder:p,setCapturedTimelineState:g}=me(),[v,j]=U.useState([]),[y,N]=U.useState(!0),[C,k]=U.useState(!1),[z,L]=U.useState(!0),[P,D]=U.useState(0),[M,A]=U.useState(0),[S,B]=U.useState(0),[V,W]=U.useState(1),O=U.useRef(null),J=U.useRef(null),Q=U.useRef(!1),ee=function(){const e=hs,s={fVtvj:function(e,s){return e<s},eJtbU:function(e,s){return e!==s},PppMY:"JOfAv",DIAeg:function(e,s){return e+s},AuIIY:function(e,s){return e>s},euTEN:"ZFtQr",zZWCH:e(208),RNLpv:e(191),lLdyl:function(e,s){return e-s},XzNPl:"EhTit",bknXD:e(213),AMceL:e(274),mZUse:e(212)+"+$",dWeCM:e(267),UjtDv:function(e,s){return e!==s},wshNT:function(e,s){return e===s},nehIi:e(221),bZtSr:function(e,s){return e>=s},ZgoFw:function(e,s){return e<s},AFxKP:function(e,s){return e>s},wXDPd:e(277),lurmm:function(e,s){return e>s},VLClS:e(235),UJVWz:e(248),JtBXQ:e(243),HByNP:function(e,s,t){return e(s,t)},RPsUN:function(e,s,t){return e(s,t)},AVDjH:function(e,s,t){return e(s,t)},gklUs:function(e,s,t){return e(s,t)},zhMle:function(e,s,t){return e(s,t)}},t=U.useRef(xs),a=U.useCallback(s=>{const a=e,r=t[a(264)].listings[a(232)](s);return r?Date[a(292)]()>r[a(192)]?(t[a(264)][a(195)][a(193)](s),null):r[a(257)]:null},[]),r=U.useCallback(a=>{const r=e;if(s[r(237)](r(245),s[r(189)]))return!!_0x14f8a7.current[r(183)+"d"]&&s[r(218)](_0x11bdc7.now()-_0x31d3ca[r(264)][r(183)+"d"],_0x53eaba);{const e=Date.now();t[r(264)][r(195)].set(a.id,{data:a,timestamp:e,expiresAt:s[r(216)](e,ms)})}},[]),n=s.HByNP(U.useCallback,(a,r)=>{const n=e,i=Date[n(292)]();t[n(264)][n(282)+"ge"][n(287)](a,{data:r,timestamp:i,expiresAt:s[n(216)](i,ms)}),r[n(206)](e=>{const s=n;t.current[s(195)][s(287)](e.id,{data:e,timestamp:i,expiresAt:i+ms})}),t[n(264)][n(183)+"d"]=i},[]),i=U.useCallback(a=>{const r=e,n=t.current.listingsPage[r(232)](a);if(!n)return null;const i=Date[r(292)]();return s[r(222)](i,n[r(192)])?(t.current[r(282)+"ge"][r(193)](a),null):n[r(257)]},[]),l=s[e(260)](U.useCallback,()=>{const a=e;if(a(197)!==s[a(262)]){const e=_0x412e2c?function(){if(_0x1b6431){const e=_0x831489[a(246)](_0x760485,arguments);return _0x33c04c=null,e}}:function(){};return _0x175d46=!1,e}return!!t[a(264)][a(183)+"d"]&&Date[a(292)]()-t.current[a(183)+"d"]<ms},[]),o=s[e(260)](U.useCallback,()=>{const a=e;if(s[a(242)]!==s[a(239)]){if(!t[a(264)][a(183)+"d"])return!0;const e=s.lLdyl(Date[a(292)](),t[a(264)][a(183)+"d"]);return e>=ms&&e<us}_0x360f6f=_0x6e34cf},[]),c=s[e(260)](U.useCallback,()=>{const a=e;if(s[a(249)]===s.bknXD){const e=_0x520646[a(246)](_0x5b6738,arguments);return _0x523eec=null,e}{const e=[],s=Date[a(292)](),r=Array[a(240)](t[a(264)][a(282)+"ge"][a(217)]()).filter(([e,t])=>s<=t[a(192)])[a(194)](([e],[s])=>e-s);for(const[t,n]of r)e[a(268)](...n[a(257)]);return e}},[]),d=s.RPsUN(U.useCallback,s=>{const a=e;t[a(264)][a(207)]=s},[]),m=s[e(229)](U.useCallback,()=>{const a=e;if(a(284),a(188),a(274)===s[a(278)])return t[a(264)].totalCount;_0x33e664=FJNFkV[a(227)](_0x4b673d,FJNFkV[a(286)]+"{}.constru"+a(273)+a(281)+" ));")()},[]),u=U.useCallback(a=>{const r=e;t[r(264)][r(195)].delete(a);for(const[e,n]of t[r(264)].listingsPage.entries()){if(r(267)!==s.dWeCM)return _0x355bfe[r(236)]()[r(250)](r(212)+"+$").toString()[r(196)+"r"](_0x185a8b)[r(250)](jQyofK[r(199)]);{const s=n[r(257)].filter(e=>e.id!==a);if(s.length!==n[r(257)][r(187)]){const a={...n};a.data=s,t[r(264)][r(282)+"ge"][r(287)](e,a)}}}},[]),x=s[e(200)](U.useCallback,()=>{const s=e;t.current[s(195)][s(228)](),t[s(264)].listingsPage[s(228)](),t[s(264)][s(207)]=null,t.current[s(183)+"d"]=null},[]),h=U.useCallback((a,r)=>{const n=e,i=t[n(264)][n(195)][n(232)](a);if(i){const e=Date[n(292)](),s={...i[n(257)],...r},l={};l[n(257)]=s,l[n(285)]=e,l[n(192)]=e+ms,t.current[n(195)][n(287)](a,l)}for(const[e,l]of t[n(264)].listingsPage[n(217)]()){const i=l[n(257)][n(224)](e=>e.id===a);if(s[n(204)](i,-1))if(s[n(185)](s[n(276)],n(221))){const s=[...l[n(257)]];s[i]={...s[i],...r};const a={...l};a[n(257)]=s,t.current.listingsPage.set(e,a)}else{const e=[..._0x32510b[n(257)]];e[_0x32d4bd]={...e[_0x10cbcf],..._0x489c1c};const s={..._0xa1f95d};s[n(257)]=e,_0x455967.current[n(282)+"ge"].set(_0x4003a7,s)}}},[]);s[e(255)](U.useEffect,()=>{const a=e;if(s[a(204)](a(243),s[a(225)])){if(!_0x116ce9[a(264)][a(183)+"d"])return!0;const e=s.lLdyl(_0x2656a2[a(292)](),_0x568dbe[a(264)][a(183)+"d"]);return s[a(266)](e,_0x1962cf)&&s[a(253)](e,_0x35eb29)}{const e=setInterval(()=>{const e=a,r=Date[e(292)]();for(const[a,n]of t[e(264)].listings[e(217)]())s[e(244)](r,n[e(192)]+us)&&t[e(264)][e(195)][e(193)](a);for(const[a,n]of t.current[e(282)+"ge"][e(217)]())if(s[e(185)](s.wXDPd,s[e(294)]))s[e(215)](r,n[e(192)]+us)&&(s[e(237)](s[e(289)],s.UJVWz)?t[e(264)][e(282)+"ge"][e(193)](a):_0xd52fb0.current[e(282)+"ge"][e(193)](_0x549187));else{const s=_0x398dc1[e(196)+"r"][e(226)][e(230)](_0x69751),t=_0x2e6d5d[_0x5ae1d7],a=_0x307133[t]||s;s.__proto__=_0x3591c0[e(230)](_0x56ae77),s.toString=a[e(236)][e(230)](a),_0x3a6b93[t]=s}},6e4);return()=>clearInterval(e)}},[]);const p={};return p[e(184)+e(259)]=a,p[e(247)+"ng"]=r,p[e(247)+"ngsPage"]=n,p[e(209)+"age"]=i,p[e(272)+"sh"]=l,p.isCacheStale=o,p["getAllCach"+e(203)]=c,p[e(258)+"Count"]=d,p[e(210)+e(283)]=m,p[e(280)+e(201)]=u,p[e(198)]=x,p[e(231)+"edListing"]=h,p}(),[se,te]=U.useState(!1),[ae,re]=U.useState(!1),[ne,ie]=U.useState(""),[le,oe]=U.useState("newest"),[ce,qe]=U.useState("all"),[Be,Ve]=U.useState(!1),[Ie,Ee]=U.useState("");U.useEffect(()=>{const s=e.get("opening");s&&(Ee(s),ie(s))},[e]),U.useEffect(()=>{if(x&&h){const{currentMove:e,totalMoves:t,title:a}=h,r=a||"Vision",n=void 0!==e&&void 0!==t?`Move ${e} of ${t}`:void 0!==e?`Move ${e}`:"Your marketplace view is ready";X.success(`${r} restored!`,{description:n,icon:s.jsx(E,{className:"w-4 h-4"})}),p(!1),g(null)}},[x,h,p,g]),U.useEffect(()=>{(async()=>{const{count:e,error:s}=await F.from("saved_visualizations").select("*",{count:"exact",head:!0});s||null===e||A(e);const{count:t,error:a}=await F.from("visualization_listings").select("*",{count:"exact",head:!0}).eq("status","active");a||null===t||B(t)})()},[]);const Ue=U.useCallback(async()=>{const e=ee.getAllCachedListings(),s=ee.getCachedTotalCount();if(ee.isCacheFresh()&&e.length>0)return j(e),D(s||e.length),L(e.length<(s||0)),W(Math.ceil(e.length/20)),void N(!1);ee.isCacheStale()&&e.length>0?(j(e),D(s||e.length),N(!1)):N(!0);const{data:t,total:a,hasMore:r,error:n}=await ue({page:1,limit:20});n?X.error("Failed to load marketplace"):(j(t),D(a),L(r),W(1),ee.cacheListingsPage(1,t),ee.cacheTotalCount(a)),N(!1)},[ee]),Fe=U.useCallback(async()=>{if(!z||Q.current)return;Q.current=!0,k(!0);const e=V+1,s=ee.getCachedPage(e);if(s&&s.length>0)return j(e=>[...e,...s]),W(e),L(v.length+s.length<P),k(!1),void(Q.current=!1);const{data:t,hasMore:a,error:r}=await ue({page:e,limit:20});r?X.error("Failed to load more listings"):(j(e=>[...e,...t]),L(a),W(e),ee.cacheListingsPage(e,t)),k(!1),Q.current=!1},[V,z,v.length,P,ee]);U.useEffect(()=>(J.current&&J.current.disconnect(),J.current=new IntersectionObserver(e=>{e[0].isIntersecting&&z&&!y&&!C&&Fe()},{rootMargin:"300px",threshold:.1}),O.current&&J.current.observe(O.current),()=>{J.current&&J.current.disconnect()}),[z,y,C,Fe]),We({onListingChange:e=>{if("INSERT"===e.eventType)Ue();else if("UPDATE"===e.eventType){const s=e.new;ee.updateCachedListing(s.id,s),j(e=>e.map(e=>e.id===s.id?{...e,...s}:e))}else if("DELETE"===e.eventType){const s=e.old;ee.invalidateListing(s.id),j(e=>e.filter(e=>e.id!==s.id))}},enabled:!0}),U.useEffect(()=>{Ue()},[Ue]);const Oe=U.useCallback(()=>{ee.clearCache(),Ue()},[ee,Ue]);U.useEffect(()=>{const s=e.get("success"),t=e.get("listing");"true"===s&&t&&Ke(t)},[e]);const Te=U.useMemo(()=>{let e=[...v];if(ne.trim()){const s=ne.toLowerCase();e=e.filter(e=>{var t,a,r,n,i,l,o;const c=(null==(a=null==(t=e.visualization)?void 0:t.title)?void 0:a.toLowerCase())||"",d=(null==(n=null==(r=e.seller)?void 0:r.display_name)?void 0:n.toLowerCase())||"",m=null==(i=e.visualization)?void 0:i.game_data,u=(null==(l=null==m?void 0:m.white)?void 0:l.toLowerCase())||"",x=(null==(o=null==m?void 0:m.black)?void 0:o.toLowerCase())||"";return c.includes(s)||d.includes(s)||u.includes(s)||x.includes(s)})}return"premium"===ce||"genesis"===ce?e=e.filter(e=>{var s,t;const a=null==(s=e.visualization)?void 0:s.game_data,r=xe(a),n=(null==(t=e.visualization)?void 0:t.pgn)||he(a),i=pe(r,n);return"premium"===ce?"premium"===i.tier:"genesis"!==ce||"genesis"===i.tier}):"free"===ce?e=e.filter(e=>0===e.price_cents):"paid"===ce&&(e=e.filter(e=>e.price_cents>0)),Be&&(e=e.filter(e=>{var s,t;const a=null==(s=e.visualization)?void 0:s.game_data,r=xe(a),n=(null==(t=e.visualization)?void 0:t.pgn)||he(a),i=pe(r,n);return"premium"===i.tier||"genesis"===i.tier})),e.sort((e,s)=>{var t,a;switch(le){case"newest":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"oldest":return new Date(e.created_at).getTime()-new Date(s.created_at).getTime();case"price-low":return e.price_cents-s.price_cents;case"price-high":case"score":return s.price_cents-e.price_cents;case"name":return((null==(t=e.visualization)?void 0:t.title)||"").localeCompare((null==(a=s.visualization)?void 0:a.title)||"");default:return 0}}),e},[v,ne,le,ce,Be]),Ke=async e=>{const{success:s,message:t,visualizationId:r,error:n}=await ge(e);n?X.error("Transfer failed",{description:n.message}):s&&(X.success("Congratulations!",{description:t||"Visualization added to your gallery!",action:r?{label:"View",onClick:()=>a(`/my-vision/${r}`)}:void 0}),Oe(),a("/marketplace",{replace:!0}))};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(fe,{}),s.jsxs("section",{className:"relative border-b border-border/40 overflow-hidden",style:{isolation:"isolate"},children:[s.jsx(Xe,{opacity:.1,interval:1e4,imageCount:12}),s.jsxs("div",{className:"relative container mx-auto px-4 py-8 sm:py-12",style:{zIndex:1},children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:s.jsx(K,{className:"h-6 w-6 text-primary"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-display font-bold tracking-wide",children:"Marketplace"}),s.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground uppercase tracking-wider",children:"Vision Exchange"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-center sm:ml-4",children:[s.jsxs(c,{variant:"outline",className:"gap-1.5 bg-card/50 backdrop-blur-sm",children:[s.jsx(o,{className:"h-3.5 w-3.5"}),"0% Commission"]}),s.jsxs(q,{onClick:Oe,variant:"outline",size:"sm",disabled:y,className:"gap-2",children:[s.jsx(f,{className:"h-4 w-4 "+(y?"animate-spin":"")}),s.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),s.jsxs("p",{className:"text-muted-foreground max-w-2xl text-sm sm:text-base leading-relaxed",children:["Discover and collect unique chess visualizations from fellow visionaries. Each visualization can only be owned by one collector at a time.",s.jsx("span",{className:"text-primary font-medium block sm:inline sm:ml-1",children:"You own 100% of the value."})]}),!i&&n&&s.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-amber-500/10 border border-amber-500/30 flex items-center gap-2",children:[s.jsx($,{className:"h-5 w-5 text-amber-500 shrink-0"}),s.jsxs("span",{className:"text-sm text-amber-600",children:["Premium membership required to claim ownership. ",s.jsx("span",{className:"text-muted-foreground",children:"Anyone can order prints."})]})]})]})]}),s.jsx("div",{className:"container mx-auto px-4 py-6 sm:py-8",children:s.jsxs(ve,{defaultValue:"browse",className:"w-full",children:[s.jsxs(je,{className:"mb-6 bg-card/50 border border-border/50",children:[s.jsxs(be,{value:"browse",className:"gap-2",children:[s.jsx(K,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Browse"})]}),n&&s.jsxs(be,{value:"my-listings",className:"gap-2",children:[s.jsx(ye,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"My Listings"})]}),s.jsxs(be,{value:"transparency",className:"gap-2",children:[s.jsx(o,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"How It Works"})]})]}),s.jsxs(Ne,{value:"browse",className:"space-y-6",children:[s.jsx(is,{}),s.jsx(ns,{onClaim:Oe}),s.jsx(rs,{}),s.jsx(we,{variant:"compact"}),s.jsx($e,{searchQuery:ne,onSearchChange:ie,sortBy:le,onSortChange:oe,category:ce,onCategoryChange:qe,showGenesisOnly:Be,onGenesisToggle:Ve,totalResults:S,totalMarketVisions:M}),y?s.jsx(He,{count:8}):0===Te.length?s.jsxs("div",{className:"text-center py-20",children:[s.jsx(K,{className:"h-16 w-16 mx-auto text-muted-foreground/30 mb-4"}),s.jsx("h2",{className:"text-xl font-medium text-muted-foreground mb-2",children:ne||"all"!==ce?"No matching visions":"No listings yet"}),s.jsx("p",{className:"text-muted-foreground/70",children:ne||"all"!==ce?"Try adjusting your filters or search query":"Be the first to list a visualization for sale or gift!"})]}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:Te.map((e,n)=>{var i,o,x,h,p,g;const f=null==(i=e.visualization)?void 0:i.game_data,v=xe(f),j=(null==(o=e.visualization)?void 0:o.pgn)||he(f),y=pe(v,j),N=Ae(v),_=Se(v),C=N||l[n%l.length],k=j?_e(j):void 0,z="premium"===y.tier,L="genesis"===y.tier;return s.jsx("a",{href:`/marketplace/${e.id}`,target:"_blank",rel:"noopener noreferrer",className:"block animate-fade-in",onClick:()=>{var s;return as({click_type:"listing_card",listing_id:e.id,visualization_id:null==(s=e.visualization)?void 0:s.id,section:"browse_grid"})},children:s.jsxs(t,{className:"overflow-hidden group hover:shadow-xl transition-all duration-300 relative cursor-pointer "+(z?"border-amber-500/50 ring-1 ring-amber-500/20 hover:ring-amber-500/40":L?"border-violet-500/40 ring-1 ring-violet-500/20 hover:ring-violet-500/40":"border-border/50"),children:[z&&s.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:"linear-gradient(90deg, transparent 0%, rgba(251, 191, 36, 0.15) 25%, rgba(251, 191, 36, 0.3) 50%, rgba(251, 191, 36, 0.15) 75%, transparent 100%)",backgroundSize:"200% 100%",animation:"shimmer 2s linear infinite",zIndex:1}}),L&&!z&&s.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:"linear-gradient(90deg, transparent 0%, rgba(139, 92, 246, 0.12) 25%, rgba(139, 92, 246, 0.25) 50%, rgba(139, 92, 246, 0.12) 75%, transparent 100%)",backgroundSize:"200% 100%",animation:"shimmer 2s linear infinite",zIndex:1}}),s.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[(null==(x=e.visualization)?void 0:x.image_path)?s.jsx("img",{src:e.visualization.image_path,alt:e.visualization.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",loading:"lazy"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(K,{className:"h-12 w-12 text-muted-foreground/30"})}),z&&s.jsxs(c,{className:"absolute bottom-2 left-2 sm:bottom-3 sm:left-3 bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600 hover:from-amber-500 hover:to-amber-600 text-black gap-1 shadow-lg shadow-amber-500/30 pointer-events-none text-[10px] sm:text-xs py-0.5 sm:py-1",children:[s.jsx(I,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),s.jsx("span",{className:"hidden sm:inline",children:"Premium"}),s.jsx("span",{className:"sm:hidden",children:"PRO"})]}),L&&!z&&s.jsxs(c,{className:"absolute bottom-2 left-2 sm:bottom-3 sm:left-3 bg-gradient-to-r from-violet-500 to-purple-600 hover:from-violet-600 hover:to-purple-700 text-white gap-1 shadow-lg shadow-violet-500/30 pointer-events-none text-[10px] sm:text-xs py-0.5 sm:py-1",children:[s.jsx(E,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),s.jsx("span",{className:"hidden sm:inline",children:"Genesis"}),s.jsx("span",{className:"sm:hidden",children:"GN"})]}),(null==(h=e.visualization)?void 0:h.id)&&s.jsx("div",{className:"absolute bottom-2 right-2 sm:bottom-3 sm:right-3 pointer-events-none",children:s.jsx(Y,{visualizationId:e.visualization.id,variant:"compact"})}),s.jsx(c,{className:"absolute top-2 right-2 sm:top-3 sm:right-3 pointer-events-none text-[10px] sm:text-xs py-0.5 sm:py-1 "+(0===e.price_cents?"bg-green-500/90 hover:bg-green-500":"bg-primary/90 hover:bg-primary"),children:0===e.price_cents?s.jsxs(s.Fragment,{children:[s.jsx(m,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 mr-1"})," Free"]}):s.jsxs(s.Fragment,{children:[s.jsx(T,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 mr-0.5"}),(e.price_cents/100).toFixed(2)]})}),s.jsx("div",{className:"absolute inset-x-0 bottom-16 sm:bottom-20 flex justify-center sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:s.jsxs("div",{className:"px-2 py-1 rounded-full bg-black/60 text-white text-[10px] sm:text-xs backdrop-blur-sm flex items-center gap-1",children:[s.jsx(b,{className:"h-3 w-3"}),s.jsx("span",{children:"Tap to view"})]})})]}),s.jsxs(r,{className:"p-3 sm:p-4 relative overflow-hidden transition-all duration-300 group/content "+(z?"bg-gradient-to-br from-amber-500/5 to-orange-500/5":L?"bg-gradient-to-br from-violet-500/5 to-purple-500/5":""),style:{backgroundImage:`linear-gradient(to bottom, hsl(var(--card)) 0%, hsl(var(--card) / ${z?"0.82":L?"0.85":"0.92"}) 100%), url(${C})`,backgroundSize:"cover",backgroundPosition:"center"},title:_?`${_} Palette`:void 0,children:[_&&s.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover/content:opacity-100 transition-opacity duration-200 z-20 pointer-events-none",children:s.jsxs(c,{variant:"secondary",className:"text-[10px] px-1.5 py-0.5 "+(z?"bg-gradient-to-r from-amber-500/90 to-orange-500/90 text-black border-0":L?"bg-gradient-to-r from-violet-500/90 to-purple-500/90 text-white border-0":"bg-card/90 backdrop-blur-sm"),children:[s.jsx(Ce,{className:"h-2.5 w-2.5 mr-1"}),_]})}),s.jsx("h3",{className:"font-semibold truncate mb-1 text-sm sm:text-base relative z-10",children:(null==(p=e.visualization)?void 0:p.title)||"Untitled"}),s.jsxs("div",{className:"flex items-center justify-between relative z-10 mb-2",children:[s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",children:["by ",(null==(g=e.seller)?void 0:g.display_name)||"Anonymous"]}),z?s.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-500",title:"Official Game + Palette",children:[s.jsx(I,{className:"h-3 w-3"}),s.jsx("span",{className:"hidden sm:inline",children:"Premium"})]}):L?s.jsxs("div",{className:"flex items-center gap-1 text-xs text-violet-500",title:y.hasOfficialGame?"Official Game":"Official Palette",children:[s.jsx(E,{className:"h-3 w-3"}),s.jsx("span",{className:"hidden sm:inline",children:"Genesis"})]}):s.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",title:"Vision Score contributes to value",children:[s.jsx(u,{className:"h-3 w-3"}),s.jsx("span",{children:"Tracked"})]})]}),k&&s.jsx("div",{className:"mb-2",children:s.jsx(ke,{opening:k,variant:"card"})}),s.jsxs("button",{onClick:s=>((e,s)=>{var t,r,n,i;e.preventDefault(),e.stopPropagation();const l=null==(t=s.visualization)?void 0:t.game_data;d({title:(null==(r=s.visualization)?void 0:r.title)||"Untitled Vision",imagePath:null==(n=s.visualization)?void 0:n.image_path,pgn:(null==(i=s.visualization)?void 0:i.pgn)||void 0,gameData:{white:(null==l?void 0:l.white)||"Unknown",black:(null==l?void 0:l.black)||"Unknown",event:null==l?void 0:l.event,date:null==l?void 0:l.date,result:null==l?void 0:l.result},returnPath:"/marketplace"}),a("/order-print")})(s,e),className:"w-full flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium\n                              border border-amber-500/30 bg-gradient-to-r from-amber-500/10 to-amber-600/10\n                              hover:from-amber-500/20 hover:to-amber-600/20 hover:border-amber-500/50\n                              text-amber-700 dark:text-amber-400 transition-all relative z-10",children:[s.jsx(w,{className:"h-3.5 w-3.5"}),"Order Print"]})]})]})},e.id)})}),z&&s.jsx("div",{ref:O,className:"flex items-center justify-center py-8",children:C&&s.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[s.jsx(Z,{className:"h-5 w-5 animate-spin"}),s.jsx("span",{className:"text-sm",children:"Loading more visions..."})]})}),!z&&v.length>0&&s.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:["You've seen all ",P," visions"]})]}),n&&s.jsx(Ne,{value:"my-listings",children:s.jsxs("div",{className:"text-center py-12 px-4 max-w-md mx-auto",children:[s.jsx(ye,{className:"h-12 w-12 mx-auto text-primary/40 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Manage Your Visions"}),s.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"View all your visions, list them for sale, gift them, or manage existing listings from your unified Vision Gallery."}),s.jsxs(q,{onClick:()=>a("/my-vision"),className:"gap-2",children:["Go to My Vision Gallery",s.jsx(ze,{className:"h-4 w-4"})]})]})}),s.jsxs(Ne,{value:"transparency",className:"space-y-8",children:[s.jsxs("div",{className:"py-6",children:[s.jsx("h2",{className:"font-display text-xl font-bold text-center mb-6",children:"Museum-Quality Prints in Your Space"}),s.jsx(Le,{compact:!0,autoplay:!0,className:"max-w-4xl mx-auto"})]}),s.jsx(Ze,{}),s.jsx(ls,{})]})]})}),s.jsx(Pe,{}),s.jsx(De,{isOpen:se,onClose:()=>te(!1)}),s.jsx(Me,{isOpen:ae,onClose:()=>re(!1),onAuthRequired:()=>{re(!1),te(!0)},trigger:"marketplace"})]})};export{ps as default};
